{"version":3,"file":"index.233a55a6.js","sources":["../../vite/modulepreload-polyfill","../../src/xpra/types.ts","../../src/xpra/constants.ts","../../src/xpra/errors.ts","../../src/xpra/io/ws.ts","../../src/xpra/utils/data.ts","../../src/xpra/io/audio.ts","../../src/xpra/utils/browser.ts","../../src/xpra/io/keyboard.ts","../../src/xpra/io/mouse.ts","../../src/xpra/io/clipboard.ts","../../src/xpra/io/logger.ts","../../src/xpra/connection/options.ts","../../src/xpra/connection/auth.ts","../../src/xpra/connection/worker.ts","../../src/xpra/utils/image.ts","../../src/xpra/utils/xdg.ts","../../src/xpra/connection/capabilities.ts","../../src/xpra/connection/client.ts","../../src/xpra/io/render.ts","../../src/xpra/wm.ts","../../src/ui/utils.ts","../../src/ui/store.ts","../../src/ui/context.tsx","../../src/ui/transitions.tsx","../../src/ui/cursor.png","../../src/ui/desktop.tsx","../../src/ui/inputs.tsx","../../src/ui/panels.tsx","../../src/ui/App.tsx","../../src/main.ts"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nexport interface XpraCommonCapability {\n  digest: string[]\n  'salt-digest': string[]\n  flush: boolean\n  zlib: boolean\n  rencode: boolean\n  bencode: boolean\n  yaml: boolean\n  platform: string\n  'platform.name': string\n  'platform.processor': string\n  'platform.platform': string\n  'build.revision': string\n  'build.local_modifications': number\n  'build.branch': string\n  version: string\n  uuid: string\n  bell: boolean\n  cursors: boolean\n  desktop_size: XpraVector\n  display: string\n  windows: boolean\n  keyboard: boolean\n  notifications: boolean\n  'notifications.close': boolean\n  'notifications.actions': boolean\n  clipboard: boolean\n  'clipboard.contents-slice-fix': boolean\n  'clipboard.preferred-targets': string[]\n  'file-transfer': boolean\n  'file-size-limit': number\n  printing: boolean\n  'open-url': boolean\n  'xdg-menu-update': boolean\n  'connection-data': Record<string, string | number>\n  'ping-echo-sourceid': boolean\n  encoding: XpraPacketEncoder\n  auto_refresh_delay: number\n}\n\nexport interface XpraBaseCapability {\n  'session-type': string\n  'session-type.full': string\n  namespace: boolean\n  share: boolean\n  steal: boolean\n  client_type: string\n  'websocket.multi-packet': boolean\n  'setting-change': boolean\n  username: string\n  argv: string[]\n  compression_level: number\n  'mouse.show': boolean\n  rencodeplus: boolean\n  vrefresh: number\n  'bandwidth-limit': number\n  lz4: boolean\n  'encoding.rgb_lz4': boolean\n  brotli: boolean\n  'start-new-session'?: Partial<XpraStartNewSession>\n  randr_notify: boolean\n  'sound.server_driven': boolean\n  'server-window-resize': boolean\n  'screen-resize-bigger': boolean\n  'metadata.supported': string[]\n  'window.pre-map': boolean\n  xkbmap_layout: string\n  xkbmap_keycodes: XpraXkbpMapKeycode[]\n  xkbmap_print: string\n  xkbmap_query: string\n  desktop_mode_size: XpraVector\n  screen_sizes: XpraScreen[]\n  dpi: number\n  'clipboard.want_targets': boolean\n  'clipboard.greedy': boolean\n  'clipboard.selections': XpraClipboardSelection[]\n  notifications: boolean\n  'notifications.close': boolean\n  'notifications.actions': boolean\n  system_tray: boolean\n  named_cursors: boolean\n  challenge_response?: string\n  challenge_client_salt?: string\n}\n\nexport interface XpraCipherCapability {\n  cipher?: boolean\n  'cipher.mode'?: string\n  'cipher.iv'?: string\n  'cipher.key_salt'?: string\n  'cipher.key_size'?: number\n  'cipher.key_hash'?: string\n  'cipher.key_stretch_iterations'?: number\n  'cipher.padding.options'?: string[]\n  'cipher.key_stretch'?: string\n}\n\nexport interface XpraSoundCapability {\n  'sound.receive': boolean\n  'sound.send': boolean\n  'sound.decoders': string[]\n  'sound.bundle-metadata': boolean\n}\nexport interface XpraEncodingCapability {\n  encodings: XpraDrawEncoding[]\n  'encoding.scrolling': boolean\n  'encoding.icons.max_size': XpraVector\n  'encodings.core': XpraDrawEncoding[]\n  'encodings.rgb_formats': XpraRGBFormats[]\n  'encodings.window-icon': string[]\n  'encodings.cursor': string[]\n  'encoding.flush': boolean\n  'encoding.transparency': boolean\n  //'encoding.scrolling.min-percent': number\n  'encoding.decoder-speed': { video: number }\n  'encodings.packet': boolean\n  //'encoding.min-speed': number\n  //'encoding.min-quality': number\n  'encoding.color-gamut': string\n  //'encoding.non-scroll': string[]\n  'encoding.video_scaling': boolean\n  'encoding.video_max_size': XpraVector\n  'encoding.eos': boolean\n  'encoding.full_csc_modes': Record<string, string[]>\n  'encoding.x264.YUV420P.profile': string\n  'encoding.h264.YUV420P.profile': string\n  'encoding.h264.YUV420P.level': string\n  'encoding.h264.cabac': boolean\n  'encoding.h264.deblocking-filter': boolean\n  'encoding.h264.fast-decode': boolean\n  'encoding.h264+mp4.YUV420P.profile': string\n  'encoding.h264+mp4.YUV420P.level': string\n  'encoding.h264.score-delta': number\n  'encoding.h264+mp4.score-delta': number\n  'encoding.h264+mp4.': number\n  //'encoding.h264+mp4.fast-decode': boolean\n  'encoding.mpeg4+mp4.score-delta': number\n  //'encoding.mpeg4+mp4.fast-decode': boolean\n  'encoding.vp8+webm.score-delta': number\n  'encoding.rgb_zlib': boolean\n}\n\nexport interface XpraServerBaseCapability extends XpraCommonCapability {\n  compressors: string[]\n  encoders: XpraCompressor[]\n  'zlib.python-zlib': boolean\n  'zlib.python-zlib.version': string\n  'lz4.version': string\n  'lz4.python-lz4': boolean\n  'lz4.python-lz4.version': boolean\n  none: boolean\n  'none.version': string\n  'rencode.version': string\n  'bencode.version': string\n  'yaml.version': string\n  'platform.linux_distribution': string\n  'platform.release': string\n  'platform.sysrelease': string\n  'platform.machine': string\n  'platform.architecture': string\n  'build.version': string\n  'build.commit': string\n  'build.date': string\n  'build.time': string\n  'build.bit': string\n  'build.cpu': string\n  'build.compiler': string\n  'build.linker': string\n  'build.python': string\n  'build.cython': string\n  'build.lib.gobject_introspection': string\n  'build.lib.gtk': string\n  'build.lib.gtk_x11': string\n  'build.lib.nvenc': string\n  'build.lib.nvfbc': string\n  'build.lib.py3cairo': string\n  'build.lib.pygobject': string\n  'build.lib.python3': string\n  'build.lib.vpx': string\n  'build.lib.x11': string\n  'build.lib.x264': string\n  'build.lib.x265': string\n  'build.lib.xcomposite': string\n  'build.lib.xdamage': string\n  'build.lib.xext': string\n  'build.lib.xfixes': string\n  'build.lib.xkbfile': string\n  'build.lib.xrandr': string\n  'build.lib.xtst': string\n  pid: number\n  byteorder: string\n  'python.bits': number\n  'python.full_version': string\n  'python.version': string\n  hostname: string\n  uid: number\n  gid: number\n  start_time: number\n  current_time: number\n  elapsed_time: number\n  server_type: string\n  'server.mode': string\n  'readonly-server': boolean\n  readonly: boolean\n  'server-log': string\n  machine_id: string\n  session_name: string\n  key_repeat: number[]\n  key_repeat_modifiers: boolean\n  'xdg-menu': boolean\n  subcommands: string[]\n  opengl: boolean\n  max_desktop_size: XpraVector\n  'client-shutdown': boolean\n  sharing: boolean\n  'sharing-toggle': boolean\n  lock: boolean\n  'lock-toggle': boolean\n  pointer: boolean\n  toggle_keyboard_sync: boolean\n  webcam: boolean\n  'webcam.encodings': string[]\n  'virtual-video-devices': string[]\n  clipboards: string[]\n  'clipboard-direction': string\n  'clipboard.enable-selections': boolean\n  'clipboard.loop-uuids.CLIPBOARD': string\n  'clipboard.loop-uuids.PRIMARY': string\n  'clipboard.loop-uuids.SECONDARY': string\n  'av-sync': boolean\n  'av-sync.enabled': boolean\n  'sound.ogg-latency-fix': boolean\n  'file-transfer-ask': boolean\n  'max-file-size': number\n  'file-chunks': number\n  'open-files': boolean\n  'open-files-ask': boolean\n  'printing-ask': boolean\n  'open-url-ask': boolean\n  'file-ask-timeout': number\n  'printer.attributes': string[]\n  'request-file': boolean\n  'input-devices': string[]\n  'pointer.relative': boolean\n  'start-new-commands': boolean\n  'exit-with-children': boolean\n  'server-commands-signals': string[]\n  'server-commands-info': boolean\n  dbus_proxy: boolean\n  'rpc-types': string[]\n  'auto-video-encoding': boolean\n  'remote-logging': boolean\n  'remote-logging.receive': boolean\n  'remote-logging.multi-line': boolean\n  'remote-logging.send': boolean\n  'network.bandwidth-limit-change': boolean\n  'network.bandwidth-limit': number\n  shell: boolean\n  window_refresh_config: boolean\n  'window-filters': boolean\n  'configure.pointer': boolean\n  'cursor.default_size': XpraVector\n  'cursor.max_size': XpraVector\n  'gobject.version': string\n  'gi.version': string\n  'gtk.version': string\n  'gdk.version': string\n  'pixbuf.version': string\n  'glib.version': string\n  'cairo.version': string\n  'pango.version': string\n  resize_screen: string\n  resize_exact: string\n  force_ungrab: string\n  'keyboard.fast-switching': boolean\n  'wheel.precise': boolean\n  'touchpad-device': boolean\n  'screen-sizes': XpraVector[]\n  'pointer.grabs': boolean\n  'window.decorations': boolean\n  'window.frame-extents': boolean\n  'window.configure.delta': boolean\n  'window.signals': string[]\n  'window.dragndrop': boolean\n  'window.states': string[]\n  actual_desktop_size: XpraVector\n  root_window_size: XpraVector\n  aliases: boolean\n  'sound.encoders': string[]\n  'sound.sources': string[]\n  'sound.source.default': string[]\n  'sound.sinks': string[]\n  'sound.sink.default': string[]\n  'sound.muxers': string[]\n  'sound.demuxers': string[]\n  'sound.gst.version': string\n  'sound.pygst.version': string\n  'sound.plugins': string[]\n  'sound.python.version': string\n  'sound.python.bits': number\n  'sound.device.Xpra-Speaker.monitor': string\n  'sound.device.Xpra-Microphone.monitor': string\n  'sound.device.Xpra-Speaker': string\n  'sound.device.Xpra-Microphone': string\n  'sound.devices': number\n  'sound.pulseaudio.wrapper': string\n  'sound.pulseaudio.found': boolean\n  'sound.pulseaudio.id': string\n  'sound.pulseaudio.server': string\n  'sound.pulseaudio.cookie-hash': string\n  'sound.codec-full-names': boolean\n  modifier_keycodes?: XpraModifierKeycodes\n}\n\nexport type XpraSendPacketType =\n  | 'hello'\n  | 'ping'\n  | 'ping_echo'\n  | 'desktop_size'\n  | 'close-window'\n  | 'map-window'\n  | 'unmap-window'\n  | 'configure-window'\n  | 'damage-sequence'\n  | 'pointer-position'\n  | 'wheel-motion'\n  | 'button-action'\n  | 'key-action'\n  | 'focus'\n  | 'notification-close'\n  | 'suspend'\n  | 'resume'\n  | 'buffer-refresh'\n  | 'connection-data'\n  | 'sound-control'\n  | 'start-command'\n  | 'clipboard-contents-none'\n  | 'clipboard-contents'\n  | 'clipboard-token'\n  | 'logging'\n  | 'send-file'\n  | 'shutdown-server'\n  | 'layout-changed'\n\nexport type XpraPacketArguments = any[] // FIXME: Create an actual type for this\n\nexport type XpraSendPacket = [XpraSendPacketType, ...XpraPacketArguments]\n\nexport type XpraPacketEncoder = 'bencode' | 'rencode' | 'rencodeplus' | 'auto'\n\nexport type XpraCompressor = 'zlib' | 'lz4' | 'none'\n\nexport type XpraRecieveHeader = any[]\n\nexport type XpraRecievePacket = [XpraRecievePacketType, ...XpraPacketArguments]\n\nexport type XpraRecievePacketType =\n  | 'hello'\n  | 'new-window'\n  | 'window-icon'\n  | 'startup-complete'\n  | 'encodings'\n  | 'cursor'\n  | 'ping'\n  | 'ping_echo'\n  | 'draw'\n  | 'setting-change'\n  | 'window-move-resize'\n  | 'window-resized'\n  | 'raise-window'\n  | 'lost-window'\n  | 'window-metadata'\n  | 'new-override-redirect'\n  | 'configure-override-redirect'\n  | 'notify_show'\n  | 'notify_close'\n  | 'bell'\n  | 'initiate-moveresize'\n  | 'send-file'\n  | 'sound-data'\n  | 'clipboard-token'\n  | 'set-clipboard-enabled'\n  | 'clipboard-request'\n  | 'challenge'\n  | 'info-response'\n  | 'new-tray'\n  | 'pointer-position'\n  | 'eos'\n  | 'disconnect'\n  | 'open-url'\n\nexport type XpraServerCapabilities = XpraCommonCapability &\n  XpraSoundCapability &\n  XpraServerBaseCapability\n\nexport type XpraCapabilities = XpraCommonCapability &\n  XpraBaseCapability &\n  XpraCipherCapability &\n  XpraEncodingCapability &\n  XpraSoundCapability\n\nexport type XpraDrawEncoding =\n  | 'webp'\n  | 'jpeg'\n  | 'png'\n  | 'png/P'\n  | 'png/L'\n  | 'rgb32'\n  | 'rgb24'\n  | 'avif'\n  | 'scroll'\n  | 'void'\n  | 'rgb'\n  | 'h264'\n  | 'mpeg1'\n  | 'vp8+webm'\n  | 'h264+mp4'\n  | 'mpeg4+mp4'\n\nexport type XpraDrawScrollData = [\n  number,\n  number,\n  number,\n  number,\n  number,\n  number\n][]\n\nexport type XpraVector = [number, number]\n\nexport interface XpraConnectionStats {\n  lastServerPing: number\n  lastClientEcho: number\n  clientPingLatency: number\n  serverPingLatency: number\n  serverLoad: [number, number, number]\n}\n\nexport interface XpraConnectionOptions {\n  reconnect: boolean\n  reconnectInterval: number\n  reconnectAttempts: number\n  startNewSession: XpraStartNewSessionMode | null\n  showStartMenu: boolean\n  bandWidthLimit: number\n  clipboardDirection: XpraClipboardDirection\n  clipboardImages: boolean\n  clipboard: boolean\n  shareSession: boolean\n  stealSession: boolean\n  username: string\n  password: string\n  display: string\n  fileTransfer: boolean\n  printing: boolean\n  connectionTimeout: number\n  bell: boolean\n  audio: boolean\n  video: boolean\n  nativeVideo: boolean\n  cursor: boolean\n  keyboard: boolean\n  mouse: boolean\n  tray: boolean\n  notifications: boolean\n  ssl: boolean\n  encryption: string | null\n  encryptionKey: string | null\n  encoder: XpraPacketEncoder\n  openUrl: boolean\n  swapKeys: boolean\n  keyboardLayout: string\n  exitWithChildren: boolean\n  exitWithClient: boolean\n  startCommand: string\n  reverseScrollX: boolean\n  reverseScrollY: boolean\n}\n\nexport interface XpraDrawOptions {\n  decode_time?: number\n  flush?: boolean\n  zlib?: number\n  lz4?: number\n}\n\nexport interface XpraDraw {\n  wid: number\n  encoding: XpraDrawEncoding\n  position: XpraVector\n  dimension: XpraVector\n  image: Uint8Array | XpraDrawScrollData\n  packetSequence: number\n  rowStride: number\n  options: XpraDrawOptions\n  callback: (error?: Error) => void\n}\n\nexport interface XpraNotification {\n  id: number\n  replacesId: number\n  summary: string\n  body: string\n  expires: number\n  icon: string | null\n  actions: string[]\n  hints: string[]\n}\n\nexport interface XpraCursor {\n  dimension: XpraVector\n  xhot: number\n  yhot: number\n  image: string\n}\n\nexport interface XpraWindowIcon {\n  wid: number\n  dimension: XpraVector\n  image: string\n}\n\nexport interface XpraWindowClientProperties {\n  // TODO: Add types\n}\n\nexport interface XpraWindowState {\n  focused?: boolean\n}\n\nexport type XpraWindowMetadataType =\n  | ''\n  | 'NORMAL'\n  | 'DIALOG'\n  | 'UTILITY'\n  | 'DROPDOWN'\n  | 'TOOLTIP'\n  | 'POPUP_MENU'\n  | 'MENU'\n  | 'COMBO'\n  | 'DESKTOP'\n\nexport interface XpraWindowMetadata {\n  'has-alpha'?: boolean\n  tray?: boolean\n  'transient-for'?: number\n  'window-type': XpraWindowMetadataType[]\n  'class-instance': string[]\n  'size-constraints'?: {\n    'base-size'?: XpraVector\n    'minimum-size'?: XpraVector\n    'maximum-size'?: XpraVector\n    increment?: XpraVector\n    position?: XpraVector\n    gravity?: number\n  }\n  iconic?: boolean\n  title: string\n  fullscreen?: boolean\n  maximized?: boolean\n  above?: boolean\n  below?: boolean\n  opacity?: number\n  decorations?: number\n  modal?: boolean\n}\n\nexport interface XpraWindow {\n  id: number\n  position: XpraVector\n  dimension: XpraVector\n  metadata: XpraWindowMetadata\n  clientProperties: XpraWindowClientProperties\n  overrideRedirect: boolean\n}\n\nexport interface XpraWindowMoveResize {\n  wid: number\n  position?: XpraVector\n  dimension?: XpraVector\n}\n\nexport interface XpraWindowInitiateMoveResize {\n  wid: number\n  position: XpraVector\n  direction: number\n  button: number\n  sourceIndication: number\n}\n\nexport interface XpraWindowMetadataUpdate {\n  wid: number\n  metadata: Partial<XpraWindowMetadata>\n}\n\nexport interface XpraSendFile {\n  print: boolean\n  filename: string\n  size: number\n  mime: string\n  blob: Blob\n}\n\nexport interface XpraInfoResponse {\n  // TODO: Add types\n}\n\nexport interface XpraPointerPosition {\n  wid: number\n  position: XpraVector\n}\n\nexport interface XpraXDGEntryData {\n  Categories: string[]\n  Comment: string\n  Name: string\n  Exec: string\n  IconData?: string\n  IconType?: string\n  Type: string\n}\n\nexport interface XpraXDGMenuData {\n  IconData?: string\n  IconType?: string\n  Name: string\n  Entries: Record<string, XpraXDGEntryData>\n}\n\nexport type XpraXDGMenu = Record<string, XpraXDGMenuData>\n\nexport interface XpraXDGReducedMenuEntry {\n  name: string\n  exec: string\n  icon?: string\n  attributes: XpraXDGEntryData\n}\n\nexport type XpraXDGReducedMenu = {\n  name: string\n  icon?: string\n  entries: XpraXDGReducedMenuEntry[]\n}[]\n\nexport type XpraSettingChangeValue = XpraXDGMenu | any\n\nexport type XpraMonitor = [\n  string,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number\n]\n\nexport type XpraScreen = [\n  string,\n  number,\n  number,\n  number,\n  number,\n  XpraMonitor[],\n  number,\n  number,\n  number,\n  number\n]\n\nexport type XpraClipboardDirection = 'to-server' | 'both'\n\nexport type XpraClipboardSelection = 'CLIPBOARD' | 'PRIMARY'\n\nexport type XpraClipboardTarget =\n  | 'UTF8_STRING'\n  | 'TEXT'\n  | 'STRING'\n  | 'text/plain'\n  | 'image/png'\n\nexport type XpraRGBFormats = 'RGBX' | 'RGBA' | 'RGB'\n\nexport type XpraWorkerData = any\n\nexport type XpraWorkerMessage =\n  | 'connected'\n  | 'send'\n  | 'recieve'\n  | 'failure'\n  | 'configure'\n\nexport type XpraAudioFramework = 'mediasource' | 'aurora'\n\nexport type XpraAudioCodecType = string\n\nexport type XpraAudioCodec = string\n\nexport type XpraAudioCodecMap = Record<XpraAudioCodecType, XpraAudioCodec>\n\nexport type XpraAudioMetadata = string[]\n\nexport interface XpraAudioOptions {\n  'start-of-stream'?: number\n  'end-of-stream'?: number\n}\n\nexport type XpraStartNewSessionMode = 'shadow' | 'start-desktop' | 'start'\n\nexport interface XpraStartNewSession {\n  mode: XpraStartNewSessionMode\n  'exit-with-children': boolean\n  'start-child'?: string[]\n  'exit-with-client': boolean\n  start?: string[]\n}\n\nexport type XpraXkbpMapKeycode = [number, string, number, number, number]\n\nexport type XpraModifierKeycodes = Record<string, [string, number][]>\n\nexport enum XpraLogLevel {\n  ERROR = 40,\n  WARNING = 30,\n  INFO = 20,\n  DEBUG = 10,\n}\n\nexport enum XpraInflateBit {\n  ZLIB = 0x1,\n  LZ4 = 0x10,\n  LZO = 0x20,\n  BROTLI = 0x40,\n}\n\nexport enum XpraEncodeBit {\n  BENCODE = 0x0,\n  RENCODELEGACY = 0x1,\n  RENCODEPLUS = 0x10,\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport { XpraClipboardTarget, XpraRGBFormats, XpraDrawEncoding } from './types'\n\n// FIXME: Insert from environmental variables\nexport const XPRA_HTML5_VERSION = '5.0'\nexport const XPRA_HTML5_REVISION = '1237'\nexport const XPRA_HTML5_LOCAL_MODIFICATIONS = 0\nexport const XPRA_HTML5_BRANCH = 'master'\n\nexport const XPRA_MAX_AUDIO_BUFFERS = 250\n\nexport const XPRA_READ_ONLY_PACKETS: string[] = [\n  'pointer-position',\n  'button-action',\n  'key-action',\n  'desktop_size',\n]\n\nexport const XPRA_IMAGE_ENCODERS: XpraDrawEncoding[] = [\n  'jpeg',\n  'png',\n  'png/P',\n  'png/L',\n  'rgb',\n  'rgb32',\n  'rgb24',\n  'scroll',\n  'webp',\n  'void',\n  'avif',\n]\n\nexport const XPRA_RGB_FORMATS: XpraRGBFormats[] = ['RGBX', 'RGBA', 'RGB']\n\nexport const XPRA_COLOR_GAMUT: Record<string, string> = {\n  rec2020: 'rec2020',\n  p3: 'P3',\n  srgb: 'srgb',\n}\n\nexport const XPRA_PLATFORM: Record<string, string[]> = {\n  Win: ['win32', 'Microsoft Windows'],\n  Mac: ['darwin', 'Mac OSX'],\n  Linux: ['linux', 'Linux'],\n  X11: ['posix', 'Posix'],\n}\n\nexport const XPRA_CLIPBOARD_TARGETS: XpraClipboardTarget[] = [\n  'UTF8_STRING',\n  'TEXT',\n  'STRING',\n  'text/plain',\n]\n\nexport const XPRA_KEYBOARD_LAYOUTS: Record<string, string> = {\n  us: 'English USA',\n  gb: 'United Kingdom',\n  fr: 'France',\n  de: 'Germany',\n  es: 'Spain',\n  ad: 'Andorra',\n  af: 'Afghanistan',\n  al: 'Albania',\n  ara: 'Arabic',\n  am: 'Armenia',\n  az: 'Azerbaijan',\n  bd: 'Bangladesh',\n  by: 'Belarus',\n  be: 'Belgium',\n  bt: 'Bhutan',\n  ba: 'Bosnia',\n  br: 'Brazil',\n  bg: 'Bulgaria',\n  kh: 'Cambodia',\n  ca: 'Canada',\n  cn: 'China',\n  cd: 'Congo,',\n  hr: 'Croatia',\n  cz: 'Czechia',\n  dk: 'Denmark',\n  epo: 'Esperanto',\n  ee: 'Estonia',\n  et: 'Ethiopia',\n  ir: 'Iran',\n  iq: 'Iraq',\n  fo: 'Faroe',\n  fi: 'Finland',\n  ge: 'Georgia',\n  gh: 'Ghana',\n  gr: 'Greece',\n  gn: 'Guinea',\n  hu: 'Hungary',\n  is: 'Iceland',\n  in: 'India',\n  ie: 'Ireland',\n  il: 'Israel',\n  it: 'Italy',\n  jp: 'Japan',\n  kz: 'Kazakhstan',\n  kr: 'Korea,',\n  kg: 'Kyrgyzstan',\n  latam: 'Latin',\n  lv: 'Latvia',\n  la: 'Laos',\n  lt: 'Lithuania',\n  mao: 'Maori',\n  mk: 'Macedonia',\n  mv: 'Maldives',\n  ml: 'Mali',\n  mt: 'Malta',\n  mn: 'Mongolia',\n  me: 'Montenegro',\n  ma: 'Morocco',\n  mm: 'Myanmar',\n  np: 'Nepal',\n  nl: 'Netherlands',\n  ng: 'Nigeria',\n  no: 'Norway',\n  pk: 'Pakistan',\n  pl: 'Poland',\n  pt: 'Portugal',\n  ro: 'Romania',\n  ru: 'Russia',\n  sn: 'Senegal',\n  rs: 'Serbia',\n  sk: 'Slovakia',\n  si: 'Slovenia',\n  za: 'South Africa',\n  lk: 'Sri Lanka',\n  se: 'Sweden',\n  ch: 'Switzerland',\n  sy: 'Syria',\n  tw: 'Taiwan',\n  tj: 'Tajikistan',\n  tz: 'Tanzania',\n  th: 'Thailand',\n  tr: 'Turkey',\n  tm: 'Turkmenistan',\n  ua: 'Ukraine',\n  uz: 'Uzbekistan',\n  vn: 'Vietnam',\n}\n\nexport const XPRA_CLOSE_CODES: Record<number, string> = {\n  1000: 'Normal Closure',\n  1001: 'Going Away',\n  1002: 'Protocol Error',\n  1003: 'Unsupported Data',\n  1004: '(For future)',\n  1005: 'No Status Received',\n  1006: 'Abnormal Closure',\n  1007: 'Invalid frame payload data',\n  1008: 'Policy Violation',\n  1009: 'Message too big',\n  1010: 'Missing Extension',\n  1011: 'Internal Error',\n  1012: 'Service Restart',\n  1013: 'Try Again Later',\n  1014: 'Bad Gateway',\n  1015: 'TLS Handshake',\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nexport class XpraCapabilityError extends TypeError {}\nexport class XpraInvalidEncoderError extends TypeError {}\nexport class XpraInvalidHeaderError extends Error {}\nexport class XpraPacketError extends Error {}\nexport class XpraConnectionError extends Error {}\nexport class XpraInvalidAudioCodec extends Error {}\nexport class XpraAudioError extends Error {}\nexport class XpraChallengeError extends Error {}\nexport class XpraDisconnectionError extends Error {}\nexport class XpraWorkerError extends Error {}\nexport class XpraCryptoError extends Error {}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { XpraConnectionError } from '../errors'\nimport { XpraConnectionOptions } from '../types'\nimport { XPRA_CLOSE_CODES } from '../constants'\n\nexport type XpraConnectionStatus =\n  | 'disconnected'\n  | 'connecting'\n  | 'connected'\n  | 'reconnecting'\n\nexport type XpraWebsocketEventEmitters = {\n  open: () => void\n  close: (reason?: Error) => void\n  error: (error: Error) => void\n  message: (message: Uint8Array) => void\n  connect: (status: XpraConnectionStatus) => void\n  disconnect: (status: XpraConnectionStatus) => void\n}\n\nexport function createXpraCloseError(ev: CloseEvent | Event): Error {\n  if (ev instanceof CloseEvent) {\n    const { code, reason } = ev\n    const prefix = XPRA_CLOSE_CODES[code]\n      ? `'${XPRA_CLOSE_CODES[code]}' (${code})`\n      : String(code)\n\n    const suffix = reason ? `: '${reason}'` : ''\n\n    return new XpraConnectionError(prefix + suffix)\n  }\n\n  return new XpraConnectionError('unknown error')\n}\n\n/**\n * @noInheritDoc\n */\nexport class XpraWebsocket extends (EventEmitter as unknown as new () => TypedEmitter<XpraWebsocketEventEmitters>) {\n  private ws: WebSocket | null = null\n  private connectionStatus: XpraConnectionStatus = 'disconnected'\n  private reconnectTimeout = 0\n  private reconnectAttempt = 0\n  private maxReconnectAttempts = 3\n  private reconnectIntervalTime = 5 * 1000\n  private host = ''\n\n  send(message: string | Uint8Array | ArrayBufferLike) {\n    if (this.ws) {\n      this.ws.send(message)\n    }\n  }\n\n  connect(host: string, options?: XpraConnectionOptions) {\n    const reconnecting = this.connectionStatus === 'reconnecting'\n    const ws = new WebSocket(host, 'binary')\n\n    console.info('Connecting websocket', host, this.connectionStatus)\n\n    ws.binaryType = 'arraybuffer'\n\n    ws.onopen = () => {\n      console.info('Opened websocket')\n      this.connectionStatus = 'connected'\n      this.emit('open')\n    }\n\n    ws.onclose = (ev: CloseEvent) => {\n      console.info('Closed websocket')\n      this.connectionStatus = 'disconnected'\n      this.emit('close', createXpraCloseError(ev))\n    }\n\n    ws.onerror = (ev: Event) => {\n      this.emit('error', createXpraCloseError(ev))\n    }\n\n    ws.onmessage = (ev) => {\n      const q = new Uint8Array(ev.data)\n      this.emit('message', q)\n    }\n\n    if (!reconnecting) {\n      this.reconnectAttempt = 0\n    }\n\n    if (options) {\n      this.maxReconnectAttempts = options.reconnectAttempts\n      this.reconnectIntervalTime = options.reconnectInterval\n    }\n\n    this.ws = ws\n    this.host = host\n    this.clearTimers()\n    this.emit('connect', this.connectionStatus)\n  }\n\n  disconnect(reconnect = false) {\n    if (reconnect && this.connectionStatus === 'reconnecting') {\n      return\n    }\n\n    console.info('Disconnect websocket')\n\n    this.clearTimers()\n    this.connectionStatus = reconnect ? 'reconnecting' : 'disconnected'\n\n    if (this.ws) {\n      this.ws.onopen = null\n      this.ws.onclose = null\n      this.ws.onerror = null\n      this.ws.onmessage = null\n      this.ws.close()\n    }\n\n    this.ws = null\n\n    if (reconnect) {\n      if (this.reconnectAttempt >= this.maxReconnectAttempts) {\n        this.disconnect(false)\n      } else {\n        this.reconnectAttempt++\n\n        this.reconnectTimeout = setTimeout(\n          () => this.connect(this.host),\n          this.reconnectIntervalTime\n        )\n      }\n    }\n\n    this.emit('disconnect', this.connectionStatus)\n  }\n\n  private clearTimers() {\n    clearTimeout(this.reconnectTimeout)\n  }\n\n  get connected() {\n    return !!this.ws\n  }\n\n  get status() {\n    return this.connectionStatus\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nexport function arrayBufferToBase64(uintArray: Uint8Array) {\n  // apply in chunks of 10400 to avoid call stack overflow\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\n  let s = ''\n  const skip = 10400\n  if (uintArray.subarray) {\n    for (let i = 0, len = uintArray.length; i < len; i += skip) {\n      s += String.fromCharCode.apply(\n        null,\n        uintArray.subarray(i, Math.min(i + skip, len)) as unknown as number[]\n      )\n    }\n  } else {\n    for (let i = 0, len = uintArray.length; i < len; i += skip) {\n      s += String.fromCharCode.apply(\n        null,\n        uintArray.slice(i, Math.min(i + skip, len)) as unknown as number[]\n      )\n    }\n  }\n  return window.btoa(s)\n}\n\nexport function uint8toString(u8a: Uint8Array) {\n  const CHUNK_SZ = 0x8000\n  const c = []\n  for (let i = 0; i < u8a.length; i += CHUNK_SZ) {\n    c.push(\n      String.fromCharCode.apply(\n        null,\n        u8a.subarray(i, i + CHUNK_SZ) as unknown as number[]\n      )\n    )\n  }\n  return c.join('')\n}\n\nexport function uint8fromString(input: string) {\n  const uint = new Uint8Array(input.length)\n  for (let i = 0; i < input.length; ++i) {\n    uint[i] = input.charCodeAt(i)\n  }\n  return uint\n}\n\nexport function uint8fromStringOrString(input: string | Uint8Array) {\n  if (input instanceof Uint8Array) {\n    return uint8toString(input)\n  }\n\n  return input\n}\n\nexport function createHexUUID() {\n  const s = []\n  const hexDigits = '0123456789abcdef'\n  for (let i = 0; i < 36; i++) {\n    if (i == 8 || i == 13 || i == 18 || i == 23) {\n      s[i] = '-'\n    } else {\n      s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1)\n    }\n  }\n  return s.join('')\n}\n\nexport function createRandomSecureString(len: number) {\n  const crypto = window.crypto || window.mscrypto\n\n  if (!crypto) {\n    let s = ''\n    while (s.length < len) {\n      s += createHexUUID()\n    }\n    return s.substr(0, len)\n  }\n\n  const u = new Uint8Array(len)\n  crypto.getRandomValues(u)\n\n  return String.fromCharCode.apply(null, u as unknown as number[])\n}\n\nexport function xorString(str1: string, str2: string) {\n  let result = ''\n  if (str1.length !== str2.length) {\n    throw new TypeError('strings must be equal length')\n  }\n  for (let i = 0; i < str1.length; i++) {\n    result += String.fromCharCode(str1[i].charCodeAt(0) ^ str2[i].charCodeAt(0))\n  }\n  return result\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport '../lib/aurora/aurora'\nimport '../lib/aurora/aac'\nimport '../lib/aurora/mp3'\nimport '../lib/aurora/flac'\nimport '../lib/aurora/aurora-xpra'\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { uint8fromString } from '../utils/data'\nimport { XPRA_MAX_AUDIO_BUFFERS } from '../constants'\nimport { XpraInvalidAudioCodec, XpraAudioError } from '../errors'\nimport {\n  XpraServerCapabilities,\n  XpraAudioFramework,\n  XpraAudioCodecMap,\n  XpraAudioCodecType,\n  XpraAudioMetadata,\n} from '../types'\nimport {\n  getMediaSourceAudioCodecs,\n  getDefaultAudioCodec,\n  getMediaSourceClass,\n  getAuroraAudioCodecs,\n  getMediaSource,\n  get_supported_codecs,\n  get_best_codec,\n  CODEC_STRING,\n  PREFERRED_CODEC_ORDER,\n} from '../lib/media'\n\nexport type XpraAudioEventEmitters = {\n  start: () => void\n  stop: () => void\n}\n\nconst AV = window.AV\n\nconst CONCAT = true\n\nconst hasMS = !!getMediaSourceClass()\n\nconst hasAV =\n  typeof AV !== 'undefined' &&\n  AV != null &&\n  AV.Decoder != null &&\n  AV.Player.fromXpraSource != null\n\nexport class XpraAudioAdapter {\n  protected readonly audio: HTMLAudioElement\n  protected readonly audioCodec: XpraAudioCodecType\n  private audioBuffer: Uint8Array[] = []\n  private audioBufferCount = 0\n\n  constructor(audio: HTMLAudioElement, codec: XpraAudioCodecType) {\n    this.audio = audio\n    this.audioCodec = codec\n  }\n\n  async setup() {\n    console.warn('XpraAudioAdapter#setup', 'unhandled event')\n  }\n\n  async start() {\n    console.warn('XpraAudioAdapter#start', 'unhandled event')\n  }\n\n  stop() {\n    this.audio.pause()\n    this.audioBuffer = []\n    this.audioBufferCount = 0\n    this.audio.src = ''\n  }\n\n  addQueue(buffer: Uint8Array, metadata?: XpraAudioMetadata) {\n    let minStartBuffers = 4\n    if (this.audioBuffer.length >= XPRA_MAX_AUDIO_BUFFERS) {\n      throw new XpraAudioError('Buffer queue overflow')\n    }\n\n    if (metadata) {\n      for (let i = 0; i < metadata.length; i++) {\n        this.audioBuffer.push(uint8fromString(metadata[i]))\n      }\n\n      minStartBuffers = 1\n    }\n\n    this.audioBuffer.push(buffer)\n    this.processQueue(minStartBuffers)\n  }\n\n  protected pushBuffer(_buffer: Uint8Array) {\n    console.warn('XpraAudioAdapter#pushBuffer', 'unhandled event')\n  }\n\n  private processQueue(minStartBuffers: number) {\n    if (\n      this.isReady() &&\n      (this.audioBufferCount > 0 || this.audioBuffer.length >= minStartBuffers)\n    ) {\n      if (CONCAT) {\n        let buf\n        if (this.audioBuffer.length == 1) {\n          buf = this.audioBuffer[0]\n        } else {\n          let size = 0\n          for (let i = 0, j = this.audioBuffer.length; i < j; ++i) {\n            size += this.audioBuffer[i].length\n          }\n          buf = new Uint8Array(size)\n          size = 0\n          for (let i = 0, j = this.audioBuffer.length; i < j; ++i) {\n            const v = this.audioBuffer[i]\n            if (v.length > 0) {\n              buf.set(v, size)\n              size += v.length\n            }\n          }\n        }\n\n        this.audioBufferCount += 1\n        this.pushBuffer(buf)\n      } else {\n        this.audioBufferCount += this.audioBuffer.length\n        for (let i = 0, j = this.audioBuffer.length; i < j; ++i) {\n          if (this.audioBuffer[i]) {\n            this.pushBuffer(this.audioBuffer[i])\n          }\n        }\n      }\n\n      this.audioBuffer = []\n    }\n  }\n\n  protected isReady() {\n    return false\n  }\n}\n\nexport class XpraMediaSourceAdapter extends XpraAudioAdapter {\n  private mediaSource: MediaSource | null = null\n  private mediaSourceReady = false\n  private mediaSourceBuffer: SourceBuffer | null = null\n\n  async setup() {\n    const mediaSource = getMediaSource() as MediaSource\n\n    const attach = () =>\n      new Promise<SourceBuffer>((resolve, reject) => {\n        mediaSource.addEventListener('sourceopen', () => {\n          console.debug('XpraAudio -> MediaSource', 'Source opened')\n          if (this.mediaSourceReady) {\n            reject(new XpraAudioError('MediaSource already open'))\n          } else {\n            const codec = (CODEC_STRING as Record<string, string>)[\n              this.audioCodec\n            ]\n\n            if (codec) {\n              try {\n                const asb = mediaSource.addSourceBuffer(codec)\n                asb.mode = 'sequence'\n                asb.addEventListener('error', (e) => {\n                  console.error('XpraAudio -> MediaSource -> SourceBuffer', e)\n                })\n\n                resolve(asb)\n              } catch (e) {\n                reject(e)\n              }\n            } else {\n              reject(\n                new XpraInvalidAudioCodec(\n                  `Media codec '${this.audioCodec}' unsupported`\n                )\n              )\n            }\n          }\n        })\n      })\n\n    this.mediaSource = mediaSource\n    this.audio.src = window.URL.createObjectURL(this.mediaSource)\n    this.mediaSourceBuffer = await attach()\n    this.mediaSourceReady = true\n  }\n\n  async start() {\n    try {\n      await this.audio.play()\n    } catch (e) {\n      console.error('XpraAudio#start', 'audio start error', e)\n    }\n  }\n\n  stop() {\n    super.stop()\n\n    if (this.mediaSource) {\n      try {\n        if (this.mediaSourceBuffer) {\n          this.mediaSource.removeSourceBuffer(this.mediaSourceBuffer)\n        }\n\n        if (this.mediaSource.readyState === 'open') {\n          this.mediaSource.endOfStream()\n        }\n      } catch (e) {\n        console.error('XpraMediaSourceAdapter', e)\n      }\n    }\n\n    this.mediaSource = null\n    this.mediaSourceBuffer = null\n    this.mediaSourceReady = false\n  }\n\n  protected pushBuffer(buffer: Uint8Array) {\n    if (this.mediaSourceBuffer) {\n      this.mediaSourceBuffer.appendBuffer(buffer)\n    }\n  }\n\n  protected isReady() {\n    return !!this.mediaSourceBuffer && !this.mediaSourceBuffer.updating\n  }\n}\n\nexport class XpraAuroraAdapter extends XpraAudioAdapter {\n  private auroraSource: AuroraSource | null = null\n\n  async setup() {\n    this.auroraSource = AV.Player.fromXpraSource()\n  }\n\n  async start() {\n    if (this.auroraSource) {\n      this.auroraSource.play()\n    }\n  }\n\n  stop() {\n    super.stop()\n\n    if (this.auroraSource?.context) {\n      try {\n        this.auroraSource.context.close()\n      } catch (e) {\n        console.error('XpraAuroraAdapter', e)\n      }\n    }\n\n    this.auroraSource = null\n  }\n\n  protected pushBuffer(buffer: Uint8Array) {\n    if (this.auroraSource) {\n      this.auroraSource.asset.source._on_data(buffer)\n    }\n  }\n\n  protected isReady() {\n    return !!this.auroraSource\n  }\n}\n\n/**\n * @noInheritDoc\n */\nexport class XpraAudio extends (EventEmitter as unknown as new () => TypedEmitter<XpraAudioEventEmitters>) {\n  private readonly audio: HTMLAudioElement = document.createElement('audio')\n  private enabled = false\n  private adapter: XpraAudioAdapter | null = null\n  private defaultCodec: XpraAudioCodecType | null = null\n  private audioCodec: XpraAudioCodecType | null = null\n  private audioFramework: XpraAudioFramework | null = null\n\n  private auroraCodecs: XpraAudioCodecMap = (hasAV\n    ? getAuroraAudioCodecs()\n    : {}) as XpraAudioCodecMap\n\n  private mediaCodecs: XpraAudioCodecMap = (hasMS\n    ? getMediaSourceAudioCodecs()\n    : {}) as XpraAudioCodecMap\n\n  private detectedCodecs: XpraAudioCodecMap = {\n    ...this.mediaCodecs,\n    ...this.auroraCodecs,\n  }\n\n  constructor() {\n    super()\n\n    if (Object.values(this.detectedCodecs).length > 0) {\n      this.defaultCodec = getDefaultAudioCodec(this.detectedCodecs)\n    }\n\n    console.debug('XpraAudio#constructor', this)\n  }\n\n  async init() {\n    this.audio.setAttribute('autoplay', String(true))\n\n    this.audio.addEventListener('play', () => {\n      console.info('XpraAudio -> <audio>', 'playing')\n    })\n\n    this.audio.addEventListener('error', (ev: ErrorEvent) => {\n      console.error('XpraAudio -> <audio>', ev)\n      this.stop()\n    })\n  }\n\n  validate(codec: XpraAudioCodecType) {\n    if (codec !== this.audioCodec) {\n      console.error('XpraAudio#validate', 'invalid codec', codec)\n      this.stop()\n\n      return false\n    }\n\n    return true\n  }\n\n  stop() {\n    if (this.adapter) {\n      this.adapter.stop()\n    }\n    this.enabled = false\n    this.adapter = null\n    this.emit('stop')\n  }\n\n  async setup(serverCapabilities: XpraServerCapabilities) {\n    if (serverCapabilities['sound.send']) {\n      const encoders = serverCapabilities['sound.encoders']\n\n      if (this.defaultCodec) {\n        const detected =\n          PREFERRED_CODEC_ORDER.find((codec) => {\n            if (codec in this.detectedCodecs && encoders.includes(codec)) {\n              return true\n            }\n\n            return false\n          }) || this.defaultCodec\n\n        if (detected) {\n          this.enabled = true\n          this.audioCodec = detected\n          this.audioFramework = this.auroraCodecs[detected]\n            ? 'aurora'\n            : 'mediasource'\n        }\n      }\n    }\n\n    if (this.enabled) {\n      const supported = get_supported_codecs(\n        this.audioFramework === 'mediasource',\n        this.audioFramework === 'aurora',\n        false\n      )\n\n      const best = get_best_codec(supported)\n\n      if (best) {\n        const [framework, codec] = best.split(':')\n        this.audioFramework = framework as XpraAudioFramework\n        this.audioCodec = codec as XpraAudioCodecType\n      }\n\n      if (this.audioCodec) {\n        if (this.audioFramework === 'mediasource') {\n          this.adapter = new XpraMediaSourceAdapter(this.audio, this.audioCodec)\n        } else if (this.audioFramework === 'aurora') {\n          this.adapter = new XpraAuroraAdapter(this.audio, this.audioCodec)\n        }\n      }\n\n      try {\n        if (this.adapter) {\n          await this.adapter.setup()\n          this.emit('start')\n        }\n      } catch (e) {\n        console.error('XpraAudio#setup', e)\n        this.stop()\n      }\n    }\n  }\n\n  async start() {\n    if (this.adapter) {\n      this.adapter.start()\n    } else {\n      this.stop()\n    }\n  }\n\n  addQueue(buffer: Uint8Array, metadata?: XpraAudioMetadata) {\n    if (this.adapter) {\n      this.adapter.addQueue(buffer, metadata)\n    }\n  }\n\n  getDecoders() {\n    return Object.keys(this.detectedCodecs)\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport { LANGUAGE_TO_LAYOUT } from '../lib/keycodes'\nimport { XPRA_COLOR_GAMUT, XPRA_PLATFORM } from '../constants'\n\nexport interface BrowserFile {\n  buffer: Uint8Array\n  name: string\n  size: number\n  type: string\n}\n\nconst defaultPlatform = ['unknown', ['unknown', 'unknown']]\n\nexport function getBrowserLanguages() {\n  const layout = LANGUAGE_TO_LAYOUT as Record<string, string>\n  function resolve() {\n    const keys = [\n      'language',\n      'browserLanguage',\n      'systemLanguage',\n      'userLanguage',\n    ]\n\n    const found = keys.find(\n      (k) => typeof navigator[k as keyof Navigator] === 'string'\n    )\n\n    if (navigator.languages) {\n      return navigator.languages\n    } else if (found) {\n      return [found]\n    }\n\n    return ['us']\n  }\n\n  return resolve().map((str) => {\n    const [shortened] = str.split(/-|_/)\n    return layout[str] || layout[shortened] || str\n  })\n}\n\nexport function getBrowser() {\n  const [layout] = getBrowserLanguages()\n  const ua = navigator.userAgent\n\n  const isSafari =\n    !!navigator.vendor.match(/apple/i) &&\n    !ua.match(/crios/i) &&\n    !ua.match(/fxios/i) &&\n    !ua.match(/Opera|OPT\\//)\n\n  const browsers = [\n    ['MSIE', ua.includes('MSIE') || ua.includes('Trident/')],\n    ['Firefox', 'firefox'],\n    ['Opera', 'opera'],\n    ['Safari', isSafari],\n    ['Chrome', 'chrome'],\n  ]\n\n  const [name] = browsers.find(([, i]) =>\n    typeof i === 'boolean' ? i : ua.toLowerCase().includes(i)\n  ) || ['', '']\n\n  return {\n    agent: navigator.userAgent,\n    name: name as string,\n    layout,\n  }\n}\n\nexport function getBrowserPlatform() {\n  const { appVersion, oscpu, cpuClass } = navigator\n\n  const found = Object.entries(XPRA_PLATFORM).find(([k]) =>\n    appVersion?.includes(k)\n  )\n\n  const [, [type, name]] = found || defaultPlatform\n\n  return {\n    type,\n    name,\n    platform: appVersion,\n    processor: oscpu || cpuClass || 'unknown',\n  }\n}\n\nexport function getBrowserConnectionInfo() {\n  const convert = (n?: number | string) =>\n    typeof n === 'number' && n > 0 && isFinite(n)\n      ? Math.round(n * 1000 * 1000)\n      : n\n\n  const result = {\n    type: 'unknown',\n    downlink: -1,\n    downlinkMax: -1,\n    effectiveType: '4g',\n    rtt: 0,\n  }\n\n  if ('connection' in navigator) {\n    const append = Object.keys(result)\n      .filter((k) => k in navigator.connection)\n      .map((k) => [k, navigator.connection[k as keyof NetworkInformation]])\n\n    Object.assign(result, Object.fromEntries(append))\n  }\n\n  return {\n    ...result,\n    downlink: convert(result.downlink),\n    downlinkMax: convert(result.downlinkMax),\n  } as Record<string, string | number>\n}\n\nexport const getBrowserSupportsClipboard = () =>\n  navigator.clipboard &&\n  !!navigator.clipboard.readText &&\n  !!navigator.clipboard.writeText\n\nexport async function browserLoadFile() {\n  const input = document.createElement('input')\n  input.type = 'file'\n\n  const load = (blob: Blob) =>\n    new Promise<ArrayBuffer>((resolve, reject) => {\n      const fileReader = new FileReader()\n      fileReader.onload = () => {\n        resolve(fileReader.result as ArrayBuffer)\n      }\n\n      fileReader.onerror = (ev: ProgressEvent) => {\n        reject(ev)\n      }\n\n      fileReader.readAsArrayBuffer(blob)\n    })\n\n  return new Promise<BrowserFile[]>((resolve, reject) => {\n    input.onchange = async () => {\n      try {\n        if (input.files) {\n          const promises = Array.from(input.files).map((file) =>\n            load(file).then(\n              (buffer) =>\n                ({\n                  buffer,\n                  name: file.name,\n                  size: file.size,\n                  type: file.type,\n                } as BrowserFile)\n            )\n          )\n\n          const result = await Promise.all(promises)\n          resolve(result)\n        } else {\n          resolve([])\n        }\n      } catch (e) {\n        reject(e)\n      }\n    }\n\n    input.click()\n  })\n}\n\nexport function browserSaveFile(name: string, blob: Blob | string) {\n  if (navigator.msSaveOrOpenBlob) {\n    navigator.msSaveOrOpenBlob(blob as Blob, name)\n  } else {\n    const url = blob instanceof Blob ? window.URL.createObjectURL(blob) : blob\n\n    try {\n      const a = document.createElement('a')\n      a.href = url\n      a.download = name\n      a.click()\n    } finally {\n      window.URL.revokeObjectURL(url)\n    }\n  }\n}\n\nexport function browserPrintFile(name: string, blob: Blob) {\n  const url = URL.createObjectURL(blob)\n\n  try {\n    const win = window.open(url)\n    if (!win || win.closed || win.closed !== undefined) {\n      browserSaveFile(name, url)\n    } else {\n      win.print()\n    }\n  } finally {\n    window.URL.revokeObjectURL(url)\n  }\n}\n\nexport async function browserReadClipboard(\n  textType: string\n): Promise<[string, string]> {\n  if (navigator.clipboard.read) {\n    const read = (blob: Blob) =>\n      new Promise<string>((resolve, reject) => {\n        const fileReader = new FileReader()\n\n        fileReader.onload = () => {\n          resolve(fileReader.result as string)\n        }\n\n        fileReader.onerror = (ev: ProgressEvent) => {\n          reject(ev)\n        }\n\n        fileReader.readAsText(blob)\n      })\n\n    const data = await navigator.clipboard.read()\n    for (let i = 0; i < data.length; i++) {\n      const item = data[i]\n      for (let j = 0; j < item.types.length; j++) {\n        const itemType = item.types[j]\n        const blob = await item.getType(itemType)\n        const data = await read(blob)\n\n        if (itemType === 'text/plain') {\n          return [textType, data]\n        } else if (itemType === 'image/png') {\n          return [itemType, data]\n        }\n      }\n    }\n  }\n\n  const text = await navigator.clipboard.readText()\n  return [textType, text]\n}\n\nexport async function browserWriteClipboard(data: string, binaryType?: string) {\n  if (binaryType) {\n    if (navigator.clipboard.write) {\n      const blob = new Blob([data], { type: binaryType })\n      const item = new ClipboardItem({ [binaryType]: blob })\n      const items = [item]\n\n      await navigator.clipboard.write(items)\n\n      return true\n    }\n  } else {\n    await navigator.clipboard.writeText(data)\n    return true\n  }\n\n  return false\n}\n\nexport async function createNativeNotification(\n  title: string,\n  options: NotificationOptions\n) {\n  if (!('Notification' in window)) {\n    throw new Error('Notifications are not supported in this browser')\n  }\n\n  if (Notification.permission !== 'denied') {\n    const permission = await Notification.requestPermission()\n    if (permission === 'granted') {\n      const notification = new Notification(title, options)\n\n      return notification\n    }\n  }\n\n  return null\n}\n\nexport function getBrowserColorGamut() {\n  if (window.matchMedia) {\n    const found = Object.entries(XPRA_COLOR_GAMUT).find(([k]) =>\n      window.matchMedia(`(color-gamut: ${k})`)\n    )\n\n    if (found) {\n      return found[1]\n    }\n  }\n\n  return ''\n}\n\nexport const getBrowserDPI = (() => {\n  let dpi = 96\n\n  if (typeof window !== 'undefined') {\n    if ('deviceXDPI' in screen) {\n      dpi = (screen.systemXDPI + screen.systemYDPI) / 2\n    } else {\n      const el = document.createElement('div') as HTMLDivElement\n      el.style.width = '1in'\n      el.style.height = '1in'\n      el.style.left = '-100%'\n      el.style.top = '-100%'\n      el.style.position = 'absolute'\n      document.body.appendChild(el)\n      const { offsetWidth, offsetHeight } = el\n      el.remove()\n\n      if (offsetWidth > 0 && offsetHeight > 0) {\n        dpi = Math.round((offsetWidth + offsetHeight) / 2.0)\n      }\n    }\n  }\n\n  return () => dpi as number\n})()\n\n// FIXME: Find a modern replacement\nexport const unescapeUri = (s: string) => unescape(encodeURIComponent(s))\n\nexport function parseUrlQuerySearch<T>(\n  booleans: string[],\n  numbers: string[],\n  required: string[]\n): T {\n  const { search } = window.location\n  const params = new URLSearchParams(search)\n\n  const entries = Array.from(params as unknown as ArrayLike<string>).map(\n    ([k, v]) => {\n      if (booleans.includes(k)) {\n        return [k, ['1', 'true', 'on'].includes(String(v).toLowerCase())]\n      } else if (numbers.includes(k)) {\n        return [k, parseInt(v)]\n      }\n\n      return [k, v ? v : undefined]\n    }\n  )\n\n  return Object.fromEntries(\n    entries.filter(\n      ([k, v]) => required.includes(k as string) && v !== undefined\n    )\n  )\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { get_key, get_modifiers } from '../lib/keycodes'\nimport { getBrowserLanguages } from '../utils/browser'\nimport { XpraConnectionOptions, XpraServerCapabilities } from '../types'\n\nexport type XpraKeyboardEventEmitters = {\n  layoutChanged: (layout: string) => void\n}\n\n/**\n * @noInheritDoc\n */\nexport class XpraKeyboard extends (EventEmitter as unknown as new () => TypedEmitter<XpraKeyboardEventEmitters>) {\n  private altgrState = false\n  private keyboardKayout = 'us'\n  private swapKeys = false\n  private modifiers = {\n    numlock: null,\n    alt: null,\n    ctrl: null,\n    meta: null,\n    altgr: null,\n  }\n\n  configure(\n    options: XpraConnectionOptions,\n    capabilities: XpraServerCapabilities\n  ) {\n    this.keyboardKayout = options.keyboardLayout\n    this.swapKeys = options.swapKeys\n\n    const modifiers = capabilities.modifier_keycodes\n    let numlockModifier = null\n    let altModifier = null\n    let ctrlModifier = null\n    let metaModifier = null\n    let altgrModifier = null\n\n    if (modifiers) {\n      for (const mod in modifiers) {\n        const keys = modifiers[mod]\n        for (let i = 0; i < keys.length; i++) {\n          const key = keys[i]\n          for (let j = 0; j < key.length; j++) {\n            if ('Alt_L' == key[j]) altModifier = mod\n            else if ('Meta_L' == key[j]) metaModifier = mod\n            else if ('ISO_Level3_Shift' == key[j] || 'Mode_switch' == key[j])\n              altgrModifier = mod\n            else if ('Control_L' == key[j]) ctrlModifier = mod\n            else if ('Num_Lock' === key[j]) numlockModifier = mod\n          }\n        }\n      }\n\n      if (this.swapKeys) {\n        ;[metaModifier, ctrlModifier] = [ctrlModifier, metaModifier]\n      }\n    }\n\n    Object.assign(this.modifiers, {\n      numlock: numlockModifier,\n      alt: altModifier,\n      ctrl: ctrlModifier,\n      meta: metaModifier,\n      altgr: altgrModifier,\n    })\n  }\n\n  getKey(ev: KeyboardEvent | MouseEvent) {\n    return get_key(ev)\n  }\n\n  getModifiers(ev: KeyboardEvent | MouseEvent): string[] {\n    const original = get_modifiers(ev)\n    const newModifiers = original.slice()\n\n    let index = original.indexOf('meta')\n    if (index >= 0 && this.modifiers.meta)\n      newModifiers[index] = this.modifiers.meta\n\n    index = original.indexOf('control')\n    if (index >= 0 && this.modifiers.ctrl)\n      newModifiers[index] = this.modifiers.ctrl\n\n    index = original.indexOf('alt')\n    if (index >= 0 && this.modifiers.alt)\n      newModifiers[index] = this.modifiers.alt\n\n    index = original.indexOf('numlock')\n    if (index >= 0) {\n      if (this.modifiers.numlock) {\n        newModifiers[index] = this.modifiers.numlock\n      } else {\n        newModifiers.splice(index, 1)\n      }\n    }\n\n    index = original.indexOf('capslock')\n    if (index >= 0) {\n      newModifiers[index] = 'lock'\n    }\n\n    if (\n      this.altgrState &&\n      this.modifiers.altgr &&\n      !newModifiers.includes(this.modifiers.altgr)\n    ) {\n      newModifiers.push(this.modifiers.altgr)\n\n      index = newModifiers.indexOf(this.modifiers.altgr)\n      if (index >= 0) newModifiers.splice(index, 1)\n\n      index = newModifiers.indexOf(this.modifiers.ctrl)\n      if (index >= 0) newModifiers.splice(index, 1)\n    }\n\n    return newModifiers\n  }\n\n  onKeyPress(str: string, pressed: boolean) {\n    const [layout] = getBrowserLanguages()\n    if (this.keyboardKayout !== layout) {\n      this.emit('layoutChanged', layout)\n    }\n\n    if (str === 'AltGraph') {\n      this.altgrState = pressed\n    }\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nexport class XpraMouse {\n  getButton(ev: MouseEvent) {\n    let button = 0\n\n    if ('which' in ev)\n      // Gecko (Firefox), WebKit (Safari/Chrome) & Opera\n      button = Math.max(0, ev.which)\n    else if ('button' in ev)\n      // IE, Opera (zero based)\n      button = Math.max(0, ev.button) + 1\n\n    return button\n  }\n\n  getPosition(ev: MouseEvent): [number, number] {\n    return [ev.clientX, ev.clientY]\n  }\n\n  getScroll(event: WheelEvent | MouseEvent | Event): [number, number] {\n    const ev = event as WheelEvent\n    const normalize = (num: number) => (num > 1 ? 1 : num < 0 ? -1 : 0)\n\n    if (typeof ev.deltaX === 'number') {\n      return [normalize(ev.deltaX), normalize(ev.deltaY)]\n    } else if (typeof ev.wheelDelta === 'number') {\n      return [0, ev.wheelDelta / 120]\n    } else if (typeof ev.wheelDeltaX === 'number') {\n      return [ev.wheelDeltaX / 120, ev.wheelDeltaY / 120]\n    }\n\n    // TODO: ev.axis\n    return [0, 0]\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { uint8toString } from '../utils/data'\nimport { unescapeUri } from '../utils/browser'\nimport { browserReadClipboard, browserWriteClipboard } from '../utils/browser'\nimport {\n  XpraPacketArguments,\n  XpraClipboardSelection,\n  XpraClipboardTarget,\n  XpraCapabilities,\n  XpraConnectionOptions,\n  XpraClipboardDirection,\n} from '../types'\n\nexport type XpraClipboardEventEmitters = {\n  token: (data: string) => void\n  send: (\n    requestId: number,\n    selection: string,\n    buffer: string,\n    dataType?: string,\n    dataFormat?: number,\n    encoding?: string\n  ) => void\n}\n\n/**\n * @noInheritDoc\n */\nexport class XpraClipboard extends (EventEmitter as unknown as new () => TypedEmitter<XpraClipboardEventEmitters>) {\n  private enabled = false\n  private direction: XpraClipboardDirection = 'both'\n  private clipboardBuffer: Partial<\n    Record<XpraClipboardSelection, XpraPacketArguments>\n  > = {}\n\n  configure(options: XpraConnectionOptions) {\n    this.enabled = options.clipboard\n    this.direction = options.clipboardDirection\n  }\n\n  reset() {\n    this.clipboardBuffer = {}\n  }\n\n  async write(\n    capabilities: XpraCapabilities,\n    selection: XpraClipboardSelection,\n    _targets: XpraClipboardTarget[],\n    target: XpraClipboardTarget,\n    type: XpraClipboardTarget,\n    format: number,\n    wireEncoding: string,\n    wireData: string | Uint8Array\n  ) {\n    if (!this.enabled) {\n      return\n    }\n\n    if (arguments.length >= 7) {\n      this.clipboardBuffer[selection] = [wireData, type, format, wireEncoding]\n    }\n\n    const preferedTargets = capabilities['clipboard.preferred-targets']\n    const valid = target && preferedTargets.includes(target)\n\n    if (valid) {\n      let data = wireData\n      const isText = type.match(/text|string/i)\n\n      if (isText) {\n        if (data instanceof Uint8Array) {\n          data = uint8toString(data)\n        }\n\n        await browserWriteClipboard(data)\n      } else if (\n        type === 'image/png' &&\n        format == 8 &&\n        wireEncoding == 'bytes'\n      ) {\n        await browserWriteClipboard(wireData as string, type)\n      }\n    }\n  }\n\n  async read(requestId: number, selection: XpraClipboardSelection) {\n    if (!this.enabled) {\n      return\n    }\n\n    const resend = () => {\n      const buffer = this.clipboardBuffer['CLIPBOARD']\n      if (buffer) {\n        const [data, type, format, encoding] = buffer\n        this.emit('send', requestId, selection, data, type, format, encoding)\n      }\n    }\n\n    if (selection != 'CLIPBOARD') {\n      this.emit('send', requestId, selection, '')\n      return\n    }\n\n    try {\n      const result = await browserReadClipboard('UTF8_STRING')\n      const buffer = this.clipboardBuffer['PRIMARY']\n\n      if (\n        buffer &&\n        buffer[1] == 8 &&\n        buffer[2] == 'bytes' &&\n        result == buffer[3]\n      ) {\n        resend()\n      } else if (result) {\n        const [type, data] = result\n        this.emit('send', requestId, selection, data, type)\n      }\n    } catch (e) {\n      resend()\n      console.error('XpraClipboard#read', e)\n    }\n  }\n\n  async poll() {\n    if (this.direction === 'to-server') {\n      return\n    }\n\n    const [, text] = await browserReadClipboard('UTF8_STRING')\n    const data = unescapeUri(text)\n\n    this.emit('token', data)\n  }\n\n  isEnabled() {\n    return this.enabled\n  }\n\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { XpraLogLevel } from '../types'\n\n// eslint-disable-next-line\nexport type XpraLoggerArguments = any[]\n\nexport type XpraLoggerType = 'log' | 'info' | 'warn' | 'error' | 'debug'\n\nexport type XpraLoggerEventEmitters = {\n  log: (level: XpraLogLevel, args: XpraLoggerArguments) => void\n}\n\nconst mapped: Record<XpraLoggerType, XpraLogLevel> = {\n  log: XpraLogLevel.INFO,\n  info: XpraLogLevel.INFO,\n  warn: XpraLogLevel.WARNING,\n  error: XpraLogLevel.ERROR,\n  debug: XpraLogLevel.DEBUG,\n}\n\n/**\n * @noInheritDoc\n */\nexport class XpraLogger extends (EventEmitter as unknown as new () => TypedEmitter<XpraLoggerEventEmitters>) {\n  log(...args: XpraLoggerArguments) {\n    this.perform('log', args)\n  }\n\n  info(...args: XpraLoggerArguments) {\n    this.perform('info', args)\n  }\n\n  warn(...args: XpraLoggerArguments) {\n    this.perform('warn', args)\n  }\n\n  error(...args: XpraLoggerArguments) {\n    this.perform('error', args)\n  }\n\n  debug(...args: XpraLoggerArguments) {\n    this.perform('debug', args)\n  }\n\n  private perform(level: XpraLoggerType, args: XpraLoggerArguments) {\n    const cons = console[level]\n    const actual = mapped[level]\n    cons.apply(cons, ['-->', ...args])\n    this.emit('log', actual, args)\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport { getBrowserLanguages, parseUrlQuerySearch } from '../utils/browser'\nimport { XpraConnectionOptions } from '../types'\n\nconst [defaultKeyboardLayout] = getBrowserLanguages()\n\nexport const defaultXpraConnectionOptions: XpraConnectionOptions = {\n  reconnect: true,\n  connectionTimeout: 30000,\n  reconnectInterval: 5000,\n  reconnectAttempts: 3,\n  bandWidthLimit: 0,\n  startNewSession: null,\n  shareSession: false,\n  stealSession: false,\n  username: '',\n  display: '',\n  password: '',\n  showStartMenu: true,\n  fileTransfer: true,\n  clipboardImages: false,\n  clipboardDirection: 'both',\n  clipboard: true,\n  printing: false,\n  bell: true,\n  audio: true,\n  video: false,\n  nativeVideo: false,\n  cursor: true,\n  keyboard: true,\n  mouse: true,\n  tray: true,\n  notifications: true,\n  ssl: false,\n  encryption: null,\n  encryptionKey: null,\n  encoder: 'auto',\n  openUrl: true,\n  swapKeys: false,\n  keyboardLayout: defaultKeyboardLayout,\n  exitWithChildren: false,\n  exitWithClient: false,\n  startCommand: '',\n  reverseScrollX: false,\n  reverseScrollY: false,\n}\n\nconst booleanParams: string[] = [\n  'reconnect',\n  'showStartMenu',\n  'clipboardImages',\n  'clipboard',\n  'shareSession',\n  'stealSession',\n  'fileTransfer',\n  'printing',\n  'bell',\n  'audio',\n  'cursor',\n  'keyboard',\n  'mouse',\n  'tray',\n  'notifications',\n  'ssl',\n  'openUrl',\n  'video',\n  'nativeVideo',\n  'swapKeys',\n  'exitWithChildren',\n  'exitWithClient',\n  'reverseScrollX',\n  'reverseScrollY',\n]\n\nconst numberParams: string[] = [\n  'bandWidthLimit',\n  'connectionTimeout',\n  'reconnectAttempts',\n  'reconnectInterval',\n]\n\nexport const createXpraConnectionOptionsFromUrl = () =>\n  parseUrlQuerySearch<Partial<XpraConnectionOptions>>(\n    booleanParams,\n    numberParams,\n    Object.keys(defaultXpraConnectionOptions)\n  )\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport forge from 'node-forge'\nimport { xorString, createRandomSecureString } from '../utils/data'\nimport { XpraChallengeError } from '../errors'\n\nexport function createXpraChallengeDigest(\n  digest: string,\n  password: string,\n  salt: string\n) {\n  if (digest.startsWith('hmac')) {\n    let hash = 'md5'\n    if (digest.indexOf('+') > 0) {\n      hash = digest.split('+')[1]\n    }\n    const hmac = forge.hmac.create()\n    hmac.start(hash, password)\n    hmac.update(salt)\n    return hmac.digest().toHex()\n  } else if (digest == 'xor') {\n    const trimmed_salt = salt.slice(0, password.length)\n    return xorString(trimmed_salt, password)\n  }\n\n  return null\n}\n\nexport function createXpraChallengeResponse(\n  serverSalt: string,\n  digest: string,\n  saltDigest: string,\n  password: string,\n  useSsl: boolean,\n  useEncryption: string | null\n) {\n  if (!password) {\n    throw new XpraChallengeError('Invalid login')\n  }\n\n  if (saltDigest === 'xor') {\n    if (digest === 'xor') {\n      if (!useSsl && !useEncryption) {\n        throw new XpraChallengeError(\n          'Aborted challenge because xor is not safe in this environment'\n        )\n      }\n    }\n\n    if (serverSalt.length < 16 || serverSalt.length > 256) {\n      throw new XpraChallengeError(\n        `Invalid challenge xor salt length: ${serverSalt.length}`\n      )\n    }\n  }\n\n  const clientSaltLength = saltDigest === 'xor' ? serverSalt.length : 32\n  const clientSalt = createRandomSecureString(clientSaltLength)\n  const salt = createXpraChallengeDigest(saltDigest, clientSalt, serverSalt)\n\n  let challengeResponse = null\n  if (salt) {\n    challengeResponse = createXpraChallengeDigest(digest, password, salt)\n  }\n\n  if (!challengeResponse) {\n    throw new XpraChallengeError('Could not challenge server auth attempt')\n  }\n\n  return [challengeResponse, clientSalt]\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { XpraWorkerError } from '../errors'\nimport {\n  XpraConnectionOptions,\n  XpraSendPacket,\n  XpraRecievePacket,\n  XpraWorkerMessage,\n  XpraWorkerData,\n} from '../types'\n\nexport type XpraConnectionWorkerEventEmitters = {\n  recieve: (packet: XpraRecievePacket) => void\n  send: (data: ArrayBuffer) => void\n  failure: (error: Error) => void\n}\n\nexport class XpraConnectionWorker extends (EventEmitter as unknown as new () => TypedEmitter<XpraConnectionWorkerEventEmitters>) {\n  private readonly worker\n\n  constructor(worker: Worker) {\n    super()\n    this.worker = worker\n  }\n\n  async init() {\n    this.worker.addEventListener('message', (ev: MessageEvent) => {\n      const [msg, data] = ev.data\n      this.recieve(msg, data)\n    })\n\n    this.worker.addEventListener('error', (ev: ErrorEvent) => {\n      this.emit('failure', ev as unknown as Error)\n    })\n  }\n\n  private send(msg: XpraWorkerMessage, data: XpraWorkerData) {\n    this.worker.postMessage([msg, data])\n  }\n\n  private recieve(msg: XpraWorkerMessage, data: XpraWorkerData) {\n    switch (msg) {\n      case 'send':\n        this.emit('send', data as ArrayBuffer)\n        break\n\n      case 'recieve':\n        this.emit('recieve', data as XpraRecievePacket)\n        break\n\n      case 'failure':\n        const [msg, stack] = data as [string, string]\n        const err = new XpraWorkerError(`${msg} | ${stack}`)\n        this.emit('failure', err)\n    }\n  }\n\n  configure(options: XpraConnectionOptions) {\n    this.send('configure', options)\n  }\n\n  setConnected(connected: boolean) {\n    this.send('connected', connected)\n  }\n\n  pushSend(packet: XpraSendPacket) {\n    this.send('send', packet)\n  }\n\n  pushRecieve(data: Uint8Array) {\n    this.send('recieve', data)\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport { uint8fromString, arrayBufferToBase64 } from './data'\n\nexport const loadImage = (src: string) =>\n  new Promise<HTMLImageElement | null>((resolve) => {\n    const image = new Image()\n    image.onload = () => {\n      if (image.width && image.height) {\n        resolve(image)\n      } else {\n        resolve(null)\n      }\n    }\n    image.onerror = () => {\n      resolve(null)\n    }\n    image.src = src\n  })\n\nexport function imageSourceFromData(\n  encoding: string,\n  data: Uint8Array | string\n) {\n  const imageData = typeof data === 'string' ? uint8fromString(data) : data\n\n  const src = arrayBufferToBase64(imageData)\n  const enc = encoding === 'svg' ? 'image/svg+xml' : encoding\n\n  return `data:image/${enc};base64,${src}`\n}\n\n// re-striding\n// might be quicker to copy 32bit at a time using Uint32Array\n// and then casting the result?\nexport function RGB32Restride(\n  data: Uint8Array,\n  width: number,\n  height: number,\n  rowStride: number\n) {\n  const uint = new Uint8Array(width * height * 4)\n  for (let i = 0; i < height; i++) {\n    let psrc = i * rowStride\n    let pdst = i * width * 4\n    for (let j = 0; j < width * 4; j++) {\n      uint[pdst++] = data[psrc++]\n    }\n  }\n\n  return uint\n}\n\nexport function RGB24ToRGB32(\n  data: number[],\n  width: number,\n  height: number,\n  rowStride: number\n) {\n  const uint = new Uint8Array(width * height * 4)\n\n  //faster path, single loop:\n  if (rowStride == width * 3) {\n    const l = data.length\n    let i = 0\n    let j = 0\n\n    while (i < l) {\n      uint[j++] = data[i++]\n      uint[j++] = data[i++]\n      uint[j++] = data[i++]\n      uint[j++] = 255\n    }\n  } else {\n    let pdst = 0\n    for (let i = 0; i < height; i++) {\n      let psrc = i * rowStride\n      for (let j = 0; j < width; j++) {\n        uint[pdst++] = data[psrc++]\n        uint[pdst++] = data[psrc++]\n        uint[pdst++] = data[psrc++]\n        uint[pdst++] = 255\n      }\n    }\n  }\n\n  return uint\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport { XpraXDGMenu, XpraXDGReducedMenu } from '../types'\nimport { imageSourceFromData } from '../utils/image'\n\nexport const createXDGMenu = (value: XpraXDGMenu): XpraXDGReducedMenu =>\n  Object.values(value as XpraXDGMenu).map((sub) => ({\n    name: sub.Name,\n    icon:\n      sub.IconData && sub.IconType\n        ? imageSourceFromData(sub.IconType, sub.IconData)\n        : undefined,\n    entries: Object.entries(sub.Entries).map(\n      ([name, { IconType, IconData, ...attributes }]) => ({\n        name,\n        exec: attributes.Exec.replace(/%[uUfF]/g, ''),\n        icon:\n          IconData && IconType\n            ? imageSourceFromData(IconType, IconData)\n            : undefined,\n        attributes,\n      })\n    ),\n  }))\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport forge from 'node-forge'\nimport JSMpeg from '../lib/jsmpeg'\nimport { XpraCapabilityError } from '../errors'\nimport { rencode_selftest } from '../lib/rencode'\nimport { get_key_codes } from '../lib/keycodes'\nimport {\n  XPRA_CLIPBOARD_TARGETS,\n  XPRA_RGB_FORMATS,\n  XPRA_IMAGE_ENCODERS,\n  XPRA_HTML5_VERSION,\n  XPRA_HTML5_REVISION,\n  XPRA_HTML5_LOCAL_MODIFICATIONS,\n  XPRA_HTML5_BRANCH,\n} from '../constants'\nimport {\n  XpraVector,\n  XpraCapabilities,\n  XpraConnectionOptions,\n  XpraMonitor,\n  XpraScreen,\n  XpraClipboardSelection,\n  XpraStartNewSessionMode,\n  XpraStartNewSession,\n  XpraXkbpMapKeycode,\n} from '../types'\nimport { createRandomSecureString, createHexUUID } from '../utils/data'\nimport {\n  getBrowserDPI,\n  getBrowser,\n  getBrowserPlatform,\n  getBrowserConnectionInfo,\n  getBrowserSupportsClipboard,\n  getBrowserColorGamut,\n} from '../utils/browser'\n\nconst getSupportedDigests = () => {\n  const additions = Object.keys(forge.md.algorithms).map((s) => `hmac+${s}`)\n  return ['hmac', 'hmac+md5', 'xor', ...additions]\n}\n\nconst getSupportedClipboard = (images: boolean) =>\n  images ? [...XPRA_CLIPBOARD_TARGETS, 'image/png'] : XPRA_CLIPBOARD_TARGETS\n\nfunction createNewSessionData({\n  startNewSession,\n  exitWithChildren,\n  exitWithClient,\n  startCommand,\n}: XpraConnectionOptions): Partial<XpraStartNewSession> {\n  if (startNewSession) {\n    const startKey = exitWithChildren ? 'start-child' : 'start'\n    return {\n      mode: startNewSession as XpraStartNewSessionMode,\n      'exit-with-children': exitWithChildren,\n      'exit-with-client': exitWithClient,\n      [startKey]: exitWithClient ? [startCommand] : [],\n    }\n  }\n\n  return {}\n}\n\nexport function createXpraScreen(w: number, h: number): XpraScreen[] {\n  const dpi = getBrowserDPI()\n  const wmm = Math.round((w * 25.4) / dpi)\n  const hmm = Math.round((h * 25.4) / dpi)\n\n  const monitor = ['Canvas', 0, 0, w, h, wmm, hmm] as XpraMonitor\n  const screen = ['HTML', w, h, wmm, hmm, [monitor], 0, 0, w, h] as XpraScreen\n\n  return [screen]\n}\n\nexport function createXpraCapabilities(\n  capabilities: Partial<XpraCapabilities> = {},\n  check = true\n): XpraCapabilities {\n  const size = [window.innerWidth, window.innerHeight] as XpraVector\n\n  const digests = getSupportedDigests()\n  const platform = getBrowserPlatform()\n  const browser = getBrowser()\n\n  const selections: XpraClipboardSelection[] = getBrowserSupportsClipboard()\n    ? ['CLIPBOARD']\n    : ['CLIPBOARD', 'PRIMARY']\n\n  const rencode = rencode_selftest()\n  const supportedEncodings = XPRA_IMAGE_ENCODERS\n\n  const result: XpraCapabilities = {\n    version: XPRA_HTML5_VERSION,\n    'build.revision': XPRA_HTML5_REVISION,\n    'build.local_modifications': XPRA_HTML5_LOCAL_MODIFICATIONS,\n    'build.branch': XPRA_HTML5_BRANCH,\n    platform: platform.type,\n    'platform.name': platform.name,\n    'platform.processor': platform.processor,\n    'platform.platform': platform.platform,\n    'session-type': browser.name,\n    'session-type.full': browser.agent,\n    namespace: true,\n    'clipboard.contents-slice-fix': true,\n    client_type: 'HTML5',\n    'websocket.multi-packet': true,\n    'setting-change': true,\n    uuid: createHexUUID(),\n    argv: [window.location.href],\n    digest: digests,\n    'salt-digest': digests,\n    zlib: true,\n    compression_level: 1,\n    'file-transfer': false,\n    printing: false,\n    share: false,\n    steal: false,\n    username: '',\n    display: '',\n    'mouse.show': true,\n    rencode: rencode,\n    rencodeplus: rencode,\n    bencode: true,\n    yaml: false,\n    'open-url': true,\n    'ping-echo-sourceid': true,\n    vrefresh: -1,\n    'xdg-menu-update': true,\n    'bandwidth-limit': 0,\n    'connection-data': getBrowserConnectionInfo(),\n    lz4: true,\n    'encoding.rgb_lz4': true,\n    brotli: true,\n    'clipboard.preferred-targets': [],\n    'start-new-session': undefined,\n    auto_refresh_delay: 500,\n    randr_notify: true,\n    'sound.server_driven': true,\n    'server-window-resize': true,\n    'screen-resize-bigger': false,\n    'metadata.supported': [\n      'fullscreen',\n      'maximized',\n      'iconic',\n      'above',\n      'below',\n      //'set-initial-position', 'group-leader',\n      'title',\n      'size-hints',\n      'class-instance',\n      'transient-for',\n      'window-type',\n      'has-alpha',\n      'decorations',\n      'override-redirect',\n      'tray',\n      'modal',\n      'opacity',\n      //'shadow', 'desktop',\n    ],\n    encoding: 'auto',\n    encodings: supportedEncodings,\n    'encoding.icons.max_size': [30, 30],\n    'encodings.core': supportedEncodings,\n    'encodings.rgb_formats': XPRA_RGB_FORMATS,\n    'encodings.window-icon': ['png'],\n    'encodings.cursor': ['png'],\n    'encoding.flush': true,\n    'encoding.transparency': true,\n    'encoding.scrolling': supportedEncodings.includes('scroll'),\n    //'encoding.scrolling.min-percent': 30,\n    'encoding.decoder-speed': { video: 0 },\n    'encodings.packet': true,\n    //'encoding.min-speed': 80,\n    //'encoding.min-quality': 50,\n    'encoding.color-gamut': getBrowserColorGamut(),\n    //'encoding.non-scroll': ['rgb32', 'png', 'jpeg'],\n    //video stuff:\n    'encoding.video_scaling': true,\n    'encoding.video_max_size': [1024, 768],\n    'encoding.eos': true,\n    'encoding.full_csc_modes': {\n      mpeg1: ['YUV420P'],\n      h264: ['YUV420P'],\n      'mpeg4+mp4': ['YUV420P'],\n      'h264+mp4': ['YUV420P'],\n      'vp8+webm': ['YUV420P'],\n      webp: ['BGRX', 'BGRA'],\n      jpeg: [\n        'BGRX',\n        'BGRA',\n        'BGR',\n        'RGBX',\n        'RGBA',\n        'RGB',\n        'YUV420P',\n        'YUV422P',\n        'YUV444P',\n      ],\n    },\n    //this is a workaround for server versions between 2.5.0 to 2.5.2 only:\n    'encoding.x264.YUV420P.profile': 'baseline',\n    'encoding.h264.YUV420P.profile': 'baseline',\n    'encoding.h264.YUV420P.level': '2.1',\n    'encoding.h264.cabac': false,\n    'encoding.h264.deblocking-filter': false,\n    'encoding.h264.fast-decode': true,\n    'encoding.h264+mp4.YUV420P.profile': 'baseline',\n    'encoding.h264+mp4.YUV420P.level': '3.0',\n    //prefer native video in mp4/webm container to broadway plain h264:\n    'encoding.h264.score-delta': -20,\n    'encoding.h264+mp4.score-delta': 50,\n    'encoding.h264+mp4.': 50,\n    //'encoding.h264+mp4.fast-decode': true,\n    'encoding.mpeg4+mp4.score-delta': 40,\n    //'encoding.mpeg4+mp4.fast-decode': true,\n    'encoding.vp8+webm.score-delta': 40,\n    'sound.receive': true,\n    'sound.send': false,\n    'sound.decoders': [],\n    'sound.bundle-metadata': true,\n    'encoding.rgb_zlib': true,\n    windows: true,\n    'window.pre-map': true,\n    keyboard: true,\n    xkbmap_layout: browser.layout,\n    xkbmap_keycodes: get_key_codes() as XpraXkbpMapKeycode[],\n    xkbmap_print: '',\n    xkbmap_query: '',\n    desktop_size: size,\n    desktop_mode_size: size,\n    screen_sizes: createXpraScreen(size[0], size[1]),\n    dpi: getBrowserDPI(),\n    clipboard: true,\n    'clipboard.want_targets': true,\n    'clipboard.greedy': true,\n    'clipboard.selections': selections,\n    notifications: true,\n    'notifications.close': true,\n    'notifications.actions': true,\n    cursors: true,\n    bell: true,\n    system_tray: true,\n    named_cursors: false,\n    'file-size-limit': 10,\n    flush: true,\n\n    // Encryption\n    cipher: undefined,\n    'cipher.mode': undefined,\n    'cipher.iv': undefined,\n    'cipher.key_salt': undefined,\n    'cipher.key_size': undefined,\n    'cipher.key_hash': undefined,\n    'cipher.key_stretch_iterations': undefined,\n    'cipher.padding.options': undefined,\n\n    ...capabilities,\n  }\n\n  if (check) {\n    Object.entries(result).forEach(([k, v]) => {\n      if (v === null) {\n        throw new XpraCapabilityError(\n          `Invalid value ('${v}') for capability '${k}'`\n        )\n      }\n    })\n  }\n\n  return Object.fromEntries(\n    Object.entries(result).filter(([, v]) => v !== undefined)\n  ) as unknown as XpraCapabilities\n}\n\nexport function createXpraCapabilitiesFromOptions(\n  options: XpraConnectionOptions\n): Partial<XpraCapabilities> {\n  const size = [window.innerWidth, window.innerHeight] as XpraVector\n  const startNewSession = createNewSessionData(options)\n\n  const capabilities = {\n    'clipboard.preferred-targets': getSupportedClipboard(\n      options.clipboardImages\n    ),\n    'bandwidth-limit': options.bandWidthLimit,\n    'xdg-menu-update': options.showStartMenu,\n    'start-new-session': startNewSession,\n    share: options.shareSession,\n    steal: options.stealSession,\n    username: options.username,\n    display: options.display,\n    'file-transfer': options.fileTransfer,\n    'open-url': options.openUrl,\n    printing: options.printing,\n    clipboard: options.clipboard,\n    desktop_size: size,\n    desktop_mode_size: size,\n    cursors: options.cursor,\n    bell: options.bell,\n    system_tray: options.tray,\n    notifications: options.notifications,\n    xkbmap_layout: options.keyboardLayout,\n    encoding: options.encoder,\n  }\n\n  if (options.encryption) {\n    const [enc, mode] = options.encryption.split('-')\n\n    if (enc !== 'AES') {\n      throw new XpraCapabilityError(`Invalid encryption: ${enc} (${mode})`)\n    }\n\n    Object.assign(capabilities, {\n      cipher: enc,\n      'cipher.mode': mode,\n      'cipher.iv': createRandomSecureString(16),\n      'cipher.key_salt': createRandomSecureString(32),\n      'cipher.key_size': 32, // 256 bits\n      'cipher.key_hash': 'SHA1',\n      'cipher.key_stretch_iterations': 1000,\n      'cipher.padding.options': ['PKCS#7'],\n    })\n  }\n\n  if (options.video) {\n    const encodings = [...XPRA_IMAGE_ENCODERS, 'h264']\n    if (JSMpeg && JSMpeg.Renderer && JSMpeg.Decoder) {\n      encodings.push('mpeg1')\n    }\n\n    if (options.nativeVideo) {\n      encodings.push('vp8+webm', 'h264+mp4', 'mpeg4+mp4')\n    }\n\n    Object.assign(capabilities, {\n      encodings,\n      'encodings.core': encodings,\n    })\n  }\n\n  return capabilities\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * @link https://github.com/Xpra-org/xpra-html5\n */\n\nimport TypedEmitter from 'typed-emitter'\nimport EventEmitter from 'events'\nimport { XPRA_READ_ONLY_PACKETS } from '../constants'\nimport { XpraWebsocket, XpraConnectionStatus } from '../io/ws'\nimport { XpraClipboard } from '../io/clipboard'\nimport { XpraAudio } from '../io/audio'\nimport { XpraKeyboard } from '../io/keyboard'\nimport { XpraMouse } from '../io/mouse'\nimport { XpraConnectionWorker } from './worker'\nimport { XpraLogger, XpraLoggerArguments } from '../io/logger'\nimport { defaultXpraConnectionOptions } from './options'\nimport { createXpraChallengeResponse } from './auth'\nimport { createXDGMenu } from '../utils/xdg'\nimport { imageSourceFromData } from '../utils/image'\nimport { uint8toString } from '../utils/data'\nimport { unescapeUri, getBrowserConnectionInfo } from '../utils/browser'\nimport {\n  XpraConnectionError,\n  XpraChallengeError,\n  XpraDisconnectionError,\n} from '../errors'\nimport {\n  createXpraScreen,\n  createXpraCapabilities,\n  createXpraCapabilitiesFromOptions,\n} from './capabilities'\nimport {\n  XpraDrawEncoding,\n  XpraDrawScrollData,\n  XpraConnectionStats,\n  XpraConnectionOptions,\n  XpraDrawOptions,\n  XpraDraw,\n  XpraNotification,\n  XpraCursor,\n  XpraWindowIcon,\n  XpraWindowClientProperties,\n  XpraWindowState,\n  XpraWindowMetadata,\n  XpraWindow,\n  XpraWindowMoveResize,\n  XpraWindowInitiateMoveResize,\n  XpraWindowMetadataUpdate,\n  XpraCapabilities,\n  XpraServerCapabilities,\n  XpraVector,\n  XpraSendPacket,\n  XpraRecievePacket,\n  XpraRecievePacketType,\n  XpraPacketArguments,\n  XpraSettingChangeValue,\n  XpraSendFile,\n  XpraLogLevel,\n  XpraAudioOptions,\n  XpraAudioMetadata,\n  XpraAudioCodecType,\n  XpraClipboardSelection,\n  XpraClipboardTarget,\n  XpraInfoResponse,\n  XpraPointerPosition,\n  XpraXDGReducedMenu,\n} from '../types'\n\nexport type XpraClientEventEmitters = {\n  connect: (status: XpraConnectionStatus) => void\n  disconnect: (status: XpraConnectionStatus) => void\n  error: (message: string) => void\n  sessionStarted: () => void\n  newWindow: (win: XpraWindow) => void\n  removeWindow: (wid: number) => void\n  windowIcon: (icon: XpraWindowIcon) => void\n  moveResizeWindow: (data: XpraWindowMoveResize) => void\n  initiateMoveResize: (data: XpraWindowInitiateMoveResize) => void\n  updateWindowMetadata: (data: XpraWindowMetadataUpdate) => void\n  raiseWindow: (wid: number) => void\n  showNotification: (notification: XpraNotification) => void\n  hideNotification: (id: number) => void\n  pong: (stats: XpraConnectionStats) => void\n  cursor: (cursor: XpraCursor | null) => void\n  draw: (draw: XpraDraw) => void\n  hello: (capabilities: XpraServerCapabilities) => void\n  sendFile: (file: XpraSendFile) => void\n  infoResponse: (info: XpraInfoResponse) => void\n  newTray: (win: XpraWindow) => void\n  eos: (wid: number) => void\n  pointerPosition: (pointer: XpraPointerPosition) => void\n  updateXDGMenu: (menu: XpraXDGReducedMenu) => void\n}\n\nexport const initialXpraConnectionStats: XpraConnectionStats = {\n  lastServerPing: 0,\n  lastClientEcho: 0,\n  clientPingLatency: 0,\n  serverPingLatency: 0,\n  serverLoad: [0, 0, 0],\n}\n\n/**\n * @noInheritDoc\n */\nexport class XpraClient extends (EventEmitter as unknown as new () => TypedEmitter<XpraClientEventEmitters>) {\n  private capabilities: XpraCapabilities = createXpraCapabilities({}, false)\n  private options: XpraConnectionOptions = { ...defaultXpraConnectionOptions }\n  private stats: XpraConnectionStats = { ...initialXpraConnectionStats }\n  private serverCapabilities: XpraServerCapabilities | null = null\n  private connectionCheckTimeout = 0\n  private pingInterval = 0\n  private inited = false\n  private started = false\n  private readonly worker\n  private readonly audio = new XpraAudio()\n  private readonly ws = new XpraWebsocket()\n  public readonly clipboard = new XpraClipboard()\n  public readonly keyboard = new XpraKeyboard()\n  public readonly mouse = new XpraMouse()\n  public readonly logger = new XpraLogger()\n\n  private processorBindings: Record<\n    XpraRecievePacketType,\n    (...args: XpraPacketArguments) => void\n  > = {\n    'new-window': this.processNewWindow,\n    'window-icon': this.processWindowIcon,\n    'startup-complete': this.processStartupComplete,\n    'setting-change': this.processSettingChange,\n    'window-move-resize': this.processWindowMoveResize,\n    'window-resized': this.processWindowResized,\n    'raise-window': this.processWindowRaise,\n    'lost-window': this.processWindowLost,\n    'window-metadata': this.processWindowMetadata,\n    'new-override-redirect': this.processNewOverrideRedirect,\n    'configure-override-redirect': this.processConfigureOverrideRedirect,\n    'initiate-moveresize': this.processInitiateMoveResize,\n    'send-file': this.processSendFile,\n    'sound-data': this.processSoundData,\n    'clipboard-token': this.processClipboardToken,\n    'set-clipboard-enabled': this.processSetClipboardEnabled,\n    'clipboard-request': this.processClipboardRequest,\n    'info-response': this.processInfoResponse,\n    'new-tray': this.processNewTray,\n    'pointer-position': this.processPointerPosition,\n    'open-url': this.processOpenUrl,\n    notify_show: this.processShowNotification,\n    notify_close: this.processCloseNotification,\n    encodings: this.processEncodings,\n    cursor: this.processCursor,\n    hello: this.processHello,\n    ping: this.processPing,\n    ping_echo: this.processPingEcho,\n    draw: this.processDraw,\n    bell: this.processBell,\n    challenge: this.processChallenge,\n    eos: this.processEos,\n    disconnect: this.processDisconnect,\n  }\n\n  constructor(worker: Worker) {\n    super()\n    this.worker = new XpraConnectionWorker(worker)\n  }\n\n  async init() {\n    if (this.inited) {\n      return\n    }\n\n    await this.worker.init()\n    await this.audio.init()\n\n    this.inited = true\n\n    this.ws.on('open', () => this.handshake())\n    this.ws.on('error', (err: Error) => this.disconnect(err))\n    this.ws.on('close', (err?: Error) => this.disconnect(err))\n    this.ws.on('connect', (s) => this.emit('connect', s))\n    this.ws.on('disconnect', (s) => this.emit('disconnect', s))\n    this.ws.on('message', (d: Uint8Array) => this.worker.pushRecieve(d))\n\n    this.worker.on('recieve', (p: XpraRecievePacket) => this.recieve(p))\n    this.worker.on('send', (d: ArrayBuffer) => this.ws.send(d))\n    this.worker.on('failure', (e: Error) => this.disconnect(e))\n\n    this.audio.on('start', () => this.sendSoundStart())\n    this.audio.on('stop', () => this.sendSoundStop())\n\n    this.clipboard.on('send', (...args) => this.sendClipboard(...args))\n    this.clipboard.on('token', (data) => this.sendClipboardToken(data))\n\n    this.keyboard.on('layoutChanged', (l: string) => this.sendLayoutChanged(l))\n\n    this.logger.on('log', (level: XpraLogLevel, args: XpraLoggerArguments) => {\n      this.sendLog(level, args)\n    })\n\n    if ('connection' in navigator) {\n      navigator.connection.addEventListener('change', () => {\n        if (this.ws.connected) {\n          this.sendConnectionData()\n        }\n      })\n    }\n  }\n\n  connect(host: string, options: Partial<XpraConnectionOptions> = {}) {\n    if (!this.inited) {\n      throw new XpraConnectionError('Xpra instance not initialized')\n    }\n\n    this.options = {\n      ...defaultXpraConnectionOptions,\n      ...options,\n    }\n\n    try {\n      this.clipboard.configure(this.options)\n      this.worker.configure(this.options)\n      this.worker.setConnected(true)\n      this.ws.connect(host, this.options)\n    } catch (e) {\n      this.emit('error', (e as Error).message)\n    }\n  }\n\n  disconnect(error?: Error) {\n    if (error) {\n      console.error('XpraConnection#disconnect', error)\n    }\n\n    const skipReconnect =\n      error instanceof XpraChallengeError ||\n      error instanceof XpraDisconnectionError\n\n    const reconnect = this.options.reconnect && !skipReconnect && !!error\n\n    if (skipReconnect) {\n      this.emit('error', error.message)\n    }\n\n    this.clearTimers()\n    this.audio.stop()\n    this.worker.setConnected(false)\n    this.clipboard.reset()\n    this.serverCapabilities = null\n    this.ws.disconnect(reconnect)\n  }\n\n  private handshake() {\n    this.connectionCheckTimeout = setTimeout(() => {\n      this.disconnect(new XpraConnectionError('Not a valid xpra server?'))\n    }, this.options.connectionTimeout)\n\n    this.createCapabilities()\n    this.sendHello()\n  }\n\n  private recieve(packet: XpraRecievePacket) {\n    const [name, ...args] = packet as [\n      XpraRecievePacketType,\n      ...XpraPacketArguments\n    ]\n\n    if (this.ws.connected) {\n      if (this.processorBindings[name]) {\n        this.processorBindings[name].apply(this, args)\n      } else {\n        console.debug('Unhandled message', name, args)\n      }\n    }\n  }\n\n  private send(packet: XpraSendPacket) {\n    if (this.ws.connected) {\n      if (this.isReadOnly() && XPRA_READ_ONLY_PACKETS.includes(packet[0])) {\n        return\n      }\n\n      const unstartedPackets = ['hello', 'ping', 'ping_echo', 'logging']\n      if (!this.started && !unstartedPackets.includes(packet[0])) {\n        return\n      }\n\n      this.worker.pushSend(packet)\n    }\n  }\n\n  private clearTimers() {\n    clearTimeout(this.connectionCheckTimeout)\n    clearInterval(this.pingInterval)\n  }\n\n  private createCapabilities(append: Partial<XpraCapabilities> = {}) {\n    this.capabilities = createXpraCapabilities({\n      ...createXpraCapabilitiesFromOptions(this.options),\n      'sound.decoders': this.audio.getDecoders(),\n      ...append,\n    })\n  }\n\n  getOptions() {\n    return { ...this.options }\n  }\n\n  getCapabilities() {\n    return { ...this.capabilities }\n  }\n\n  getServerCapabilities() {\n    return this.serverCapabilities ? { ...this.serverCapabilities } : null\n  }\n\n  isReady() {\n    return this.started\n  }\n\n  isReadOnly() {\n    return !!this.serverCapabilities?.readonly\n  }\n\n  sendResize(iw: number, ih: number) {\n    const w = Math.round(iw)\n    const h = Math.round(ih)\n    this.send(['desktop_size', w, h, createXpraScreen(w, h)])\n  }\n\n  sendCloseWindow(wid: number) {\n    this.send(['close-window', wid])\n  }\n\n  sendMapWindow(win: XpraWindow) {\n    const [x, y] = win.position\n    const [w, h] = win.dimension\n    this.send([\n      'map-window',\n      win.id,\n      Math.round(x),\n      Math.round(y),\n      Math.round(w),\n      Math.round(h),\n      win.clientProperties,\n    ])\n  }\n\n  sendUnmapWindow(win: XpraWindow) {\n    this.send(['unmap-window', win.id, true])\n  }\n\n  sendGeometryWindow(wid: number, position: XpraVector, dimension: XpraVector) {\n    const [x, y] = position\n    const [w, h] = dimension\n\n    this.send([\n      'configure-window',\n      wid,\n      Math.round(x),\n      Math.round(y),\n      Math.round(w),\n      Math.round(h),\n      {},\n    ])\n  }\n\n  private sendConfigureWindow(\n    wid: number,\n    position: XpraVector,\n    dimension: XpraVector,\n    clientProperties: XpraWindowClientProperties,\n    state: XpraWindowState,\n    skipGeometry: boolean\n  ) {\n    const [x, y] = position\n    const [w, h] = dimension\n\n    this.send([\n      'configure-window',\n      wid,\n      Math.round(x),\n      Math.round(y),\n      Math.round(w),\n      Math.round(h),\n      clientProperties,\n      0,\n      state,\n      skipGeometry,\n    ])\n  }\n\n  private sendDamageSequence(\n    packetSequence: number,\n    wid: number,\n    dimension: XpraVector,\n    decodeTime: number,\n    message = ''\n  ) {\n    if (decodeTime < 0) {\n      console.warn('XpraConnection#sendDamageSequence', decodeTime)\n    }\n\n    this.send([\n      'damage-sequence',\n      packetSequence,\n      wid,\n      ...dimension,\n      decodeTime,\n      message,\n    ])\n  }\n\n  sendMouseMove(wid: number, position: XpraVector, modifiers: string[]) {\n    const [x, y] = position\n    const buttons: number[] = []\n\n    if (this.options.mouse) {\n      this.send([\n        'pointer-position',\n        wid,\n        [Math.round(x), Math.round(y)],\n        modifiers,\n        buttons,\n      ])\n    }\n  }\n\n  sendMouseWheel(\n    wid: number,\n    scroll: XpraVector,\n    position: XpraVector,\n    modifiers: string[]\n  ) {\n    if (!this.options.mouse || !this.serverCapabilities) {\n      return\n    }\n\n    const [isx, isy] = scroll\n    const precise = !!this.serverCapabilities['wheel.precise']\n    const sx = this.options.reverseScrollX ? -isx : isx\n    const sy = this.options.reverseScrollY ? -isy : isy\n    const buttons: number[] = []\n    const btnX = sx > 0 ? 6 : 7\n    const btnY = sy > 0 ? 5 : 4\n    const btn = sx > 0 ? btnX : btnY\n    const dist = 100 // FIXME: Add a proper value here\n\n    if (precise) {\n      this.send(['wheel-motion', wid, btn, dist, position, modifiers, buttons])\n    } else {\n      this.send(['button-action', wid, btn, true, position, modifiers, buttons])\n      this.send([\n        'button-action',\n        wid,\n        btn,\n        false,\n        position,\n        modifiers,\n        buttons,\n      ])\n    }\n  }\n\n  sendMouseButton(\n    wid: number,\n    position: XpraVector,\n    button: number,\n    pressed: boolean,\n    modifiers: string[]\n  ) {\n    const buttons: number[] = []\n\n    if (this.options.mouse) {\n      this.send([\n        'button-action',\n        wid,\n        button,\n        pressed,\n        position,\n        modifiers,\n        buttons,\n      ])\n    }\n  }\n\n  sendKeyAction(\n    wid: number,\n    keyname: string,\n    pressed: boolean,\n    modifiers: string[],\n    keyval: number,\n    str: string,\n    keycode: number,\n    group: number\n  ) {\n    if (this.options.keyboard) {\n      this.keyboard.onKeyPress(str, pressed)\n\n      this.send([\n        'key-action',\n        wid,\n        keyname,\n        pressed,\n        modifiers,\n        keyval,\n        str,\n        keycode,\n        group,\n      ])\n    }\n  }\n\n  sendLayoutChanged(layout: string) {\n    this.send(['layout-changed', layout, ''])\n  }\n\n  sendWindowRaise(wid: number, windows: XpraWindow[]) {\n    this.send(['focus', wid, []])\n\n    windows.forEach((win) => {\n      this.sendConfigureWindow(\n        win.id,\n        win.position,\n        win.dimension,\n        win.clientProperties,\n        { focused: win.id === wid },\n        true\n      )\n    })\n  }\n\n  sendWindowClose(wid: number) {\n    this.send(['close-window', wid])\n  }\n\n  sendNotificationClose(nid: number) {\n    this.send(['notification-close', nid, 2, ''])\n  }\n\n  sendSuspend(wids: number[]) {\n    this.send(['suspend', true, wids])\n  }\n\n  sendResume(wids: number[]) {\n    this.send(['resume', true, wids])\n    this.sendBufferRefresh(-1)\n\n    // TODO: Request window redraw\n  }\n\n  sendBufferRefresh(wid: number) {\n    this.send([\n      'buffer-refresh',\n      wid,\n      0,\n      100,\n      {\n        'refresh-now': true,\n        batch: { reset: true },\n      },\n      {}, //no client_properties\n    ])\n  }\n\n  sendConnectionData() {\n    const info = getBrowserConnectionInfo()\n    this.send(['connection-data', info])\n  }\n\n  sendSoundStart() {\n    this.send(['sound-control', 'start'])\n  }\n\n  sendSoundStop() {\n    this.send(['sound-control', 'stop'])\n  }\n\n  sendStartCommand(name: string, command: string, ignore: boolean) {\n    this.send(['start-command', name, command, ignore ? 'True' : 'False'])\n  }\n\n  sendFile(\n    filename: string,\n    mime: string,\n    size: number,\n    buffer: ArrayBuffer | Uint8Array\n  ) {\n    if (this.serverCapabilities) {\n      const old = this.options.encoder === 'rencodeplus'\n      const open = !!this.serverCapabilities['open-files']\n      const converted =\n        buffer instanceof ArrayBuffer ? new Uint8Array(buffer) : buffer\n\n      const file = old ? uint8toString(converted) : converted\n\n      this.send(['send-file', filename, mime, false, open, size, file, {}])\n    }\n  }\n\n  sendShutdown() {\n    this.send(['shutdown-server'])\n  }\n\n  private sendClipboardToken(data: string) {\n    if (this.clipboard.isEnabled()) {\n      const claim = true\n      const greedy = true\n      const synchronous = true\n      const type = data ? 'UTF8_STRING' : ''\n      const targets = data ? ['UTF8_STRING', 'text/plain'] : []\n\n      this.send([\n        'clipboard-token',\n        'CLIPBOARD',\n        targets,\n        type,\n        type,\n        8,\n        'bytes',\n        data,\n        claim,\n        greedy,\n        synchronous,\n      ])\n    }\n  }\n\n  private sendLog(level: XpraLogLevel, ...args: XpraLoggerArguments) {\n    if (\n      this.serverCapabilities &&\n      this.serverCapabilities['remote-logging.multi-line']\n    ) {\n      const sargs = args.map((str) => unescapeUri(String(str)))\n      this.send(['logging', level, sargs])\n    }\n  }\n\n  private sendHello() {\n    this.send(['hello', this.capabilities])\n  }\n\n  private sendPing() {\n    const now = Math.ceil(performance.now())\n    this.send(['ping', now])\n  }\n\n  private sendClipboard(\n    requestId: number,\n    selection: string,\n    buffer: string,\n    dataType = 'UTF8_STRING',\n    dataFormat = 8,\n    encoding = 'bytes'\n  ) {\n    if (buffer === '') {\n      this.send(['clipboard-contents-none', requestId, selection])\n    } else {\n      this.send([\n        'clipboard-contents',\n        requestId,\n        selection,\n        dataType,\n        dataFormat,\n        encoding,\n        buffer,\n      ])\n    }\n  }\n\n  private processHello(capabilities: XpraServerCapabilities) {\n    clearTimeout(this.connectionCheckTimeout)\n    this.started = true\n    this.serverCapabilities = capabilities\n    this.emit('hello', this.serverCapabilities)\n    this.keyboard.configure(this.options, capabilities)\n\n    if (this.options.audio) {\n      this.audio.setup(this.serverCapabilities)\n    }\n  }\n\n  private processNewWindow(\n    id: number,\n    ix: number | string,\n    iy: number | string,\n    iw: number | string,\n    ih: number | string,\n    metadata: XpraWindowMetadata,\n    clientProperties: XpraWindowClientProperties = {}\n  ) {\n    const x = parseInt(ix as string)\n    const y = parseInt(iy as string)\n    const w = parseInt(iw as string)\n    const h = parseInt(ih as string)\n\n    this.emit('newWindow', {\n      id,\n      position: [x, y],\n      dimension: [w, h],\n      overrideRedirect: false,\n      metadata,\n      clientProperties,\n    })\n  }\n\n  private processWindowIcon(\n    wid: number,\n    w: number,\n    h: number,\n    encoding: string,\n    data: Uint8Array\n  ) {\n    const image = imageSourceFromData(encoding, data)\n\n    this.emit('windowIcon', {\n      wid,\n      dimension: [w, h],\n      image,\n    })\n  }\n\n  private processStartupComplete() {\n    this.emit('sessionStarted')\n    this.sendPing()\n    this.pingInterval = setInterval(() => this.sendPing(), 5000)\n    this.logger.info('Connection from Xpra HTML client')\n  }\n\n  private processEncodings(caps: string[]) {\n    console.debug('XpraConnection#processEncodings', caps)\n  }\n\n  private processCursor(\n    encoding: string,\n    _unknown1: number,\n    _unknown2: number,\n    w: number,\n    h: number,\n    xhot: number,\n    yhot: number,\n    _unknown3: number,\n    data: string\n  ) {\n    if (!this.options.cursor) {\n      return\n    }\n\n    if (arguments.length < 8) {\n      this.emit('cursor', null)\n    } else if (encoding === 'png') {\n      const image = imageSourceFromData(encoding, data)\n      this.emit('cursor', {\n        dimension: [w, h],\n        image,\n        xhot,\n        yhot,\n      })\n    }\n  }\n\n  private processPing(...packet: number[]) {\n    const echotime = packet.length > 1 ? packet[1] : packet[0]\n    const sid = packet.length >= 3 ? packet[2] : ''\n\n    this.stats.lastServerPing = echotime\n    this.send(['ping_echo', echotime, 0, 0, 0, 0, sid || ''])\n  }\n\n  private processPingEcho(\n    last: number,\n    l1: number,\n    l2: number,\n    l3: number,\n    latency: number\n  ) {\n    this.stats.lastClientEcho = last\n    this.stats.clientPingLatency = latency\n    this.stats.serverPingLatency =\n      Math.ceil(performance.now()) - this.stats.lastClientEcho\n    this.stats.serverLoad = [l1 / 1000.0, l2 / 1000.0, l3 / 1000.0]\n\n    this.emit('pong', { ...this.stats })\n  }\n\n  private processDraw(\n    wid: number,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    encoding: XpraDrawEncoding,\n    image: Uint8Array | XpraDrawScrollData,\n    packetSequence: number,\n    rowStride: number,\n    options: XpraDrawOptions\n  ) {\n    const start = performance.now()\n\n    const sendDamage = (decodeTime: number, message = '') =>\n      this.sendDamageSequence(\n        packetSequence,\n        wid,\n        [width, height],\n        decodeTime,\n        message\n      )\n\n    this.emit('draw', {\n      wid,\n      image,\n      encoding,\n      packetSequence,\n      rowStride,\n      options: options || {},\n      position: [x, y],\n      dimension: [width, height],\n      callback: (error?: Error) => {\n        const decodeTime = Math.round(1000 * performance.now() - 1000 * start)\n        if (error) {\n          console.warn('XpraConnection#processDraw -> callback', error)\n        }\n\n        // TODO: Request redraw\n        sendDamage(decodeTime, error?.message)\n      },\n    })\n  }\n\n  private processSettingChange(setting: string, value: XpraSettingChangeValue) {\n    switch (setting) {\n      case 'xdg-menu':\n        const menu = createXDGMenu(value)\n        this.emit('updateXDGMenu', menu)\n        break\n\n      default:\n        console.debug(\n          'XpraConnection#processSettingChange',\n          'uncaught',\n          setting,\n          value\n        )\n        break\n    }\n  }\n\n  private processWindowMoveResize(\n    wid: number,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n  ) {\n    this.emit('moveResizeWindow', {\n      wid,\n      position: [x, y],\n      dimension: [w, h],\n    })\n  }\n\n  private processWindowResized(wid: number, w: number, h: number) {\n    this.emit('moveResizeWindow', {\n      wid,\n      dimension: [w, h],\n    })\n  }\n\n  private processWindowRaise(wid: number) {\n    this.emit('raiseWindow', wid)\n  }\n\n  private processWindowLost(wid: number) {\n    this.emit('removeWindow', wid)\n  }\n\n  private processWindowMetadata(\n    wid: number,\n    metadata: Partial<XpraWindowMetadata>\n  ) {\n    this.emit('updateWindowMetadata', {\n      wid,\n      metadata,\n    })\n  }\n\n  private processNewOverrideRedirect(\n    id: number,\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    metadata: XpraWindowMetadata,\n    clientProperties: XpraWindowClientProperties = {}\n  ) {\n    this.emit('newWindow', {\n      id,\n      position: [x, y],\n      dimension: [w, h],\n      overrideRedirect: true,\n      metadata,\n      clientProperties,\n    })\n  }\n\n  private processConfigureOverrideRedirect(\n    wid: number,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n  ) {\n    this.emit('moveResizeWindow', {\n      wid,\n      dimension: [w, h],\n      position: [x, y],\n    })\n  }\n\n  private processShowNotification(\n    _unknown1: string,\n    id: number,\n    _unknown2: string,\n    replacesId: number,\n    _unknown3: string,\n    summary: string,\n    body: string,\n    expires: number,\n    icon: [string, number, number, string | Uint8Array] | null,\n    actions: string[],\n    hints: string[]\n  ) {\n    this.emit('showNotification', {\n      id,\n      replacesId,\n      expires,\n      actions,\n      hints,\n      icon: icon ? imageSourceFromData(icon[0], icon[3]) : null,\n      summary,\n      body,\n    })\n  }\n\n  private processCloseNotification(id: number) {\n    this.emit('hideNotification', id)\n  }\n\n  private processBell() {\n    if (this.options.bell) {\n      const snd = new Audio(\n        'data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU='\n      )\n      snd.play()\n    }\n  }\n\n  private processInitiateMoveResize(\n    wid: number,\n    xRoot: number,\n    yRoot: number,\n    direction: number,\n    button: number,\n    sourceIndication: number\n  ) {\n    this.emit('initiateMoveResize', {\n      wid,\n      position: [xRoot, yRoot],\n      direction,\n      button,\n      sourceIndication,\n    })\n  }\n\n  private processSendFile(\n    filename: string,\n    mime: string,\n    print: boolean,\n    size: number,\n    data: Uint8Array\n  ) {\n    if (data.length !== size) {\n      console.warn(\n        'XpraConnection#processSendFile',\n        'Invalid length for',\n        filename\n      )\n      return\n    }\n\n    const blob = new Blob([data], mime as BlobPropertyBag)\n\n    this.emit('sendFile', {\n      filename,\n      mime,\n      size,\n      blob,\n      print,\n    })\n  }\n\n  private processSoundData(\n    codec: XpraAudioCodecType,\n    buffer: Uint8Array | null,\n    options: XpraAudioOptions,\n    metadata: XpraAudioMetadata\n  ) {\n    try {\n      if (!this.options.audio || !this.audio.validate(codec)) {\n        return\n      }\n\n      if (options['start-of-stream'] === 1) {\n        this.audio.start()\n      }\n\n      if (buffer && buffer.length > 0) {\n        this.audio.addQueue(buffer, metadata)\n      }\n\n      if (options['end-of-stream'] === 1) {\n        this.audio.stop()\n      }\n    } catch (e) {\n      console.error('XpraConnection#processSoundData', e)\n      this.audio.stop()\n    }\n  }\n\n  private async processClipboardToken(\n    selection: XpraClipboardSelection,\n    targets: XpraClipboardTarget[],\n    target: XpraClipboardTarget,\n    type: XpraClipboardTarget,\n    format: number,\n    wireEncoding: string,\n    wireData: string | Uint8Array\n  ) {\n    await this.clipboard.write(\n      this.capabilities,\n      selection,\n      targets,\n      target,\n      type,\n      format,\n      wireEncoding,\n      wireData\n    )\n  }\n\n  private processSetClipboardEnabled(enabled: boolean | number) {\n    this.clipboard.setEnabled(!!enabled)\n  }\n\n  private async processClipboardRequest(\n    requestId: number,\n    selection: XpraClipboardSelection\n  ) {\n    await this.clipboard.read(requestId, selection)\n  }\n\n  private processChallenge(\n    serverSalt: string,\n    _cipherOutCaps: string,\n    digest: string,\n    saltDigest: string,\n    prompt: string\n  ) {\n    prompt = (prompt || 'password').replace(/[^a-zA-Z0-9\\.,:\\+/]/gi, '')\n    saltDigest = saltDigest || 'xor'\n\n    try {\n      const challengeResponse = createXpraChallengeResponse(\n        serverSalt,\n        digest,\n        saltDigest,\n        this.options.password,\n        this.options.ssl,\n        this.options.encryption\n      )\n\n      if (challengeResponse) {\n        const [response, clientSalt] = challengeResponse\n        this.createCapabilities({\n          challenge_response: response,\n          challenge_client_salt: clientSalt,\n        })\n\n        this.sendHello()\n      }\n    } catch (e) {\n      this.disconnect(e as Error)\n    }\n  }\n\n  private processInfoResponse(info: XpraInfoResponse) {\n    this.emit('infoResponse', info)\n  }\n\n  private processNewTray(\n    id: number,\n    iw: number | string,\n    ih: number | string,\n    metadata: XpraWindowMetadata\n  ) {\n    const w = parseInt(iw as string)\n    const h = parseInt(ih as string)\n\n    this.emit('newTray', {\n      id,\n      metadata,\n      position: [0, 0],\n      dimension: [w, h],\n      overrideRedirect: false,\n      clientProperties: {},\n    })\n  }\n\n  private processPointerPosition(\n    wid: number,\n    ix: number | string,\n    iy: number | string\n  ) {\n    const x = parseInt(ix as string)\n    const y = parseInt(iy as string)\n\n    this.emit('pointerPosition', {\n      wid,\n      position: [x, y],\n    })\n  }\n\n  private processEos(wid: number) {\n    this.emit('eos', wid)\n  }\n\n  private processDisconnect(message: string) {\n    this.disconnect(new XpraDisconnectionError(`Disconnected: ${message}`))\n  }\n\n  private processOpenUrl(url: string) {\n    if (this.options.openUrl) {\n      window.open(url, '_blank')\n    }\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * Original source: https://github.com/Xpra-org/xpra-html5\n */\n\nimport { XpraDraw, XpraDrawScrollData } from '../types'\nimport { imageSourceFromData, loadImage } from '../utils/image'\n\nexport async function encodeXpraDrawData(\n  draw: XpraDraw\n): Promise<CanvasImageSource | ImageData | null> {\n  switch (draw.encoding) {\n    case 'rgb':\n    case 'rgb32':\n    case 'rgb24':\n      const [w, h] = draw.dimension\n\n      return new ImageData(\n        new Uint8ClampedArray((draw.image as Uint8Array).buffer),\n        w,\n        h\n      )\n\n    case 'avif':\n    case 'jpeg':\n    case 'png/P':\n    case 'png/L':\n    case 'png':\n    case 'webp':\n      const data = imageSourceFromData(draw.encoding, draw.image as Uint8Array)\n\n      return loadImage(data)\n\n    default:\n      console.warn('encodeXpraDrawData', 'Unhandled decode', draw)\n  }\n\n  return null\n}\n\nexport async function renderXpraDrawData(\n  canvas: HTMLCanvasElement,\n  draw: XpraDraw\n) {\n  const context = canvas.getContext('2d')\n  const [x, y] = draw.position\n  const [w, h] = draw.dimension\n\n  if (context && draw.encoding !== 'void') {\n    if (draw.encoding === 'scroll') {\n      ;(draw.image as XpraDrawScrollData).forEach(\n        ([sx, sy, sw, sh, xdelta, ydelta]) => {\n          context.drawImage(\n            canvas,\n            sx,\n            sy,\n            sw,\n            sh,\n            sx + xdelta,\n            sy + ydelta,\n            sw,\n            sh\n          )\n        }\n      )\n    } else {\n      const result = await encodeXpraDrawData(draw)\n\n      if (result) {\n        if (result instanceof ImageData) {\n          context.putImageData(result, x, y, 0, 0, w, h)\n        } else {\n          context.clearRect(x, y, w, h)\n          context.drawImage(result, x, y)\n        }\n      }\n    }\n  }\n}\n","/**\n * Xpra Typescript Client\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n *\n * ---\n *\n * Based on original Xpra source\n * Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>\n * Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/\n * Original source: https://github.com/Xpra-org/xpra-html5\n */\n\nimport { debounce } from 'lodash-es'\nimport { XpraClient } from './connection/client'\nimport { renderXpraDrawData } from './io/render'\nimport {\n  XpraWindow,\n  XpraDraw,\n  XpraVector,\n  XpraSendFile,\n  XpraWindowMoveResize,\n  XpraNotification,\n} from './types'\nimport {\n  browserSaveFile,\n  browserPrintFile,\n  createNativeNotification,\n} from './utils/browser'\n\nexport interface XpraWindowManagerWindow {\n  attributes: XpraWindow\n  renderQueue: XpraDraw[]\n  renderPending: number\n  canvas: HTMLCanvasElement\n  inited: boolean\n  destroyed: boolean\n}\n\nexport function createXpraWindowBaseZindex(win: XpraWindow, zIndex: number) {\n  let baseIndex = 5000\n\n  if (win.overrideRedirect) {\n    baseIndex = 30000\n  } else {\n    const type = win.metadata['window-type'] || []\n\n    switch (type[0]) {\n      case 'DROPDOWN':\n      case 'TOOLTIP':\n      case 'POPUP_MENU':\n      case 'MENU':\n      case 'COMBO':\n        baseIndex = 20000\n        break\n\n      case 'UTILITY':\n      case 'DIALOG':\n        baseIndex = 15000\n        break\n    }\n  }\n\n  if (win.metadata.above) {\n    baseIndex += 5000\n  } else if (win.metadata.below) {\n    baseIndex -= 5000\n  }\n\n  return baseIndex + zIndex\n}\n\nexport class XpraWindowManager {\n  private windows: XpraWindowManagerWindow[] = []\n  private xpra: XpraClient\n  private activeWindow = -1\n  private $desktop: HTMLElement | null = null\n\n  constructor(xpra: XpraClient) {\n    this.xpra = xpra\n  }\n\n  init() {\n    const resize = debounce(() => {\n      if (this.$desktop) {\n        const { offsetWidth, offsetHeight } = this.$desktop\n        this.xpra.sendResize(offsetWidth, offsetHeight)\n      }\n    }, 200)\n\n    this.xpra.on('sessionStarted', resize)\n    this.xpra.on('sendFile', this.sendFile.bind(this))\n    this.xpra.on('newWindow', this.createWindow.bind(this))\n    this.xpra.on('newTray', this.createWindow.bind(this))\n\n    this.xpra.on('connect', () => {\n      Notification.requestPermission()\n    })\n\n    this.xpra.on('moveResizeWindow', (data: XpraWindowMoveResize) => {\n      if (data.dimension) {\n        this.onResize(data.wid, data.dimension)\n      }\n    })\n\n    this.xpra.on('draw', (draw: XpraDraw) => {\n      const found = this.getWindow(draw.wid)\n      if (found) {\n        const len = found.renderQueue.push(draw)\n\n        // FIXME: Find a saner limit for this\n        if (len > 10) {\n          console.debug(\n            'XpraWindowManager <- draw',\n            'truncated draw queue for',\n            draw.wid\n          )\n\n          found.renderQueue.splice(-10)\n        }\n      }\n    })\n\n    this.xpra.on('disconnect', () => {\n      this.clearWindows()\n    })\n\n    window.addEventListener('resize', resize)\n    window.addEventListener('keydown', this.onKeyAction.bind(this))\n    window.addEventListener('keyup', this.onKeyAction.bind(this))\n    window.addEventListener('wheel', this.onScrollAction.bind(this))\n    window.addEventListener('mousewheel', this.onScrollAction.bind(this))\n    window.addEventListener('DOMMouseScroll', this.onScrollAction.bind(this))\n  }\n\n  private onKeyAction(ev: KeyboardEvent) {\n    if (this.xpra.isReady() && ev.target === document.body) {\n      ev.preventDefault()\n      ev.stopPropagation()\n    } else {\n      return\n    }\n\n    const win = this.getWindow(this.activeWindow)\n    this.keyPress(win, ev, ev.type === 'keydown')\n  }\n\n  private onScrollAction(ev: WheelEvent | MouseEvent | Event) {\n    const win = this.getWindow(this.activeWindow)\n    if (win) {\n      this.mouseWheel(win, ev)\n    }\n  }\n\n  private onResize(wid: number, dimension: XpraVector) {\n    const win = this.getWindow(wid)\n    if (win) {\n      const [w, h] = dimension\n      if (win.canvas.width !== w) {\n        win.canvas.width = w\n      }\n\n      if (win.canvas.height !== h) {\n        win.canvas.height = h\n      }\n    }\n  }\n\n  private sendFile(file: XpraSendFile) {\n    if (file.print) {\n      browserPrintFile(file.filename, file.blob)\n    } else {\n      browserSaveFile(file.filename, file.blob)\n    }\n  }\n\n  async createNotification(notif: XpraNotification) {\n    const nnotif = await createNativeNotification(notif.summary, {\n      body: notif.body,\n      icon: notif.icon || undefined,\n    })\n\n    if (nnotif) {\n      const onclose = () => this.xpra.sendNotificationClose(notif.id)\n      nnotif.addEventListener('close', onclose)\n    }\n\n    return nnotif\n  }\n\n  clearWindows() {\n    this.windows = []\n  }\n\n  createWindow(attributes: XpraWindow) {\n    const [w, h] = attributes.dimension\n    const canvas = document.createElement('canvas')\n    canvas.width = w\n    canvas.height = h\n\n    const instance = {\n      canvas,\n      attributes,\n      renderQueue: [],\n      renderPending: 0,\n      inited: false,\n      destroyed: false,\n    }\n\n    this.windows.push(instance)\n\n    const anim = async () => {\n      if (!instance.destroyed) {\n        await this.renderWindow(instance)\n\n        window.requestAnimationFrame(anim)\n      }\n    }\n\n    window.requestAnimationFrame(anim)\n\n    this.xpra.sendMapWindow(attributes)\n  }\n\n  private async renderWindow(win: XpraWindowManagerWindow) {\n    const draw = win.renderQueue.shift()\n    if (draw && win.canvas) {\n      try {\n        await renderXpraDrawData(win.canvas, draw)\n        draw.callback()\n      } catch (e) {\n        draw.callback(e as Error)\n        this.renderWindow(win)\n      }\n    }\n  }\n\n  removeWindow(id: number) {\n    const foundIndex = this.windows.findIndex((w) => w.attributes.id === id)\n    if (foundIndex !== -1) {\n      this.windows[foundIndex].destroyed = true\n      this.windows.splice(foundIndex, 1)\n    }\n  }\n\n  updateWindow(attributes: XpraWindow) {\n    const found = this.getWindow(attributes.id)\n    if (found) {\n      Object.assign(found.attributes, attributes)\n    }\n  }\n\n  moveResize(\n    win: XpraWindowManagerWindow,\n    position: XpraVector,\n    dimension: XpraVector\n  ) {\n    this.onResize(win.attributes.id, dimension)\n    this.xpra.sendGeometryWindow(win.attributes.id, position, dimension)\n  }\n\n  mouseButton(\n    win: XpraWindowManagerWindow | null,\n    ev: MouseEvent,\n    pressed: boolean\n  ) {\n    const modifiers = this.xpra.keyboard.getModifiers(ev)\n    const button = this.xpra.mouse.getButton(ev)\n    const position = this.xpra.mouse.getPosition(ev)\n\n    this.xpra.sendMouseButton(\n      win ? win.attributes.id : -1,\n      position,\n      button,\n      pressed,\n      modifiers\n    )\n  }\n\n  mouseWheel(\n    win: XpraWindowManagerWindow,\n    ev: WheelEvent | MouseEvent | Event\n  ) {\n    const modifiers = this.xpra.keyboard.getModifiers(ev as MouseEvent)\n    const position = this.xpra.mouse.getPosition(ev as MouseEvent)\n    const wheel = this.xpra.mouse.getScroll(ev)\n\n    this.xpra.sendMouseWheel(win.attributes.id, wheel, position, modifiers)\n  }\n\n  mouseMove(win: XpraWindowManagerWindow | null, ev: MouseEvent) {\n    const wid = win ? win.attributes.id : 0\n    const modifiers = this.xpra.keyboard.getModifiers(ev)\n    const position = this.xpra.mouse.getPosition(ev)\n\n    this.xpra.sendMouseMove(wid, position, modifiers)\n  }\n\n  keyPress(\n    win: XpraWindowManagerWindow | null,\n    ev: KeyboardEvent,\n    pressed: boolean\n  ) {\n    const wid = win ? win.attributes.id : 0\n    const modifiers = this.xpra.keyboard.getModifiers(ev)\n    const { keyname, keycode, keyval, group, str } =\n      this.xpra.keyboard.getKey(ev)\n\n    this.xpra.sendKeyAction(\n      wid,\n      keyname,\n      pressed,\n      modifiers,\n      keyval,\n      str,\n      keycode,\n      group\n    )\n  }\n\n  raise(win: XpraWindowManagerWindow) {\n    const wins = this.windows.map((w) => w.attributes)\n    this.xpra.sendWindowRaise(win.attributes.id, wins)\n  }\n\n  minimize(win: XpraWindowManagerWindow) {\n    this.xpra.sendUnmapWindow(win.attributes)\n  }\n\n  maximize(\n    win: XpraWindowManagerWindow,\n    position: XpraVector,\n    dimension: XpraVector\n  ) {\n    this.restore(win)\n    this.moveResize(win, position, dimension)\n  }\n\n  restore(win: XpraWindowManagerWindow) {\n    this.xpra.sendMapWindow(win.attributes)\n  }\n\n  close(win: XpraWindowManagerWindow) {\n    this.xpra.sendCloseWindow(win.attributes.id)\n  }\n\n  getWindow(id: number): XpraWindowManagerWindow | null {\n    return this.windows.find((w) => w.attributes.id === id) || null\n  }\n\n  setDesktopElement(el: HTMLElement | null) {\n    this.$desktop = el\n  }\n\n  setActiveWindow(wid: number) {\n    this.activeWindow = wid\n  }\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React from 'react'\nimport { XpraCursor, XpraWindowMetadata } from '../xpra'\n\nexport function createCursorBackgroundCSS(cursor: XpraCursor | null) {\n  if (cursor) {\n    const { image, xhot, yhot } = cursor\n    return `transparent url('${image}') no-repeat ${xhot}px ${yhot}px`\n  }\n\n  return ''\n}\n\nexport function createCursorCSS(cursor: XpraCursor | null, defaultValue = '') {\n  if (cursor) {\n    const { image, xhot, yhot } = cursor\n    const suffix = defaultValue ? `, ${defaultValue}` : ''\n    return `url('${image}') ${xhot} ${yhot}${suffix}`\n  }\n\n  return defaultValue\n}\n\nexport function detectCorner(\n  root: HTMLElement,\n  position: [number, number],\n  size: number\n) {\n  let direction = ''\n  const { width, height, x, y } = root.getBoundingClientRect()\n  const relativeX = position[0] - x\n  const relativeY = position[1] - y\n\n  if (relativeY <= size) {\n    direction += 'n'\n  } else if (relativeY >= height - size) {\n    direction += 's'\n  }\n\n  if (relativeX <= size) {\n    direction += 'w'\n  } else if (relativeX >= width - size) {\n    direction += 'e'\n  }\n\n  return direction\n}\n\nexport function useDrag(\n  callback: () => {\n    onDown?: (ev: MouseEvent, startX: number, startY: number) => void\n    onMove: (ev: MouseEvent, diffX: number, diffY: number) => void\n    onRelease: (ev: MouseEvent, moved: boolean) => void\n  }\n) {\n  const { onDown, onMove, onRelease } = callback()\n  return (ev: React.MouseEvent<HTMLElement>) => {\n    ev.preventDefault()\n\n    const startX = ev.pageX\n    const startY = ev.pageY\n    let moved = false\n\n    const onMouseMove = (ev: MouseEvent) => {\n      const diffX = ev.pageX - startX\n      const diffY = ev.pageY - startY\n      moved = true\n      onMove(ev, diffX, diffY)\n    }\n\n    const onMouseUp = (ev: MouseEvent) => {\n      window.removeEventListener('mousemove', onMouseMove)\n      window.removeEventListener('mouseup', onMouseUp)\n      onRelease(ev, moved)\n    }\n\n    window.addEventListener('mousemove', onMouseMove)\n    window.addEventListener('mouseup', onMouseUp)\n\n    if (onDown) {\n      onDown(ev.nativeEvent, startX, startY)\n    }\n  }\n}\n\nexport function createOpacity({\n  opacity,\n}: Partial<XpraWindowMetadata>): number | undefined {\n  if (typeof opacity === 'number') {\n    return opacity < 0 ? 1 : opacity / 0x100000000\n  }\n\n  return undefined\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport { ActionMap, ValueOf } from './types'\nimport { createOpacity } from './utils'\nimport {\n  XpraWindow,\n  XpraWindowIcon,\n  XpraConnectionStats,\n  XpraWindowMoveResize,\n  XpraWindowMetadataUpdate,\n  XpraCursor,\n  XpraNotification,\n  XpraVector,\n  XpraConnectionOptions,\n  XpraXDGReducedMenu,\n  defaultXpraConnectionOptions,\n  initialXpraConnectionStats,\n  createXpraWindowBaseZindex,\n} from '../xpra'\n\nexport interface AppWindowState {\n  id: number\n  title: string\n  minimized: boolean\n  maximized: boolean\n  position: XpraVector\n  dimension: XpraVector\n  icon?: XpraWindowIcon\n  zIndex: number\n  tray: boolean\n  opacity?: number\n  maxDimension?: XpraVector\n  minDimension?: XpraVector\n  oldPosition?: XpraVector\n  oldDimension?: XpraVector\n}\n\nexport interface AppState {\n  connect: boolean\n  host: string\n  showOptions: boolean\n  connected: boolean\n  cursor: XpraCursor | null\n  stats: XpraConnectionStats\n  windows: AppWindowState[]\n  draggingWindow: number\n  activeWindow: number\n  notifications: [XpraNotification, Notification | null][]\n  actualDesktopSize: XpraVector\n  options: XpraConnectionOptions\n  menu: XpraXDGReducedMenu\n  error: string\n  started: boolean\n}\n\nexport interface AppMaximizeWindow {\n  wid: number\n  position?: XpraVector\n  dimension?: XpraVector\n  maximize: boolean\n}\n\nexport enum ActionTypes {\n  SetHost = 'SET_HOST',\n  SetShowOptions = 'SET_SHOW_OPTIONS',\n  AddWindow = 'ADD_WINDOW',\n  RemoveWindow = 'REMOVE_WINDOW',\n  SetWindowIcon = 'SET_WINDOW_ICON',\n  SetConnected = 'SET_CONNECTED',\n  SetCursor = 'SET_CURSOR',\n  UpdateStats = 'UPDATE_STATS',\n  MoveResizeWindow = 'MOVE_RESIZE_WINDOW',\n  MaximizeWindow = 'MAXIMIZE_WINDOW',\n  UpdateMetadata = 'UPDATE_METADATA',\n  RaiseWindow = 'RAISE_WINDOW',\n  AddNotification = 'ADD_NOTIFICATION',\n  RemoveNotification = 'REMOVE_NOTIFICATION,',\n  SetDraggingWindow = 'SET_DRAGGING_WINDOW',\n  ClearWindows = 'CLEAR_WINDOWS',\n  SetOption = 'SET_OPTION',\n  UpdateMenu = 'UPDATE_MENU',\n  SetError = 'SET_ERROR',\n  SetStarted = 'SET_STARTED',\n}\n\nexport type AppStatePayload = {\n  [ActionTypes.SetHost]: string\n  [ActionTypes.SetShowOptions]: boolean\n  [ActionTypes.AddWindow]: XpraWindow\n  [ActionTypes.RemoveWindow]: number\n  [ActionTypes.SetWindowIcon]: XpraWindowIcon\n  [ActionTypes.SetConnected]: boolean\n  [ActionTypes.SetCursor]: XpraCursor | null\n  [ActionTypes.UpdateStats]: XpraConnectionStats\n  [ActionTypes.MoveResizeWindow]: XpraWindowMoveResize\n  [ActionTypes.MaximizeWindow]: AppMaximizeWindow\n  [ActionTypes.UpdateMetadata]: XpraWindowMetadataUpdate\n  [ActionTypes.RaiseWindow]: XpraWindow\n  [ActionTypes.AddNotification]: [XpraNotification, Notification | null]\n  [ActionTypes.RemoveNotification]: number\n  [ActionTypes.SetDraggingWindow]: number\n  [ActionTypes.ClearWindows]: undefined\n  [ActionTypes.SetOption]: [\n    keyof XpraConnectionOptions,\n    ValueOf<XpraConnectionOptions>\n  ]\n  [ActionTypes.UpdateMenu]: XpraXDGReducedMenu\n  [ActionTypes.SetError]: string\n  [ActionTypes.SetStarted]: boolean\n}\n\nexport type AppStateActions =\n  ActionMap<AppStatePayload>[keyof ActionMap<AppStatePayload>]\n\nlet lastZindex = 1\n\nexport const initialState: AppState = {\n  connect: false,\n  host: 'ws://127.0.0.1:10000',\n  showOptions: false,\n  connected: false,\n  cursor: null,\n  windows: [],\n  notifications: [],\n  activeWindow: 0,\n  draggingWindow: -1,\n  actualDesktopSize: [0, 0],\n  stats: { ...initialXpraConnectionStats },\n  options: { ...defaultXpraConnectionOptions },\n  menu: [],\n  error: '',\n  started: false,\n}\n\nexport function stateReducer(state: AppState, action: AppStateActions) {\n  const newWindowState = (\n    wid: number,\n    append: (data: AppWindowState) => Partial<AppWindowState>\n  ) => {\n    const windows = state.windows\n    const found = windows.find((w) => w.id === wid)\n    if (found) {\n      Object.assign(found, append(found))\n    }\n\n    return {\n      ...state,\n      windows,\n    }\n  }\n\n  switch (action.type) {\n    case ActionTypes.SetHost:\n      return {\n        ...state,\n        host: action.payload,\n      }\n\n    case ActionTypes.SetShowOptions:\n      return {\n        ...state,\n        showOptions: action.payload,\n      }\n\n    case ActionTypes.AddWindow:\n      const isTray = !!action.payload.metadata.tray\n      return {\n        ...state,\n        activeWindow: action.payload.id,\n        windows: [\n          ...state.windows,\n          {\n            id: action.payload.id,\n            minimized: action.payload.metadata.iconic === true,\n            maximized: false,\n            title: action.payload.metadata.title || String(action.payload.id),\n            position: action.payload.position,\n            dimension: action.payload.dimension,\n            minDimension:\n              action.payload.metadata['size-constraints']?.['minimum-size'],\n            maxDimension:\n              action.payload.metadata['size-constraints']?.['maximum-size'],\n            opacity: createOpacity(action.payload.metadata),\n            tray: isTray,\n            zIndex: isTray\n              ? 0\n              : createXpraWindowBaseZindex(action.payload, ++lastZindex),\n          },\n        ],\n      }\n\n    case ActionTypes.RemoveWindow:\n      const { windows } = state\n      const foundIndex = windows.findIndex((w) => w.id === action.payload)\n      if (foundIndex !== -1) {\n        windows.splice(foundIndex, 1)\n      }\n\n      const nextActiveWindow =\n        windows.length > 0 ? windows[windows.length - 1].id : 0\n\n      return {\n        ...state,\n        activeWindow: nextActiveWindow,\n        windows,\n      }\n\n    case ActionTypes.SetWindowIcon:\n      const icon = action.payload\n      return newWindowState(icon.wid, () => ({ icon }))\n\n    case ActionTypes.SetConnected:\n      return {\n        ...state,\n        started: false,\n        windows: action.payload ? state.windows : [],\n        connected: action.payload,\n      }\n\n    case ActionTypes.SetCursor:\n      return {\n        ...state,\n        cursor: action.payload,\n      }\n\n    case ActionTypes.UpdateStats:\n      return {\n        ...state,\n        stats: {\n          ...state.stats,\n          ...action.payload,\n        },\n      }\n\n    case ActionTypes.MoveResizeWindow:\n      const { wid, position, dimension } = action.payload\n      return newWindowState(wid, (win) => ({\n        position: position || win.position,\n        dimension: dimension || win.dimension,\n      }))\n\n    case ActionTypes.MaximizeWindow:\n      const { maximize } = action.payload\n      return newWindowState(action.payload.wid, (win) => ({\n        oldPosition: maximize ? win.position : undefined,\n        oldDimension: maximize ? win.dimension : undefined,\n        position: maximize ? action.payload.position : win.oldPosition,\n        dimension: maximize ? action.payload.dimension : win.oldDimension,\n        maximized: maximize,\n      }))\n\n    case ActionTypes.UpdateMetadata:\n      const { title, iconic } = action.payload.metadata\n\n      return newWindowState(action.payload.wid, (win) => ({\n        opacity: createOpacity(action.payload.metadata),\n        minimized: iconic === undefined ? win.minimized : iconic === true,\n        title: title === undefined ? win.title : title,\n      }))\n\n    case ActionTypes.RaiseWindow:\n      return {\n        ...newWindowState(action.payload.id, () => ({\n          zIndex: createXpraWindowBaseZindex(action.payload, ++lastZindex),\n        })),\n        activeWindow: action.payload.id,\n      }\n\n    case ActionTypes.AddNotification:\n      return {\n        ...state,\n        notifications: [...state.notifications, action.payload],\n      }\n\n    case ActionTypes.RemoveNotification:\n      const { notifications } = state\n      const foundNotificationIndex = notifications.findIndex(\n        ([n]) => n.id === action.payload\n      )\n\n      if (foundNotificationIndex !== -1) {\n        notifications.splice(foundNotificationIndex, 1)\n      }\n\n      return { ...state, notifications }\n\n    case ActionTypes.SetDraggingWindow:\n      return {\n        ...state,\n        draggingWindow: action.payload,\n      }\n\n    case ActionTypes.ClearWindows:\n      return {\n        ...state,\n        cursor: null,\n        windows: [],\n        notifications: [],\n        draggingWindow: -1,\n      }\n\n    case ActionTypes.SetOption:\n      const [key, value] = action.payload\n\n      return {\n        ...state,\n        options: {\n          ...state.options,\n          [key]: value,\n        },\n      }\n\n    case ActionTypes.UpdateMenu:\n      return {\n        ...state,\n        menu: action.payload,\n      }\n\n    case ActionTypes.SetError:\n      return {\n        ...state,\n        error: action.payload,\n      }\n\n    case ActionTypes.SetStarted:\n      return {\n        ...state,\n        started: action.payload,\n      }\n\n    default:\n      return state\n  }\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React, {\n  useEffect,\n  useReducer,\n  useState,\n  createContext,\n  FC,\n  Dispatch,\n} from 'react'\nimport {\n  XpraClient,\n  XpraWindow,\n  XpraWindowIcon,\n  XpraConnectionStats,\n  XpraWindowMoveResize,\n  XpraWindowMetadataUpdate,\n  XpraCursor,\n  XpraWindowManager,\n  XpraNotification,\n  XpraWindowInitiateMoveResize,\n  XpraConnectionStatus,\n  XpraPointerPosition,\n  XpraXDGReducedMenu,\n  createXpraConnectionOptionsFromUrl,\n  parseUrlQuerySearch,\n} from '../xpra'\nimport {\n  ActionTypes,\n  AppState,\n  AppStateActions,\n  initialState,\n  stateReducer,\n} from './store'\n\nexport type AppContextProps = {\n  xpra: XpraClient\n  wm: XpraWindowManager\n}\n\nexport const AppContext = createContext<{\n  wm: XpraWindowManager\n  xpra: XpraClient\n  state: AppState\n  root: HTMLElement | null\n  dispatch: Dispatch<AppStateActions>\n  setRoot: Dispatch<HTMLElement | null>\n  setCursor: Dispatch<HTMLElement | null>\n}>({\n  /* eslint-disable @typescript-eslint/no-non-null-assertion */\n  wm: null!,\n  xpra: null!,\n  state: initialState,\n  root: null,\n  setRoot: () => {\n    /*placeholder*/\n  },\n  setCursor: () => {\n    /*placeholder*/\n  },\n  dispatch: () => {\n    /*placeholder */\n  },\n})\n\nconst otherOptions = parseUrlQuerySearch<{\n  connect: boolean\n  host: string\n}>(['connect'], [], ['connect', 'host'])\n\nconst createdOptions = createXpraConnectionOptionsFromUrl()\n\nconst initialCreatedState = {\n  ...initialState,\n  ...otherOptions,\n  options: {\n    ...initialState.options,\n    ...createdOptions,\n  },\n}\n\nexport const AppContextProvider: FC<AppContextProps> = ({\n  children,\n  wm,\n  xpra,\n}) => {\n  const [state, dispatch] = useReducer(stateReducer, initialCreatedState)\n\n  const [root, setRoot] = useState<HTMLElement | null>(null)\n  const [cursor, setCursor] = useState<HTMLElement | null>(null)\n\n  const setConnected = () => {\n    dispatch({\n      type: ActionTypes.SetConnected,\n      payload: true,\n    })\n\n    dispatch({\n      type: ActionTypes.SetError,\n      payload: '',\n    })\n  }\n\n  const setDisconnected = (s: XpraConnectionStatus) => {\n    dispatch({\n      type: ActionTypes.SetConnected,\n      payload: s !== 'disconnected',\n    })\n    dispatch({\n      type: ActionTypes.ClearWindows,\n    })\n  }\n\n  const addWindow = (attributes: XpraWindow) =>\n    dispatch({\n      type: ActionTypes.AddWindow,\n      payload: attributes,\n    })\n\n  const removeWindow = (wid: number) =>\n    dispatch({\n      type: ActionTypes.RemoveWindow,\n      payload: wid,\n    })\n\n  const addWindowIcon = (icon: XpraWindowIcon) =>\n    dispatch({\n      type: ActionTypes.SetWindowIcon,\n      payload: icon,\n    })\n\n  const updateStats = (stats: XpraConnectionStats) =>\n    dispatch({\n      type: ActionTypes.UpdateStats,\n      payload: stats,\n    })\n\n  const updateCursor = (cursor: XpraCursor | null) =>\n    dispatch({\n      type: ActionTypes.SetCursor,\n      payload: cursor,\n    })\n\n  const resizeMoveWindow = (data: XpraWindowMoveResize) =>\n    dispatch({\n      type: ActionTypes.MoveResizeWindow,\n      payload: data,\n    })\n\n  const raiseWindow = (wid: number) => {\n    const win = wm.getWindow(wid)\n    if (win) {\n      dispatch({\n        type: ActionTypes.RaiseWindow,\n        payload: win.attributes,\n      })\n    }\n  }\n\n  const updateMetadata = (data: XpraWindowMetadataUpdate) =>\n    dispatch({\n      type: ActionTypes.UpdateMetadata,\n      payload: data,\n    })\n\n  const initiateMoveResize = (_: XpraWindowInitiateMoveResize) => {\n    /* TODO: Implement */\n  }\n\n  const showNotification = async (notif: XpraNotification) =>\n    dispatch({\n      type: ActionTypes.AddNotification,\n      payload: [notif, await wm.createNotification(notif)],\n    })\n\n  const hideNotification = (nid: number) =>\n    dispatch({\n      type: ActionTypes.RemoveNotification,\n      payload: nid,\n    })\n\n  const pointerPosition = (pointer: XpraPointerPosition) => {\n    if (cursor) {\n      const [x, y] = pointer.position\n      Object.assign(cursor.style, {\n        left: `${x}px`,\n        top: `${y}px`,\n      })\n    }\n  }\n\n  const eos = () => {\n    /* TODO: Implement */\n  }\n\n  const setError = (error: string) =>\n    dispatch({\n      type: ActionTypes.SetError,\n      payload: error,\n    })\n\n  const updateMenu = (payload: XpraXDGReducedMenu) =>\n    dispatch({\n      type: ActionTypes.UpdateMenu,\n      payload,\n    })\n\n  const sessionStarted = () =>\n    dispatch({\n      type: ActionTypes.SetStarted,\n      payload: true,\n    })\n\n  useEffect(() => {\n    xpra.on('connect', setConnected)\n    xpra.on('disconnect', setDisconnected)\n    xpra.on('newWindow', addWindow)\n    xpra.on('removeWindow', removeWindow)\n    xpra.on('windowIcon', addWindowIcon)\n    xpra.on('pong', updateStats)\n    xpra.on('cursor', updateCursor)\n    xpra.on('moveResizeWindow', resizeMoveWindow)\n    xpra.on('updateWindowMetadata', updateMetadata)\n    xpra.on('raiseWindow', raiseWindow)\n    xpra.on('initiateMoveResize', initiateMoveResize)\n    xpra.on('showNotification', showNotification)\n    xpra.on('hideNotification', hideNotification)\n    xpra.on('pointerPosition', pointerPosition)\n    xpra.on('newTray', addWindow)\n    xpra.on('eos', eos)\n    xpra.on('updateXDGMenu', updateMenu)\n    xpra.on('error', setError)\n    xpra.on('sessionStarted', sessionStarted)\n\n    return () => {\n      xpra.off('connect', setConnected)\n      xpra.off('disconnect', setDisconnected)\n      xpra.off('newWindow', addWindow)\n      xpra.off('removeWindow', removeWindow)\n      xpra.off('windowIcon', addWindowIcon)\n      xpra.off('pong', updateStats)\n      xpra.off('cursor', updateCursor)\n      xpra.off('moveResizeWindow', resizeMoveWindow)\n      xpra.off('updateWindowMetadata', updateMetadata)\n      xpra.off('raiseWindow', raiseWindow)\n      xpra.off('initiateMoveResize', initiateMoveResize)\n      xpra.off('showNotification', showNotification)\n      xpra.off('hideNotification', hideNotification)\n      xpra.off('pointerPosition', pointerPosition)\n      xpra.off('newTray', addWindow)\n      xpra.off('eos', eos)\n      xpra.off('updateXDGMenu', updateMenu)\n      xpra.off('error', setError)\n      xpra.off('sessionStarted', sessionStarted)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (state.connect) {\n      xpra.connect(state.host, state.options)\n    }\n  }, [])\n\n  useEffect(() => {\n    wm.setDesktopElement(root)\n  }, [root])\n\n  useEffect(() => {\n    wm.setActiveWindow(state.activeWindow)\n  }, [state.activeWindow])\n\n  return (\n    <AppContext.Provider\n      value={{ state, dispatch, root, wm, xpra, setRoot, setCursor }}\n    >\n      {children}\n    </AppContext.Provider>\n  )\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React, { FC } from 'react'\nimport { CSSTransition } from 'react-transition-group'\n\nconst duration = 300\n\nexport const FadeInOutTransition: FC<{\n  toggled: boolean\n  mountOnEnter?: boolean\n  unmountOnExit?: boolean\n}> = ({ toggled, children, mountOnEnter = true, unmountOnExit = true }) => {\n  return (\n    <CSSTransition\n      in={toggled}\n      timeout={duration}\n      mountOnEnter={mountOnEnter}\n      unmountOnExit={unmountOnExit}\n      classNames=\"fade-on-out\"\n    >\n      {children}\n    </CSSTransition>\n  )\n}\n","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAUdEVYdEF1dGhvcgBKYWt1YiBTdGVpbmVy5vv3LwAAADV0RVh0RGVzY3JpcHRpb24ASW52ZXJ0ZWQgdmFyaWFudCBvZiB0aGUgRE1aIGN1cnNvciB0aGVtZS5odVs8AAAAM3RFWHRTb3VyY2UAaHR0cDovL2ppbW1hYy5tdXNpY2hhbGwuY3ovdGhlbWVzLnBocD9za2luPTdQM5WxAAADwUlEQVRYhe2WTUhsZRjHf+PVcdLU48d1GkMvdwI185ZIzEYpaKttWqhcKhlFF65USjcK6equNFJbCEokiISiochQgfmBaI6CKGmg5MeIwpBXZpIRPec8LWb0Wte6c1SsRX94eDcvvD+er/8L/+sFEpFX/833o3Vd9zc3N78FxAIRdw0QKyISCAT8xcXFDuDlu4aIl5D8fr+voKDgbe44E/EiIu3t7eL3+8Xn8x3l5ua+GYIw3RlAeXm5FBUVSSAQEJ/Pd2i32x8BMbcBEVYqdV1nfn4ep9OJxWJJXFpa+t5msz0AXropRFgAmqahqiqTk5NUVVURGxtrXV1ddQFpgOUmEIYAVFVlYmKCuro6FEXJ8Hq93wE2IPq6EGEBiMgFgKqquFwuGhoaSE5Ofri/v/8t8Mp1IcIep8sAqqoyPj5Oa2srVqs1d29vbwiwAmajENcGUFWV4eFh2traSEtLy9/Z2fkGSDUKYWihXAUxMDBAZ2cn6enpjo2Nja+A+0YgDANcbsjz6O/vp6+vD7vd/t7a2tqXQAoQFQ6EIYC/NuPl6OnpYXBwkKysrPdXVla+CBfC8E6/6vHzrHR3dzM8PExOTs4HCwsLT4BkIPKfICKNAlwuAYDD4cBisWA2m4mOjmZxcZG8vDzy8/M/mpmZ+b2wsPAz4ClwZvQtCHlBSUmJABcRGRkpcXFxYrVaxe12y99J13WZnp5+Aii3lgGAsrIyxsbGUFWVrq4uent76ejo+GFoaOgns9l8bDKZxGQy6WazOSAivxJcUtfScxmora0VXdelpqZGEhISxGazyebmpni93qdAEfA6YAceAg8ILqiYWwFoaGgQXdfl9PRU9Xg8oiiKpKSkSH19vWiaJk1NTY0EvcEM3AtFBDcwqwuAxsZGERFZXFxcdzqdn2uaJtXV1aIoimRkZMjBwYEcHBx4gDe4oUM+BzA3Nye6rsvs7OwK8DFQcHR05Nna2hJFUSQ1NVVaWlpEVVWprKysIDh+t/Jtiz/v5qmpqSXgQ+ARkDw6OvpY0zSpqKiQpKQkyczMlOPjY1leXp4DXiO4hG4HYH5+/kegDMgF4ghOj+L3+/c2NjYkMTFRsrOz5fDwUNbX138OQd5KGWJ3d3e/Bt4Bsnn2LTcBUS6X6/HZ2Zlsb29LIBCQk5MTvbS0tCV017A1X6UoIJGgw8Xw57qagPiRkZFPPB7PL2632+1wOD4F3iXoA2H1wIsITQRHSQA9dF7WPYIluU/wg3oC/Ab4APWK+4YBwlEEz2ZeC8X54vrv6w+aYEf+AZkZtAAAAABJRU5ErkJggg==\"","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React, {\n  useEffect,\n  useContext,\n  useState,\n  useRef,\n  useCallback,\n  createRef,\n  RefObject,\n  FC,\n} from 'react'\nimport { debounce } from 'lodash-es'\nimport {\n  createCursorCSS,\n  createCursorBackgroundCSS,\n  useDrag,\n  detectCorner,\n} from './utils'\nimport { ActionTypes, AppWindowState } from './store'\nimport { XpraWindowManagerWindow, XpraVector } from '../xpra'\nimport { FadeInOutTransition } from './transitions'\nimport { AppContext } from './context'\nimport defaultCursor from './cursor.png'\n\nexport const INPUT_DEBOUNCE_TIME = 10\n\nexport const DRAG_CORNER_SIZE = 16\n\nlet isDragging = false\n\n/**\n * Window Buttons Component\n */\nexport const AppWindowButtons: FC<{\n  winstance: XpraWindowManagerWindow\n  win: AppWindowState\n  bar: RefObject<HTMLDivElement>\n  outer: RefObject<HTMLDivElement>\n}> = ({ win, bar, winstance }) => {\n  const { oldPosition, oldDimension } = win\n  const { wm, xpra, root, dispatch } = useContext(AppContext)\n  const buttonClassNames =\n    'w-4 h-4 rounded-full cursor-pointer bg-gradient-to-b shadow-inner hover:shadow'\n\n  const onMouseDown = (ev: React.MouseEvent<HTMLDivElement>) => {\n    ev.stopPropagation()\n    ev.preventDefault()\n  }\n\n  const onMaximize = () => {\n    if (bar.current && root) {\n      if (win.maximized) {\n        if (oldPosition && oldDimension) {\n          wm.maximize(winstance, oldPosition, oldDimension)\n\n          dispatch({\n            type: ActionTypes.MaximizeWindow,\n            payload: {\n              wid: win.id,\n              maximize: false,\n            },\n          })\n        }\n      } else {\n        const x = 0\n        const y = bar.current.offsetHeight\n        const w = root.offsetWidth\n        const h = root.offsetHeight - y\n\n        wm.maximize(winstance, [x, y], [w, h])\n\n        dispatch({\n          type: ActionTypes.MaximizeWindow,\n          payload: {\n            wid: win.id,\n            position: [x, y],\n            dimension: [w, h],\n            maximize: true,\n          },\n        })\n      }\n    }\n  }\n\n  return (\n    <div className=\"flex items-center space-x-2\" onMouseDown={onMouseDown}>\n      <div\n        title=\"Minimize\"\n        className={`${buttonClassNames} from-green-300 to-green-500 hover:from-green-400`}\n        onClick={() => wm.minimize(winstance)}\n      />\n      <div\n        title=\"Maximize\"\n        className={`${buttonClassNames} from-blue-300 to-blue-500 hover:from-blue-400`}\n        onClick={onMaximize}\n      />\n      {!xpra.isReadOnly() && (\n        <div\n          title=\"Close\"\n          className={`${buttonClassNames} from-red-300 to-red-500 hover:from-red-400`}\n          onClick={() => wm.close(winstance)}\n        />\n      )}\n    </div>\n  )\n}\n\nexport const AppWindowIcon: FC<{ win: AppWindowState }> = ({\n  win: { icon, title },\n}) => {\n  return (\n    <>\n      {icon && <img alt={title} src={icon.image} className=\"max-h-full\" />}\n      {!icon && <div className=\"w-full h-full bg-gray-500 rounded\" />}\n    </>\n  )\n}\n\n/**\n * Window canvas Component\n */\nexport const AppWindowCanvas: FC<{\n  id: number\n}> = ({ id }) => {\n  const root = useRef<HTMLDivElement | null>(null)\n  const { wm, state } = useContext(AppContext)\n  const winstance = wm.getWindow(id) as XpraWindowManagerWindow\n\n  const canvasClassNames =\n    state.draggingWindow >= 0 ? 'pointer-events-none' : ''\n\n  const onMouseDown = (ev: React.MouseEvent<HTMLDivElement>) => {\n    wm.mouseButton(winstance, ev.nativeEvent, true)\n  }\n\n  const onMouseUp = (ev: React.MouseEvent<HTMLDivElement>) => {\n    wm.mouseButton(winstance, ev.nativeEvent, false)\n  }\n\n  const onMouseMove = (ev: React.MouseEvent<HTMLDivElement>) => {\n    ev.preventDefault()\n    ev.stopPropagation()\n    wm.mouseMove(winstance, ev.nativeEvent)\n  }\n\n  useEffect(() => {\n    if (root.current) {\n      root.current.appendChild(winstance.canvas)\n    }\n  }, [root.current])\n\n  return (\n    <div\n      ref={root}\n      className={canvasClassNames}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseMove={onMouseMove}\n    />\n  )\n}\n\n/**\n * Window Component\n */\nexport const AppWindow: FC<{ win: AppWindowState }> = ({ win }) => {\n  const {\n    id,\n    position,\n    dimension,\n    title,\n    minimized,\n    maximized,\n    opacity,\n    zIndex,\n    minDimension,\n    maxDimension,\n  } = win\n\n  const [resizeCursor, setResizeCursor] = useState<string>('default')\n  const { wm, dispatch, xpra } = useContext(AppContext)\n  const root = useRef<HTMLDivElement | null>(null)\n  const bar = useRef<HTMLDivElement | null>(null)\n  const resizer = useRef<HTMLDivElement | null>(null)\n  const winstance = wm.getWindow(id) as XpraWindowManagerWindow\n\n  const style = {\n    opacity,\n    zIndex,\n  }\n\n  const resizerStyle = {\n    cursor: resizeCursor,\n  }\n\n  const transitionParams = {\n    toggled: !minimized,\n    mountOnEnter: false,\n    unmountOnExit: false,\n  }\n\n  const setSizeFromAction = (\n    x: number,\n    y: number,\n    w: number,\n    h: number,\n    store = false\n  ) => {\n    if (root.current) {\n      Object.assign(root.current.style, {\n        left: `${x}px`,\n        top: `${y}px`,\n        width: `${w}px`,\n        height: `${h}px`,\n      })\n    }\n\n    if (winstance?.canvas) {\n      Object.assign(winstance.canvas.style, {\n        width: `${w}px`,\n        height: `${h}px`,\n      })\n    }\n\n    if (store) {\n      dispatch({\n        type: ActionTypes.MoveResizeWindow,\n        payload: {\n          wid: id,\n          position: [x, y],\n          dimension: [w, h],\n        },\n      })\n    }\n  }\n\n  const setSizeFromStore = (store = false) => {\n    const [x, y] = position\n    const [w, h] = dimension\n    setSizeFromAction(x, y, w, h, store)\n  }\n\n  const roundValues =\n    (\n      cb: (x: number, y: number, w: number, h: number, moved?: boolean) => void\n    ) =>\n    (x: number, y: number, w: number, h: number, moved?: boolean) => {\n      const [minW, minH] = minDimension || [100, 100]\n      const [maxW, maxH] = maxDimension || [Number.MAX_VALUE, Number.MAX_VALUE]\n\n      w = Math.min(maxW, Math.max(minW, w))\n      h = Math.min(maxH, Math.max(minH, h))\n      // x = Math.max(0, x)\n      // y = Math.max(0, y)\n\n      cb(x, y, w, h, moved)\n    }\n\n  const dragMoveMove = roundValues(\n    (x: number, y: number, w: number, h: number) => {\n      if (!xpra.isReadOnly() && !maximized) {\n        setSizeFromAction(x, y, w, h)\n      }\n\n      setDragging(true)\n    }\n  )\n\n  const dragMoveRelease = roundValues(\n    (x: number, y: number, w: number, h: number, moved?: boolean) => {\n      setDragging(false)\n\n      if (!xpra.isReadOnly() && !maximized) {\n        setSizeFromAction(x, y, w, h, true)\n\n        if (moved) {\n          wm.moveResize(winstance, [x, y], [w, h])\n        }\n      }\n    }\n  )\n\n  const setDragging = (value: boolean) => {\n    if (!isDragging) {\n      dispatch({\n        type: ActionTypes.SetDraggingWindow,\n        payload: value ? id : -1,\n      })\n    }\n\n    isDragging = value\n  }\n\n  const onRootMouseDown = (ev: React.MouseEvent<HTMLDivElement>) => {\n    ev.preventDefault()\n    ev.stopPropagation()\n\n    wm.raise(winstance)\n    wm.mouseButton(null, ev.nativeEvent, true)\n\n    dispatch({\n      type: ActionTypes.RaiseWindow,\n      payload: winstance.attributes,\n    })\n  }\n\n  const onRootMouseMove = debounce((ev: React.MouseEvent<HTMLDivElement>) => {\n    if (resizer.current) {\n      const corner = detectCorner(\n        resizer.current,\n        [ev.pageX, ev.pageY],\n        DRAG_CORNER_SIZE\n      )\n      setResizeCursor(`${corner}-resize`)\n    } else {\n      setResizeCursor('default')\n    }\n  }, INPUT_DEBOUNCE_TIME)\n\n  const onDragMouseDown = useCallback(\n    useDrag(() => {\n      const [w, h] = dimension\n      let [newX, newY] = position\n\n      return {\n        onMove(_, diffX, diffY) {\n          newX = position[0] + diffX\n          newY = position[1] + diffY\n\n          dragMoveMove(newX, newY, w, h)\n          setDragging(true)\n        },\n        onRelease(_, moved) {\n          dragMoveRelease(newX, newY, w, h, moved)\n        },\n      }\n    }),\n    [position, dimension]\n  )\n\n  const onResizeMouseDown = useCallback(\n    useDrag(() => {\n      let corner = ''\n      let [newX, newY] = position\n      let [newW, newH] = dimension\n\n      return {\n        onDown(_, startX, startY) {\n          if (resizer.current) {\n            corner = detectCorner(\n              resizer.current,\n              [startX, startY],\n              DRAG_CORNER_SIZE\n            )\n          }\n        },\n\n        onMove(_, diffX, diffY) {\n          if (corner.startsWith('n')) {\n            newH = dimension[1] - diffY\n            newY = position[1] + diffY\n          } else if (corner.startsWith('s')) {\n            newH = dimension[1] + diffY\n          }\n\n          if (corner.endsWith('w')) {\n            newW = dimension[0] - diffX\n            newX = position[0] + diffX\n          } else if (corner.endsWith('e')) {\n            newW = dimension[0] + diffX\n          }\n\n          dragMoveMove(newX, newY, newW, newH)\n        },\n        onRelease(_, moved) {\n          dragMoveRelease(newX, newY, newW, newH, moved)\n        },\n      }\n    }),\n    [resizer, position, dimension]\n  )\n\n  useEffect(() => {\n    setSizeFromStore()\n  }, [position, dimension])\n\n  useEffect(() => {\n    setSizeFromStore()\n  }, [root])\n\n  useEffect(() => {\n    const [x, y] = position\n    const [w, h] = dimension\n\n    if (!xpra.isReadOnly()) {\n      // TODO: Clamp position in all directions\n      if (x <= 0 || y <= 0) {\n        const newX = 100\n        const newY = 100\n\n        wm.moveResize(winstance, [newX, newY], [w, h])\n        setSizeFromAction(newX, newY, w, h, true)\n      }\n    }\n  }, [])\n\n  if (winstance?.attributes?.overrideRedirect) {\n    return (\n      <FadeInOutTransition {...transitionParams}>\n        <div\n          className=\"absolute bg-black cursor-default shadow\"\n          ref={root}\n          style={style}\n          onMouseDown={onRootMouseDown}\n        >\n          <AppWindowCanvas id={id} />\n        </div>\n      </FadeInOutTransition>\n    )\n  }\n\n  return (\n    <FadeInOutTransition {...transitionParams}>\n      <div\n        ref={root}\n        style={style}\n        className=\"absolute\"\n        onMouseDown={onRootMouseDown}\n        onMouseMove={onRootMouseMove}\n      >\n        <div\n          ref={resizer}\n          className=\"absolute z-10 -left-2 -top-10 -bottom-2 -right-2\"\n          style={resizerStyle}\n          onMouseDown={onResizeMouseDown}\n        />\n\n        <div className=\"relative w-full h-full z-20 outline outline-1 outline-gray-200 shadow-xl\">\n          <div\n            className=\"absolute -top-8 w-full flex items-center p-1 px-2 h-8 space-x-2 outline outline-1 outline-gray-200 bg-gray-100 cursor-default\"\n            ref={bar}\n            onMouseDown={onDragMouseDown}\n          >\n            <div\n              className=\"flex items-center justify-center\"\n              style={{ width: '16px', height: '16px' }}\n            >\n              <AppWindowIcon win={win} />\n            </div>\n            <div className=\"flex-grow truncate text-sm\">\n              <span>{title || id}</span>\n            </div>\n            <AppWindowButtons\n              winstance={winstance}\n              win={win}\n              bar={bar}\n              outer={root}\n            />\n          </div>\n\n          <div className=\"xpra-window-canvas w-full h-full bg-black\">\n            <AppWindowCanvas id={id} />\n          </div>\n        </div>\n      </div>\n    </FadeInOutTransition>\n  )\n}\n\n/**\n * Desktop Component\n */\nexport const AppDesktop: FC = ({ children }) => {\n  const root = createRef<HTMLDivElement>()\n  const cursor = createRef<HTMLDivElement>()\n  const { wm, state, setRoot, setCursor } = useContext(AppContext)\n\n  const onMouseMove = (ev: React.MouseEvent<HTMLDivElement>) => {\n    wm.mouseMove(null, ev.nativeEvent)\n  }\n\n  const onContextMenu = (ev: React.MouseEvent<HTMLDivElement>) => {\n    ev.preventDefault()\n  }\n\n  const onMouseDown = useCallback((ev) => {\n    wm.mouseButton(null, ev, true)\n  }, [])\n\n  const onMouseUp = useCallback((ev) => {\n    wm.mouseButton(null, ev, false)\n  }, [])\n\n  const sharedCursor = {\n    dimension: [32, 32] as XpraVector,\n    xhot: 8,\n    yhot: 3,\n    image: defaultCursor,\n    ...(state.cursor || {}),\n  }\n\n  const style = `\n.xpra-cursor {\n  background: ${createCursorBackgroundCSS(sharedCursor)};\n}\n\n.xpra-window-canvas {\n  cursor: ${createCursorCSS(state.cursor, 'default')};\n}\n`\n\n  const windows = state.windows.filter((w) => !w.tray)\n\n  useEffect(() => {\n    if (root.current) {\n      setRoot(root.current)\n    }\n  }, [root.current])\n\n  useEffect(() => {\n    if (cursor.current) {\n      setCursor(cursor.current)\n    }\n  }, [cursor.current])\n\n  return (\n    <>\n      <div\n        id=\"xpra-desktop\"\n        className=\"absolute inset-0 z-30 overflow-hidden bg-gradient-to-br from-emerald-500 via-emerald-300 to-emerald-500\"\n        ref={root}\n        onMouseMove={onMouseMove}\n        onContextMenu={onContextMenu}\n        onMouseDown={onMouseDown}\n        onMouseUp={onMouseUp}\n      >\n        {state.connected &&\n          windows.map((w) => <AppWindow key={w.id} win={w} />)}\n\n        {children}\n      </div>\n      <div ref={cursor} className=\"xpra-cursor absolute z-50\" />\n      <style>{style}</style>\n    </>\n  )\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React, { FC } from 'react'\n\nlet lastElementId = 1\n\nexport const AppSelect: FC<{\n  disabled?: boolean\n  label?: string\n  required?: boolean\n  value: string\n  options: Record<string, string>\n  onChange: (ev: React.ChangeEvent<HTMLSelectElement>) => void\n}> = ({ disabled, label, value, required, options, onChange }) => {\n  const htmlFor = `xpra_${++lastElementId}`\n  const inputClassNames =\n    'rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed'\n\n  return (\n    <div>\n      {label && <label htmlFor={htmlFor}>{label}</label>}\n      <div>\n        <select\n          className={inputClassNames}\n          id={htmlFor}\n          required={required}\n          disabled={disabled}\n          defaultValue={value}\n          onChange={onChange}\n        >\n          {Object.entries(options).map(([k, v]) => (\n            <option key={k} value={k}>\n              {v}\n            </option>\n          ))}\n        </select>\n      </div>\n    </div>\n  )\n}\n\n/**\n * Button Component\n */\nexport const AppButton: FC<{\n  disabled?: boolean\n  label?: string\n  type?: 'button' | 'submit' | 'reset'\n  transparent?: boolean\n  onClick?: (ev: React.MouseEvent<HTMLButtonElement>) => void\n}> = ({ children, disabled, label, type, transparent, onClick }) => {\n  let inputClassNames =\n    'flex items-center justify-center relative rounded w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed hover:outline hover:outline-1'\n\n  if (transparent) {\n    inputClassNames += ' border border border-transparent'\n  } else {\n    inputClassNames += ' bg-white border border-black-100'\n  }\n\n  return (\n    <button\n      className={inputClassNames}\n      disabled={disabled}\n      type={type || 'button'}\n      onClick={onClick}\n    >\n      {label || children}\n    </button>\n  )\n}\n\n/**\n * Text Input Component\n */\nexport const AppTextField: FC<{\n  type?: string\n  disabled?: boolean\n  label?: string\n  placeholder?: string\n  required?: boolean\n  value: string\n  onChange: (ev: React.ChangeEvent<HTMLInputElement>) => void\n}> = ({ disabled, label, value, type, placeholder, required, onChange }) => {\n  const htmlFor = `xpra_${++lastElementId}`\n  const inputClassNames =\n    'rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed'\n\n  return (\n    <div>\n      {label && <label htmlFor={htmlFor}>{label}</label>}\n      <div>\n        <input\n          type={type || 'text'}\n          className={inputClassNames}\n          id={htmlFor}\n          placeholder={placeholder}\n          required={required}\n          disabled={disabled}\n          defaultValue={value}\n          onInput={onChange}\n        />\n      </div>\n    </div>\n  )\n}\n\n/**\n * Checkbox Input Component\n */\nexport const AppCheckbox: FC<{\n  label: string\n  value: boolean\n  onChange: (ev: React.ChangeEvent<HTMLInputElement>) => void\n}> = ({ label, value, onChange }) => {\n  return (\n    <div className=\"select-none\">\n      <label className=\"inline-flex items-center space-x-2 cursor-pointer\">\n        <input type=\"checkbox\" defaultChecked={value} onChange={onChange} />\n        <span>{label}</span>\n      </label>\n    </div>\n  )\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React, { useContext, useState, useRef, useEffect, FC } from 'react'\nimport { ValueOf } from './types'\nimport { AppContext } from './context'\nimport { FadeInOutTransition } from './transitions'\nimport { ActionTypes, AppWindowState } from './store'\nimport { AppCheckbox, AppTextField, AppButton, AppSelect } from './inputs'\nimport { AppWindowCanvas, AppWindowIcon } from './desktop'\nimport {\n  XPRA_KEYBOARD_LAYOUTS,\n  XpraConnectionOptions,\n  browserLoadFile,\n} from '../xpra'\n\ninterface AppMenuItem {\n  icon?: string\n  title: string\n  callback?: () => void\n  items?: AppMenuItem[]\n}\n\nconst panelClassNames = [\n  'shadow-lg',\n  'bg-emerald-100/50',\n  'opacity-90',\n  'rounded',\n]\n\nconst cs = (...args: string[]) => args.join(' ')\n\nexport const AppMenu: FC<{\n  items: AppMenuItem[]\n  root?: boolean\n  onCallback?: () => void\n}> = ({\n  items,\n  onCallback = () => {\n    /*noop */\n  },\n  root = true,\n}) => {\n  const ref = useRef<HTMLDivElement | null>(null)\n  const [hovering, setHovering] = useState(-1)\n\n  const classNames = ['max-h-96', 'max-w-xs']\n  if (root) {\n    classNames.push('top-full', 'left-0')\n  } else {\n    classNames.push('top-0', 'left-full', 'overflow-auto')\n  }\n\n  const onMouseOver = (i: number) => setHovering(i)\n  const onMouseLeave = () => setHovering(-1)\n  const onClose = (fn?: () => void) => {\n    if (fn) {\n      fn()\n    }\n    onCallback()\n  }\n\n  if (root) {\n    const checkOutsideClick = (ev: MouseEvent) => {\n      if (ref.current) {\n        const target = ev.target as HTMLElement\n        const hit =\n          target &&\n          (ref.current.contains(target) || target === ref.current.parentNode)\n\n        if (!hit) {\n          onClose()\n        }\n      }\n    }\n\n    useEffect(() => {\n      document.addEventListener('click', checkOutsideClick)\n\n      return () => {\n        document.removeEventListener('click', checkOutsideClick)\n      }\n    }, [ref])\n  }\n\n  return (\n    <div\n      ref={ref}\n      className={cs('absolute', 'shadow', 'bg-emerald-100/80', ...classNames)}\n      onMouseLeave={onMouseLeave}\n    >\n      {items.map(({ icon, title, items, callback }, i) => (\n        <div key={i} className=\"relative text-left\">\n          <div\n            className=\"p-2 hover:bg-white truncate flex space-x-2 items-center\"\n            onClick={() => onClose(callback)}\n            onMouseOver={() => onMouseOver(i)}\n          >\n            {icon && <img src={icon} className=\"w-4 h-4\" />}\n            <span>{title}</span>\n          </div>\n          {hovering === i && items && items.length > 0 && (\n            <AppMenu root={false} items={items} />\n          )}\n        </div>\n      ))}\n    </div>\n  )\n}\n\n/**\n * Panel Wrapper\n */\nexport const AppPanel: FC<{ classNames: string[] }> = ({\n  classNames,\n  children,\n}) => {\n  const className = cs('absolute', 'z-50', ...panelClassNames, ...classNames)\n\n  return <div className={className}>{children}</div>\n}\n\nexport const AppConnectionPanel: FC = () => {\n  const { xpra, state, dispatch } = useContext(AppContext)\n\n  const optionsLabel = state.showOptions ? 'Hide options' : 'Show options'\n\n  const updateOption = (\n    key: keyof XpraConnectionOptions,\n    value: ValueOf<XpraConnectionOptions>\n  ) =>\n    dispatch({\n      type: ActionTypes.SetOption,\n      payload: [key, value],\n    })\n\n  const inputs = [\n    {\n      key: 'reconnect',\n      label: 'Automatically reconnect',\n      component: AppCheckbox,\n    },\n    {\n      key: 'shareSession',\n      label: 'Share Session',\n      component: AppCheckbox,\n    },\n    {\n      key: 'stealSession',\n      label: 'Steal Session',\n      component: AppCheckbox,\n    },\n    {\n      key: 'clipboard',\n      label: 'Clipboard',\n      component: AppCheckbox,\n    },\n    {\n      key: 'clipboardImages',\n      label: 'Clipboard Images',\n      component: AppCheckbox,\n    },\n    {\n      key: 'fileTransfer',\n      label: 'File Transfer',\n      component: AppCheckbox,\n    },\n    {\n      key: 'printing',\n      label: 'Printing',\n      component: AppCheckbox,\n    },\n    {\n      key: 'bell',\n      label: 'Bell',\n      component: AppCheckbox,\n    },\n    {\n      key: 'notifications',\n      label: 'Notifications',\n      component: AppCheckbox,\n    },\n    {\n      key: 'openUrl',\n      label: 'Open URLs',\n      component: AppCheckbox,\n    },\n    {\n      key: 'audio',\n      label: 'Audio',\n      component: AppCheckbox,\n    },\n    {\n      key: 'showStartMenu',\n      label: 'XDG Menu',\n      component: AppCheckbox,\n    },\n    {\n      key: 'swapKeys',\n      label: 'Swap Ctrl and Cmd key',\n      component: AppCheckbox,\n    },\n    {\n      key: 'reverseScrollX',\n      label: 'Reverse X scroll',\n      component: AppCheckbox,\n    },\n    {\n      key: 'reverseScrollY',\n      label: 'Reverse Y scroll',\n      component: AppCheckbox,\n    },\n    {\n      key: 'keyboardLayout',\n      label: 'Keyboard Layout',\n      component: AppSelect,\n      options: XPRA_KEYBOARD_LAYOUTS,\n    },\n  ].map((input) => ({\n    ...input,\n    value: state.options[input.key as keyof XpraConnectionOptions],\n    onChange: (ev: React.ChangeEvent<HTMLInputElement>) =>\n      updateOption(input.key as keyof XpraConnectionOptions, ev.target.value),\n  }))\n\n  const onHostChange = (ev: React.ChangeEvent<HTMLInputElement>) =>\n    dispatch({\n      type: ActionTypes.SetHost,\n      payload: ev.target.value,\n    })\n\n  const onUsernameChange = (ev: React.ChangeEvent<HTMLInputElement>) =>\n    updateOption('username', ev.target.value)\n\n  const onPasswordChange = (ev: React.ChangeEvent<HTMLInputElement>) =>\n    updateOption('password', ev.target.value)\n\n  const onConnect = (ev: React.FormEvent<HTMLFormElement>) => {\n    ev.preventDefault()\n\n    dispatch({\n      type: ActionTypes.SetError,\n      payload: '',\n    })\n\n    xpra.connect(state.host, state.options)\n  }\n\n  const onOptionsClick = () =>\n    dispatch({\n      type: ActionTypes.SetShowOptions,\n      payload: !state.showOptions,\n    })\n\n  return (\n    <AppPanel\n      classNames={[\n        'p-8',\n        'top-1/2',\n        'left-1/2 transform',\n        '-translate-x-1/2',\n        '-translate-y-1/2',\n        'w-96',\n        'max-w-full',\n        'max-h-full',\n        'overflow-auto',\n      ]}\n    >\n      <form className=\"space-y-4\" onSubmit={onConnect}>\n        <div className=\"space-y-2\">\n          <AppTextField\n            required\n            placeholder=\"Host\"\n            value={state.host}\n            onChange={onHostChange}\n          />\n\n          <div className=\"flex space-x-2\">\n            <AppTextField\n              placeholder=\"Username\"\n              value={state.options.username}\n              onChange={onUsernameChange}\n            />\n\n            <AppTextField\n              type=\"password\"\n              placeholder=\"Password\"\n              value={state.options.password}\n              onChange={onPasswordChange}\n            />\n          </div>\n        </div>\n\n        {state.error && (\n          <div className=\"bg-red-300 border border-red-500 text-red-500 p-2 rounded\">\n            {state.error}\n          </div>\n        )}\n\n        <div className=\"flex space-x-2\">\n          <AppButton label=\"Connect\" type=\"submit\" />\n          <AppButton label={optionsLabel} onClick={onOptionsClick} />\n        </div>\n\n        <FadeInOutTransition toggled={state.showOptions}>\n          <div className=\"px-2 text-sm\">\n            {inputs.map(({ component, key, ...input }) => {\n              const Component = component as FC\n              return <Component key={key} {...input} />\n            })}\n          </div>\n        </FadeInOutTransition>\n      </form>\n    </AppPanel>\n  )\n}\n\n/**\n * Connection panel\n */\nexport const AppDebugPanel: FC = () => {\n  const { state } = useContext(AppContext)\n\n  const rows = [\n    ['Last server ping', state.stats.lastServerPing],\n    ['Last client echo', state.stats.lastClientEcho],\n    ['Client ping latency', state.stats.clientPingLatency],\n    ['Server ping latency', state.stats.serverPingLatency],\n    ['Server load', state.stats.serverLoad.join(' / ')],\n    ['Window count', state.windows.length],\n  ]\n\n  return (\n    <div className=\"absolute bottom-1 left-1 p-1 z-0 opacity-50 bg-emerald-100 rounded\">\n      <table className=\"text-xs\">\n        <tbody>\n          {rows.map(([label, value]) => (\n            <tr key={label}>\n              <td className=\"p-1\">{label}</td>\n              <td className=\"p-1 text-right text-gray-500\">{value}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  )\n}\n\n/**\n * Minimized window tray\n */\nexport const AppTrayPanel: FC = () => {\n  const { wm, state, dispatch, xpra } = useContext(AppContext)\n\n  const [menuVisible, setMenuVisible] = useState(false)\n  const minimized = state.windows.filter((w) => w.minimized)\n  const trays = state.windows.filter((w) => w.tray)\n\n  const menu = [\n    ...state.menu.map((sub) => ({\n      title: sub.name,\n      icon: sub.icon,\n      items: sub.entries.map((entry) => ({\n        title: entry.name,\n        icon: entry.icon,\n        callback: () => {\n          xpra.sendStartCommand(entry.name, entry.exec, false)\n        },\n      })),\n    })),\n    {\n      title: 'Server',\n      items: [\n        {\n          title: 'Shutdown server',\n          callback: () => {\n            if (confirm('Are you sure you want to shut down the server ?')) {\n              xpra.sendShutdown()\n            }\n          },\n        },\n      ],\n    },\n  ]\n\n  const onDisconnect = () => xpra.disconnect()\n\n  const onClick =\n    (w: AppWindowState) => (ev: React.MouseEvent<HTMLButtonElement>) => {\n      ev.stopPropagation()\n      ev.preventDefault()\n\n      const win = wm.getWindow(w.id)\n      if (win) {\n        wm.restore(win)\n        wm.raise(win)\n\n        dispatch({\n          type: ActionTypes.RaiseWindow,\n          payload: win.attributes,\n        })\n      }\n    }\n\n  const onMenuToggle = () => setMenuVisible(!menuVisible)\n\n  const onMenuCallback = () => {\n    setMenuVisible(false)\n  }\n\n  const onPollClipboard = () => xpra.clipboard.poll()\n\n  const onFileUpload = async () => {\n    const files = await browserLoadFile()\n    files.forEach(({ buffer, name, size, type }) =>\n      xpra.sendFile(name, type, size, buffer)\n    )\n  }\n\n  return (\n    <AppPanel\n      classNames={[\n        'top-1',\n        'left-1/2',\n        '-translate-x-1/2',\n        'p-1',\n        'select-none',\n      ]}\n    >\n      <div className=\"flex space-x-4 px-2\">\n        <div className=\"flex space-x-1\">\n          {state.menu.length > 0 && (\n            <AppButton transparent={true} onClick={onMenuToggle}>\n              <i className=\"fa fa-bars pointer-events-none\" />\n              <FadeInOutTransition toggled={menuVisible}>\n                <AppMenu items={menu} onCallback={onMenuCallback} />\n              </FadeInOutTransition>\n            </AppButton>\n          )}\n\n          <AppButton transparent={true} onClick={onDisconnect}>\n            <i className=\"fa fa-unlink\" />\n          </AppButton>\n\n          {state.options.clipboard && (\n            <AppButton transparent={true} onClick={onPollClipboard}>\n              <i className=\"fa fa-clipboard\" />\n            </AppButton>\n          )}\n          {state.options.fileTransfer && (\n            <AppButton transparent={true} onClick={onFileUpload}>\n              <i className=\"fa fa-upload\" />\n            </AppButton>\n          )}\n        </div>\n\n        {minimized.length > 0 && (\n          <div className=\"flex space-x-1\">\n            {minimized.map((win) => (\n              <AppButton key={win.id} transparent={true} onClick={onClick(win)}>\n                <div\n                  className=\"flex space-x-1 items-center\"\n                  style={{ maxWidth: '128px' }}\n                >\n                  <div className=\"w-4 h-4\">\n                    <AppWindowIcon win={win} />\n                  </div>\n                  <div className=\"truncate text-center text-sm\">\n                    {win.title}\n                  </div>\n                </div>\n              </AppButton>\n            ))}\n          </div>\n        )}\n\n        {trays.length > 0 && (\n          <div className=\"flex space-x-1\">\n            {trays.map((win) => (\n              <div key={win.id} className=\"flex space-x-1 items-center\">\n                <div\n                  className=\"flex items-center justify-center w-4 h-4 overflow-hidden\"\n                  title={win.title}\n                >\n                  <AppWindowCanvas id={win.id} />\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </AppPanel>\n  )\n}\n\nexport const AppConnectingPanel: FC = () => {\n  const { state, xpra } = useContext(AppContext)\n\n  const onDisconnect = () => xpra.disconnect()\n  return (\n    <AppPanel\n      classNames={[\n        'p-8',\n        'top-1/2',\n        'left-1/2 transform',\n        '-translate-x-1/2',\n        '-translate-y-1/2',\n        'w-96',\n      ]}\n    >\n      <div className=\"space-y-4\">\n        <div className=\"text-center\">Connecting to {state.host}</div>\n        <div>\n          <AppButton onClick={onDisconnect}>Cancel</AppButton>\n        </div>\n      </div>\n    </AppPanel>\n  )\n}\n","/**\n * Xpra Typescript Client React UI\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport React, { useContext } from 'react'\nimport { AppContext, AppContextProvider } from './context'\nimport { AppDesktop } from './desktop'\nimport {\n  AppConnectionPanel,\n  AppDebugPanel,\n  AppTrayPanel,\n  AppConnectingPanel,\n} from './panels'\nimport { FadeInOutTransition } from './transitions'\nimport { XpraClient, XpraWindowManager } from '../xpra'\n\nexport function AppInner() {\n  const { state } = useContext(AppContext)\n  return (\n    <>\n      <FadeInOutTransition toggled={!state.connected}>\n        <AppConnectionPanel />\n      </FadeInOutTransition>\n\n      <FadeInOutTransition toggled={!state.started && state.connected}>\n        <AppConnectingPanel />\n      </FadeInOutTransition>\n\n      <AppDesktop>{state.connected && <AppDebugPanel />}</AppDesktop>\n\n      <FadeInOutTransition toggled={state.started}>\n        <AppTrayPanel />\n      </FadeInOutTransition>\n    </>\n  )\n}\n\nexport function App({ xpra, wm }: { xpra: XpraClient; wm: XpraWindowManager }) {\n  return (\n    <AppContextProvider wm={wm} xpra={xpra}>\n      <AppInner />\n    </AppContextProvider>\n  )\n}\n","/**\n * Xpra Typescript Client Example\n * @link https://github.com/andersevenrud/xpra-html5-client\n * @author Anders Evenrud <andersevenrud@gmail.com>\n * @license Mozilla Public License Version 2.0\n */\n\nimport './style.css'\nimport ReactDOM from 'react-dom'\nimport { createElement } from 'react'\nimport { XpraClient, XpraWindowManager } from './xpra'\nimport { App } from './ui/App'\nimport XpraWorker from './xpra/workers/webworker?worker'\n\nasync function main() {\n  const app = document.querySelector<HTMLDivElement>('#app')\n  const worker = new XpraWorker()\n  const xpra = new XpraClient(worker)\n  const wm = new XpraWindowManager(xpra)\n\n  await xpra.init()\n  wm.init()\n\n  if (app) {\n    ReactDOM.render(createElement(App, { xpra, wm }), app)\n  }\n\n  window.xpra = { xpra }\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  main()\n})\n"],"names":["forge","createContext","useReducer","useState","useEffect","useContext","useRef","useCallback","createRef","XpraWorker","createElement"],"mappings":"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"}