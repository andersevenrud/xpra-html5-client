var et=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var ne=(o,e,t)=>e in o?et(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,f=(o,e)=>{for(var t in e||(e={}))pe.call(e,t)&&ne(o,t,e[t]);if($)for(var t of $(e))he.call(e,t)&&ne(o,t,e[t]);return o},k=(o,e)=>tt(o,nt(e));var oe=(o,e)=>{var t={};for(var n in o)pe.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&$)for(var n of $(o))e.indexOf(n)<0&&he.call(o,n)&&(t[n]=o[n]);return t};var m=(o,e,t)=>(ne(o,typeof e!="symbol"?e+"":e,t),t);import{E as F,l as We,d as Ie,r as g,R as a,C as ot,a as st}from"./vendor.bc96ecdf.js";import{g as it,a as rt,b as at,P as ct,c as dt,d as lt,e as ut,f as pt,C as ht,L as mt,h as ft,i as wt,r as gt,j as At,J as se}from"./lib.34b3f480.js";const yt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};yt();/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */var G=(o=>(o[o.ERROR=40]="ERROR",o[o.WARNING=30]="WARNING",o[o.INFO=20]="INFO",o[o.DEBUG=10]="DEBUG",o))(G||{});/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const bt="5.0",vt="1237",Et=0,St="master",Ct=250,xt=["pointer-position","button-action","key-action","desktop_size"],Ne=["jpeg","png","png/P","png/L","rgb","rgb32","rgb24","scroll","webp","void","avif"],kt=["RGBX","RGBA","RGB"],Rt={rec2020:"rec2020",p3:"P3",srgb:"srgb"},Mt={Win:["win32","Microsoft Windows"],Mac:["darwin","Mac OSX"],Linux:["linux","Linux"],X11:["posix","Posix"]},me=["UTF8_STRING","TEXT","STRING","text/plain"],Wt={us:"English USA",gb:"United Kingdom",fr:"France",de:"Germany",es:"Spain",ad:"Andorra",af:"Afghanistan",al:"Albania",ara:"Arabic",am:"Armenia",az:"Azerbaijan",bd:"Bangladesh",by:"Belarus",be:"Belgium",bt:"Bhutan",ba:"Bosnia",br:"Brazil",bg:"Bulgaria",kh:"Cambodia",ca:"Canada",cn:"China",cd:"Congo,",hr:"Croatia",cz:"Czechia",dk:"Denmark",epo:"Esperanto",ee:"Estonia",et:"Ethiopia",ir:"Iran",iq:"Iraq",fo:"Faroe",fi:"Finland",ge:"Georgia",gh:"Ghana",gr:"Greece",gn:"Guinea",hu:"Hungary",is:"Iceland",in:"India",ie:"Ireland",il:"Israel",it:"Italy",jp:"Japan",kz:"Kazakhstan",kr:"Korea,",kg:"Kyrgyzstan",latam:"Latin",lv:"Latvia",la:"Laos",lt:"Lithuania",mao:"Maori",mk:"Macedonia",mv:"Maldives",ml:"Mali",mt:"Malta",mn:"Mongolia",me:"Montenegro",ma:"Morocco",mm:"Myanmar",np:"Nepal",nl:"Netherlands",ng:"Nigeria",no:"Norway",pk:"Pakistan",pl:"Poland",pt:"Portugal",ro:"Romania",ru:"Russia",sn:"Senegal",rs:"Serbia",sk:"Slovakia",si:"Slovenia",za:"South Africa",lk:"Sri Lanka",se:"Sweden",ch:"Switzerland",sy:"Syria",tw:"Taiwan",tj:"Tajikistan",tz:"Tanzania",th:"Thailand",tr:"Turkey",tm:"Turkmenistan",ua:"Ukraine",uz:"Uzbekistan",vn:"Vietnam"},fe={1e3:"Normal Closure",1001:"Going Away",1002:"Protocol Error",1003:"Unsupported Data",1004:"(For future)",1005:"No Status Received",1006:"Abnormal Closure",1007:"Invalid frame payload data",1008:"Policy Violation",1009:"Message too big",1010:"Missing Extension",1011:"Internal Error",1012:"Service Restart",1013:"Try Again Later",1014:"Bad Gateway",1015:"TLS Handshake"};/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */class De extends TypeError{}class ee extends Error{}class It extends Error{}class Oe extends Error{}class Z extends Error{}class we extends Error{}class Nt extends Error{}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */function ge(o){if(o instanceof CloseEvent){const{code:e,reason:t}=o,n=fe[e]?`'${fe[e]}' (${e})`:String(e),s=t?`: '${t}'`:"";return new ee(n+s)}return new ee("unknown error")}class Dt extends F{constructor(){super(...arguments);m(this,"ws",null);m(this,"connectionStatus","disconnected");m(this,"reconnectTimeout",0);m(this,"reconnectAttempt",0);m(this,"maxReconnectAttempts",3);m(this,"reconnectIntervalTime",5*1e3);m(this,"host","")}send(e){this.ws&&this.ws.send(e)}connect(e,t){const n=this.connectionStatus==="reconnecting",s=new WebSocket(e,"binary");console.info("Connecting websocket",e,this.connectionStatus),s.binaryType="arraybuffer",s.onopen=()=>{console.info("Opened websocket"),this.connectionStatus="connected",this.emit("open")},s.onclose=i=>{console.info("Closed websocket"),this.connectionStatus="disconnected",this.emit("close",ge(i))},s.onerror=i=>{this.emit("error",ge(i))},s.onmessage=i=>{const r=new Uint8Array(i.data);this.emit("message",r)},n||(this.reconnectAttempt=0),t&&(this.maxReconnectAttempts=t.reconnectAttempts,this.reconnectIntervalTime=t.reconnectInterval),this.ws=s,this.host=e,this.clearTimers(),this.emit("connect",this.connectionStatus)}disconnect(e=!1){e&&this.connectionStatus==="reconnecting"||(console.info("Disconnect websocket"),this.clearTimers(),this.connectionStatus=e?"reconnecting":"disconnected",this.ws&&(this.ws.onopen=null,this.ws.onclose=null,this.ws.onerror=null,this.ws.onmessage=null,this.ws.close()),this.ws=null,e&&(this.reconnectAttempt>=this.maxReconnectAttempts?this.disconnect(!1):(this.reconnectAttempt++,this.reconnectTimeout=setTimeout(()=>this.connect(this.host),this.reconnectIntervalTime))),this.emit("disconnect",this.connectionStatus))}clearTimers(){clearTimeout(this.reconnectTimeout)}get connected(){return!!this.ws}get status(){return this.connectionStatus}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */function Ot(o){let e="";if(o.subarray)for(let n=0,s=o.length;n<s;n+=10400)e+=String.fromCharCode.apply(null,o.subarray(n,Math.min(n+10400,s)));else for(let n=0,s=o.length;n<s;n+=10400)e+=String.fromCharCode.apply(null,o.slice(n,Math.min(n+10400,s)));return window.btoa(e)}function Be(o){const t=[];for(let n=0;n<o.length;n+=32768)t.push(String.fromCharCode.apply(null,o.subarray(n,n+32768)));return t.join("")}function Pe(o){const e=new Uint8Array(o.length);for(let t=0;t<o.length;++t)e[t]=o.charCodeAt(t);return e}function Ue(){const o=[],e="0123456789abcdef";for(let t=0;t<36;t++)t==8||t==13||t==18||t==23?o[t]="-":o[t]=e.substr(Math.floor(Math.random()*16),1);return o.join("")}function re(o){const e=window.crypto||window.mscrypto;if(!e){let n="";for(;n.length<o;)n+=Ue();return n.substr(0,o)}const t=new Uint8Array(o);return e.getRandomValues(t),String.fromCharCode.apply(null,t)}function Bt(o,e){let t="";if(o.length!==e.length)throw new TypeError("strings must be equal length");for(let n=0;n<o.length;n++)t+=String.fromCharCode(o[n].charCodeAt(0)^e[n].charCodeAt(0));return t}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const H=window.AV,Pt=!!ut(),Ut=typeof H!="undefined"&&H!=null&&H.Decoder!=null&&H.Player.fromXpraSource!=null;class Te{constructor(e,t){m(this,"audio");m(this,"audioCodec");m(this,"audioBuffer",[]);m(this,"audioBufferCount",0);this.audio=e,this.audioCodec=t}async setup(){console.warn("XpraAudioAdapter#setup","unhandled event")}async start(){console.warn("XpraAudioAdapter#start","unhandled event")}stop(){this.audio.pause(),this.audioBuffer=[],this.audioBufferCount=0,this.audio.src=""}addQueue(e,t){let n=4;if(this.audioBuffer.length>=Ct)throw new Oe("Buffer queue overflow");if(t){for(let s=0;s<t.length;s++)this.audioBuffer.push(Pe(t[s]));n=1}this.audioBuffer.push(e),this.processQueue(n)}pushBuffer(e){console.warn("XpraAudioAdapter#pushBuffer","unhandled event")}processQueue(e){if(this.isReady()&&(this.audioBufferCount>0||this.audioBuffer.length>=e)){{let t;if(this.audioBuffer.length==1)t=this.audioBuffer[0];else{let n=0;for(let s=0,i=this.audioBuffer.length;s<i;++s)n+=this.audioBuffer[s].length;t=new Uint8Array(n),n=0;for(let s=0,i=this.audioBuffer.length;s<i;++s){const r=this.audioBuffer[s];r.length>0&&(t.set(r,n),n+=r.length)}}this.audioBufferCount+=1,this.pushBuffer(t)}this.audioBuffer=[]}}isReady(){return!1}}class Tt extends Te{constructor(){super(...arguments);m(this,"mediaSource",null);m(this,"mediaSourceReady",!1);m(this,"mediaSourceBuffer",null)}async setup(){const e=pt(),t=()=>new Promise((n,s)=>{e.addEventListener("sourceopen",()=>{if(console.debug("XpraAudio -> MediaSource","Source opened"),this.mediaSourceReady)s(new Oe("MediaSource already open"));else{const i=ht[this.audioCodec];if(i)try{const r=e.addSourceBuffer(i);r.mode="sequence",r.addEventListener("error",c=>{console.error("XpraAudio -> MediaSource -> SourceBuffer",c)}),n(r)}catch(r){s(r)}else s(new It(`Media codec '${this.audioCodec}' unsupported`))}})});this.mediaSource=e,this.audio.src=window.URL.createObjectURL(this.mediaSource),this.mediaSourceBuffer=await t(),this.mediaSourceReady=!0}async start(){try{await this.audio.play()}catch(e){console.error("XpraAudio#start","audio start error",e)}}stop(){if(super.stop(),this.mediaSource)try{this.mediaSourceBuffer&&this.mediaSource.removeSourceBuffer(this.mediaSourceBuffer),this.mediaSource.readyState==="open"&&this.mediaSource.endOfStream()}catch(e){console.error("XpraMediaSourceAdapter",e)}this.mediaSource=null,this.mediaSourceBuffer=null,this.mediaSourceReady=!1}pushBuffer(e){this.mediaSourceBuffer&&this.mediaSourceBuffer.appendBuffer(e)}isReady(){return!!this.mediaSourceBuffer&&!this.mediaSourceBuffer.updating}}class _t extends Te{constructor(){super(...arguments);m(this,"auroraSource",null)}async setup(){this.auroraSource=H.Player.fromXpraSource()}async start(){this.auroraSource&&this.auroraSource.play()}stop(){var e;if(super.stop(),(e=this.auroraSource)!=null&&e.context)try{this.auroraSource.context.close()}catch(t){console.error("XpraAuroraAdapter",t)}this.auroraSource=null}pushBuffer(e){this.auroraSource&&this.auroraSource.asset.source._on_data(e)}isReady(){return!!this.auroraSource}}class zt extends F{constructor(){super();m(this,"audio",document.createElement("audio"));m(this,"enabled",!1);m(this,"adapter",null);m(this,"defaultCodec",null);m(this,"audioCodec",null);m(this,"audioFramework",null);m(this,"auroraCodecs",Ut?it():{});m(this,"mediaCodecs",Pt?rt():{});m(this,"detectedCodecs",f(f({},this.mediaCodecs),this.auroraCodecs));Object.values(this.detectedCodecs).length>0&&(this.defaultCodec=at(this.detectedCodecs)),console.debug("XpraAudio#constructor",this)}async init(){this.audio.setAttribute("autoplay",String(!0)),this.audio.addEventListener("play",()=>{console.info("XpraAudio -> <audio>","playing")}),this.audio.addEventListener("error",e=>{console.error("XpraAudio -> <audio>",e),this.stop()})}validate(e){return e!==this.audioCodec?(console.error("XpraAudio#validate","invalid codec",e),this.stop(),!1):!0}stop(){this.adapter&&this.adapter.stop(),this.enabled=!1,this.adapter=null,this.emit("stop")}async setup(e){if(e["sound.send"]){const t=e["sound.encoders"];if(this.defaultCodec){const n=ct.find(s=>!!(s in this.detectedCodecs&&t.includes(s)))||this.defaultCodec;n&&(this.enabled=!0,this.audioCodec=n,this.audioFramework=this.auroraCodecs[n]?"aurora":"mediasource")}}if(this.enabled){const t=dt(this.audioFramework==="mediasource",this.audioFramework==="aurora",!1),n=lt(t);if(n){const[s,i]=n.split(":");this.audioFramework=s,this.audioCodec=i}this.audioCodec&&(this.audioFramework==="mediasource"?this.adapter=new Tt(this.audio,this.audioCodec):this.audioFramework==="aurora"&&(this.adapter=new _t(this.audio,this.audioCodec)));try{this.adapter&&(await this.adapter.setup(),this.emit("start"))}catch(s){console.error("XpraAudio#setup",s),this.stop()}}}async start(){this.adapter?this.adapter.start():this.stop()}addQueue(e,t){this.adapter&&this.adapter.addQueue(e,t)}getDecoders(){return Object.keys(this.detectedCodecs)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const Lt=["unknown",["unknown","unknown"]];function de(){const o=mt;function e(){const n=["language","browserLanguage","systemLanguage","userLanguage"].find(s=>typeof navigator[s]=="string");return navigator.languages?navigator.languages:n?[n]:["us"]}return e().map(t=>{const[n]=t.split(/-|_/);return o[t]||o[n]||t})}function Xt(){const[o]=de(),e=navigator.userAgent,t=!!navigator.vendor.match(/apple/i)&&!e.match(/crios/i)&&!e.match(/fxios/i)&&!e.match(/Opera|OPT\//),n=[["MSIE",e.includes("MSIE")||e.includes("Trident/")],["Firefox","firefox"],["Opera","opera"],["Safari",t],["Chrome","chrome"]],[s]=n.find(([,i])=>typeof i=="boolean"?i:e.toLowerCase().includes(i))||["",""];return{agent:navigator.userAgent,name:s,layout:o}}function Ft(){const{appVersion:o,oscpu:e,cpuClass:t}=navigator,n=Object.entries(Mt).find(([r])=>o==null?void 0:o.includes(r)),[,[s,i]]=n||Lt;return{type:s,name:i,platform:o,processor:e||t||"unknown"}}function _e(){const o=t=>typeof t=="number"&&t>0&&isFinite(t)?Math.round(t*1e3*1e3):t,e={type:"unknown",downlink:-1,downlinkMax:-1,effectiveType:"4g",rtt:0};if("connection"in navigator){const t=Object.keys(e).filter(n=>n in navigator.connection).map(n=>[n,navigator.connection[n]]);Object.assign(e,Object.fromEntries(t))}return k(f({},e),{downlink:o(e.downlink),downlinkMax:o(e.downlinkMax)})}const Gt=()=>navigator.clipboard&&!!navigator.clipboard.readText&&!!navigator.clipboard.writeText;async function Yt(){const o=document.createElement("input");o.type="file";const e=t=>new Promise((n,s)=>{const i=new FileReader;i.onload=()=>{n(i.result)},i.onerror=r=>{s(r)},i.readAsArrayBuffer(t)});return new Promise((t,n)=>{o.onchange=async()=>{try{if(o.files){const s=Array.from(o.files).map(r=>e(r).then(c=>({buffer:c,name:r.name,size:r.size,type:r.type}))),i=await Promise.all(s);t(i)}else t([])}catch(s){n(s)}},o.click()})}function ze(o,e){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,o);else{const t=e instanceof Blob?window.URL.createObjectURL(e):e;try{const n=document.createElement("a");n.href=t,n.download=o,n.click()}finally{window.URL.revokeObjectURL(t)}}}function Qt(o,e){const t=URL.createObjectURL(e);try{const n=window.open(t);!n||n.closed||n.closed!==void 0?ze(o,t):n.print()}finally{window.URL.revokeObjectURL(t)}}async function Ae(o){if(navigator.clipboard.read){const t=s=>new Promise((i,r)=>{const c=new FileReader;c.onload=()=>{i(c.result)},c.onerror=d=>{r(d)},c.readAsText(s)}),n=await navigator.clipboard.read();for(let s=0;s<n.length;s++){const i=n[s];for(let r=0;r<i.types.length;r++){const c=i.types[r],d=await i.getType(c),l=await t(d);if(c==="text/plain")return[o,l];if(c==="image/png")return[c,l]}}}const e=await navigator.clipboard.readText();return[o,e]}async function ye(o,e){if(e){if(navigator.clipboard.write){const t=new Blob([o],{type:e}),s=[new ClipboardItem({[e]:t})];return await navigator.clipboard.write(s),!0}}else return await navigator.clipboard.writeText(o),!0;return!1}async function Kt(o,e){if(!("Notification"in window))throw new Error("Notifications are not supported in this browser");return Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"?new Notification(o,e):null}function Vt(){if(window.matchMedia){const o=Object.entries(Rt).find(([e])=>window.matchMedia(`(color-gamut: ${e})`));if(o)return o[1]}return""}const Le=(()=>{let o=96;if(typeof window!="undefined")if("deviceXDPI"in screen)o=(screen.systemXDPI+screen.systemYDPI)/2;else{const e=document.createElement("div");e.style.width="1in",e.style.height="1in",e.style.left="-100%",e.style.top="-100%",e.style.position="absolute",document.body.appendChild(e);const{offsetWidth:t,offsetHeight:n}=e;e.remove(),t>0&&n>0&&(o=Math.round((t+n)/2))}return()=>o})(),Xe=o=>unescape(encodeURIComponent(o));function Fe(o,e,t){const{search:n}=window.location,s=new URLSearchParams(n),i=Array.from(s).map(([r,c])=>o.includes(r)?[r,["1","true","on"].includes(String(c).toLowerCase())]:e.includes(r)?[r,parseInt(c)]:[r,c||void 0]);return Object.fromEntries(i.filter(([r,c])=>t.includes(r)&&c!==void 0))}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class jt extends F{constructor(){super(...arguments);m(this,"altgrState",!1);m(this,"keyboardKayout","us");m(this,"swapKeys",!1);m(this,"modifiers",{numlock:null,alt:null,ctrl:null,meta:null,altgr:null})}configure(e,t){this.keyboardKayout=e.keyboardLayout,this.swapKeys=e.swapKeys;const n=t.modifier_keycodes;let s=null,i=null,r=null,c=null,d=null;if(n){for(const l in n){const p=n[l];for(let u=0;u<p.length;u++){const h=p[u];for(let w=0;w<h.length;w++)h[w]=="Alt_L"?i=l:h[w]=="Meta_L"?c=l:h[w]=="ISO_Level3_Shift"||h[w]=="Mode_switch"?d=l:h[w]=="Control_L"?r=l:h[w]==="Num_Lock"&&(s=l)}}this.swapKeys&&([c,r]=[r,c])}Object.assign(this.modifiers,{numlock:s,alt:i,ctrl:r,meta:c,altgr:d})}getKey(e){return ft(e)}getModifiers(e){const t=wt(e),n=t.slice();let s=t.indexOf("meta");return s>=0&&this.modifiers.meta&&(n[s]=this.modifiers.meta),s=t.indexOf("control"),s>=0&&this.modifiers.ctrl&&(n[s]=this.modifiers.ctrl),s=t.indexOf("alt"),s>=0&&this.modifiers.alt&&(n[s]=this.modifiers.alt),s=t.indexOf("numlock"),s>=0&&(this.modifiers.numlock?n[s]=this.modifiers.numlock:n.splice(s,1)),s=t.indexOf("capslock"),s>=0&&(n[s]="lock"),this.altgrState&&this.modifiers.altgr&&!n.includes(this.modifiers.altgr)&&(n.push(this.modifiers.altgr),s=n.indexOf(this.modifiers.altgr),s>=0&&n.splice(s,1),s=n.indexOf(this.modifiers.ctrl),s>=0&&n.splice(s,1)),n}onKeyPress(e,t){const[n]=de();this.keyboardKayout!==n&&this.emit("layoutChanged",n),e==="AltGraph"&&(this.altgrState=t)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class Zt{getButton(e){let t=0;return"which"in e?t=Math.max(0,e.which):"button"in e&&(t=Math.max(0,e.button)+1),t}getPosition(e){return[e.clientX,e.clientY]}getScroll(e){const t=e,n=s=>s>1?1:s<0?-1:0;return typeof t.deltaX=="number"?[n(t.deltaX),n(t.deltaY)]:typeof t.wheelDelta=="number"?[0,t.wheelDelta/120]:typeof t.wheelDeltaX=="number"?[t.wheelDeltaX/120,t.wheelDeltaY/120]:[0,0]}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class Ht extends F{constructor(){super(...arguments);m(this,"enabled",!1);m(this,"direction","both");m(this,"clipboardBuffer",{})}configure(e){this.enabled=e.clipboard,this.direction=e.clipboardDirection}reset(){this.clipboardBuffer={}}async write(e,t,n,s,i,r,c,d){if(!this.enabled)return;arguments.length>=7&&(this.clipboardBuffer[t]=[d,i,r,c]);const l=e["clipboard.preferred-targets"];if(s&&l.includes(s)){let u=d;i.match(/text|string/i)?(u instanceof Uint8Array&&(u=Be(u)),await ye(u)):i==="image/png"&&r==8&&c=="bytes"&&await ye(d,i)}}async read(e,t){if(!this.enabled)return;const n=()=>{const s=this.clipboardBuffer.CLIPBOARD;if(s){const[i,r,c,d]=s;this.emit("send",e,t,i,r,c,d)}};if(t!="CLIPBOARD"){this.emit("send",e,t,"");return}try{const s=await Ae("UTF8_STRING"),i=this.clipboardBuffer.PRIMARY;if(i&&i[1]==8&&i[2]=="bytes"&&s==i[3])n();else if(s){const[r,c]=s;this.emit("send",e,t,c,r)}}catch(s){n(),console.error("XpraClipboard#read",s)}}async poll(){if(this.direction==="to-server")return;const[,e]=await Ae("UTF8_STRING"),t=Xe(e);this.emit("token",t)}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const qt={log:G.INFO,info:G.INFO,warn:G.WARNING,error:G.ERROR,debug:G.DEBUG};class Jt extends F{log(...e){this.perform("log",e)}info(...e){this.perform("info",e)}warn(...e){this.perform("warn",e)}error(...e){this.perform("error",e)}debug(...e){this.perform("debug",e)}perform(e,t){const n=console[e],s=qt[e];n.apply(n,["-->",...t]),this.emit("log",s,t)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const[$t]=de(),te={reconnect:!0,connectionTimeout:3e4,reconnectInterval:5e3,reconnectAttempts:3,bandWidthLimit:0,startNewSession:null,shareSession:!1,stealSession:!1,username:"",display:"",password:"",showStartMenu:!0,fileTransfer:!0,clipboardImages:!1,clipboardDirection:"both",clipboard:!0,printing:!1,bell:!0,audio:!0,video:!1,nativeVideo:!1,cursor:!0,keyboard:!0,mouse:!0,tray:!0,notifications:!0,ssl:!1,encryption:null,encryptionKey:null,encoder:"auto",openUrl:!0,swapKeys:!1,keyboardLayout:$t,exitWithChildren:!1,exitWithClient:!1,startCommand:"",reverseScrollX:!1,reverseScrollY:!1},en=["reconnect","showStartMenu","clipboardImages","clipboard","shareSession","stealSession","fileTransfer","printing","bell","audio","cursor","keyboard","mouse","tray","notifications","ssl","openUrl","video","nativeVideo","swapKeys","exitWithChildren","exitWithClient","reverseScrollX","reverseScrollY"],tn=["bandWidthLimit","connectionTimeout","reconnectAttempts","reconnectInterval"],nn=()=>Fe(en,tn,Object.keys(te));/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */function be(o,e,t){if(o.startsWith("hmac")){let n="md5";o.indexOf("+")>0&&(n=o.split("+")[1]);const s=We.hmac.create();return s.start(n,e),s.update(t),s.digest().toHex()}else if(o=="xor"){const n=t.slice(0,e.length);return Bt(n,e)}return null}function on(o,e,t,n,s,i){if(!n)throw new Z("Invalid login");if(t==="xor"){if(e==="xor"&&!s&&!i)throw new Z("Aborted challenge because xor is not safe in this environment");if(o.length<16||o.length>256)throw new Z(`Invalid challenge xor salt length: ${o.length}`)}const r=t==="xor"?o.length:32,c=re(r),d=be(t,c,o);let l=null;if(d&&(l=be(e,n,d)),!l)throw new Z("Could not challenge server auth attempt");return[l,c]}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class sn extends F{constructor(e){super();m(this,"worker");this.worker=e}async init(){this.worker.addEventListener("message",e=>{const[t,n]=e.data;this.recieve(t,n)}),this.worker.addEventListener("error",e=>{this.emit("failure",e)})}send(e,t){this.worker.postMessage([e,t])}recieve(e,t){switch(e){case"send":this.emit("send",t);break;case"recieve":this.emit("recieve",t);break;case"failure":const[n,s]=t,i=new Nt(`${n} | ${s}`);this.emit("failure",i)}}configure(e){this.send("configure",e)}setConnected(e){this.send("connected",e)}pushSend(e){this.send("send",e)}pushRecieve(e){this.send("recieve",e)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const rn=o=>new Promise(e=>{const t=new Image;t.onload=()=>{t.width&&t.height?e(t):e(null)},t.onerror=()=>{e(null)},t.src=o});function Y(o,e){const t=typeof e=="string"?Pe(e):e,n=Ot(t);return`data:image/${o==="svg"?"image/svg+xml":o};base64,${n}`}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const an=()=>{const o=Object.keys(We.md.algorithms).map(e=>`hmac+${e}`);return["hmac","hmac+md5","xor",...o]},cn=o=>o?[...me,"image/png"]:me;function dn({startNewSession:o,exitWithChildren:e,exitWithClient:t,startCommand:n}){return o?{mode:o,"exit-with-children":e,"exit-with-client":t,[e?"start-child":"start"]:t?[n]:[]}:{}}function Ge(o,e){const t=Le(),n=Math.round(o*25.4/t),s=Math.round(e*25.4/t);return[["HTML",o,e,n,s,[["Canvas",0,0,o,e,n,s]],0,0,o,e]]}function ve(o={},e=!0){const t=[window.innerWidth,window.innerHeight],n=an(),s=Ft(),i=Xt(),r=Gt()?["CLIPBOARD"]:["CLIPBOARD","PRIMARY"],c=gt(),d=Ne,l=f({version:bt,"build.revision":vt,"build.local_modifications":Et,"build.branch":St,platform:s.type,"platform.name":s.name,"platform.processor":s.processor,"platform.platform":s.platform,"session-type":i.name,"session-type.full":i.agent,namespace:!0,"clipboard.contents-slice-fix":!0,client_type:"HTML5","websocket.multi-packet":!0,"setting-change":!0,uuid:Ue(),argv:[window.location.href],digest:n,"salt-digest":n,zlib:!0,compression_level:1,"file-transfer":!1,printing:!1,share:!1,steal:!1,username:"",display:"","mouse.show":!0,rencode:c,rencodeplus:c,bencode:!0,yaml:!1,"open-url":!0,"ping-echo-sourceid":!0,vrefresh:-1,"xdg-menu-update":!0,"bandwidth-limit":0,"connection-data":_e(),lz4:!0,"encoding.rgb_lz4":!0,brotli:!0,"clipboard.preferred-targets":[],"start-new-session":void 0,auto_refresh_delay:500,randr_notify:!0,"sound.server_driven":!0,"server-window-resize":!0,"screen-resize-bigger":!1,"metadata.supported":["fullscreen","maximized","iconic","above","below","title","size-hints","class-instance","transient-for","window-type","has-alpha","decorations","override-redirect","tray","modal","opacity"],encoding:"auto",encodings:d,"encoding.icons.max_size":[30,30],"encodings.core":d,"encodings.rgb_formats":kt,"encodings.window-icon":["png"],"encodings.cursor":["png"],"encoding.flush":!0,"encoding.transparency":!0,"encoding.scrolling":d.includes("scroll"),"encoding.decoder-speed":{video:0},"encodings.packet":!0,"encoding.color-gamut":Vt(),"encoding.video_scaling":!0,"encoding.video_max_size":[1024,768],"encoding.eos":!0,"encoding.full_csc_modes":{mpeg1:["YUV420P"],h264:["YUV420P"],"mpeg4+mp4":["YUV420P"],"h264+mp4":["YUV420P"],"vp8+webm":["YUV420P"],webp:["BGRX","BGRA"],jpeg:["BGRX","BGRA","BGR","RGBX","RGBA","RGB","YUV420P","YUV422P","YUV444P"]},"encoding.x264.YUV420P.profile":"baseline","encoding.h264.YUV420P.profile":"baseline","encoding.h264.YUV420P.level":"2.1","encoding.h264.cabac":!1,"encoding.h264.deblocking-filter":!1,"encoding.h264.fast-decode":!0,"encoding.h264+mp4.YUV420P.profile":"baseline","encoding.h264+mp4.YUV420P.level":"3.0","encoding.h264.score-delta":-20,"encoding.h264+mp4.score-delta":50,"encoding.h264+mp4.":50,"encoding.mpeg4+mp4.score-delta":40,"encoding.vp8+webm.score-delta":40,"sound.receive":!0,"sound.send":!1,"sound.decoders":[],"sound.bundle-metadata":!0,"encoding.rgb_zlib":!0,windows:!0,"window.pre-map":!0,keyboard:!0,xkbmap_layout:i.layout,xkbmap_keycodes:At(),xkbmap_print:"",xkbmap_query:"",desktop_size:t,desktop_mode_size:t,screen_sizes:Ge(t[0],t[1]),dpi:Le(),clipboard:!0,"clipboard.want_targets":!0,"clipboard.greedy":!0,"clipboard.selections":r,notifications:!0,"notifications.close":!0,"notifications.actions":!0,cursors:!0,bell:!0,system_tray:!0,named_cursors:!1,"file-size-limit":10,flush:!0,cipher:void 0,"cipher.mode":void 0,"cipher.iv":void 0,"cipher.key_salt":void 0,"cipher.key_size":void 0,"cipher.key_hash":void 0,"cipher.key_stretch_iterations":void 0,"cipher.padding.options":void 0},o);return e&&Object.entries(l).forEach(([p,u])=>{if(u===null)throw new De(`Invalid value ('${u}') for capability '${p}'`)}),Object.fromEntries(Object.entries(l).filter(([,p])=>p!==void 0))}function ln(o){const e=[window.innerWidth,window.innerHeight],t=dn(o),n={"clipboard.preferred-targets":cn(o.clipboardImages),"bandwidth-limit":o.bandWidthLimit,"xdg-menu-update":o.showStartMenu,"start-new-session":t,share:o.shareSession,steal:o.stealSession,username:o.username,display:o.display,"file-transfer":o.fileTransfer,"open-url":o.openUrl,printing:o.printing,clipboard:o.clipboard,desktop_size:e,desktop_mode_size:e,cursors:o.cursor,bell:o.bell,system_tray:o.tray,notifications:o.notifications,xkbmap_layout:o.keyboardLayout,encoding:o.encoder};if(o.encryption){const[s,i]=o.encryption.split("-");if(s!=="AES")throw new De(`Invalid encryption: ${s} (${i})`);Object.assign(n,{cipher:s,"cipher.mode":i,"cipher.iv":re(16),"cipher.key_salt":re(32),"cipher.key_size":32,"cipher.key_hash":"SHA1","cipher.key_stretch_iterations":1e3,"cipher.padding.options":["PKCS#7"]})}if(o.video){const s=[...Ne,"h264"];se&&se.Renderer&&se.Decoder&&s.push("mpeg1"),o.nativeVideo&&s.push("vp8+webm","h264+mp4","mpeg4+mp4"),Object.assign(n,{encodings:s,"encodings.core":s})}return n}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const Ye={lastServerPing:0,lastClientEcho:0,clientPingLatency:0,serverPingLatency:0,serverLoad:[0,0,0]};class un extends F{constructor(e){super();m(this,"capabilities",ve({},!1));m(this,"options",f({},te));m(this,"stats",f({},Ye));m(this,"serverCapabilities",null);m(this,"connectionCheckTimeout",0);m(this,"pingInterval",0);m(this,"inited",!1);m(this,"started",!1);m(this,"worker");m(this,"audio",new zt);m(this,"ws",new Dt);m(this,"clipboard",new Ht);m(this,"keyboard",new jt);m(this,"mouse",new Zt);m(this,"logger",new Jt);m(this,"processorBindings",{"new-window":this.processNewWindow,"window-icon":this.processWindowIcon,"startup-complete":this.processStartupComplete,"setting-change":this.processSettingChange,"window-move-resize":this.processWindowMoveResize,"window-resized":this.processWindowResized,"raise-window":this.processWindowRaise,"lost-window":this.processWindowLost,"window-metadata":this.processWindowMetadata,"new-override-redirect":this.processNewOverrideRedirect,"configure-override-redirect":this.processConfigureOverrideRedirect,"initiate-moveresize":this.processInitiateMoveResize,"send-file":this.processSendFile,"sound-data":this.processSoundData,"clipboard-token":this.processClipboardToken,"set-clipboard-enabled":this.processSetClipboardEnabled,"clipboard-request":this.processClipboardRequest,"info-response":this.processInfoResponse,"new-tray":this.processNewTray,"pointer-position":this.processPointerPosition,"open-url":this.processOpenUrl,notify_show:this.processShowNotification,notify_close:this.processCloseNotification,encodings:this.processEncodings,cursor:this.processCursor,hello:this.processHello,ping:this.processPing,ping_echo:this.processPingEcho,draw:this.processDraw,bell:this.processBell,challenge:this.processChallenge,eos:this.processEos,disconnect:this.processDisconnect});this.worker=new sn(e)}async init(){this.inited||(await this.worker.init(),await this.audio.init(),this.ws.on("open",()=>this.handshake()),this.ws.on("error",e=>this.disconnect(e)),this.ws.on("close",e=>this.disconnect(e)),this.ws.on("connect",e=>this.emit("connect",e)),this.ws.on("disconnect",e=>this.emit("disconnect",e)),this.ws.on("message",e=>this.worker.pushRecieve(e)),this.worker.on("recieve",e=>this.recieve(e)),this.worker.on("send",e=>this.ws.send(e)),this.worker.on("failure",e=>this.disconnect(e)),this.audio.on("start",()=>this.sendSoundStart()),this.audio.on("stop",()=>this.sendSoundStop()),this.clipboard.on("send",(...e)=>this.sendClipboard(...e)),this.clipboard.on("token",e=>this.sendClipboardToken(e)),this.keyboard.on("layoutChanged",e=>this.sendLayoutChanged(e)),this.logger.on("log",(e,t)=>{this.sendLog(e,t)}),"connection"in navigator&&navigator.connection.addEventListener("change",()=>{this.ws.connected&&this.sendConnectionData()}),this.inited=!0)}connect(e,t={}){if(!this.inited)throw new ee("Xpra instance not initialized");this.options=f(f({},te),t);try{this.clipboard.configure(this.options),this.worker.configure(this.options),this.worker.setConnected(!0),this.ws.connect(e,this.options)}catch(n){this.emit("error",n.message)}}disconnect(e){e&&console.error("XpraConnection#disconnect",e);const t=e instanceof Z||e instanceof we,n=this.options.reconnect&&!t&&!!e;t&&this.emit("error",e.message),this.clearTimers(),this.audio.stop(),this.worker.setConnected(!1),this.clipboard.reset(),this.serverCapabilities=null,this.ws.disconnect(n)}handshake(){this.started=!0,this.connectionCheckTimeout=setTimeout(()=>{this.disconnect(new ee("Not a valid xpra server?"))},this.options.connectionTimeout),this.createCapabilities(),this.sendHello()}recieve(e){const[t,...n]=e;this.ws.connected&&(this.processorBindings[t]?this.processorBindings[t].apply(this,n):console.debug("Unhandled message",t,n))}send(e){if(this.ws.connected){if(this.isReadOnly()&&xt.includes(e[0]))return;const t=["hello","ping","ping_echo","logging"];if(!this.started&&!t.includes(e[0]))return;this.worker.pushSend(e)}}clearTimers(){clearTimeout(this.connectionCheckTimeout),clearInterval(this.pingInterval)}createCapabilities(e={}){this.capabilities=ve(f(k(f({},ln(this.options)),{"sound.decoders":this.audio.getDecoders()}),e))}getOptions(){return f({},this.options)}getCapabilities(){return f({},this.capabilities)}getServerCapabilities(){return this.serverCapabilities?f({},this.serverCapabilities):null}isReady(){return this.started}isReadOnly(){var e;return!!((e=this.serverCapabilities)!=null&&e.readonly)}sendResize(e,t){const n=Math.round(e),s=Math.round(t);this.send(["desktop_size",n,s,Ge(n,s)])}sendCloseWindow(e){this.send(["close-window",e])}sendMapWindow(e){const[t,n]=e.position,[s,i]=e.dimension;this.send(["map-window",e.id,Math.round(t),Math.round(n),Math.round(s),Math.round(i),e.clientProperties])}sendUnmapWindow(e){this.send(["unmap-window",e.id,!0])}sendGeometryWindow(e,t,n){const[s,i]=t,[r,c]=n;this.send(["configure-window",e,Math.round(s),Math.round(i),Math.round(r),Math.round(c),{}])}sendConfigureWindow(e,t,n,s,i,r){const[c,d]=t,[l,p]=n;this.send(["configure-window",e,Math.round(c),Math.round(d),Math.round(l),Math.round(p),s,0,i,r])}sendDamageSequence(e,t,n,s,i=""){s<0&&console.warn("XpraConnection#sendDamageSequence",s),this.send(["damage-sequence",e,t,...n,s,i])}sendMouseMove(e,t,n){const[s,i]=t,r=[];this.options.mouse&&this.send(["pointer-position",e,[Math.round(s),Math.round(i)],n,r])}sendMouseWheel(e,t,n,s){if(!this.options.mouse||!this.serverCapabilities)return;const[i,r]=t,c=!!this.serverCapabilities["wheel.precise"],d=this.options.reverseScrollX?-i:i,l=this.options.reverseScrollY?-r:r,p=[],u=d>0?6:7,h=l>0?5:4,w=d>0?u:h,S=100;c?this.send(["wheel-motion",e,w,S,n,s,p]):(this.send(["button-action",e,w,!0,n,s,p]),this.send(["button-action",e,w,!1,n,s,p]))}sendMouseButton(e,t,n,s,i){const r=[];this.options.mouse&&this.send(["button-action",e,n,s,t,i,r])}sendKeyAction(e,t,n,s,i,r,c,d){this.options.keyboard&&(this.keyboard.onKeyPress(r,n),this.send(["key-action",e,t,n,s,i,r,c,d]))}sendLayoutChanged(e){this.send(["layout-changed",e,""])}sendWindowRaise(e,t){this.send(["focus",e,[]]),t.forEach(n=>{this.sendConfigureWindow(n.id,n.position,n.dimension,n.clientProperties,{focused:n.id===e},!0)})}sendWindowClose(e){this.send(["close-window",e])}sendNotificationClose(e){this.send(["notification-close",e,2,""])}sendSuspend(e){this.send(["suspend",!0,e])}sendResume(e){this.send(["resume",!0,e]),this.sendBufferRefresh(-1)}sendBufferRefresh(e){this.send(["buffer-refresh",e,0,100,{"refresh-now":!0,batch:{reset:!0}},{}])}sendConnectionData(){const e=_e();this.send(["connection-data",e])}sendSoundStart(){this.send(["sound-control","start"])}sendSoundStop(){this.send(["sound-control","stop"])}sendStartCommand(e,t,n){this.send(["start-command",e,t,n?"True":"False"])}sendFile(e,t,n,s){if(this.serverCapabilities){const i=this.options.encoder==="rencodeplus",r=!!this.serverCapabilities["open-files"],c=s instanceof ArrayBuffer?new Uint8Array(s):s,d=i?Be(c):c;this.send(["send-file",e,t,!1,r,n,d,{}])}}sendShutdown(){this.send(["shutdown-server"])}sendClipboardToken(e){if(this.clipboard.isEnabled()){const i=e?"UTF8_STRING":"",r=e?["UTF8_STRING","text/plain"]:[];this.send(["clipboard-token","CLIPBOARD",r,i,i,8,"bytes",e,!0,!0,!0])}}sendLog(e,...t){if(this.serverCapabilities&&this.serverCapabilities["remote-logging.multi-line"]){const n=t.map(s=>Xe(String(s)));this.send(["logging",e,n])}}sendHello(){this.send(["hello",this.capabilities])}sendPing(){const e=Math.ceil(performance.now());this.send(["ping",e])}sendClipboard(e,t,n,s="UTF8_STRING",i=8,r="bytes"){n===""?this.send(["clipboard-contents-none",e,t]):this.send(["clipboard-contents",e,t,s,i,r,n])}processHello(e){clearTimeout(this.connectionCheckTimeout),this.serverCapabilities=e,this.emit("hello",this.serverCapabilities),this.keyboard.configure(this.options,e),this.options.audio&&this.audio.setup(this.serverCapabilities)}processNewWindow(e,t,n,s,i,r,c={}){const d=parseInt(t),l=parseInt(n),p=parseInt(s),u=parseInt(i);this.emit("newWindow",{id:e,position:[d,l],dimension:[p,u],overrideRedirect:!1,metadata:r,clientProperties:c})}processWindowIcon(e,t,n,s,i){const r=Y(s,i);this.emit("windowIcon",{wid:e,dimension:[t,n],image:r})}processStartupComplete(){this.started=!0,this.emit("sessionStarted"),this.sendPing(),this.pingInterval=setInterval(()=>this.sendPing(),5e3),this.logger.info("Connection from Xpra HTML client")}processEncodings(e){console.debug("XpraConnection#processEncodings",e)}processCursor(e,t,n,s,i,r,c,d,l){if(!!this.options.cursor){if(arguments.length<8)this.emit("cursor",null);else if(e==="png"){const p=Y(e,l);this.emit("cursor",{dimension:[s,i],image:p,xhot:r,yhot:c})}}}processPing(...e){const t=e.length>1?e[1]:e[0],n=e.length>=3?e[2]:"";this.stats.lastServerPing=t,this.send(["ping_echo",t,0,0,0,0,n||""])}processPingEcho(e,t,n,s,i){this.stats.lastClientEcho=e,this.stats.clientPingLatency=i,this.stats.serverPingLatency=Math.ceil(performance.now())-this.stats.lastClientEcho,this.stats.serverLoad=[t/1e3,n/1e3,s/1e3],this.emit("pong",f({},this.stats))}processDraw(e,t,n,s,i,r,c,d,l,p){const u=performance.now(),h=(w,S="")=>this.sendDamageSequence(d,e,[s,i],w,S);this.emit("draw",{wid:e,image:c,encoding:r,packetSequence:d,rowStride:l,options:p||{},position:[t,n],dimension:[s,i],callback:w=>{const S=Math.round(1e3*performance.now()-1e3*u);w&&console.warn("XpraConnection#processDraw -> callback",w),h(S,w==null?void 0:w.message)}})}processSettingChange(e,t){switch(e){case"xdg-menu":const n=Object.values(t).map(s=>({name:s.Name,icon:s.IconData&&s.IconType?Y(s.IconType,s.IconData):void 0,entries:Object.entries(s.Entries).map(l=>{var[i,p]=l,u=p,{IconType:r,IconData:c}=u,d=oe(u,["IconType","IconData"]);return{name:i,exec:d.Exec.replace(/%[uUfF]/g,""),icon:c&&r?Y(r,c):void 0,attributes:d}})}));this.emit("updateXDGMenu",n);break;default:console.debug("XpraConnection#processSettingChange","uncaught",e,t);break}}processWindowMoveResize(e,t,n,s,i){this.emit("moveResizeWindow",{wid:e,position:[t,n],dimension:[s,i]})}processWindowResized(e,t,n){this.emit("moveResizeWindow",{wid:e,dimension:[t,n]})}processWindowRaise(e){this.emit("raiseWindow",e)}processWindowLost(e){this.emit("removeWindow",e)}processWindowMetadata(e,t){this.emit("updateWindowMetadata",{wid:e,metadata:t})}processNewOverrideRedirect(e,t,n,s,i,r,c={}){this.emit("newWindow",{id:e,position:[t,n],dimension:[s,i],overrideRedirect:!0,metadata:r,clientProperties:c})}processConfigureOverrideRedirect(e,t,n,s,i){this.emit("moveResizeWindow",{wid:e,dimension:[s,i],position:[t,n]})}processShowNotification(e,t,n,s,i,r,c,d,l,p,u){this.emit("showNotification",{id:t,replacesId:s,expires:d,actions:p,hints:u,icon:l?Y(l[0],l[3]):null,summary:r,body:c})}processCloseNotification(e){this.emit("hideNotification",e)}processBell(){this.options.bell&&new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()}processInitiateMoveResize(e,t,n,s,i,r){this.emit("initiateMoveResize",{wid:e,position:[t,n],direction:s,button:i,sourceIndication:r})}processSendFile(e,t,n,s,i){if(i.length!==s){console.warn("XpraConnection#processSendFile","Invalid length for",e);return}const r=new Blob([i],t);this.emit("sendFile",{filename:e,mime:t,size:s,blob:r,print:n})}processSoundData(e,t,n,s){try{if(!this.options.audio||!this.audio.validate(e))return;n["start-of-stream"]===1&&this.audio.start(),t&&t.length>0&&this.audio.addQueue(t,s),n["end-of-stream"]===1&&this.audio.stop()}catch(i){console.error("XpraConnection#processSoundData",i),this.audio.stop()}}async processClipboardToken(e,t,n,s,i,r,c){await this.clipboard.write(this.capabilities,e,t,n,s,i,r,c)}processSetClipboardEnabled(e){this.clipboard.setEnabled(!!e)}async processClipboardRequest(e,t){await this.clipboard.read(e,t)}processChallenge(e,t,n,s,i){i=(i||"password").replace(/[^a-zA-Z0-9\.,:\+/]/gi,""),s=s||"xor";try{const r=on(e,n,s,this.options.password,this.options.ssl,this.options.encryption);if(r){const[c,d]=r;this.createCapabilities({challenge_response:c,challenge_client_salt:d}),this.sendHello()}}catch(r){this.disconnect(r)}}processInfoResponse(e){this.emit("infoResponse",e)}processNewTray(e,t,n,s){const i=parseInt(t),r=parseInt(n);this.emit("newTray",{id:e,metadata:s,position:[0,0],dimension:[i,r],overrideRedirect:!1,clientProperties:{}})}processPointerPosition(e,t,n){const s=parseInt(t),i=parseInt(n);this.emit("pointerPosition",{wid:e,position:[s,i]})}processEos(e){this.emit("eos",e)}processDisconnect(e){this.disconnect(new we(`Disconnected: ${e}`))}processOpenUrl(e){this.options.openUrl&&window.open(e,"_blank")}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * Original source: https://github.com/Xpra-org/xpra-html5
 */async function pn(o){switch(o.encoding){case"rgb32":case"rgb24":const[e,t]=o.dimension;return new ImageData(new Uint8ClampedArray(o.image.buffer),e,t);case"avif":case"jpeg":case"png/P":case"png/L":case"png":case"webp":const n=Y(o.encoding,o.image);return rn(n);default:console.warn("encodeXpraDrawData","Unhandled decode",o)}return null}async function hn(o,e){const t=o.getContext("2d"),[n,s]=e.position,[i,r]=e.dimension;if(t&&e.encoding!=="void")if(e.encoding==="scroll")e.image.forEach(([c,d,l,p,u,h])=>{t.drawImage(o,c,d,l,p,c+u,d+h,l,p)});else{const c=await pn(e);c&&(c instanceof ImageData?t.putImageData(c,n,s,0,0,i,r):(t.clearRect(n,s,i,r),t.drawImage(c,n,s)))}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * Original source: https://github.com/Xpra-org/xpra-html5
 */function Ee(o,e){let t=5e3;if(o.overrideRedirect)t=3e4;else switch((o.metadata["window-type"]||[])[0]){case"DROPDOWN":case"TOOLTIP":case"POPUP_MENU":case"MENU":case"COMBO":t=2e4;break;case"UTILITY":case"DIALOG":t=15e3;break}return o.metadata.above?t+=5e3:o.metadata.below&&(t-=5e3),t+e}class mn{constructor(e){m(this,"windows",[]);m(this,"xpra");m(this,"activeWindow",-1);m(this,"$desktop",null);this.xpra=e}init(){const e=Ie(()=>{if(this.$desktop){const{offsetWidth:t,offsetHeight:n}=this.$desktop;this.xpra.sendResize(t,n)}},200);this.xpra.on("sessionStarted",e),this.xpra.on("sendFile",this.sendFile.bind(this)),this.xpra.on("newWindow",this.createWindow.bind(this)),this.xpra.on("newTray",this.createWindow.bind(this)),this.xpra.on("connect",()=>{Notification.requestPermission()}),this.xpra.on("moveResizeWindow",t=>{t.dimension&&this.onResize(t.wid,t.dimension)}),this.xpra.on("draw",t=>{const n=this.getWindow(t.wid);n&&(n.renderQueue.push(t),this.renderWindow(n))}),this.xpra.on("disconnect",()=>{this.clearWindows()}),window.addEventListener("resize",e),window.addEventListener("keydown",this.onKeyAction.bind(this)),window.addEventListener("keyup",this.onKeyAction.bind(this)),window.addEventListener("wheel",this.onScrollAction.bind(this)),window.addEventListener("mousewheel",this.onScrollAction.bind(this)),window.addEventListener("DOMMouseScroll",this.onScrollAction.bind(this))}onKeyAction(e){if(this.xpra.isReady()&&e.target===document.body)e.preventDefault(),e.stopPropagation();else return;const t=this.getWindow(this.activeWindow);this.keyPress(t,e,e.type==="keydown")}onScrollAction(e){const t=this.getWindow(this.activeWindow);t&&this.mouseWheel(t,e)}onResize(e,t){const n=this.getWindow(e);if(n){const[s,i]=t;n.canvas.width!==s&&(n.canvas.width=s),n.canvas.height!==i&&(n.canvas.height=i)}}sendFile(e){e.print?Qt(e.filename,e.blob):ze(e.filename,e.blob)}async createNotification(e){const t=await Kt(e.summary,{body:e.body,icon:e.icon||void 0});if(t){const n=()=>this.xpra.sendNotificationClose(e.id);t.addEventListener("close",n)}return t}clearWindows(){this.windows=[]}createWindow(e){const[t,n]=e.dimension,s=document.createElement("canvas");s.width=t,s.height=n,this.windows.push({canvas:s,attributes:e,renderQueue:[],renderPending:0,inited:!1}),this.xpra.sendMapWindow(e)}async renderWindow(e){const t=e.renderQueue.shift();if(t&&e.canvas){try{await hn(e.canvas,t)}catch(n){t.callback(n),this.renderWindow(e);return}t.callback()}}removeWindow(e){const t=this.windows.findIndex(n=>n.attributes.id===e);t!==-1&&this.windows.splice(t,1)}updateWindow(e){const t=this.getWindow(e.id);t&&Object.assign(t.attributes,e)}moveResize(e,t,n){this.onResize(e.attributes.id,n),this.xpra.sendGeometryWindow(e.attributes.id,t,n)}mouseButton(e,t,n){const s=this.xpra.keyboard.getModifiers(t),i=this.xpra.mouse.getButton(t),r=this.xpra.mouse.getPosition(t);this.xpra.sendMouseButton(e.attributes.id,r,i,n,s)}mouseWheel(e,t){const n=this.xpra.keyboard.getModifiers(t),s=this.xpra.mouse.getPosition(t),i=this.xpra.mouse.getScroll(t);this.xpra.sendMouseWheel(e.attributes.id,i,s,n)}mouseMove(e,t){const n=e?e.attributes.id:0,s=this.xpra.keyboard.getModifiers(t),i=this.xpra.mouse.getPosition(t);this.xpra.sendMouseMove(n,i,s)}keyPress(e,t,n){const s=e?e.attributes.id:0,i=this.xpra.keyboard.getModifiers(t),{keyname:r,keycode:c,keyval:d,group:l,str:p}=this.xpra.keyboard.getKey(t);this.xpra.sendKeyAction(s,r,n,i,d,p,c,l)}raise(e){const t=this.windows.map(n=>n.attributes);this.xpra.sendWindowRaise(e.attributes.id,t)}minimize(e){this.xpra.sendUnmapWindow(e.attributes)}maximize(e,t,n){this.restore(e),this.moveResize(e,t,n)}restore(e){this.xpra.sendMapWindow(e.attributes)}close(e){this.xpra.sendCloseWindow(e.attributes.id)}getWindow(e){return this.windows.find(t=>t.attributes.id===e)||null}setDesktopElement(e){this.$desktop=e}setActiveWindow(e){this.activeWindow=e}}/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */function fn(o){if(o){const{image:e,xhot:t,yhot:n}=o;return`transparent url('${e}') no-repeat ${t}px ${n}px`}return""}function wn(o,e=""){if(o){const{image:t,xhot:n,yhot:s}=o,i=e?`, ${e}`:"";return`url('${t}') ${n} ${s}${i}`}return e}function Se(o,e,t){let n="";const{width:s,height:i,x:r,y:c}=o.getBoundingClientRect(),d=e[0]-r,l=e[1]-c;return l<=t?n+="n":l>=i-t&&(n+="s"),d<=t?n+="w":d>=s-t&&(n+="e"),n}function Ce(o){const{onDown:e,onMove:t,onRelease:n}=o();return s=>{s.preventDefault();const i=s.pageX,r=s.pageY;let c=!1;const d=p=>{const u=p.pageX-i,h=p.pageY-r;c=!0,t(p,u,h)},l=p=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",l),n(p,c)};window.addEventListener("mousemove",d),window.addEventListener("mouseup",l),e&&e(s.nativeEvent,i,r)}}function xe({opacity:o}){if(typeof o=="number")return o<0?1:o/4294967296}/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */var v=(o=>(o.SetHost="SET_HOST",o.SetShowOptions="SET_SHOW_OPTIONS",o.AddWindow="ADD_WINDOW",o.RemoveWindow="REMOVE_WINDOW",o.SetWindowIcon="SET_WINDOW_ICON",o.SetConnected="SET_CONNECTED",o.SetCursor="SET_CURSOR",o.UpdateStats="UPDATE_STATS",o.MoveResizeWindow="MOVE_RESIZE_WINDOW",o.MaximizeWindow="MAXIMIZE_WINDOW",o.UpdateMetadata="UPDATE_METADATA",o.RaiseWindow="RAISE_WINDOW",o.AddNotification="ADD_NOTIFICATION",o.RemoveNotification="REMOVE_NOTIFICATION,",o.SetDraggingWindow="SET_DRAGGING_WINDOW",o.ClearWindows="CLEAR_WINDOWS",o.SetOption="SET_OPTION",o.UpdateMenu="UPDATE_MENU",o.SetError="SET_ERROR",o.SetStarted="SET_STARTED",o))(v||{});let ke=1;const ae={connect:!1,host:"ws://127.0.0.1:10000",showOptions:!1,connected:!1,cursor:null,windows:[],notifications:[],activeWindow:0,draggingWindow:-1,actualDesktopSize:[0,0],stats:f({},Ye),options:f({},te),menu:[],error:"",started:!1};function gn(o,e){var n,s;const t=(i,r)=>{const c=o.windows,d=c.find(l=>l.id===i);return d&&Object.assign(d,r(d)),k(f({},o),{windows:c})};switch(e.type){case"SET_HOST":return k(f({},o),{host:e.payload});case"SET_SHOW_OPTIONS":return k(f({},o),{showOptions:e.payload});case"ADD_WINDOW":const i=!!e.payload.metadata.tray;return k(f({},o),{activeWindow:e.payload.id,windows:[...o.windows,{id:e.payload.id,minimized:e.payload.metadata.iconic===!0,maximized:!1,title:e.payload.metadata.title||String(e.payload.id),position:e.payload.position,dimension:e.payload.dimension,minDimension:(n=e.payload.metadata["size-constraints"])==null?void 0:n["minimum-size"],maxDimension:(s=e.payload.metadata["size-constraints"])==null?void 0:s["maximum-size"],opacity:xe(e.payload.metadata),tray:i,zIndex:i?0:Ee(e.payload,++ke)}]});case"REMOVE_WINDOW":const{windows:r}=o,c=r.findIndex(M=>M.id===e.payload);c!==-1&&r.splice(c,1);const d=r.length>0?r[r.length-1].id:0;return k(f({},o),{activeWindow:d,windows:r});case"SET_WINDOW_ICON":const l=e.payload;return t(l.wid,()=>({icon:l}));case"SET_CONNECTED":return k(f({},o),{started:!1,windows:e.payload?o.windows:[],connected:e.payload});case"SET_CURSOR":return k(f({},o),{cursor:e.payload});case"UPDATE_STATS":return k(f({},o),{stats:f(f({},o.stats),e.payload)});case"MOVE_RESIZE_WINDOW":const{wid:p,position:u,dimension:h}=e.payload;return t(p,M=>({position:u||M.position,dimension:h||M.dimension}));case"MAXIMIZE_WINDOW":const{maximize:w}=e.payload;return t(e.payload.wid,M=>({oldPosition:w?M.position:void 0,oldDimension:w?M.dimension:void 0,position:w?e.payload.position:M.oldPosition,dimension:w?e.payload.dimension:M.oldDimension,maximized:w}));case"UPDATE_METADATA":const{title:S,iconic:A}=e.payload.metadata;return t(e.payload.wid,M=>({opacity:xe(e.payload.metadata),minimized:A===void 0?M.minimized:A===!0,title:S===void 0?M.title:S}));case"RAISE_WINDOW":return k(f({},t(e.payload.id,()=>({zIndex:Ee(e.payload,++ke)}))),{activeWindow:e.payload.id});case"ADD_NOTIFICATION":return k(f({},o),{notifications:[...o.notifications,e.payload]});case"REMOVE_NOTIFICATION,":const{notifications:C}=o,N=C.findIndex(([M])=>M.id===e.payload);return N!==-1&&C.splice(N,1),k(f({},o),{notifications:C});case"SET_DRAGGING_WINDOW":return k(f({},o),{draggingWindow:e.payload});case"CLEAR_WINDOWS":return k(f({},o),{cursor:null,windows:[],notifications:[],draggingWindow:-1});case"SET_OPTION":const[O,W]=e.payload;return k(f({},o),{options:k(f({},o.options),{[O]:W})});case"UPDATE_MENU":return k(f({},o),{menu:e.payload});case"SET_ERROR":return k(f({},o),{error:e.payload});case"SET_STARTED":return k(f({},o),{started:e.payload});default:return o}}/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const U=g.exports.createContext({wm:null,xpra:null,state:ae,root:null,setRoot:()=>{},setCursor:()=>{},dispatch:()=>{}}),An=Fe(["connect"],[],["connect","host"]),yn=nn(),bn=k(f(f({},ae),An),{options:f(f({},ae.options),yn)}),vn=({children:o,wm:e,xpra:t})=>{const[n,s]=g.exports.useReducer(gn,bn),[i,r]=g.exports.useState(null),[c,d]=g.exports.useState(null),l=()=>{s({type:v.SetConnected,payload:!0}),s({type:v.SetError,payload:""})},p=y=>{s({type:v.SetConnected,payload:y!=="disconnected"}),s({type:v.ClearWindows})},u=y=>{s({type:v.AddWindow,payload:y})},h=y=>{s({type:v.RemoveWindow,payload:y})},w=y=>s({type:v.SetWindowIcon,payload:y}),S=y=>s({type:v.UpdateStats,payload:y}),A=y=>s({type:v.SetCursor,payload:y}),C=y=>{s({type:v.MoveResizeWindow,payload:y})},N=y=>{const P=e.getWindow(y);P&&s({type:v.RaiseWindow,payload:P.attributes})},O=y=>s({type:v.UpdateMetadata,payload:y}),W=y=>{},M=async y=>{const P=await e.createNotification(y);s({type:v.AddNotification,payload:[y,P]})},q=y=>s({type:v.RemoveNotification,payload:y}),Q=y=>{if(c){const[P,J]=y.position;Object.assign(c.style,{left:`${P}px`,top:`${J}px`})}},z=()=>{},K=y=>s({type:v.SetError,payload:y}),V=y=>s({type:v.UpdateMenu,payload:y}),j=()=>s({type:v.SetStarted,payload:!0});return g.exports.useEffect(()=>(t.on("connect",l),t.on("disconnect",p),t.on("newWindow",u),t.on("removeWindow",h),t.on("windowIcon",w),t.on("pong",S),t.on("cursor",A),t.on("moveResizeWindow",C),t.on("updateWindowMetadata",O),t.on("raiseWindow",N),t.on("initiateMoveResize",W),t.on("showNotification",M),t.on("hideNotification",q),t.on("pointerPosition",Q),t.on("newTray",u),t.on("eos",z),t.on("updateXDGMenu",V),t.on("error",K),t.on("sessionStarted",j),()=>{t.off("connect",l),t.off("disconnect",p),t.off("newWindow",u),t.off("removeWindow",h),t.off("windowIcon",w),t.off("pong",S),t.off("cursor",A),t.off("moveResizeWindow",C),t.off("updateWindowMetadata",O),t.off("raiseWindow",N),t.off("initiateMoveResize",W),t.off("showNotification",M),t.off("hideNotification",q),t.off("pointerPosition",Q),t.off("newTray",u),t.off("eos",z),t.off("updateXDGMenu",V),t.off("error",K),t.off("sessionStarted",j)}),[]),g.exports.useEffect(()=>{n.connect&&t.connect(n.host,n.options)},[]),g.exports.useEffect(()=>{e.setDesktopElement(i)},[i]),g.exports.useEffect(()=>{e.setActiveWindow(n.activeWindow)},[n.activeWindow]),a.createElement(U.Provider,{value:{state:n,dispatch:s,root:i,wm:e,xpra:t,setRoot:r,setCursor:d}},o)};/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const En=300,X=({toggled:o,children:e,mountOnEnter:t=!0,unmountOnExit:n=!0})=>a.createElement(ot,{in:o,timeout:En,mountOnEnter:t,unmountOnExit:n,classNames:"fade-on-out"},e);var Sn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAUdEVYdEF1dGhvcgBKYWt1YiBTdGVpbmVy5vv3LwAAADV0RVh0RGVzY3JpcHRpb24ASW52ZXJ0ZWQgdmFyaWFudCBvZiB0aGUgRE1aIGN1cnNvciB0aGVtZS5odVs8AAAAM3RFWHRTb3VyY2UAaHR0cDovL2ppbW1hYy5tdXNpY2hhbGwuY3ovdGhlbWVzLnBocD9za2luPTdQM5WxAAADwUlEQVRYhe2WTUhsZRjHf+PVcdLU48d1GkMvdwI185ZIzEYpaKttWqhcKhlFF65USjcK6equNFJbCEokiISiochQgfmBaI6CKGmg5MeIwpBXZpIRPec8LWb0Wte6c1SsRX94eDcvvD+er/8L/+sFEpFX/833o3Vd9zc3N78FxAIRdw0QKyISCAT8xcXFDuDlu4aIl5D8fr+voKDgbe44E/EiIu3t7eL3+8Xn8x3l5ua+GYIw3RlAeXm5FBUVSSAQEJ/Pd2i32x8BMbcBEVYqdV1nfn4ep9OJxWJJXFpa+t5msz0AXropRFgAmqahqiqTk5NUVVURGxtrXV1ddQFpgOUmEIYAVFVlYmKCuro6FEXJ8Hq93wE2IPq6EGEBiMgFgKqquFwuGhoaSE5Ofri/v/8t8Mp1IcIep8sAqqoyPj5Oa2srVqs1d29vbwiwAmajENcGUFWV4eFh2traSEtLy9/Z2fkGSDUKYWihXAUxMDBAZ2cn6enpjo2Nja+A+0YgDANcbsjz6O/vp6+vD7vd/t7a2tqXQAoQFQ6EIYC/NuPl6OnpYXBwkKysrPdXVla+CBfC8E6/6vHzrHR3dzM8PExOTs4HCwsLT4BkIPKfICKNAlwuAYDD4cBisWA2m4mOjmZxcZG8vDzy8/M/mpmZ+b2wsPAz4ClwZvQtCHlBSUmJABcRGRkpcXFxYrVaxe12y99J13WZnp5+Aii3lgGAsrIyxsbGUFWVrq4uent76ejo+GFoaOgns9l8bDKZxGQy6WazOSAivxJcUtfScxmora0VXdelpqZGEhISxGazyebmpni93qdAEfA6YAceAg8ILqiYWwFoaGgQXdfl9PRU9Xg8oiiKpKSkSH19vWiaJk1NTY0EvcEM3AtFBDcwqwuAxsZGERFZXFxcdzqdn2uaJtXV1aIoimRkZMjBwYEcHBx4gDe4oUM+BzA3Nye6rsvs7OwK8DFQcHR05Nna2hJFUSQ1NVVaWlpEVVWprKysIDh+t/Jtiz/v5qmpqSXgQ+ARkDw6OvpY0zSpqKiQpKQkyczMlOPjY1leXp4DXiO4hG4HYH5+/kegDMgF4ghOj+L3+/c2NjYkMTFRsrOz5fDwUNbX138OQd5KGWJ3d3e/Bt4Bsnn2LTcBUS6X6/HZ2Zlsb29LIBCQk5MTvbS0tCV017A1X6UoIJGgw8Xw57qagPiRkZFPPB7PL2632+1wOD4F3iXoA2H1wIsITQRHSQA9dF7WPYIluU/wg3oC/Ab4APWK+4YBwlEEz2ZeC8X54vrv6w+aYEf+AZkZtAAAAABJRU5ErkJggg==";/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const Cn=10,Re=16;let Me=!1;const xn=({win:o,bar:e,winstance:t})=>{const{oldPosition:n,oldDimension:s}=o,{wm:i,xpra:r,root:c,dispatch:d}=g.exports.useContext(U),l="w-4 h-4 rounded-full cursor-pointer bg-gradient-to-b shadow-inner hover:shadow",p=h=>{h.stopPropagation(),h.preventDefault()},u=()=>{if(e.current&&c)if(o.maximized)n&&s&&(i.maximize(t,n,s),d({type:v.MaximizeWindow,payload:{wid:o.id,maximize:!1}}));else{const w=e.current.offsetHeight,S=c.offsetWidth,A=c.offsetHeight-w;i.maximize(t,[0,w],[S,A]),d({type:v.MaximizeWindow,payload:{wid:o.id,position:[0,w],dimension:[S,A],maximize:!0}})}};return a.createElement("div",{className:"flex items-center space-x-2",onMouseDown:p},a.createElement("div",{title:"Minimize",className:`${l} from-green-300 to-green-500 hover:from-green-400`,onClick:()=>i.minimize(t)}),a.createElement("div",{title:"Maximize",className:`${l} from-blue-300 to-blue-500 hover:from-blue-400`,onClick:u}),!r.isReadOnly()&&a.createElement("div",{title:"Close",className:`${l} from-red-300 to-red-500 hover:from-red-400`,onClick:()=>i.close(t)}))},Qe=({win:{icon:o,title:e}})=>a.createElement(a.Fragment,null,o&&a.createElement("img",{alt:e,src:o.image,className:"max-h-full"}),!o&&a.createElement("div",{className:"w-full h-full bg-gray-500 rounded"})),ce=({id:o})=>{const e=g.exports.useRef(null),{wm:t,state:n}=g.exports.useContext(U),s=t.getWindow(o),i=n.draggingWindow>=0?"pointer-events-none":"",r=g.exports.useCallback(l=>{t.mouseButton(s,l,!0)},[]),c=g.exports.useCallback(l=>{t.mouseButton(s,l,!1)},[]),d=g.exports.useCallback(l=>{l.preventDefault(),l.stopPropagation(),t.mouseMove(s,l.nativeEvent)},[]);return g.exports.useEffect(()=>{e.current&&e.current.appendChild(s.canvas)},[e.current]),a.createElement("div",{ref:e,className:i,onMouseDown:r,onMouseUp:c,onMouseMove:d})},kn=({win:o})=>{var ue;const{id:e,position:t,dimension:n,title:s,minimized:i,maximized:r,opacity:c,zIndex:d,minDimension:l,maxDimension:p}=o,[u,h]=g.exports.useState("default"),{wm:w,dispatch:S,xpra:A}=g.exports.useContext(U),C=g.exports.useRef(null),N=g.exports.useRef(null),O=g.exports.useRef(null),W=w.getWindow(e),M={opacity:c,zIndex:d},q={cursor:u},Q={toggled:!i,mountOnEnter:!1,unmountOnExit:!1},z=(b,R,x,E,I=!1)=>{C.current&&Object.assign(C.current.style,{left:`${b}px`,top:`${R}px`,width:`${x}px`,height:`${E}px`}),W!=null&&W.canvas&&Object.assign(W.canvas.style,{width:`${x}px`,height:`${E}px`}),I&&S({type:v.MoveResizeWindow,payload:{wid:e,position:[b,R],dimension:[x,E]}})},K=(b=!1)=>{const[R,x]=t,[E,I]=n;z(R,x,E,I,b)},V=b=>(R,x,E,I,T)=>{const[B,L]=l||[100,100],[Je,$e]=p||[Number.MAX_VALUE,Number.MAX_VALUE];E=Math.min(Je,Math.max(B,E)),I=Math.min($e,Math.max(L,I)),b(R,x,E,I,T)},j=V((b,R,x,E)=>{!A.isReadOnly()&&!r&&z(b,R,x,E),P(!0)}),y=V((b,R,x,E,I)=>{P(!1),!A.isReadOnly()&&!r&&(z(b,R,x,E,!0),I&&w.moveResize(W,[b,R],[x,E]))}),P=b=>{Me||S({type:v.SetDraggingWindow,payload:b?e:-1}),Me=b},J=b=>{b.preventDefault(),b.stopPropagation(),w.raise(W),S({type:v.RaiseWindow,payload:W.attributes})},Ze=Ie(b=>{if(O.current){const R=Se(O.current,[b.pageX,b.pageY],Re);h(`${R}-resize`)}else h("default")},Cn),He=g.exports.useCallback(Ce(()=>{const[b,R]=n;let[x,E]=t;return{onMove(I,T,B){x=t[0]+T,E=t[1]+B,j(x,E,b,R),P(!0)},onRelease(I,T){y(x,E,b,R,T)}}}),[t,n]),qe=g.exports.useCallback(Ce(()=>{let b="",[R,x]=t,[E,I]=n;return{onDown(T,B,L){O.current&&(b=Se(O.current,[B,L],Re))},onMove(T,B,L){b.startsWith("n")?(I=n[1]-L,x=t[1]+L):b.startsWith("s")&&(I=n[1]+L),b.endsWith("w")?(E=n[0]-B,R=t[0]+B):b.endsWith("e")&&(E=n[0]+B),j(R,x,E,I)},onRelease(T,B){y(R,x,E,I,B)}}}),[O,t,n]);return g.exports.useEffect(()=>{K()},[t,n]),g.exports.useEffect(()=>{K()},[C]),g.exports.useEffect(()=>{const[b,R]=t,[x,E]=n;A.isReadOnly()||(b<=0||R<=0)&&(w.moveResize(W,[100,100],[x,E]),z(100,100,x,E,!0))},[]),(ue=W==null?void 0:W.attributes)!=null&&ue.overrideRedirect?a.createElement(X,f({},Q),a.createElement("div",{className:"absolute bg-black cursor-default shadow",ref:C,style:M,onMouseDown:J},a.createElement(ce,{id:e}))):a.createElement(X,f({},Q),a.createElement("div",{ref:C,style:M,className:"absolute",onMouseDown:J,onMouseMove:Ze},a.createElement("div",{ref:O,className:"absolute z-10 -left-2 -top-10 -bottom-2 -right-2",style:q,onMouseDown:qe}),a.createElement("div",{className:"relative w-full h-full z-20 outline outline-1 outline-gray-200 shadow-xl"},a.createElement("div",{className:"absolute -top-8 w-full flex items-center p-1 px-2 h-8 space-x-2 outline outline-1 outline-gray-200 bg-gray-100 cursor-default",ref:N,onMouseDown:He},a.createElement("div",{className:"flex items-center justify-center",style:{width:"16px",height:"16px"}},a.createElement(Qe,{win:o})),a.createElement("div",{className:"flex-grow truncate text-sm"},a.createElement("span",null,s||e)),a.createElement(xn,{winstance:W,win:o,bar:N,outer:C})),a.createElement("div",{className:"xpra-window-canvas w-full h-full bg-black"},a.createElement(ce,{id:e})))))},Rn=({children:o})=>{const e=g.exports.createRef(),t=g.exports.createRef(),{wm:n,state:s,setRoot:i,setCursor:r}=g.exports.useContext(U),c=h=>{n.mouseMove(null,h.nativeEvent)},d=h=>{h.preventDefault()},l=f({dimension:[32,32],xhot:8,yhot:3,image:Sn},s.cursor||{}),p=`
.xpra-cursor {
  background: ${fn(l)};
}

.xpra-window-canvas {
  cursor: ${wn(s.cursor,"default")};
}
`,u=s.windows.filter(h=>!h.tray);return g.exports.useEffect(()=>{e.current&&i(e.current)},[e.current]),g.exports.useEffect(()=>{t.current&&r(t.current)},[t.current]),a.createElement(a.Fragment,null,a.createElement("div",{id:"xpra-desktop",className:"absolute inset-0 z-30 overflow-hidden bg-gradient-to-br from-emerald-500 via-emerald-300 to-emerald-500",ref:e,onMouseMove:c,onContextMenu:d},s.connected&&u.map(h=>a.createElement(kn,{key:h.id,win:h})),o),a.createElement("div",{ref:t,className:"xpra-cursor absolute z-50"}),a.createElement("style",null,p))};/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */let Ke=1;const Mn=({disabled:o,label:e,value:t,required:n,options:s,onChange:i})=>{const r=`xpra_${++Ke}`,c="rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed";return a.createElement("div",null,e&&a.createElement("label",{htmlFor:r},e),a.createElement("div",null,a.createElement("select",{className:c,id:r,required:n,disabled:o,defaultValue:t,onChange:i},Object.entries(s).map(([d,l])=>a.createElement("option",{key:d,value:d},l)))))},_=({children:o,disabled:e,label:t,type:n,transparent:s,onClick:i})=>{let r="flex items-center justify-center relative rounded w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed hover:outline hover:outline-1";return s?r+=" border border border-transparent":r+=" bg-white border border-black-100",a.createElement("button",{className:r,disabled:e,type:n||"button",onClick:i},t||o)},ie=({disabled:o,label:e,value:t,type:n,placeholder:s,required:i,onChange:r})=>{const c=`xpra_${++Ke}`,d="rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed";return a.createElement("div",null,e&&a.createElement("label",{htmlFor:c},e),a.createElement("div",null,a.createElement("input",{type:n||"text",className:d,id:c,placeholder:s,required:i,disabled:o,defaultValue:t,onInput:r})))},D=({label:o,value:e,onChange:t})=>a.createElement("div",{className:"select-none"},a.createElement("label",{className:"inline-flex items-center space-x-2 cursor-pointer"},a.createElement("input",{type:"checkbox",defaultChecked:e,onChange:t}),a.createElement("span",null,o)));/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const Wn=["shadow-lg","bg-emerald-100/50","opacity-90","rounded"],Ve=(...o)=>o.join(" "),je=({items:o,onCallback:e=()=>{},root:t=!0})=>{const n=g.exports.useRef(null),[s,i]=g.exports.useState(-1),r=["max-h-96","max-w-xs"];t?r.push("top-full","left-0"):r.push("top-0","left-full","overflow-auto");const c=p=>i(p),d=()=>i(-1),l=p=>{p&&p(),e()};if(t){const p=u=>{if(n.current){const h=u.target;h&&(n.current.contains(h)||h===n.current.parentNode)||l()}};g.exports.useEffect(()=>(document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}),[n])}return a.createElement("div",{ref:n,className:Ve("absolute","shadow","bg-emerald-100/80",...r),onMouseLeave:d},o.map(({icon:p,title:u,items:h,callback:w},S)=>a.createElement("div",{key:S,className:"relative text-left"},a.createElement("div",{className:"p-2 hover:bg-white truncate flex space-x-2 items-center",onClick:()=>l(w),onMouseOver:()=>c(S)},p&&a.createElement("img",{src:p,className:"w-4 h-4"}),a.createElement("span",null,u)),s===S&&h&&h.length>0&&a.createElement(je,{root:!1,items:h}))))},le=({classNames:o,children:e})=>{const t=Ve("absolute","z-50",...Wn,...o);return a.createElement("div",{className:t},e)},In=()=>{const{xpra:o,state:e,dispatch:t}=g.exports.useContext(U),n=e.showOptions?"Hide options":"Show options",s=(u,h)=>t({type:v.SetOption,payload:[u,h]}),i=[{key:"reconnect",label:"Automatically reconnect",component:D},{key:"shareSession",label:"Share Session",component:D},{key:"stealSession",label:"Steal Session",component:D},{key:"clipboard",label:"Clipboard",component:D},{key:"clipboardImages",label:"Clipboard Images",component:D},{key:"fileTransfer",label:"File Transfer",component:D},{key:"printing",label:"Printing",component:D},{key:"bell",label:"Bell",component:D},{key:"notifications",label:"Notifications",component:D},{key:"openUrl",label:"Open URLs",component:D},{key:"audio",label:"Audio",component:D},{key:"showStartMenu",label:"XDG Menu",component:D},{key:"swapKeys",label:"Swap Ctrl and Cmd key",component:D},{key:"reverseScrollX",label:"Reverse X scroll",component:D},{key:"reverseScrollY",label:"Reverse Y scroll",component:D},{key:"keyboardLayout",label:"Keyboard Layout",component:Mn,options:Wt}].map(u=>k(f({},u),{value:e.options[u.key],onChange:h=>s(u.key,h.target.value)})),r=u=>t({type:v.SetHost,payload:u.target.value}),c=u=>s("username",u.target.value),d=u=>s("password",u.target.value),l=u=>{u.preventDefault(),t({type:v.SetError,payload:""}),o.connect(e.host,e.options)},p=()=>t({type:v.SetShowOptions,payload:!e.showOptions});return a.createElement(le,{classNames:["p-8","top-1/2","left-1/2 transform","-translate-x-1/2","-translate-y-1/2","w-96","max-w-full","max-h-full","overflow-auto"]},a.createElement("form",{className:"space-y-4",onSubmit:l},a.createElement("div",{className:"space-y-2"},a.createElement(ie,{required:!0,placeholder:"Host",value:e.host,onChange:r}),a.createElement("div",{className:"flex space-x-2"},a.createElement(ie,{placeholder:"Username",value:e.options.username,onChange:c}),a.createElement(ie,{type:"password",placeholder:"Password",value:e.options.password,onChange:d}))),e.error&&a.createElement("div",{className:"bg-red-300 border border-red-500 text-red-500 p-2 rounded"},e.error),a.createElement("div",{className:"flex space-x-2"},a.createElement(_,{label:"Connect",type:"submit"}),a.createElement(_,{label:n,onClick:p})),a.createElement(X,{toggled:e.showOptions},a.createElement("div",{className:"px-2 text-sm"},i.map(S=>{var A=S,{component:u,key:h}=A,w=oe(A,["component","key"]);const C=u;return a.createElement(C,f({key:h},w))})))))},Nn=()=>{const{state:o}=g.exports.useContext(U),e=[["Last server ping",o.stats.lastServerPing],["Last client echo",o.stats.lastClientEcho],["Client ping latency",o.stats.clientPingLatency],["Server ping latency",o.stats.serverPingLatency],["Server load",o.stats.serverLoad.join(" / ")],["Window count",o.windows.length]];return a.createElement("div",{className:"absolute bottom-1 left-1 p-1 z-0 opacity-50 bg-emerald-100 rounded"},a.createElement("table",{className:"text-xs"},a.createElement("tbody",null,e.map(([t,n])=>a.createElement("tr",{key:t},a.createElement("td",{className:"p-1"},t),a.createElement("td",{className:"p-1 text-right text-gray-500"},n))))))},Dn=()=>{const{wm:o,state:e,dispatch:t,xpra:n}=g.exports.useContext(U),[s,i]=g.exports.useState(!1),r=e.windows.filter(A=>A.minimized),c=e.windows.filter(A=>A.tray),d=[...e.menu.map(A=>({title:A.name,icon:A.icon,items:A.entries.map(C=>({title:C.name,icon:C.icon,callback:()=>{n.sendStartCommand(C.name,C.exec,!1)}}))})),{title:"Server",items:[{title:"Shutdown server",callback:()=>{confirm("Are you sure you want to shut down the server ?")&&n.sendShutdown()}}]}],l=()=>n.disconnect(),p=A=>C=>{C.stopPropagation(),C.preventDefault();const N=o.getWindow(A.id);N&&(o.restore(N),o.raise(N),t({type:v.RaiseWindow,payload:N.attributes}))},u=()=>i(!s),h=()=>{i(!1)},w=()=>n.clipboard.poll(),S=async()=>{(await Yt()).forEach(({buffer:C,name:N,size:O,type:W})=>n.sendFile(N,W,O,C))};return a.createElement(le,{classNames:["top-1","left-1/2","-translate-x-1/2","p-1","select-none"]},a.createElement("div",{className:"flex space-x-4 px-2"},a.createElement("div",{className:"flex space-x-1"},e.menu.length>0&&a.createElement(_,{transparent:!0,onClick:u},a.createElement("i",{className:"fa fa-bars pointer-events-none"}),a.createElement(X,{toggled:s},a.createElement(je,{items:d,onCallback:h}))),a.createElement(_,{transparent:!0,onClick:l},a.createElement("i",{className:"fa fa-unlink"})),e.options.clipboard&&a.createElement(_,{transparent:!0,onClick:w},a.createElement("i",{className:"fa fa-clipboard"})),e.options.fileTransfer&&a.createElement(_,{transparent:!0,onClick:S},a.createElement("i",{className:"fa fa-upload"}))),r.length>0&&a.createElement("div",{className:"flex space-x-1"},r.map(A=>a.createElement(_,{key:A.id,transparent:!0,onClick:p(A)},a.createElement("div",{className:"flex space-x-1 items-center",style:{maxWidth:"128px"}},a.createElement("div",{className:"w-4 h-4"},a.createElement(Qe,{win:A})),a.createElement("div",{className:"truncate text-center text-sm"},A.title))))),c.length>0&&a.createElement("div",{className:"flex space-x-1"},c.map(A=>a.createElement("div",{key:A.id,className:"flex space-x-1 items-center"},a.createElement("div",{className:"flex items-center justify-center w-4 h-4 overflow-hidden",title:A.title},a.createElement(ce,{id:A.id})))))))},On=()=>{const{state:o,xpra:e}=g.exports.useContext(U),t=()=>e.disconnect();return a.createElement(le,{classNames:["p-8","top-1/2","left-1/2 transform","-translate-x-1/2","-translate-y-1/2","w-96"]},a.createElement("div",{className:"space-y-4"},a.createElement("div",{className:"text-center"},"Connecting to ",o.host),a.createElement("div",null,a.createElement(_,{onClick:t},"Cancel"))))};/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */function Bn(){const{state:o}=g.exports.useContext(U);return a.createElement(a.Fragment,null,a.createElement(X,{toggled:!o.connected},a.createElement(In,null)),a.createElement(X,{toggled:!o.started&&o.connected},a.createElement(On,null)),a.createElement(Rn,null,o.connected&&a.createElement(Nn,null)),a.createElement(X,{toggled:o.started},a.createElement(Dn,null)))}function Pn({xpra:o,wm:e}){return a.createElement(vn,{wm:e,xpra:o},a.createElement(Bn,null))}function Un(){return new Worker("assets/webworker.c83fb137.js",{type:"module"})}/**
 * Xpra Typescript Client Example
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */async function Tn(){const o=document.querySelector("#app"),e=new Un,t=new un(e),n=new mn(t);await t.init(),n.init(),o&&st.render(g.exports.createElement(Pn,{xpra:t,wm:n}),o),window.xpra={xpra:t}}window.addEventListener("DOMContentLoaded",()=>{Tn()});
//# sourceMappingURL=index.af850a54.js.map
