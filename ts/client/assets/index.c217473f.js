var tt=Object.defineProperty,nt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var re=(o,e,t)=>e in o?tt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,f=(o,e)=>{for(var t in e||(e={}))ge.call(e,t)&&re(o,t,e[t]);if(te)for(var t of te(e))Ae.call(e,t)&&re(o,t,e[t]);return o},M=(o,e)=>nt(o,ot(e));var ae=(o,e)=>{var t={};for(var n in o)ge.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&te)for(var n of te(o))e.indexOf(n)<0&&Ae.call(o,n)&&(t[n]=o[n]);return t};var w=(o,e,t)=>(re(o,typeof e!="symbol"?e+"":e,t),t);import{E as se,l as Ue,r as y,d as ue,R as c,C as st,a as it}from"./vendor.bc96ecdf.js";import{L as rt,g as at,a as ct,b as dt,c as lt,d as ut,P as pt,e as ht,f as mt,h as ft,i as wt,C as gt,r as At,j as yt,J as ce}from"./lib.a82548b2.js";const bt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};bt();var Y=(o=>(o[o.ERROR=40]="ERROR",o[o.WARNING=30]="WARNING",o[o.INFO=20]="INFO",o[o.DEBUG=10]="DEBUG",o))(Y||{});/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const vt="5.0",Et="1237",St=0,Ct="master",Rt=250,xt=["pointer-position","button-action","key-action","desktop_size"],Te=["jpeg","png","png/P","png/L","rgb","rgb32","rgb24","scroll","webp","void","avif"],kt=["RGBX","RGBA","RGB"],Mt={rec2020:"rec2020",p3:"P3",srgb:"srgb"},It={Win:["win32","Microsoft Windows"],Mac:["darwin","Mac OSX"],Linux:["linux","Linux"],X11:["posix","Posix"]},ye=["UTF8_STRING","TEXT","STRING","text/plain"],Wt={us:"English USA",gb:"United Kingdom",fr:"France",de:"Germany",es:"Spain",ad:"Andorra",af:"Afghanistan",al:"Albania",ara:"Arabic",am:"Armenia",az:"Azerbaijan",bd:"Bangladesh",by:"Belarus",be:"Belgium",bt:"Bhutan",ba:"Bosnia",br:"Brazil",bg:"Bulgaria",kh:"Cambodia",ca:"Canada",cn:"China",cd:"Congo,",hr:"Croatia",cz:"Czechia",dk:"Denmark",epo:"Esperanto",ee:"Estonia",et:"Ethiopia",ir:"Iran",iq:"Iraq",fo:"Faroe",fi:"Finland",ge:"Georgia",gh:"Ghana",gr:"Greece",gn:"Guinea",hu:"Hungary",is:"Iceland",in:"India",ie:"Ireland",il:"Israel",it:"Italy",jp:"Japan",kz:"Kazakhstan",kr:"Korea,",kg:"Kyrgyzstan",latam:"Latin",lv:"Latvia",la:"Laos",lt:"Lithuania",mao:"Maori",mk:"Macedonia",mv:"Maldives",ml:"Mali",mt:"Malta",mn:"Mongolia",me:"Montenegro",ma:"Morocco",mm:"Myanmar",np:"Nepal",nl:"Netherlands",ng:"Nigeria",no:"Norway",pk:"Pakistan",pl:"Poland",pt:"Portugal",ro:"Romania",ru:"Russia",sn:"Senegal",rs:"Serbia",sk:"Slovakia",si:"Slovenia",za:"South Africa",lk:"Sri Lanka",se:"Sweden",ch:"Switzerland",sy:"Syria",tw:"Taiwan",tj:"Tajikistan",tz:"Tanzania",th:"Thailand",tr:"Turkey",tm:"Turkmenistan",ua:"Ukraine",uz:"Uzbekistan",vn:"Vietnam"},be={1e3:"Normal Closure",1001:"Going Away",1002:"Protocol Error",1003:"Unsupported Data",1004:"(For future)",1005:"No Status Received",1006:"Abnormal Closure",1007:"Invalid frame payload data",1008:"Policy Violation",1009:"Message too big",1010:"Missing Extension",1011:"Internal Error",1012:"Service Restart",1013:"Try Again Later",1014:"Bad Gateway",1015:"TLS Handshake"};/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const Nt=["unknown",["unknown","unknown"]];function fe(){const o=rt;function e(){const n=["language","browserLanguage","systemLanguage","userLanguage"].find(s=>typeof navigator[s]=="string");return navigator.languages?navigator.languages:n?[n]:["us"]}return e().map(t=>{const[n]=t.split(/-|_/);return o[t]||o[n]||t})}function Dt(){const[o]=fe(),e=navigator.userAgent,t=!!navigator.vendor.match(/apple/i)&&!e.match(/crios/i)&&!e.match(/fxios/i)&&!e.match(/Opera|OPT\//),n=[["MSIE",e.includes("MSIE")||e.includes("Trident/")],["Firefox","firefox"],["Opera","opera"],["Safari",t],["Chrome","chrome"]],[s]=n.find(([,i])=>typeof i=="boolean"?i:e.toLowerCase().includes(i))||["",""];return{agent:navigator.userAgent,name:s,layout:o}}function Ot(){const{appVersion:o,oscpu:e,cpuClass:t}=navigator,n=Object.entries(It).find(([r])=>o==null?void 0:o.includes(r)),[,[s,i]]=n||Nt;return{type:s,name:i,platform:o,processor:e||t||"unknown"}}function Le(){const o=t=>typeof t=="number"&&t>0&&isFinite(t)?Math.round(t*1e3*1e3):t,e={type:"unknown",downlink:-1,downlinkMax:-1,effectiveType:"4g",rtt:0};if("connection"in navigator){const t=Object.keys(e).filter(n=>n in navigator.connection).map(n=>[n,navigator.connection[n]]);Object.assign(e,Object.fromEntries(t))}return M(f({},e),{downlink:o(e.downlink),downlinkMax:o(e.downlinkMax)})}const Bt=()=>navigator.clipboard&&!!navigator.clipboard.readText&&!!navigator.clipboard.writeText;function Pt(){if(window.matchMedia){const o=Object.entries(Mt).find(([e])=>window.matchMedia(`(color-gamut: ${e})`));if(o)return o[1]}return""}const _e=(()=>{let o=96;if(typeof window!="undefined")if("deviceXDPI"in screen)o=(screen.systemXDPI+screen.systemYDPI)/2;else{const e=document.createElement("div");e.style.width="1in",e.style.height="1in",e.style.left="-100%",e.style.top="-100%",e.style.position="absolute",document.body.appendChild(e);const{offsetWidth:t,offsetHeight:n}=e;e.remove(),t>0&&n>0&&(o=Math.round((t+n)/2))}return()=>o})();function Ut(o){let e="";if(o.subarray)for(let n=0,s=o.length;n<s;n+=10400)e+=String.fromCharCode.apply(null,o.subarray(n,Math.min(n+10400,s)));else for(let n=0,s=o.length;n<s;n+=10400)e+=String.fromCharCode.apply(null,o.slice(n,Math.min(n+10400,s)));return window.btoa(e)}function ve(o){const t=[];for(let n=0;n<o.length;n+=32768)t.push(String.fromCharCode.apply(null,o.subarray(n,n+32768)));return t.join("")}function ze(o){const e=new Uint8Array(o.length);for(let t=0;t<o.length;++t)e[t]=o.charCodeAt(t);return e}function Q(o,e){const t=typeof e=="string"?ze(e):e,n=Ut(t);return`data:image/${o==="svg"?"image/svg+xml":o};base64,${n}`}const Tt=o=>new Promise(e=>{const t=new Image;t.onload=()=>{t.width&&t.height?e(t):e(null)},t.onerror=()=>{e(null)},t.src=o});function Lt(o){let e=0;return"which"in o?e=Math.max(0,o.which):"button"in o&&(e=Math.max(0,o.button)+1),e}function _t(o){return at(o)}function zt(o,e,t,n){const s=ct(o);let i=null,r=null,a=null,d=null,u=null;if(n){for(const m in n){const A=n[m];for(let E=0;E<A.length;E++){const g=A[E];for(let b=0;b<g.length;b++)g[b]=="Alt_L"?r=m:g[b]=="Meta_L"?d=m:g[b]=="ISO_Level3_Shift"||g[b]=="Mode_switch"?u=m:g[b]=="Control_L"?a=m:g[b]==="Num_Lock"&&(i=m)}}e&&([d,a]=[a,d]);const p=s.slice();let l=s.indexOf("meta");return l>=0&&d&&(p[l]=d),l=s.indexOf("control"),l>=0&&a&&(p[l]=a),l=s.indexOf("alt"),l>=0&&r&&(p[l]=r),l=s.indexOf("numlock"),l>=0&&(i?p[l]=i:p.splice(l,1)),l=s.indexOf("capslock"),l>=0&&(p[l]="lock"),t&&u&&!p.includes(u)&&(p.push(u),l=p.indexOf(u),l>=0&&p.splice(l,1),l=p.indexOf(a),l>=0&&p.splice(l,1)),p}return s}function de(o){return[o.clientX,o.clientY]}function Xt(o){const e=o,t=n=>n>1?1:n<0?-1:0;return typeof e.deltaX=="number"?[t(e.deltaX),t(e.deltaY)]:typeof e.wheelDelta=="number"?[0,e.wheelDelta/120]:typeof e.wheelDeltaX=="number"?[e.wheelDeltaX/120,e.wheelDeltaY/120]:[0,0]}async function Ft(o,e){if(!("Notification"in window))throw new Error("Notifications are not supported in this browser");return Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"?new Notification(o,e):null}async function Gt(){const o=document.createElement("input");o.type="file";const e=t=>new Promise((n,s)=>{const i=new FileReader;i.onload=()=>{n(i.result)},i.onerror=r=>{s(r)},i.readAsArrayBuffer(t)});return new Promise((t,n)=>{o.onchange=async()=>{try{if(o.files){const s=Array.from(o.files).map(r=>e(r).then(a=>({buffer:a,name:r.name,size:r.size,type:r.type}))),i=await Promise.all(s);t(i)}else t([])}catch(s){n(s)}},o.click()})}function Xe(o,e){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,o);else{const t=e instanceof Blob?window.URL.createObjectURL(e):e;try{const n=document.createElement("a");n.href=t,n.download=o,n.click()}finally{window.URL.revokeObjectURL(t)}}}function Yt(o,e){const t=URL.createObjectURL(e);try{const n=window.open(t);!n||n.closed||n.closed!==void 0?Xe(o,t):n.print()}finally{window.URL.revokeObjectURL(t)}}async function Ee(o){if(navigator.clipboard.read){const t=s=>new Promise((i,r)=>{const a=new FileReader;a.onload=()=>{i(a.result)},a.onerror=d=>{r(d)},a.readAsText(s)}),n=await navigator.clipboard.read();for(let s=0;s<n.length;s++){const i=n[s];for(let r=0;r<i.types.length;r++){const a=i.types[r],d=await i.getType(a),u=await t(d);if(a==="text/plain")return[o,u];if(a==="image/png")return[a,u]}}}const e=await navigator.clipboard.readText();return[o,e]}async function Se(o,e){if(e){if(navigator.clipboard.write){const t=new Blob([o],{type:e}),s=[new ClipboardItem({[e]:t})];return await navigator.clipboard.write(s),!0}}else return await navigator.clipboard.writeText(o),!0;return!1}function Fe(){const o=[],e="0123456789abcdef";for(let t=0;t<36;t++)t==8||t==13||t==18||t==23?o[t]="-":o[t]=e.substr(Math.floor(Math.random()*16),1);return o.join("")}function pe(o){const e=window.crypto||window.mscrypto;if(!e){let n="";for(;n.length<o;)n+=Fe();return n.substr(0,o)}const t=new Uint8Array(o);return e.getRandomValues(t),String.fromCharCode.apply(null,t)}function Qt(o,e){let t="";if(o.length!==e.length)throw new TypeError("strings must be equal length");for(let n=0;n<o.length;n++)t+=String.fromCharCode(o[n].charCodeAt(0)^e[n].charCodeAt(0));return t}const Ce=o=>unescape(encodeURIComponent(o));function Ge(o,e,t){const{search:n}=window.location,s=new URLSearchParams(n),i=Array.from(s).map(([r,a])=>o.includes(r)?[r,["1","true","on"].includes(String(a).toLowerCase())]:e.includes(r)?[r,parseInt(a)]:[r,a||void 0]);return Object.fromEntries(i.filter(([r,a])=>t.includes(r)&&a!==void 0))}const[Kt]=fe(),ne={reconnect:!0,connectionTimeout:3e4,reconnectInterval:5e3,reconnectAttempts:3,bandWidthLimit:0,startNewSession:null,shareSession:!1,stealSession:!1,username:"",display:"",password:"",showStartMenu:!0,fileTransfer:!0,clipboardImages:!1,clipboardDirection:"both",clipboard:!0,printing:!1,bell:!0,audio:!0,video:!1,nativeVideo:!1,cursor:!0,keyboard:!0,mouse:!0,tray:!0,notifications:!0,ssl:!1,encryption:null,encryptionKey:null,encoder:"auto",openUrl:!0,swapKeys:!1,keyboardLayout:Kt,exitWithChildren:!1,exitWithClient:!1,startCommand:"",reverseScrollX:!1,reverseScrollY:!1},Vt=["reconnect","showStartMenu","clipboardImages","clipboard","shareSession","stealSession","fileTransfer","printing","bell","audio","cursor","keyboard","mouse","tray","notifications","ssl","openUrl","video","nativeVideo","swapKeys","exitWithChildren","exitWithClient","reverseScrollX","reverseScrollY"],jt=["bandWidthLimit","connectionTimeout","reconnectAttempts","reconnectInterval"],Zt=()=>Ge(Vt,jt,Object.keys(ne));class Ye extends TypeError{}class oe extends Error{}class Ht extends Error{}class Qe extends Error{}class q extends Error{}class Re extends Error{}class qt extends Error{}function xe(o){if(o instanceof CloseEvent){const{code:e,reason:t}=o,n=be[e]?`'${be[e]}' (${e})`:String(e),s=t?`: '${t}'`:"";return new oe(n+s)}return new oe("unknown error")}class Jt extends se{constructor(){super(...arguments);w(this,"ws",null);w(this,"connectionStatus","disconnected");w(this,"reconnectTimeout",0);w(this,"reconnectAttempt",0);w(this,"maxReconnectAttempts",3);w(this,"reconnectIntervalTime",5*1e3);w(this,"host","")}send(e){this.ws&&this.ws.send(e)}connect(e,t){const n=this.connectionStatus==="reconnecting",s=new WebSocket(e,"binary");console.info("Connecting websocket",e,this.connectionStatus),s.binaryType="arraybuffer",s.onopen=()=>{console.info("Opened websocket"),this.connectionStatus="connected",this.emit("open")},s.onclose=i=>{console.info("Closed websocket"),this.connectionStatus="disconnected",this.emit("close",xe(i))},s.onerror=i=>{this.emit("error",xe(i))},s.onmessage=i=>{const r=new Uint8Array(i.data);this.emit("message",r)},n||(this.reconnectAttempt=0),t&&(this.maxReconnectAttempts=t.reconnectAttempts,this.reconnectIntervalTime=t.reconnectInterval),this.ws=s,this.host=e,this.clearTimers(),this.emit("connect",this.connectionStatus)}disconnect(e=!1){e&&this.connectionStatus==="reconnecting"||(console.info("Disconnect websocket"),this.clearTimers(),this.connectionStatus=e?"reconnecting":"disconnected",this.ws&&(this.ws.onopen=null,this.ws.onclose=null,this.ws.onerror=null,this.ws.onmessage=null,this.ws.close()),this.ws=null,e&&(this.reconnectAttempt>=this.maxReconnectAttempts?this.disconnect(!1):(this.reconnectAttempt++,this.reconnectTimeout=setTimeout(()=>this.connect(this.host),this.reconnectIntervalTime))),this.emit("disconnect",this.connectionStatus))}clearTimers(){clearTimeout(this.reconnectTimeout)}get connected(){return!!this.ws}get status(){return this.connectionStatus}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */function ke(o,e,t){if(o.startsWith("hmac")){let n="md5";o.indexOf("+")>0&&(n=o.split("+")[1]);const s=Ue.hmac.create();return s.start(n,e),s.update(t),s.digest().toHex()}else if(o=="xor"){const n=t.slice(0,e.length);return Qt(n,e)}return null}function $t(o,e,t,n,s,i){if(!n)throw new q("Invalid login");if(t==="xor"){if(e==="xor"&&!s&&!i)throw new q("Aborted challenge because xor is not safe in this environment");if(o.length<16||o.length>256)throw new q(`Invalid challenge xor salt length: ${o.length}`)}const r=t==="xor"?o.length:32,a=pe(r),d=ke(t,a,o);let u=null;if(d&&(u=ke(e,n,d)),!u)throw new q("Could not challenge server auth attempt");return[u,a]}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const J=window.AV,en=!!ft(),tn=typeof J!="undefined"&&J!=null&&J.Decoder!=null&&J.Player.fromXpraSource!=null;class Ke{constructor(e,t){w(this,"audio");w(this,"audioCodec");w(this,"audioBuffer",[]);w(this,"audioBufferCount",0);this.audio=e,this.audioCodec=t}async setup(){console.warn("XpraAudioAdapter#setup","unhandled event")}async start(){console.warn("XpraAudioAdapter#start","unhandled event")}stop(){this.audio.pause(),this.audioBuffer=[],this.audioBufferCount=0,this.audio.src=""}addQueue(e,t){let n=4;if(this.audioBuffer.length>=Rt)throw new Qe("Buffer queue overflow");if(t){for(let s=0;s<t.length;s++)this.audioBuffer.push(ze(t[s]));n=1}this.audioBuffer.push(e),this.processQueue(n)}pushBuffer(e){console.warn("XpraAudioAdapter#pushBuffer","unhandled event")}processQueue(e){if(this.isReady()&&(this.audioBufferCount>0||this.audioBuffer.length>=e)){{let t;if(this.audioBuffer.length==1)t=this.audioBuffer[0];else{let n=0;for(let s=0,i=this.audioBuffer.length;s<i;++s)n+=this.audioBuffer[s].length;t=new Uint8Array(n),n=0;for(let s=0,i=this.audioBuffer.length;s<i;++s){const r=this.audioBuffer[s];r.length>0&&(t.set(r,n),n+=r.length)}}this.audioBufferCount+=1,this.pushBuffer(t)}this.audioBuffer=[]}}isReady(){return!1}}class nn extends Ke{constructor(){super(...arguments);w(this,"mediaSource",null);w(this,"mediaSourceReady",!1);w(this,"mediaSourceBuffer",null)}async setup(){const e=wt(),t=()=>new Promise((n,s)=>{e.addEventListener("sourceopen",()=>{if(console.debug("XpraAudio -> MediaSource","Source opened"),this.mediaSourceReady)s(new Qe("MediaSource already open"));else{const i=gt[this.audioCodec];if(i)try{const r=e.addSourceBuffer(i);r.mode="sequence",r.addEventListener("error",a=>{console.error("XpraAudio -> MediaSource -> SourceBuffer",a)}),n(r)}catch(r){s(r)}else s(new Ht(`Media codec '${this.audioCodec}' unsupported`))}})});this.mediaSource=e,this.audio.src=window.URL.createObjectURL(this.mediaSource),this.mediaSourceBuffer=await t(),this.mediaSourceReady=!0}async start(){try{await this.audio.play()}catch(e){console.error("XpraAudio#start","audio start error",e)}}stop(){if(super.stop(),this.mediaSource)try{this.mediaSourceBuffer&&this.mediaSource.removeSourceBuffer(this.mediaSourceBuffer),this.mediaSource.readyState==="open"&&this.mediaSource.endOfStream()}catch(e){console.error("XpraMediaSourceAdapter",e)}this.mediaSource=null,this.mediaSourceBuffer=null,this.mediaSourceReady=!1}pushBuffer(e){this.mediaSourceBuffer&&this.mediaSourceBuffer.appendBuffer(e)}isReady(){return!!this.mediaSourceBuffer&&!this.mediaSourceBuffer.updating}}class on extends Ke{constructor(){super(...arguments);w(this,"auroraSource",null)}async setup(){this.auroraSource=J.Player.fromXpraSource()}async start(){this.auroraSource&&this.auroraSource.play()}stop(){var e;if(super.stop(),(e=this.auroraSource)!=null&&e.context)try{this.auroraSource.context.close()}catch(t){console.error("XpraAuroraAdapter",t)}this.auroraSource=null}pushBuffer(e){this.auroraSource&&this.auroraSource.asset.source._on_data(e)}isReady(){return!!this.auroraSource}}class sn extends se{constructor(){super();w(this,"audio",document.createElement("audio"));w(this,"enabled",!1);w(this,"adapter",null);w(this,"defaultCodec",null);w(this,"audioCodec",null);w(this,"audioFramework",null);w(this,"auroraCodecs",tn?dt():{});w(this,"mediaCodecs",en?lt():{});w(this,"detectedCodecs",f(f({},this.mediaCodecs),this.auroraCodecs));Object.values(this.detectedCodecs).length>0&&(this.defaultCodec=ut(this.detectedCodecs)),console.debug("XpraAudio#constructor",this)}async init(){this.audio.setAttribute("autoplay",String(!0)),this.audio.addEventListener("play",()=>{console.info("XpraAudio -> <audio>","playing")}),this.audio.addEventListener("error",e=>{console.error("XpraAudio -> <audio>",e),this.stop()})}validate(e){return e!==this.audioCodec?(console.error("XpraAudio#validate","invalid codec",e),this.stop(),!1):!0}stop(){this.adapter&&this.adapter.stop(),this.enabled=!1,this.adapter=null,this.emit("stop")}async setup(e){if(e["sound.send"]){const t=e["sound.encoders"];if(this.defaultCodec){const n=pt.find(s=>!!(s in this.detectedCodecs&&t.includes(s)))||this.defaultCodec;n&&(this.enabled=!0,this.audioCodec=n,this.audioFramework=this.auroraCodecs[n]?"aurora":"mediasource")}}if(this.enabled){const t=ht(this.audioFramework==="mediasource",this.audioFramework==="aurora",!1),n=mt(t);if(n){const[s,i]=n.split(":");this.audioFramework=s,this.audioCodec=i}this.audioCodec&&(this.audioFramework==="mediasource"?this.adapter=new nn(this.audio,this.audioCodec):this.audioFramework==="aurora"&&(this.adapter=new on(this.audio,this.audioCodec)));try{this.adapter&&(await this.adapter.setup(),this.emit("start"))}catch(s){console.error("XpraAudio#setup",s),this.stop()}}}async start(){this.adapter?this.adapter.start():this.stop()}addQueue(e,t){this.adapter&&this.adapter.addQueue(e,t)}getDecoders(){return Object.keys(this.detectedCodecs)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class rn extends se{constructor(e){super();w(this,"worker");this.worker=e}async init(){this.worker.addEventListener("message",e=>{const[t,n]=e.data;this.recieve(t,n)}),this.worker.addEventListener("error",e=>{this.emit("failure",e)})}send(e,t){this.worker.postMessage([e,t])}recieve(e,t){switch(e){case"send":this.emit("send",t);break;case"recieve":this.emit("recieve",t);break;case"failure":const[n,s]=t,i=new qt(`${n} | ${s}`);this.emit("failure",i)}}configure(e){this.send("configure",e)}setConnected(e){this.send("connected",e)}pushSend(e){this.send("send",e)}pushRecieve(e){this.send("recieve",e)}}const an=["log","info","warn","error","debug"],cn={log:Y.INFO,info:Y.INFO,warn:Y.WARNING,error:Y.ERROR,debug:Y.DEBUG};function dn(o){const e=an.map(t=>[t,(...n)=>{const s=console[t],i=cn[t];s.apply(s,["-->",...n]),o(i,n)}]);return Object.fromEntries(e)}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const ln=()=>{const o=Object.keys(Ue.md.algorithms).map(e=>`hmac+${e}`);return["hmac","hmac+md5","xor",...o]},un=o=>o?[...ye,"image/png"]:ye;function pn({startNewSession:o,exitWithChildren:e,exitWithClient:t,startCommand:n}){return o?{mode:o,"exit-with-children":e,"exit-with-client":t,[e?"start-child":"start"]:t?[n]:[]}:{}}function Ve(o,e){const t=_e(),n=Math.round(o*25.4/t),s=Math.round(e*25.4/t);return[["HTML",o,e,n,s,[["Canvas",0,0,o,e,n,s]],0,0,o,e]]}function Me(o={},e=!0){const t=[window.innerWidth,window.innerHeight],n=ln(),s=Ot(),i=Dt(),r=Bt()?["CLIPBOARD"]:["CLIPBOARD","PRIMARY"],a=At(),d=Te,u=f({version:vt,"build.revision":Et,"build.local_modifications":St,"build.branch":Ct,platform:s.type,"platform.name":s.name,"platform.processor":s.processor,"platform.platform":s.platform,"session-type":i.name,"session-type.full":i.agent,namespace:!0,"clipboard.contents-slice-fix":!0,client_type:"HTML5","websocket.multi-packet":!0,"setting-change":!0,uuid:Fe(),argv:[window.location.href],digest:n,"salt-digest":n,zlib:!0,compression_level:1,"file-transfer":!1,printing:!1,share:!1,steal:!1,username:"",display:"","mouse.show":!0,rencode:a,rencodeplus:a,bencode:!0,yaml:!1,"open-url":!0,"ping-echo-sourceid":!0,vrefresh:-1,"xdg-menu-update":!0,"bandwidth-limit":0,"connection-data":Le(),lz4:!0,"encoding.rgb_lz4":!0,brotli:!0,"clipboard.preferred-targets":[],"start-new-session":void 0,auto_refresh_delay:500,randr_notify:!0,"sound.server_driven":!0,"server-window-resize":!0,"screen-resize-bigger":!1,"metadata.supported":["fullscreen","maximized","iconic","above","below","title","size-hints","class-instance","transient-for","window-type","has-alpha","decorations","override-redirect","tray","modal","opacity"],encoding:"auto",encodings:d,"encoding.icons.max_size":[30,30],"encodings.core":d,"encodings.rgb_formats":kt,"encodings.window-icon":["png"],"encodings.cursor":["png"],"encoding.flush":!0,"encoding.transparency":!0,"encoding.scrolling":d.includes("scroll"),"encoding.decoder-speed":{video:0},"encodings.packet":!0,"encoding.color-gamut":Pt(),"encoding.video_scaling":!0,"encoding.video_max_size":[1024,768],"encoding.eos":!0,"encoding.full_csc_modes":{mpeg1:["YUV420P"],h264:["YUV420P"],"mpeg4+mp4":["YUV420P"],"h264+mp4":["YUV420P"],"vp8+webm":["YUV420P"],webp:["BGRX","BGRA"],jpeg:["BGRX","BGRA","BGR","RGBX","RGBA","RGB","YUV420P","YUV422P","YUV444P"]},"encoding.x264.YUV420P.profile":"baseline","encoding.h264.YUV420P.profile":"baseline","encoding.h264.YUV420P.level":"2.1","encoding.h264.cabac":!1,"encoding.h264.deblocking-filter":!1,"encoding.h264.fast-decode":!0,"encoding.h264+mp4.YUV420P.profile":"baseline","encoding.h264+mp4.YUV420P.level":"3.0","encoding.h264.score-delta":-20,"encoding.h264+mp4.score-delta":50,"encoding.h264+mp4.":50,"encoding.mpeg4+mp4.score-delta":40,"encoding.vp8+webm.score-delta":40,"sound.receive":!0,"sound.send":!1,"sound.decoders":[],"sound.bundle-metadata":!0,"encoding.rgb_zlib":!0,windows:!0,"window.pre-map":!0,keyboard:!0,xkbmap_layout:i.layout,xkbmap_keycodes:yt(),xkbmap_print:"",xkbmap_query:"",desktop_size:t,desktop_mode_size:t,screen_sizes:Ve(t[0],t[1]),dpi:_e(),clipboard:!0,"clipboard.want_targets":!0,"clipboard.greedy":!0,"clipboard.selections":r,notifications:!0,"notifications.close":!0,"notifications.actions":!0,cursors:!0,bell:!0,system_tray:!0,named_cursors:!1,"file-size-limit":10,flush:!0,cipher:void 0,"cipher.mode":void 0,"cipher.iv":void 0,"cipher.key_salt":void 0,"cipher.key_size":void 0,"cipher.key_hash":void 0,"cipher.key_stretch_iterations":void 0,"cipher.padding.options":void 0},o);return e&&Object.entries(u).forEach(([p,l])=>{if(l===null)throw new Ye(`Invalid value ('${l}') for capability '${p}'`)}),Object.fromEntries(Object.entries(u).filter(([,p])=>p!==void 0))}function hn(o){const e=[window.innerWidth,window.innerHeight],t=pn(o),n={"clipboard.preferred-targets":un(o.clipboardImages),"bandwidth-limit":o.bandWidthLimit,"xdg-menu-update":o.showStartMenu,"start-new-session":t,share:o.shareSession,steal:o.stealSession,username:o.username,display:o.display,"file-transfer":o.fileTransfer,"open-url":o.openUrl,printing:o.printing,clipboard:o.clipboard,desktop_size:e,desktop_mode_size:e,cursors:o.cursor,bell:o.bell,system_tray:o.tray,notifications:o.notifications,xkbmap_layout:o.keyboardLayout,encoding:o.encoder};if(o.encryption){const[s,i]=o.encryption.split("-");if(s!=="AES")throw new Ye(`Invalid encryption: ${s} (${i})`);Object.assign(n,{cipher:s,"cipher.mode":i,"cipher.iv":pe(16),"cipher.key_salt":pe(32),"cipher.key_size":32,"cipher.key_hash":"SHA1","cipher.key_stretch_iterations":1e3,"cipher.padding.options":["PKCS#7"]})}if(o.video){const s=[...Te,"h264"];ce&&ce.Renderer&&ce.Decoder&&s.push("mpeg1"),o.nativeVideo&&s.push("vp8+webm","h264+mp4","mpeg4+mp4"),Object.assign(n,{encodings:s,"encodings.core":s})}return n}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const je={lastServerPing:0,lastClientEcho:0,clientPingLatency:0,serverPingLatency:0,serverLoad:[0,0,0]};class mn extends se{constructor(e){super();w(this,"capabilities");w(this,"options",f({},ne));w(this,"stats",f({},je));w(this,"serverCapabilities",null);w(this,"connectionCheckTimeout",0);w(this,"pingInterval",0);w(this,"inited",!1);w(this,"started",!1);w(this,"clipboardBuffer",{});w(this,"worker");w(this,"audio",new sn);w(this,"ws",new Jt);w(this,"logger",dn((e,t)=>{this.sendLog(e,t)}));w(this,"processorBindings",{"new-window":this.processNewWindow,"window-icon":this.processWindowIcon,"startup-complete":this.processStartupComplete,"setting-change":this.processSettingChange,"window-move-resize":this.processWindowMoveResize,"window-resized":this.processWindowResized,"raise-window":this.processWindowRaise,"lost-window":this.processWindowLost,"window-metadata":this.processWindowMetadata,"new-override-redirect":this.processNewOverrideRedirect,"configure-override-redirect":this.processConfigureOverrideRedirect,"initiate-moveresize":this.processInitiateMoveResize,"send-file":this.processSendFile,"sound-data":this.processSoundData,"clipboard-token":this.processClipboardToken,"set-clipboard-enabled":this.processSetClipboardEnabled,"clipboard-request":this.processClipboardRequest,"info-response":this.processInfoResponse,"new-tray":this.processNewTray,"pointer-position":this.processPointerPosition,"open-url":this.processOpenUrl,notify_show:this.processShowNotification,notify_close:this.processCloseNotification,encodings:this.processEncodings,cursor:this.processCursor,hello:this.processHello,ping:this.processPing,ping_echo:this.processPingEcho,draw:this.processDraw,bell:this.processBell,challenge:this.processChallenge,eos:this.processEos,disconnect:this.processDisconnect});this.worker=new rn(e),this.capabilities=Me({"sound.decoders":this.audio.getDecoders()},!1)}async init(){this.inited||(await this.worker.init(),await this.audio.init(),this.ws.on("open",()=>this.handshake()),this.ws.on("error",e=>this.disconnect(e)),this.ws.on("close",e=>this.disconnect(e)),this.ws.on("connect",e=>this.emit("connect",e)),this.ws.on("disconnect",e=>this.emit("disconnect",e)),this.ws.on("message",e=>this.worker.pushRecieve(e)),this.worker.on("recieve",e=>this.recieve(e)),this.worker.on("send",e=>this.ws.send(e)),this.worker.on("failure",e=>this.disconnect(e)),this.audio.on("start",()=>this.sendSoundStart()),this.audio.on("stop",()=>this.sendSoundStop()),"connection"in navigator&&navigator.connection.addEventListener("change",()=>{this.ws.connected&&this.sendConnectionData()}),this.inited=!0)}connect(e,t={}){if(!this.inited)throw new oe("Xpra instance not initialized");this.options=f(f({},ne),t);try{this.worker.configure(this.options),this.worker.setConnected(!0),this.ws.connect(e,this.options)}catch(n){this.emit("error",n.message)}}disconnect(e){e&&console.error("XpraConnection#disconnect",e);const t=e instanceof q||e instanceof Re,n=this.options.reconnect&&!t&&!!e;t&&this.emit("error",e.message),this.clearTimers(),this.audio.stop(),this.worker.setConnected(!1),this.serverCapabilities=null,this.clipboardBuffer={},this.ws.disconnect(n)}handshake(){this.started=!0,this.connectionCheckTimeout=setTimeout(()=>{this.disconnect(new oe("Not a valid xpra server?"))},this.options.connectionTimeout),this.createCapabilities(),this.sendHello()}async pollClipboard(){if(this.options.clipboardDirection==="to-server")return;const[,e]=await Ee("UTF8_STRING"),t=Ce(e);this.sendClipboardToken(t)}recieve(e){const[t,...n]=e;this.ws.connected&&(this.processorBindings[t]?this.processorBindings[t].apply(this,n):console.debug("Unhandled message",t,n))}send(e){if(this.ws.connected){if(this.isReadOnly()&&xt.includes(e[0]))return;const t=["hello","ping","ping_echo","logging"];if(!this.started&&!t.includes(e[0]))return;this.worker.pushSend(e)}}clearTimers(){clearTimeout(this.connectionCheckTimeout),clearInterval(this.pingInterval)}createCapabilities(e={}){this.capabilities=Me(f(f({},hn(this.options)),e))}getOptions(){return f({},this.options)}getCapabilities(){return f({},this.capabilities)}getServerCapabilities(){return this.serverCapabilities?f({},this.serverCapabilities):null}isReady(){return this.started}isReadOnly(){var e;return!!((e=this.serverCapabilities)!=null&&e.readonly)}sendResize(e,t){const n=Math.round(e),s=Math.round(t);this.send(["desktop_size",n,s,Ve(n,s)])}sendCloseWindow(e){this.send(["close-window",e])}sendMapWindow(e){const[t,n]=e.position,[s,i]=e.dimension;this.send(["map-window",e.id,Math.round(t),Math.round(n),Math.round(s),Math.round(i),e.clientProperties])}sendUnmapWindow(e){this.send(["unmap-window",e.id,!0])}sendGeometryWindow(e,t,n){const[s,i]=t,[r,a]=n;this.send(["configure-window",e,Math.round(s),Math.round(i),Math.round(r),Math.round(a),{}])}sendConfigureWindow(e,t,n,s,i,r){const[a,d]=t,[u,p]=n;this.send(["configure-window",e,Math.round(a),Math.round(d),Math.round(u),Math.round(p),s,0,i,r])}sendDamageSequence(e,t,n,s,i=""){s<0&&console.warn("XpraConnection#sendDamageSequence",s),this.send(["damage-sequence",e,t,...n,s,i])}sendMouseMove(e,t,n){const[s,i]=t,r=[];this.options.mouse&&this.send(["pointer-position",e,[Math.round(s),Math.round(i)],n,r])}sendMouseWheel(e,t,n,s){if(!this.options.mouse||!this.serverCapabilities)return;const[i,r]=t,a=!!this.serverCapabilities["wheel.precise"],d=this.options.reverseScrollX?-i:i,u=this.options.reverseScrollY?-r:r,p=[],l=d>0?6:7,m=u>0?5:4,A=d>0?l:m,E=100;a?this.send(["wheel-motion",e,A,E,n,s,p]):(this.send(["button-action",e,A,!0,n,s,p]),this.send(["button-action",e,A,!1,n,s,p]))}sendMouseButton(e,t,n,s,i){const r=[];this.options.mouse&&this.send(["button-action",e,n,s,t,i,r])}sendKeyAction(e,t,n,s,i,r,a,d){this.options.keyboard&&this.send(["key-action",e,t,n,s,i,r,a,d])}sendLayoutChanged(e){this.send(["layout-changed",e,""])}sendWindowRaise(e,t){this.send(["focus",e,[]]),t.forEach(n=>{this.sendConfigureWindow(n.id,n.position,n.dimension,n.clientProperties,{focused:n.id===e},!0)})}sendWindowClose(e){this.send(["close-window",e])}sendNotificationClose(e){this.send(["notification-close",e,2,""])}sendSuspend(e){this.send(["suspend",!0,e])}sendResume(e){this.send(["resume",!0,e]),this.sendBufferRefresh(-1)}sendBufferRefresh(e){this.send(["buffer-refresh",e,0,100,{"refresh-now":!0,batch:{reset:!0}},{}])}sendConnectionData(){const e=Le();this.send(["connection-data",e])}sendSoundStart(){this.send(["sound-control","start"])}sendSoundStop(){this.send(["sound-control","stop"])}sendStartCommand(e,t,n){this.send(["start-command",e,t,n?"True":"False"])}sendFile(e,t,n,s){if(this.serverCapabilities){const i=this.options.encoder==="rencodeplus",r=!!this.serverCapabilities["open-files"],a=s instanceof ArrayBuffer?new Uint8Array(s):s,d=i?ve(a):a;this.send(["send-file",e,t,!1,r,n,d,{}])}}sendShutdown(){this.send(["shutdown-server"])}sendClipboardToken(e){if(this.options.clipboard){const i=e?"UTF8_STRING":"",r=e?["UTF8_STRING","text/plain"]:[];this.send(["clipboard-token","CLIPBOARD",r,i,i,8,"bytes",e,!0,!0,!0])}}sendLog(e,...t){if(this.serverCapabilities&&this.serverCapabilities["remote-logging.multi-line"]){const n=t.map(s=>Ce(String(s)));this.send(["logging",e,n])}}sendHello(){this.send(["hello",this.capabilities])}sendPing(){const e=Math.ceil(performance.now());this.send(["ping",e])}sendClipboard(e,t,n,s="UTF8_STRING",i=8,r="bytes"){n===""?this.send(["clipboard-contents-none",e,t]):this.send(["clipboard-contents",e,t,s,i,r,n])}sendClipboardString(e,t,n,s="UTF8_STRING"){this.sendClipboard(e,t,n,s)}processHello(e){clearTimeout(this.connectionCheckTimeout),this.serverCapabilities=e,this.emit("hello",this.serverCapabilities),this.options.audio&&this.audio.setup(this.serverCapabilities)}processNewWindow(e,t,n,s,i,r,a={}){const d=parseInt(t),u=parseInt(n),p=parseInt(s),l=parseInt(i);this.emit("newWindow",{id:e,position:[d,u],dimension:[p,l],overrideRedirect:!1,metadata:r,clientProperties:a})}processWindowIcon(e,t,n,s,i){const r=Q(s,i);this.emit("windowIcon",{wid:e,dimension:[t,n],image:r})}processStartupComplete(){this.started=!0,this.emit("sessionStarted"),this.sendPing(),this.pingInterval=setInterval(()=>this.sendPing(),5e3),this.logger.info("Connection from Xpra HTML client")}processEncodings(e){console.debug("XpraConnection#processEncodings",e)}processCursor(e,t,n,s,i,r,a,d,u){if(!!this.options.cursor){if(arguments.length<8)this.emit("cursor",null);else if(e==="png"){const p=Q(e,u);this.emit("cursor",{dimension:[s,i],image:p,xhot:r,yhot:a})}}}processPing(...e){const t=e.length>1?e[1]:e[0],n=e.length>=3?e[2]:"";this.stats.lastServerPing=t,this.send(["ping_echo",t,0,0,0,0,n||""])}processPingEcho(e,t,n,s,i){this.stats.lastClientEcho=e,this.stats.clientPingLatency=i,this.stats.serverPingLatency=Math.ceil(performance.now())-this.stats.lastClientEcho,this.stats.serverLoad=[t/1e3,n/1e3,s/1e3],this.emit("pong",f({},this.stats))}processDraw(e,t,n,s,i,r,a,d,u,p){const l=performance.now(),m=(A,E="")=>this.sendDamageSequence(d,e,[s,i],A,E);this.emit("draw",{wid:e,image:a,encoding:r,packetSequence:d,rowStride:u,options:p||{},position:[t,n],dimension:[s,i],callback:A=>{const E=Math.round(1e3*performance.now()-1e3*l);A&&console.warn("XpraConnection#processDraw -> callback",A),m(E,A==null?void 0:A.message)}})}processSettingChange(e,t){switch(e){case"xdg-menu":const n=Object.values(t).map(s=>({name:s.Name,icon:s.IconData&&s.IconType?Q(s.IconType,s.IconData):void 0,entries:Object.entries(s.Entries).map(u=>{var[i,p]=u,l=p,{IconType:r,IconData:a}=l,d=ae(l,["IconType","IconData"]);return{name:i,exec:d.Exec.replace(/%[uUfF]/g,""),icon:a&&r?Q(r,a):void 0,attributes:d}})}));this.emit("updateXDGMenu",n);break;default:console.debug("XpraConnection#processSettingChange","uncaught",e,t);break}}processWindowMoveResize(e,t,n,s,i){this.emit("moveResizeWindow",{wid:e,position:[t,n],dimension:[s,i]})}processWindowResized(e,t,n){this.emit("moveResizeWindow",{wid:e,dimension:[t,n]})}processWindowRaise(e){this.emit("raiseWindow",e)}processWindowLost(e){this.emit("removeWindow",e)}processWindowMetadata(e,t){this.emit("updateWindowMetadata",{wid:e,metadata:t})}processNewOverrideRedirect(e,t,n,s,i,r,a={}){this.emit("newWindow",{id:e,position:[t,n],dimension:[s,i],overrideRedirect:!0,metadata:r,clientProperties:a})}processConfigureOverrideRedirect(e,t,n,s,i){this.emit("moveResizeWindow",{wid:e,dimension:[s,i],position:[t,n]})}processShowNotification(e,t,n,s,i,r,a,d,u,p,l){this.emit("showNotification",{id:t,replacesId:s,expires:d,actions:p,hints:l,icon:u?Q(u[0],u[3]):null,summary:r,body:a})}processCloseNotification(e){this.emit("hideNotification",e)}processBell(){this.options.bell&&new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()}processInitiateMoveResize(e,t,n,s,i,r){this.emit("initiateMoveResize",{wid:e,position:[t,n],direction:s,button:i,sourceIndication:r})}processSendFile(e,t,n,s,i){if(i.length!==s){console.warn("XpraConnection#processSendFile","Invalid length for",e);return}const r=new Blob([i],t);this.emit("sendFile",{filename:e,mime:t,size:s,blob:r,print:n})}processSoundData(e,t,n,s){try{if(!this.options.audio||!this.audio.validate(e))return;n["start-of-stream"]===1&&this.audio.start(),t&&t.length>0&&this.audio.addQueue(t,s),n["end-of-stream"]===1&&this.audio.stop()}catch(i){console.error("XpraConnection#processSoundData",i),this.audio.stop()}}async processClipboardToken(e,t,n,s,i,r,a){if(this.options.clipboard){arguments.length>=7&&(this.clipboardBuffer[e]=[a,s,i,r]);const d=this.capabilities["clipboard.preferred-targets"];if(n&&d.includes(n)){let p=a;s.match(/text|string/i)?(p instanceof Uint8Array&&(p=ve(p)),await Se(p)):s==="image/png"&&i==8&&r=="bytes"&&await Se(a,s)}}}processSetClipboardEnabled(e){this.options.clipboard=!!e}async processClipboardRequest(e,t){const n=()=>{const s=this.clipboardBuffer.CLIPBOARD;if(s){const[i,r,a,d]=s;this.sendClipboard(e,t,i,r,a,d)}};if(this.options.clipboard){if(t!="CLIPBOARD"){this.sendClipboardString(e,t,"");return}try{const s=await Ee("UTF8_STRING"),i=this.clipboardBuffer.PRIMARY;if(i&&i[1]==8&&i[2]=="bytes"&&s==i[3])n();else if(s){const[r,a]=s;this.sendClipboardString(e,t,a,r)}}catch(s){n(),console.error("XpraConnection#processClipboardRequest",s)}}}processChallenge(e,t,n,s,i){i=(i||"password").replace(/[^a-zA-Z0-9\.,:\+/]/gi,""),s=s||"xor";try{const r=$t(e,n,s,this.options.password,this.options.ssl,this.options.encryption);if(r){const[a,d]=r;this.createCapabilities({challenge_response:a,challenge_client_salt:d}),this.sendHello()}}catch(r){this.disconnect(r)}}processInfoResponse(e){this.emit("infoResponse",e)}processNewTray(e,t,n,s){const i=parseInt(t),r=parseInt(n);this.emit("newTray",{id:e,metadata:s,position:[0,0],dimension:[i,r],overrideRedirect:!1,clientProperties:{}})}processPointerPosition(e,t,n){const s=parseInt(t),i=parseInt(n);this.emit("pointerPosition",{wid:e,position:[s,i]})}processEos(e){this.emit("eos",e)}processDisconnect(e){this.disconnect(new Re(`Disconnected: ${e}`))}processOpenUrl(e){this.options.openUrl&&window.open(e,"_blank")}}async function fn(o){switch(o.encoding){case"rgb32":case"rgb24":const[e,t]=o.dimension;return new ImageData(new Uint8ClampedArray(o.image.buffer),e,t);case"avif":case"jpeg":case"png/P":case"png/L":case"png":case"webp":const n=Q(o.encoding,o.image);return Tt(n);default:console.warn("encodeXpraDrawData","Unhandled decode",o)}return null}async function wn(o,e){const t=o.getContext("2d"),[n,s]=e.position,[i,r]=e.dimension;if(t&&e.encoding!=="void")if(e.encoding==="scroll")e.image.forEach(([a,d,u,p,l,m])=>{t.drawImage(o,a,d,u,p,a+l,d+m,u,p)});else{const a=await fn(e);a&&(a instanceof ImageData?t.putImageData(a,n,s,0,0,i,r):(t.clearRect(n,s,i,r),t.drawImage(a,n,s)))}}function Ie(o,e){let t=5e3;if(o.overrideRedirect)t=3e4;else switch((o.metadata["window-type"]||[])[0]){case"DROPDOWN":case"TOOLTIP":case"POPUP_MENU":case"MENU":case"COMBO":t=2e4;break;case"UTILITY":case"DIALOG":t=15e3;break}return o.metadata.above?t+=5e3:o.metadata.below&&(t-=5e3),t+e}class gn{constructor(e){w(this,"windows",[]);w(this,"xpra");w(this,"altgrState",!1);w(this,"keyboardKayout","us");this.xpra=e,this.xpra.on("draw",t=>{const n=this.getWindow(t.wid);n&&(n.renderQueue.push(t),this.renderWindow(n))}),this.xpra.on("connect",()=>{this.keyboardKayout=e.getOptions().keyboardLayout}),this.xpra.on("disconnect",()=>{this.clearWindows()})}onResize(e,t){const n=this.getWindow(e);if(n){const[s,i]=t;n.canvas.width!==s&&(n.canvas.width=s),n.canvas.height!==i&&(n.canvas.height=i)}}clearWindows(){this.windows=[]}createWindow(e){const[t,n]=e.dimension,s=document.createElement("canvas");s.width=t,s.height=n,this.windows.push({canvas:s,attributes:e,renderQueue:[],renderPending:0,inited:!1}),this.xpra.sendMapWindow(e)}async renderWindow(e){const t=e.renderQueue.shift();if(t&&e.canvas){try{await wn(e.canvas,t)}catch(n){t.callback(n),this.renderWindow(e);return}t.callback()}}removeWindow(e){const t=this.windows.findIndex(n=>n.attributes.id===e);t!==-1&&this.windows.splice(t,1)}updateWindow(e){const t=this.getWindow(e.id);t&&Object.assign(t.attributes,e)}moveResize(e,t,n){this.onResize(e.attributes.id,n),this.xpra.sendGeometryWindow(e.attributes.id,t,n)}mouseButton(e,t,n){const s=this.getKeyboardModifiers(t),i=Lt(t),r=de(t);this.xpra.sendMouseButton(e.attributes.id,r,i,n,s)}mouseWheel(e,t){const n=this.getKeyboardModifiers(t),s=de(t),i=Xt(t);this.xpra.sendMouseWheel(e.attributes.id,i,s,n)}mouseMove(e,t){const n=e?e.attributes.id:0,s=this.getKeyboardModifiers(t),i=de(t);this.xpra.sendMouseMove(n,i,s)}keyPress(e,t,n){const s=e?e.attributes.id:0,i=this.getKeyboardModifiers(t),{keyname:r,keycode:a,keyval:d,group:u,str:p}=_t(t);p==="AltGraph"&&(this.altgrState=n);const[l]=fe();this.keyboardKayout!==l&&(this.keyboardKayout=l,this.xpra.sendLayoutChanged(l)),this.xpra.sendKeyAction(s,r,n,i,d,p,a,u)}raise(e){const t=this.windows.map(n=>n.attributes);this.xpra.sendWindowRaise(e.attributes.id,t)}minimize(e){this.xpra.sendUnmapWindow(e.attributes)}maximize(e,t,n){this.restore(e),this.moveResize(e,t,n)}restore(e){this.xpra.sendMapWindow(e.attributes)}close(e){this.xpra.sendCloseWindow(e.attributes.id)}getWindow(e){return this.windows.find(t=>t.attributes.id===e)||null}getKeyboardModifiers(e){const t=this.xpra.getOptions().swapKeys,n=this.xpra.getServerCapabilities(),s=n==null?void 0:n.modifier_keycodes;return zt(e,t,this.altgrState,s)}}function An(o){if(o){const{image:e,xhot:t,yhot:n}=o;return`transparent url('${e}') no-repeat ${t}px ${n}px`}return""}function yn(o,e=""){if(o){const{image:t,xhot:n,yhot:s}=o,i=e?`, ${e}`:"";return`url('${t}') ${n} ${s}${i}`}return e}function We(o,e,t){let n="";const{width:s,height:i,x:r,y:a}=o.getBoundingClientRect(),d=e[0]-r,u=e[1]-a;return u<=t?n+="n":u>=i-t&&(n+="s"),d<=t?n+="w":d>=s-t&&(n+="e"),n}function Ne(o){const{onDown:e,onMove:t,onRelease:n}=o();return s=>{s.preventDefault();const i=s.pageX,r=s.pageY;let a=!1;const d=p=>{const l=p.pageX-i,m=p.pageY-r;a=!0,t(p,l,m)},u=p=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",u),n(p,a)};window.addEventListener("mousemove",d),window.addEventListener("mouseup",u),e&&e(s.nativeEvent,i,r)}}function De({opacity:o}){if(typeof o=="number")return o<0?1:o/4294967296}var S=(o=>(o.SetHost="SET_HOST",o.SetShowOptions="SET_SHOW_OPTIONS",o.AddWindow="ADD_WINDOW",o.RemoveWindow="REMOVE_WINDOW",o.SetWindowIcon="SET_WINDOW_ICON",o.SetConnected="SET_CONNECTED",o.SetCursor="SET_CURSOR",o.UpdateStats="UPDATE_STATS",o.MoveResizeWindow="MOVE_RESIZE_WINDOW",o.MaximizeWindow="MAXIMIZE_WINDOW",o.UpdateMetadata="UPDATE_METADATA",o.RaiseWindow="RAISE_WINDOW",o.AddNotification="ADD_NOTIFICATION",o.RemoveNotification="REMOVE_NOTIFICATION,",o.SetDraggingWindow="SET_DRAGGING_WINDOW",o.ClearWindows="CLEAR_WINDOWS",o.SetOption="SET_OPTION",o.UpdateMenu="UPDATE_MENU",o.SetError="SET_ERROR",o.SetStarted="SET_STARTED",o))(S||{});let Oe=1;const he={connect:!1,host:"ws://127.0.0.1:10000",showOptions:!1,connected:!1,cursor:null,windows:[],notifications:[],activeWindow:0,draggingWindow:-1,actualDesktopSize:[0,0],stats:f({},je),options:f({},ne),menu:[],error:"",started:!1};function bn(o,e){var n,s;const t=(i,r)=>{const a=o.windows,d=a.find(u=>u.id===i);return d&&Object.assign(d,r(d)),M(f({},o),{windows:a})};switch(e.type){case"SET_HOST":return M(f({},o),{host:e.payload});case"SET_SHOW_OPTIONS":return M(f({},o),{showOptions:e.payload});case"ADD_WINDOW":const i=!!e.payload.metadata.tray;return M(f({},o),{activeWindow:e.payload.id,windows:[...o.windows,{id:e.payload.id,minimized:e.payload.metadata.iconic===!0,maximized:!1,title:e.payload.metadata.title||String(e.payload.id),position:e.payload.position,dimension:e.payload.dimension,minDimension:(n=e.payload.metadata["size-constraints"])==null?void 0:n["minimum-size"],maxDimension:(s=e.payload.metadata["size-constraints"])==null?void 0:s["maximum-size"],opacity:De(e.payload.metadata),tray:i,zIndex:i?0:Ie(e.payload,++Oe)}]});case"REMOVE_WINDOW":const{windows:r}=o,a=r.findIndex(I=>I.id===e.payload);a!==-1&&r.splice(a,1);const d=r.length>0?r[r.length-1].id:0;return M(f({},o),{activeWindow:d,windows:r});case"SET_WINDOW_ICON":const u=e.payload;return t(u.wid,()=>({icon:u}));case"SET_CONNECTED":return M(f({},o),{started:!1,windows:e.payload?o.windows:[],connected:e.payload});case"SET_CURSOR":return M(f({},o),{cursor:e.payload});case"UPDATE_STATS":return M(f({},o),{stats:f(f({},o.stats),e.payload)});case"MOVE_RESIZE_WINDOW":const{wid:p,position:l,dimension:m}=e.payload;return t(p,I=>({position:l||I.position,dimension:m||I.dimension}));case"MAXIMIZE_WINDOW":const{maximize:A}=e.payload;return t(e.payload.wid,I=>({oldPosition:A?I.position:void 0,oldDimension:A?I.dimension:void 0,position:A?e.payload.position:I.oldPosition,dimension:A?e.payload.dimension:I.oldDimension,maximized:A}));case"UPDATE_METADATA":const{title:E,iconic:g}=e.payload.metadata;return t(e.payload.wid,I=>({opacity:De(e.payload.metadata),minimized:g===void 0?I.minimized:g===!0,title:E===void 0?I.title:E}));case"RAISE_WINDOW":return M(f({},t(e.payload.id,()=>({zIndex:Ie(e.payload,++Oe)}))),{activeWindow:e.payload.id});case"ADD_NOTIFICATION":return M(f({},o),{notifications:[...o.notifications,e.payload]});case"REMOVE_NOTIFICATION,":const{notifications:b}=o,D=b.findIndex(([I])=>I.id===e.payload);return D!==-1&&b.splice(D,1),M(f({},o),{notifications:b});case"SET_DRAGGING_WINDOW":return M(f({},o),{draggingWindow:e.payload});case"CLEAR_WINDOWS":return M(f({},o),{cursor:null,windows:[],notifications:[],draggingWindow:-1});case"SET_OPTION":const[B,W]=e.payload;return M(f({},o),{options:M(f({},o.options),{[B]:W})});case"UPDATE_MENU":return M(f({},o),{menu:e.payload});case"SET_ERROR":return M(f({},o),{error:e.payload});case"SET_STARTED":return M(f({},o),{started:e.payload});default:return o}}const T=y.exports.createContext({wm:null,xpra:null,state:he,root:null,setRoot:()=>{},setCursor:()=>{},dispatch:()=>{}}),vn=Ge(["connect"],[],["connect","host"]),En=Zt(),Sn=M(f(f({},he),vn),{options:f(f({},he.options),En)}),Cn=({children:o,wm:e,xpra:t})=>{const[n,s]=y.exports.useReducer(bn,Sn),[i,r]=y.exports.useState(null),[a,d]=y.exports.useState(null),u=()=>{s({type:S.SetConnected,payload:!0}),s({type:S.SetError,payload:""}),Notification.requestPermission()},p=h=>{s({type:S.SetConnected,payload:h!=="disconnected"}),s({type:S.ClearWindows})},l=h=>{e.createWindow(h),s({type:S.AddWindow,payload:h})},m=h=>{s({type:S.RemoveWindow,payload:h})},A=h=>s({type:S.SetWindowIcon,payload:h}),E=h=>s({type:S.UpdateStats,payload:h}),g=h=>s({type:S.SetCursor,payload:h}),b=h=>ue(()=>{if(h){const{offsetWidth:R,offsetHeight:P}=h;t.sendResize(R,P)}},200),D=h=>{s({type:S.MoveResizeWindow,payload:h}),h.dimension&&e.onResize(h.wid,h.dimension)},B=h=>s({type:S.RaiseWindow,payload:e.getWindow(h).attributes}),W=h=>s({type:S.UpdateMetadata,payload:h}),I=h=>{},ie=h=>R=>{if(n.connected&&R.target===document.body)R.preventDefault(),R.stopPropagation();else return;const P=e.getWindow(h);e.keyPress(P,R,R.type==="keydown")},$=h=>ue(R=>{const P=e.getWindow(h);P&&e.mouseWheel(P,R)},100),z=async h=>{const R=await Ft(h.summary,{body:h.body,icon:h.icon||void 0});if(R){const P=()=>t.sendNotificationClose(h.id);R.addEventListener("close",P)}s({type:S.AddNotification,payload:[h,R]})},K=h=>s({type:S.RemoveNotification,payload:h}),V=h=>{h.print?Yt(h.filename,h.blob):Xe(h.filename,h.blob)},j=h=>{if(a){const[R,P]=h.position;Object.assign(a.style,{left:`${R}px`,top:`${P}px`})}},Z=()=>{},G=h=>s({type:S.SetError,payload:h}),H=h=>s({type:S.UpdateMenu,payload:h}),ee=()=>s({type:S.SetStarted,payload:!0});return y.exports.useEffect(()=>(t.on("connect",u),t.on("disconnect",p),t.on("newWindow",l),t.on("removeWindow",m),t.on("windowIcon",A),t.on("pong",E),t.on("cursor",g),t.on("moveResizeWindow",D),t.on("updateWindowMetadata",W),t.on("raiseWindow",B),t.on("initiateMoveResize",I),t.on("showNotification",z),t.on("hideNotification",K),t.on("sendFile",V),t.on("pointerPosition",j),t.on("newTray",l),t.on("eos",Z),t.on("updateXDGMenu",H),t.on("error",G),t.on("sessionStarted",ee),n.connect&&t.connect(n.host,n.options),()=>{t.off("connect",u),t.off("disconnect",p),t.off("newWindow",l),t.off("removeWindow",m),t.off("windowIcon",A),t.off("pong",E),t.off("cursor",g),t.off("moveResizeWindow",D),t.off("updateWindowMetadata",W),t.off("raiseWindow",B),t.off("initiateMoveResize",I),t.off("showNotification",z),t.off("hideNotification",K),t.off("sendFile",V),t.off("pointerPosition",j),t.off("newTray",l),t.off("eos",Z),t.off("updateXDGMenu",H),t.off("error",G),t.off("sessionStarted",ee)}),[]),y.exports.useEffect(()=>{const h=b(i);return t.on("sessionStarted",h),window.addEventListener("resize",h),()=>{t.off("sessionStarted",h),window.removeEventListener("resize",h)}},[i]),y.exports.useEffect(()=>{const h=ie(n.activeWindow),R=$(n.activeWindow);return window.addEventListener("keydown",h),window.addEventListener("keyup",h),window.addEventListener("wheel",R),window.addEventListener("mousewheel",R),window.addEventListener("DOMMouseScroll",R),()=>{window.removeEventListener("keydown",h),window.removeEventListener("keyup",h),window.removeEventListener("wheel",R),window.removeEventListener("mousewheel",R),window.removeEventListener("DOMMouseScroll",R)}},[n.activeWindow]),c.createElement(T.Provider,{value:{state:n,dispatch:s,root:i,wm:e,xpra:t,setRoot:r,setCursor:d}},o)},Rn=300,F=({toggled:o,children:e,mountOnEnter:t=!0,unmountOnExit:n=!0})=>c.createElement(st,{in:o,timeout:Rn,mountOnEnter:t,unmountOnExit:n,classNames:"fade-on-out"},e);var xn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAUdEVYdEF1dGhvcgBKYWt1YiBTdGVpbmVy5vv3LwAAADV0RVh0RGVzY3JpcHRpb24ASW52ZXJ0ZWQgdmFyaWFudCBvZiB0aGUgRE1aIGN1cnNvciB0aGVtZS5odVs8AAAAM3RFWHRTb3VyY2UAaHR0cDovL2ppbW1hYy5tdXNpY2hhbGwuY3ovdGhlbWVzLnBocD9za2luPTdQM5WxAAADwUlEQVRYhe2WTUhsZRjHf+PVcdLU48d1GkMvdwI185ZIzEYpaKttWqhcKhlFF65USjcK6equNFJbCEokiISiochQgfmBaI6CKGmg5MeIwpBXZpIRPec8LWb0Wte6c1SsRX94eDcvvD+er/8L/+sFEpFX/833o3Vd9zc3N78FxAIRdw0QKyISCAT8xcXFDuDlu4aIl5D8fr+voKDgbe44E/EiIu3t7eL3+8Xn8x3l5ua+GYIw3RlAeXm5FBUVSSAQEJ/Pd2i32x8BMbcBEVYqdV1nfn4ep9OJxWJJXFpa+t5msz0AXropRFgAmqahqiqTk5NUVVURGxtrXV1ddQFpgOUmEIYAVFVlYmKCuro6FEXJ8Hq93wE2IPq6EGEBiMgFgKqquFwuGhoaSE5Ofri/v/8t8Mp1IcIep8sAqqoyPj5Oa2srVqs1d29vbwiwAmajENcGUFWV4eFh2traSEtLy9/Z2fkGSDUKYWihXAUxMDBAZ2cn6enpjo2Nja+A+0YgDANcbsjz6O/vp6+vD7vd/t7a2tqXQAoQFQ6EIYC/NuPl6OnpYXBwkKysrPdXVla+CBfC8E6/6vHzrHR3dzM8PExOTs4HCwsLT4BkIPKfICKNAlwuAYDD4cBisWA2m4mOjmZxcZG8vDzy8/M/mpmZ+b2wsPAz4ClwZvQtCHlBSUmJABcRGRkpcXFxYrVaxe12y99J13WZnp5+Aii3lgGAsrIyxsbGUFWVrq4uent76ejo+GFoaOgns9l8bDKZxGQy6WazOSAivxJcUtfScxmora0VXdelpqZGEhISxGazyebmpni93qdAEfA6YAceAg8ILqiYWwFoaGgQXdfl9PRU9Xg8oiiKpKSkSH19vWiaJk1NTY0EvcEM3AtFBDcwqwuAxsZGERFZXFxcdzqdn2uaJtXV1aIoimRkZMjBwYEcHBx4gDe4oUM+BzA3Nye6rsvs7OwK8DFQcHR05Nna2hJFUSQ1NVVaWlpEVVWprKysIDh+t/Jtiz/v5qmpqSXgQ+ARkDw6OvpY0zSpqKiQpKQkyczMlOPjY1leXp4DXiO4hG4HYH5+/kegDMgF4ghOj+L3+/c2NjYkMTFRsrOz5fDwUNbX138OQd5KGWJ3d3e/Bt4Bsnn2LTcBUS6X6/HZ2Zlsb29LIBCQk5MTvbS0tCV017A1X6UoIJGgw8Xw57qagPiRkZFPPB7PL2632+1wOD4F3iXoA2H1wIsITQRHSQA9dF7WPYIluU/wg3oC/Ab4APWK+4YBwlEEz2ZeC8X54vrv6w+aYEf+AZkZtAAAAABJRU5ErkJggg==";const kn=10,Be=16;let Pe=!1;const Mn=({win:o,bar:e,winstance:t})=>{const{oldPosition:n,oldDimension:s}=o,{wm:i,xpra:r,root:a,dispatch:d}=y.exports.useContext(T),u="w-4 h-4 rounded-full cursor-pointer bg-gradient-to-b shadow-inner hover:shadow",p=m=>{m.stopPropagation(),m.preventDefault()},l=()=>{if(e.current&&a)if(o.maximized)n&&s&&(i.maximize(t,n,s),d({type:S.MaximizeWindow,payload:{wid:o.id,maximize:!1}}));else{const A=e.current.offsetHeight,E=a.offsetWidth,g=a.offsetHeight-A;i.maximize(t,[0,A],[E,g]),d({type:S.MaximizeWindow,payload:{wid:o.id,position:[0,A],dimension:[E,g],maximize:!0}})}};return c.createElement("div",{className:"flex items-center space-x-2",onMouseDown:p},c.createElement("div",{title:"Minimize",className:`${u} from-green-300 to-green-500 hover:from-green-400`,onClick:()=>i.minimize(t)}),c.createElement("div",{title:"Maximize",className:`${u} from-blue-300 to-blue-500 hover:from-blue-400`,onClick:l}),!r.isReadOnly()&&c.createElement("div",{title:"Close",className:`${u} from-red-300 to-red-500 hover:from-red-400`,onClick:()=>i.close(t)}))},Ze=({win:{icon:o,title:e}})=>c.createElement(c.Fragment,null,o&&c.createElement("img",{alt:e,src:o.image,className:"max-h-full"}),!o&&c.createElement("div",{className:"w-full h-full bg-gray-500 rounded"})),me=({id:o})=>{const e=y.exports.useRef(null),{wm:t,state:n}=y.exports.useContext(T),s=t.getWindow(o),i=n.draggingWindow>=0?"pointer-events-none":"",r=y.exports.useCallback(u=>{t.mouseButton(s,u,!0)},[]),a=y.exports.useCallback(u=>{t.mouseButton(s,u,!1)},[]),d=y.exports.useCallback(u=>{u.preventDefault(),u.stopPropagation(),t.mouseMove(s,u.nativeEvent)},[]);return y.exports.useEffect(()=>{e.current&&e.current.appendChild(s.canvas)},[e.current]),c.createElement("div",{ref:e,className:i,onMouseDown:r,onMouseUp:a,onMouseMove:d})},In=({win:o})=>{var P;const{id:e,position:t,dimension:n,title:s,minimized:i,maximized:r,opacity:a,zIndex:d,minDimension:u,maxDimension:p}=o,[l,m]=y.exports.useState("default"),{wm:A,dispatch:E,xpra:g}=y.exports.useContext(T),b=y.exports.useRef(null),D=y.exports.useRef(null),B=y.exports.useRef(null),W=A.getWindow(e),I={opacity:a,zIndex:d},ie={cursor:l},$={toggled:!i,mountOnEnter:!1,unmountOnExit:!1},z=(v,k,x,C,N=!1)=>{b.current&&Object.assign(b.current.style,{left:`${v}px`,top:`${k}px`,width:`${x}px`,height:`${C}px`}),W!=null&&W.canvas&&Object.assign(W.canvas.style,{width:`${x}px`,height:`${C}px`}),N&&E({type:S.MoveResizeWindow,payload:{wid:e,position:[v,k],dimension:[x,C]}})},K=(v=!1)=>{const[k,x]=t,[C,N]=n;z(k,x,C,N,v)},V=v=>(k,x,C,N,L)=>{const[U,X]=u||[100,100],[$e,et]=p||[Number.MAX_VALUE,Number.MAX_VALUE];C=Math.min($e,Math.max(U,C)),N=Math.min(et,Math.max(X,N)),v(k,x,C,N,L)},j=V((v,k,x,C)=>{!g.isReadOnly()&&!r&&z(v,k,x,C),G(!0)}),Z=V((v,k,x,C,N)=>{G(!1),!g.isReadOnly()&&!r&&(z(v,k,x,C,!0),N&&A.moveResize(W,[v,k],[x,C]))}),G=v=>{Pe||E({type:S.SetDraggingWindow,payload:v?e:-1}),Pe=v},H=v=>{v.preventDefault(),v.stopPropagation(),A.raise(W),E({type:S.RaiseWindow,payload:W.attributes})},ee=ue(v=>{if(B.current){const k=We(B.current,[v.pageX,v.pageY],Be);m(`${k}-resize`)}else m("default")},kn),h=y.exports.useCallback(Ne(()=>{const[v,k]=n;let[x,C]=t;return{onMove(N,L,U){x=t[0]+L,C=t[1]+U,j(x,C,v,k),G(!0)},onRelease(N,L){Z(x,C,v,k,L)}}}),[t,n]),R=y.exports.useCallback(Ne(()=>{let v="",[k,x]=t,[C,N]=n;return{onDown(L,U,X){B.current&&(v=We(B.current,[U,X],Be))},onMove(L,U,X){v.startsWith("n")?(N=n[1]-X,x=t[1]+X):v.startsWith("s")&&(N=n[1]+X),v.endsWith("w")?(C=n[0]-U,k=t[0]+U):v.endsWith("e")&&(C=n[0]+U),j(k,x,C,N)},onRelease(L,U){Z(k,x,C,N,U)}}}),[B,t,n]);return y.exports.useEffect(()=>{K()},[t,n]),y.exports.useEffect(()=>{K()},[b]),y.exports.useEffect(()=>{const[v,k]=t,[x,C]=n;g.isReadOnly()||(v<=0||k<=0)&&(A.moveResize(W,[100,100],[x,C]),z(100,100,x,C,!0))},[]),(P=W==null?void 0:W.attributes)!=null&&P.overrideRedirect?c.createElement(F,f({},$),c.createElement("div",{className:"absolute bg-black cursor-default shadow",ref:b,style:I,onMouseDown:H},c.createElement(me,{id:e}))):c.createElement(F,f({},$),c.createElement("div",{ref:b,style:I,className:"absolute",onMouseDown:H,onMouseMove:ee},c.createElement("div",{ref:B,className:"absolute z-10 -left-2 -top-10 -bottom-2 -right-2",style:ie,onMouseDown:R}),c.createElement("div",{className:"relative w-full h-full z-20 outline outline-1 outline-gray-200 shadow-xl"},c.createElement("div",{className:"absolute -top-8 w-full flex items-center p-1 px-2 h-8 space-x-2 outline outline-1 outline-gray-200 bg-gray-100 cursor-default",ref:D,onMouseDown:h},c.createElement("div",{className:"flex items-center justify-center",style:{width:"16px",height:"16px"}},c.createElement(Ze,{win:o})),c.createElement("div",{className:"flex-grow truncate text-sm"},c.createElement("span",null,s||e)),c.createElement(Mn,{winstance:W,win:o,bar:D,outer:b})),c.createElement("div",{className:"xpra-window-canvas w-full h-full bg-black"},c.createElement(me,{id:e})))))},Wn=({children:o})=>{const e=y.exports.createRef(),t=y.exports.createRef(),{wm:n,state:s,setRoot:i,setCursor:r}=y.exports.useContext(T),a=m=>{n.mouseMove(null,m.nativeEvent)},d=m=>{m.preventDefault()},u=f({dimension:[32,32],xhot:8,yhot:3,image:xn},s.cursor||{}),p=`
.xpra-cursor {
  background: ${An(u)};
}

.xpra-window-canvas {
  cursor: ${yn(s.cursor,"default")};
}
`,l=s.windows.filter(m=>!m.tray);return y.exports.useEffect(()=>{e.current&&i(e.current)},[e.current]),y.exports.useEffect(()=>{t.current&&r(t.current)},[t.current]),c.createElement(c.Fragment,null,c.createElement("div",{id:"xpra-desktop",className:"absolute inset-0 z-30 overflow-hidden bg-gradient-to-br from-emerald-500 via-emerald-300 to-emerald-500",ref:e,onMouseMove:a,onContextMenu:d},s.connected&&l.map(m=>c.createElement(In,{key:m.id,win:m})),o),c.createElement("div",{ref:t,className:"xpra-cursor absolute z-50"}),c.createElement("style",null,p))};let He=1;const Nn=({disabled:o,label:e,value:t,required:n,options:s,onChange:i})=>{const r=`xpra_${++He}`,a="rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed";return c.createElement("div",null,e&&c.createElement("label",{htmlFor:r},e),c.createElement("div",null,c.createElement("select",{className:a,id:r,required:n,disabled:o,defaultValue:t,onChange:i},Object.entries(s).map(([d,u])=>c.createElement("option",{key:d,value:d},u)))))},_=({children:o,disabled:e,label:t,type:n,transparent:s,onClick:i})=>{let r="flex items-center justify-center relative rounded w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed hover:outline hover:outline-1";return s?r+=" border border border-transparent":r+=" bg-white border border-black-100",c.createElement("button",{className:r,disabled:e,type:n||"button",onClick:i},t||o)},le=({disabled:o,label:e,value:t,type:n,placeholder:s,required:i,onChange:r})=>{const a=`xpra_${++He}`,d="rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed";return c.createElement("div",null,e&&c.createElement("label",{htmlFor:a},e),c.createElement("div",null,c.createElement("input",{type:n||"text",className:d,id:a,placeholder:s,required:i,disabled:o,defaultValue:t,onInput:r})))},O=({label:o,value:e,onChange:t})=>c.createElement("div",{className:"select-none"},c.createElement("label",{className:"inline-flex items-center space-x-2 cursor-pointer"},c.createElement("input",{type:"checkbox",defaultChecked:e,onChange:t}),c.createElement("span",null,o))),Dn=["shadow-lg","bg-emerald-100/50","opacity-90","rounded"],qe=(...o)=>o.join(" "),Je=({items:o,onCallback:e=()=>{},root:t=!0})=>{const n=y.exports.useRef(null),[s,i]=y.exports.useState(-1),r=["max-h-96","max-w-xs"];t?r.push("top-full","left-0"):r.push("top-0","left-full","overflow-auto");const a=p=>i(p),d=()=>i(-1),u=p=>{p&&p(),e()};if(t){const p=l=>{if(n.current){const m=l.target;m&&(n.current.contains(m)||m===n.current.parentNode)||u()}};y.exports.useEffect(()=>(document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}),[n])}return c.createElement("div",{ref:n,className:qe("absolute","shadow","bg-emerald-100/80",...r),onMouseLeave:d},o.map(({icon:p,title:l,items:m,callback:A},E)=>c.createElement("div",{key:E,className:"relative text-left"},c.createElement("div",{className:"p-2 hover:bg-white truncate flex space-x-2 items-center",onClick:()=>u(A),onMouseOver:()=>a(E)},p&&c.createElement("img",{src:p,className:"w-4 h-4"}),c.createElement("span",null,l)),s===E&&m&&m.length>0&&c.createElement(Je,{root:!1,items:m}))))},we=({classNames:o,children:e})=>{const t=qe("absolute","z-50",...Dn,...o);return c.createElement("div",{className:t},e)},On=()=>{const{xpra:o,state:e,dispatch:t}=y.exports.useContext(T),n=e.showOptions?"Hide options":"Show options",s=(l,m)=>t({type:S.SetOption,payload:[l,m]}),i=[{key:"reconnect",label:"Automatically reconnect",component:O},{key:"shareSession",label:"Share Session",component:O},{key:"stealSession",label:"Steal Session",component:O},{key:"clipboard",label:"Clipboard",component:O},{key:"clipboardImages",label:"Clipboard Images",component:O},{key:"fileTransfer",label:"File Transfer",component:O},{key:"printing",label:"Printing",component:O},{key:"bell",label:"Bell",component:O},{key:"notifications",label:"Notifications",component:O},{key:"openUrl",label:"Open URLs",component:O},{key:"audio",label:"Audio",component:O},{key:"showStartMenu",label:"XDG Menu",component:O},{key:"swapKeys",label:"Swap Ctrl and Cmd key",component:O},{key:"reverseScrollX",label:"Reverse X scroll",component:O},{key:"reverseScrollY",label:"Reverse Y scroll",component:O},{key:"keyboardLayout",label:"Keyboard Layout",component:Nn,options:Wt}].map(l=>M(f({},l),{value:e.options[l.key],onChange:m=>s(l.key,m.target.value)})),r=l=>t({type:S.SetHost,payload:l.target.value}),a=l=>s("username",l.target.value),d=l=>s("password",l.target.value),u=l=>{l.preventDefault(),t({type:S.SetError,payload:""}),o.connect(e.host,e.options)},p=()=>t({type:S.SetShowOptions,payload:!e.showOptions});return c.createElement(we,{classNames:["p-8","top-1/2","left-1/2 transform","-translate-x-1/2","-translate-y-1/2","w-96","max-w-full","max-h-full","overflow-auto"]},c.createElement("form",{className:"space-y-4",onSubmit:u},c.createElement("div",{className:"space-y-2"},c.createElement(le,{required:!0,placeholder:"Host",value:e.host,onChange:r}),c.createElement("div",{className:"flex space-x-2"},c.createElement(le,{placeholder:"Username",value:e.options.username,onChange:a}),c.createElement(le,{type:"password",placeholder:"Password",value:e.options.password,onChange:d}))),e.error&&c.createElement("div",{className:"bg-red-300 border border-red-500 text-red-500 p-2 rounded"},e.error),c.createElement("div",{className:"flex space-x-2"},c.createElement(_,{label:"Connect",type:"submit"}),c.createElement(_,{label:n,onClick:p})),c.createElement(F,{toggled:e.showOptions},c.createElement("div",{className:"px-2 text-sm"},i.map(E=>{var g=E,{component:l,key:m}=g,A=ae(g,["component","key"]);const b=l;return c.createElement(b,f({key:m},A))})))))},Bn=()=>{const{state:o}=y.exports.useContext(T),e=[["Last server ping",o.stats.lastServerPing],["Last client echo",o.stats.lastClientEcho],["Client ping latency",o.stats.clientPingLatency],["Server ping latency",o.stats.serverPingLatency],["Server load",o.stats.serverLoad.join(" / ")],["Window count",o.windows.length]];return c.createElement("div",{className:"absolute bottom-1 left-1 p-1 z-0 opacity-50 bg-emerald-100 rounded"},c.createElement("table",{className:"text-xs"},c.createElement("tbody",null,e.map(([t,n])=>c.createElement("tr",{key:t},c.createElement("td",{className:"p-1"},t),c.createElement("td",{className:"p-1 text-right text-gray-500"},n))))))},Pn=()=>{const{wm:o,state:e,dispatch:t,xpra:n}=y.exports.useContext(T),[s,i]=y.exports.useState(!1),r=e.windows.filter(g=>g.minimized),a=e.windows.filter(g=>g.tray),d=[...e.menu.map(g=>({title:g.name,icon:g.icon,items:g.entries.map(b=>({title:b.name,icon:b.icon,callback:()=>{n.sendStartCommand(b.name,b.exec,!1)}}))})),{title:"Server",items:[{title:"Shutdown server",callback:()=>{confirm("Are you sure you want to shut down the server ?")&&n.sendShutdown()}}]}],u=()=>n.disconnect(),p=g=>b=>{b.stopPropagation(),b.preventDefault();const D=o.getWindow(g.id);D&&(o.restore(D),o.raise(D),t({type:S.RaiseWindow,payload:D.attributes}))},l=()=>i(!s),m=()=>{i(!1)},A=()=>n.pollClipboard(),E=async()=>{(await Gt()).forEach(({buffer:b,name:D,size:B,type:W})=>n.sendFile(D,W,B,b))};return c.createElement(we,{classNames:["top-1","left-1/2","-translate-x-1/2","p-1","select-none"]},c.createElement("div",{className:"flex space-x-4 px-2"},c.createElement("div",{className:"flex space-x-1"},e.menu.length>0&&c.createElement(_,{transparent:!0,onClick:l},c.createElement("i",{className:"fa fa-bars pointer-events-none"}),c.createElement(F,{toggled:s},c.createElement(Je,{items:d,onCallback:m}))),c.createElement(_,{transparent:!0,onClick:u},c.createElement("i",{className:"fa fa-unlink"})),e.options.clipboard&&c.createElement(_,{transparent:!0,onClick:A},c.createElement("i",{className:"fa fa-clipboard"})),e.options.fileTransfer&&c.createElement(_,{transparent:!0,onClick:E},c.createElement("i",{className:"fa fa-upload"}))),r.length>0&&c.createElement("div",{className:"flex space-x-1"},r.map(g=>c.createElement(_,{key:g.id,transparent:!0,onClick:p(g)},c.createElement("div",{className:"flex space-x-1 items-center",style:{maxWidth:"128px"}},c.createElement("div",{className:"w-4 h-4"},c.createElement(Ze,{win:g})),c.createElement("div",{className:"truncate text-center text-sm"},g.title))))),a.length>0&&c.createElement("div",{className:"flex space-x-1"},a.map(g=>c.createElement("div",{key:g.id,className:"flex space-x-1 items-center"},c.createElement("div",{className:"flex items-center justify-center w-4 h-4 overflow-hidden",title:g.title},c.createElement(me,{id:g.id})))))))},Un=()=>{const{state:o,xpra:e}=y.exports.useContext(T),t=()=>e.disconnect();return c.createElement(we,{classNames:["p-8","top-1/2","left-1/2 transform","-translate-x-1/2","-translate-y-1/2","w-96"]},c.createElement("div",{className:"space-y-4"},c.createElement("div",{className:"text-center"},"Connecting to ",o.host),c.createElement("div",null,c.createElement(_,{onClick:t},"Cancel"))))};function Tn(){const{state:o}=y.exports.useContext(T);return c.createElement(c.Fragment,null,c.createElement(F,{toggled:!o.connected},c.createElement(On,null)),c.createElement(F,{toggled:!o.started&&o.connected},c.createElement(Un,null)),c.createElement(Wn,null,o.connected&&c.createElement(Bn,null)),c.createElement(F,{toggled:o.started},c.createElement(Pn,null)))}function Ln({xpra:o,wm:e}){return c.createElement(Cn,{wm:e,xpra:o},c.createElement(Tn,null))}function _n(){return new Worker("assets/webworker.36812d10.js",{type:"module"})}async function zn(){const o=document.querySelector("#app"),e=new _n,t=new mn(e),n=new gn(t);await t.init(),o&&it.render(y.exports.createElement(Ln,{xpra:t,wm:n}),o),window.xpra={xpra:t}}window.addEventListener("DOMContentLoaded",()=>{zn()});
//# sourceMappingURL=index.c217473f.js.map
