var et=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var re=(o,e,t)=>e in o?et(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,w=(o,e)=>{for(var t in e||(e={}))we.call(e,t)&&re(o,t,e[t]);if(ne)for(var t of ne(e))ge.call(e,t)&&re(o,t,e[t]);return o},M=(o,e)=>tt(o,nt(e));var ae=(o,e)=>{var t={};for(var n in o)we.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&ne)for(var n of ne(o))e.indexOf(n)<0&&ge.call(o,n)&&(t[n]=o[n]);return t};var f=(o,e,t)=>(re(o,typeof e!="symbol"?e+"":e,t),t);import{E as $,l as Pe,r as A,d as le,R as a,C as ot,a as st}from"./vendor.bc96ecdf.js";import{g as it,a as rt,b as at,P as ct,c as dt,d as lt,e as ut,f as pt,C as ht,L as mt,h as ft,i as wt,r as gt,j as At,J as ce}from"./lib.34b3f480.js";const yt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};yt();/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */var Y=(o=>(o[o.ERROR=40]="ERROR",o[o.WARNING=30]="WARNING",o[o.INFO=20]="INFO",o[o.DEBUG=10]="DEBUG",o))(Y||{});/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const bt="5.0",vt="1237",Et=0,St="master",Ct=250,kt=["pointer-position","button-action","key-action","desktop_size"],Ue=["jpeg","png","png/P","png/L","rgb","rgb32","rgb24","scroll","webp","void","avif"],xt=["RGBX","RGBA","RGB"],Rt={rec2020:"rec2020",p3:"P3",srgb:"srgb"},Mt={Win:["win32","Microsoft Windows"],Mac:["darwin","Mac OSX"],Linux:["linux","Linux"],X11:["posix","Posix"]},Ae=["UTF8_STRING","TEXT","STRING","text/plain"],It={us:"English USA",gb:"United Kingdom",fr:"France",de:"Germany",es:"Spain",ad:"Andorra",af:"Afghanistan",al:"Albania",ara:"Arabic",am:"Armenia",az:"Azerbaijan",bd:"Bangladesh",by:"Belarus",be:"Belgium",bt:"Bhutan",ba:"Bosnia",br:"Brazil",bg:"Bulgaria",kh:"Cambodia",ca:"Canada",cn:"China",cd:"Congo,",hr:"Croatia",cz:"Czechia",dk:"Denmark",epo:"Esperanto",ee:"Estonia",et:"Ethiopia",ir:"Iran",iq:"Iraq",fo:"Faroe",fi:"Finland",ge:"Georgia",gh:"Ghana",gr:"Greece",gn:"Guinea",hu:"Hungary",is:"Iceland",in:"India",ie:"Ireland",il:"Israel",it:"Italy",jp:"Japan",kz:"Kazakhstan",kr:"Korea,",kg:"Kyrgyzstan",latam:"Latin",lv:"Latvia",la:"Laos",lt:"Lithuania",mao:"Maori",mk:"Macedonia",mv:"Maldives",ml:"Mali",mt:"Malta",mn:"Mongolia",me:"Montenegro",ma:"Morocco",mm:"Myanmar",np:"Nepal",nl:"Netherlands",ng:"Nigeria",no:"Norway",pk:"Pakistan",pl:"Poland",pt:"Portugal",ro:"Romania",ru:"Russia",sn:"Senegal",rs:"Serbia",sk:"Slovakia",si:"Slovenia",za:"South Africa",lk:"Sri Lanka",se:"Sweden",ch:"Switzerland",sy:"Syria",tw:"Taiwan",tj:"Tajikistan",tz:"Tanzania",th:"Thailand",tr:"Turkey",tm:"Turkmenistan",ua:"Ukraine",uz:"Uzbekistan",vn:"Vietnam"},ye={1e3:"Normal Closure",1001:"Going Away",1002:"Protocol Error",1003:"Unsupported Data",1004:"(For future)",1005:"No Status Received",1006:"Abnormal Closure",1007:"Invalid frame payload data",1008:"Policy Violation",1009:"Message too big",1010:"Missing Extension",1011:"Internal Error",1012:"Service Restart",1013:"Try Again Later",1014:"Bad Gateway",1015:"TLS Handshake"};/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */class Te extends TypeError{}class oe extends Error{}class Wt extends Error{}class Le extends Error{}class q extends Error{}class be extends Error{}class Nt extends Error{}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */function ve(o){if(o instanceof CloseEvent){const{code:e,reason:t}=o,n=ye[e]?`'${ye[e]}' (${e})`:String(e),s=t?`: '${t}'`:"";return new oe(n+s)}return new oe("unknown error")}class Dt extends ${constructor(){super(...arguments);f(this,"ws",null);f(this,"connectionStatus","disconnected");f(this,"reconnectTimeout",0);f(this,"reconnectAttempt",0);f(this,"maxReconnectAttempts",3);f(this,"reconnectIntervalTime",5*1e3);f(this,"host","")}send(e){this.ws&&this.ws.send(e)}connect(e,t){const n=this.connectionStatus==="reconnecting",s=new WebSocket(e,"binary");console.info("Connecting websocket",e,this.connectionStatus),s.binaryType="arraybuffer",s.onopen=()=>{console.info("Opened websocket"),this.connectionStatus="connected",this.emit("open")},s.onclose=i=>{console.info("Closed websocket"),this.connectionStatus="disconnected",this.emit("close",ve(i))},s.onerror=i=>{this.emit("error",ve(i))},s.onmessage=i=>{const r=new Uint8Array(i.data);this.emit("message",r)},n||(this.reconnectAttempt=0),t&&(this.maxReconnectAttempts=t.reconnectAttempts,this.reconnectIntervalTime=t.reconnectInterval),this.ws=s,this.host=e,this.clearTimers(),this.emit("connect",this.connectionStatus)}disconnect(e=!1){e&&this.connectionStatus==="reconnecting"||(console.info("Disconnect websocket"),this.clearTimers(),this.connectionStatus=e?"reconnecting":"disconnected",this.ws&&(this.ws.onopen=null,this.ws.onclose=null,this.ws.onerror=null,this.ws.onmessage=null,this.ws.close()),this.ws=null,e&&(this.reconnectAttempt>=this.maxReconnectAttempts?this.disconnect(!1):(this.reconnectAttempt++,this.reconnectTimeout=setTimeout(()=>this.connect(this.host),this.reconnectIntervalTime))),this.emit("disconnect",this.connectionStatus))}clearTimers(){clearTimeout(this.reconnectTimeout)}get connected(){return!!this.ws}get status(){return this.connectionStatus}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */function Ot(o){let e="";if(o.subarray)for(let n=0,s=o.length;n<s;n+=10400)e+=String.fromCharCode.apply(null,o.subarray(n,Math.min(n+10400,s)));else for(let n=0,s=o.length;n<s;n+=10400)e+=String.fromCharCode.apply(null,o.slice(n,Math.min(n+10400,s)));return window.btoa(e)}function Ee(o){const t=[];for(let n=0;n<o.length;n+=32768)t.push(String.fromCharCode.apply(null,o.subarray(n,n+32768)));return t.join("")}function _e(o){const e=new Uint8Array(o.length);for(let t=0;t<o.length;++t)e[t]=o.charCodeAt(t);return e}function ze(){const o=[],e="0123456789abcdef";for(let t=0;t<36;t++)t==8||t==13||t==18||t==23?o[t]="-":o[t]=e.substr(Math.floor(Math.random()*16),1);return o.join("")}function ue(o){const e=window.crypto||window.mscrypto;if(!e){let n="";for(;n.length<o;)n+=ze();return n.substr(0,o)}const t=new Uint8Array(o);return e.getRandomValues(t),String.fromCharCode.apply(null,t)}function Bt(o,e){let t="";if(o.length!==e.length)throw new TypeError("strings must be equal length");for(let n=0;n<o.length;n++)t+=String.fromCharCode(o[n].charCodeAt(0)^e[n].charCodeAt(0));return t}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const J=window.AV,Pt=!!ut(),Ut=typeof J!="undefined"&&J!=null&&J.Decoder!=null&&J.Player.fromXpraSource!=null;class Xe{constructor(e,t){f(this,"audio");f(this,"audioCodec");f(this,"audioBuffer",[]);f(this,"audioBufferCount",0);this.audio=e,this.audioCodec=t}async setup(){console.warn("XpraAudioAdapter#setup","unhandled event")}async start(){console.warn("XpraAudioAdapter#start","unhandled event")}stop(){this.audio.pause(),this.audioBuffer=[],this.audioBufferCount=0,this.audio.src=""}addQueue(e,t){let n=4;if(this.audioBuffer.length>=Ct)throw new Le("Buffer queue overflow");if(t){for(let s=0;s<t.length;s++)this.audioBuffer.push(_e(t[s]));n=1}this.audioBuffer.push(e),this.processQueue(n)}pushBuffer(e){console.warn("XpraAudioAdapter#pushBuffer","unhandled event")}processQueue(e){if(this.isReady()&&(this.audioBufferCount>0||this.audioBuffer.length>=e)){{let t;if(this.audioBuffer.length==1)t=this.audioBuffer[0];else{let n=0;for(let s=0,i=this.audioBuffer.length;s<i;++s)n+=this.audioBuffer[s].length;t=new Uint8Array(n),n=0;for(let s=0,i=this.audioBuffer.length;s<i;++s){const r=this.audioBuffer[s];r.length>0&&(t.set(r,n),n+=r.length)}}this.audioBufferCount+=1,this.pushBuffer(t)}this.audioBuffer=[]}}isReady(){return!1}}class Tt extends Xe{constructor(){super(...arguments);f(this,"mediaSource",null);f(this,"mediaSourceReady",!1);f(this,"mediaSourceBuffer",null)}async setup(){const e=pt(),t=()=>new Promise((n,s)=>{e.addEventListener("sourceopen",()=>{if(console.debug("XpraAudio -> MediaSource","Source opened"),this.mediaSourceReady)s(new Le("MediaSource already open"));else{const i=ht[this.audioCodec];if(i)try{const r=e.addSourceBuffer(i);r.mode="sequence",r.addEventListener("error",c=>{console.error("XpraAudio -> MediaSource -> SourceBuffer",c)}),n(r)}catch(r){s(r)}else s(new Wt(`Media codec '${this.audioCodec}' unsupported`))}})});this.mediaSource=e,this.audio.src=window.URL.createObjectURL(this.mediaSource),this.mediaSourceBuffer=await t(),this.mediaSourceReady=!0}async start(){try{await this.audio.play()}catch(e){console.error("XpraAudio#start","audio start error",e)}}stop(){if(super.stop(),this.mediaSource)try{this.mediaSourceBuffer&&this.mediaSource.removeSourceBuffer(this.mediaSourceBuffer),this.mediaSource.readyState==="open"&&this.mediaSource.endOfStream()}catch(e){console.error("XpraMediaSourceAdapter",e)}this.mediaSource=null,this.mediaSourceBuffer=null,this.mediaSourceReady=!1}pushBuffer(e){this.mediaSourceBuffer&&this.mediaSourceBuffer.appendBuffer(e)}isReady(){return!!this.mediaSourceBuffer&&!this.mediaSourceBuffer.updating}}class Lt extends Xe{constructor(){super(...arguments);f(this,"auroraSource",null)}async setup(){this.auroraSource=J.Player.fromXpraSource()}async start(){this.auroraSource&&this.auroraSource.play()}stop(){var e;if(super.stop(),(e=this.auroraSource)!=null&&e.context)try{this.auroraSource.context.close()}catch(t){console.error("XpraAuroraAdapter",t)}this.auroraSource=null}pushBuffer(e){this.auroraSource&&this.auroraSource.asset.source._on_data(e)}isReady(){return!!this.auroraSource}}class _t extends ${constructor(){super();f(this,"audio",document.createElement("audio"));f(this,"enabled",!1);f(this,"adapter",null);f(this,"defaultCodec",null);f(this,"audioCodec",null);f(this,"audioFramework",null);f(this,"auroraCodecs",Ut?it():{});f(this,"mediaCodecs",Pt?rt():{});f(this,"detectedCodecs",w(w({},this.mediaCodecs),this.auroraCodecs));Object.values(this.detectedCodecs).length>0&&(this.defaultCodec=at(this.detectedCodecs)),console.debug("XpraAudio#constructor",this)}async init(){this.audio.setAttribute("autoplay",String(!0)),this.audio.addEventListener("play",()=>{console.info("XpraAudio -> <audio>","playing")}),this.audio.addEventListener("error",e=>{console.error("XpraAudio -> <audio>",e),this.stop()})}validate(e){return e!==this.audioCodec?(console.error("XpraAudio#validate","invalid codec",e),this.stop(),!1):!0}stop(){this.adapter&&this.adapter.stop(),this.enabled=!1,this.adapter=null,this.emit("stop")}async setup(e){if(e["sound.send"]){const t=e["sound.encoders"];if(this.defaultCodec){const n=ct.find(s=>!!(s in this.detectedCodecs&&t.includes(s)))||this.defaultCodec;n&&(this.enabled=!0,this.audioCodec=n,this.audioFramework=this.auroraCodecs[n]?"aurora":"mediasource")}}if(this.enabled){const t=dt(this.audioFramework==="mediasource",this.audioFramework==="aurora",!1),n=lt(t);if(n){const[s,i]=n.split(":");this.audioFramework=s,this.audioCodec=i}this.audioCodec&&(this.audioFramework==="mediasource"?this.adapter=new Tt(this.audio,this.audioCodec):this.audioFramework==="aurora"&&(this.adapter=new Lt(this.audio,this.audioCodec)));try{this.adapter&&(await this.adapter.setup(),this.emit("start"))}catch(s){console.error("XpraAudio#setup",s),this.stop()}}}async start(){this.adapter?this.adapter.start():this.stop()}addQueue(e,t){this.adapter&&this.adapter.addQueue(e,t)}getDecoders(){return Object.keys(this.detectedCodecs)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const zt=["unknown",["unknown","unknown"]];function me(){const o=mt;function e(){const n=["language","browserLanguage","systemLanguage","userLanguage"].find(s=>typeof navigator[s]=="string");return navigator.languages?navigator.languages:n?[n]:["us"]}return e().map(t=>{const[n]=t.split(/-|_/);return o[t]||o[n]||t})}function Xt(){const[o]=me(),e=navigator.userAgent,t=!!navigator.vendor.match(/apple/i)&&!e.match(/crios/i)&&!e.match(/fxios/i)&&!e.match(/Opera|OPT\//),n=[["MSIE",e.includes("MSIE")||e.includes("Trident/")],["Firefox","firefox"],["Opera","opera"],["Safari",t],["Chrome","chrome"]],[s]=n.find(([,i])=>typeof i=="boolean"?i:e.toLowerCase().includes(i))||["",""];return{agent:navigator.userAgent,name:s,layout:o}}function Ft(){const{appVersion:o,oscpu:e,cpuClass:t}=navigator,n=Object.entries(Mt).find(([r])=>o==null?void 0:o.includes(r)),[,[s,i]]=n||zt;return{type:s,name:i,platform:o,processor:e||t||"unknown"}}function Fe(){const o=t=>typeof t=="number"&&t>0&&isFinite(t)?Math.round(t*1e3*1e3):t,e={type:"unknown",downlink:-1,downlinkMax:-1,effectiveType:"4g",rtt:0};if("connection"in navigator){const t=Object.keys(e).filter(n=>n in navigator.connection).map(n=>[n,navigator.connection[n]]);Object.assign(e,Object.fromEntries(t))}return M(w({},e),{downlink:o(e.downlink),downlinkMax:o(e.downlinkMax)})}const Gt=()=>navigator.clipboard&&!!navigator.clipboard.readText&&!!navigator.clipboard.writeText;async function Yt(){const o=document.createElement("input");o.type="file";const e=t=>new Promise((n,s)=>{const i=new FileReader;i.onload=()=>{n(i.result)},i.onerror=r=>{s(r)},i.readAsArrayBuffer(t)});return new Promise((t,n)=>{o.onchange=async()=>{try{if(o.files){const s=Array.from(o.files).map(r=>e(r).then(c=>({buffer:c,name:r.name,size:r.size,type:r.type}))),i=await Promise.all(s);t(i)}else t([])}catch(s){n(s)}},o.click()})}function Ge(o,e){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,o);else{const t=e instanceof Blob?window.URL.createObjectURL(e):e;try{const n=document.createElement("a");n.href=t,n.download=o,n.click()}finally{window.URL.revokeObjectURL(t)}}}function Qt(o,e){const t=URL.createObjectURL(e);try{const n=window.open(t);!n||n.closed||n.closed!==void 0?Ge(o,t):n.print()}finally{window.URL.revokeObjectURL(t)}}async function Se(o){if(navigator.clipboard.read){const t=s=>new Promise((i,r)=>{const c=new FileReader;c.onload=()=>{i(c.result)},c.onerror=d=>{r(d)},c.readAsText(s)}),n=await navigator.clipboard.read();for(let s=0;s<n.length;s++){const i=n[s];for(let r=0;r<i.types.length;r++){const c=i.types[r],d=await i.getType(c),l=await t(d);if(c==="text/plain")return[o,l];if(c==="image/png")return[c,l]}}}const e=await navigator.clipboard.readText();return[o,e]}async function Ce(o,e){if(e){if(navigator.clipboard.write){const t=new Blob([o],{type:e}),s=[new ClipboardItem({[e]:t})];return await navigator.clipboard.write(s),!0}}else return await navigator.clipboard.writeText(o),!0;return!1}async function Vt(o,e){if(!("Notification"in window))throw new Error("Notifications are not supported in this browser");return Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"?new Notification(o,e):null}function Kt(){if(window.matchMedia){const o=Object.entries(Rt).find(([e])=>window.matchMedia(`(color-gamut: ${e})`));if(o)return o[1]}return""}const Ye=(()=>{let o=96;if(typeof window!="undefined")if("deviceXDPI"in screen)o=(screen.systemXDPI+screen.systemYDPI)/2;else{const e=document.createElement("div");e.style.width="1in",e.style.height="1in",e.style.left="-100%",e.style.top="-100%",e.style.position="absolute",document.body.appendChild(e);const{offsetWidth:t,offsetHeight:n}=e;e.remove(),t>0&&n>0&&(o=Math.round((t+n)/2))}return()=>o})(),ke=o=>unescape(encodeURIComponent(o));function Qe(o,e,t){const{search:n}=window.location,s=new URLSearchParams(n),i=Array.from(s).map(([r,c])=>o.includes(r)?[r,["1","true","on"].includes(String(c).toLowerCase())]:e.includes(r)?[r,parseInt(c)]:[r,c||void 0]);return Object.fromEntries(i.filter(([r,c])=>t.includes(r)&&c!==void 0))}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class jt extends ${constructor(){super(...arguments);f(this,"altgrState",!1);f(this,"keyboardKayout","us");f(this,"swapKeys",!1);f(this,"modifiers",{numlock:null,alt:null,ctrl:null,meta:null,altgr:null})}configure(e,t){this.keyboardKayout=e.keyboardLayout,this.swapKeys=e.swapKeys;const n=t.modifier_keycodes;let s=null,i=null,r=null,c=null,d=null;if(n){for(const l in n){const u=n[l];for(let h=0;h<u.length;h++){const m=u[h];for(let g=0;g<m.length;g++)m[g]=="Alt_L"?i=l:m[g]=="Meta_L"?c=l:m[g]=="ISO_Level3_Shift"||m[g]=="Mode_switch"?d=l:m[g]=="Control_L"?r=l:m[g]==="Num_Lock"&&(s=l)}}this.swapKeys&&([c,r]=[r,c])}Object.assign(this.modifiers,{numlock:s,alt:i,ctrl:r,meta:c,altgr:d})}getKey(e){return ft(e)}getModifiers(e){const t=wt(e),n=t.slice();let s=t.indexOf("meta");return s>=0&&this.modifiers.meta&&(n[s]=this.modifiers.meta),s=t.indexOf("control"),s>=0&&this.modifiers.ctrl&&(n[s]=this.modifiers.ctrl),s=t.indexOf("alt"),s>=0&&this.modifiers.alt&&(n[s]=this.modifiers.alt),s=t.indexOf("numlock"),s>=0&&(this.modifiers.numlock?n[s]=this.modifiers.numlock:n.splice(s,1)),s=t.indexOf("capslock"),s>=0&&(n[s]="lock"),this.altgrState&&this.modifiers.altgr&&!n.includes(this.modifiers.altgr)&&(n.push(this.modifiers.altgr),s=n.indexOf(this.modifiers.altgr),s>=0&&n.splice(s,1),s=n.indexOf(this.modifiers.ctrl),s>=0&&n.splice(s,1)),n}onKeyPress(e,t){const[n]=me();this.keyboardKayout!==n&&this.emit("layoutChanged",n),e==="AltGraph"&&(this.altgrState=t)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class Zt{getButton(e){let t=0;return"which"in e?t=Math.max(0,e.which):"button"in e&&(t=Math.max(0,e.button)+1),t}getPosition(e){return[e.clientX,e.clientY]}getScroll(e){const t=e,n=s=>s>1?1:s<0?-1:0;return typeof t.deltaX=="number"?[n(t.deltaX),n(t.deltaY)]:typeof t.wheelDelta=="number"?[0,t.wheelDelta/120]:typeof t.wheelDeltaX=="number"?[t.wheelDeltaX/120,t.wheelDeltaY/120]:[0,0]}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const Ht=["log","info","warn","error","debug"],qt={log:Y.INFO,info:Y.INFO,warn:Y.WARNING,error:Y.ERROR,debug:Y.DEBUG};function Jt(o){const e=Ht.map(t=>[t,(...n)=>{const s=console[t],i=qt[t];s.apply(s,["-->",...n]),o(i,n)}]);return Object.fromEntries(e)}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const[$t]=me(),se={reconnect:!0,connectionTimeout:3e4,reconnectInterval:5e3,reconnectAttempts:3,bandWidthLimit:0,startNewSession:null,shareSession:!1,stealSession:!1,username:"",display:"",password:"",showStartMenu:!0,fileTransfer:!0,clipboardImages:!1,clipboardDirection:"both",clipboard:!0,printing:!1,bell:!0,audio:!0,video:!1,nativeVideo:!1,cursor:!0,keyboard:!0,mouse:!0,tray:!0,notifications:!0,ssl:!1,encryption:null,encryptionKey:null,encoder:"auto",openUrl:!0,swapKeys:!1,keyboardLayout:$t,exitWithChildren:!1,exitWithClient:!1,startCommand:"",reverseScrollX:!1,reverseScrollY:!1},en=["reconnect","showStartMenu","clipboardImages","clipboard","shareSession","stealSession","fileTransfer","printing","bell","audio","cursor","keyboard","mouse","tray","notifications","ssl","openUrl","video","nativeVideo","swapKeys","exitWithChildren","exitWithClient","reverseScrollX","reverseScrollY"],tn=["bandWidthLimit","connectionTimeout","reconnectAttempts","reconnectInterval"],nn=()=>Qe(en,tn,Object.keys(se));/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */function xe(o,e,t){if(o.startsWith("hmac")){let n="md5";o.indexOf("+")>0&&(n=o.split("+")[1]);const s=Pe.hmac.create();return s.start(n,e),s.update(t),s.digest().toHex()}else if(o=="xor"){const n=t.slice(0,e.length);return Bt(n,e)}return null}function on(o,e,t,n,s,i){if(!n)throw new q("Invalid login");if(t==="xor"){if(e==="xor"&&!s&&!i)throw new q("Aborted challenge because xor is not safe in this environment");if(o.length<16||o.length>256)throw new q(`Invalid challenge xor salt length: ${o.length}`)}const r=t==="xor"?o.length:32,c=ue(r),d=xe(t,c,o);let l=null;if(d&&(l=xe(e,n,d)),!l)throw new q("Could not challenge server auth attempt");return[l,c]}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */class sn extends ${constructor(e){super();f(this,"worker");this.worker=e}async init(){this.worker.addEventListener("message",e=>{const[t,n]=e.data;this.recieve(t,n)}),this.worker.addEventListener("error",e=>{this.emit("failure",e)})}send(e,t){this.worker.postMessage([e,t])}recieve(e,t){switch(e){case"send":this.emit("send",t);break;case"recieve":this.emit("recieve",t);break;case"failure":const[n,s]=t,i=new Nt(`${n} | ${s}`);this.emit("failure",i)}}configure(e){this.send("configure",e)}setConnected(e){this.send("connected",e)}pushSend(e){this.send("send",e)}pushRecieve(e){this.send("recieve",e)}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const rn=o=>new Promise(e=>{const t=new Image;t.onload=()=>{t.width&&t.height?e(t):e(null)},t.onerror=()=>{e(null)},t.src=o});function Q(o,e){const t=typeof e=="string"?_e(e):e,n=Ot(t);return`data:image/${o==="svg"?"image/svg+xml":o};base64,${n}`}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const an=()=>{const o=Object.keys(Pe.md.algorithms).map(e=>`hmac+${e}`);return["hmac","hmac+md5","xor",...o]},cn=o=>o?[...Ae,"image/png"]:Ae;function dn({startNewSession:o,exitWithChildren:e,exitWithClient:t,startCommand:n}){return o?{mode:o,"exit-with-children":e,"exit-with-client":t,[e?"start-child":"start"]:t?[n]:[]}:{}}function Ve(o,e){const t=Ye(),n=Math.round(o*25.4/t),s=Math.round(e*25.4/t);return[["HTML",o,e,n,s,[["Canvas",0,0,o,e,n,s]],0,0,o,e]]}function Re(o={},e=!0){const t=[window.innerWidth,window.innerHeight],n=an(),s=Ft(),i=Xt(),r=Gt()?["CLIPBOARD"]:["CLIPBOARD","PRIMARY"],c=gt(),d=Ue,l=w({version:bt,"build.revision":vt,"build.local_modifications":Et,"build.branch":St,platform:s.type,"platform.name":s.name,"platform.processor":s.processor,"platform.platform":s.platform,"session-type":i.name,"session-type.full":i.agent,namespace:!0,"clipboard.contents-slice-fix":!0,client_type:"HTML5","websocket.multi-packet":!0,"setting-change":!0,uuid:ze(),argv:[window.location.href],digest:n,"salt-digest":n,zlib:!0,compression_level:1,"file-transfer":!1,printing:!1,share:!1,steal:!1,username:"",display:"","mouse.show":!0,rencode:c,rencodeplus:c,bencode:!0,yaml:!1,"open-url":!0,"ping-echo-sourceid":!0,vrefresh:-1,"xdg-menu-update":!0,"bandwidth-limit":0,"connection-data":Fe(),lz4:!0,"encoding.rgb_lz4":!0,brotli:!0,"clipboard.preferred-targets":[],"start-new-session":void 0,auto_refresh_delay:500,randr_notify:!0,"sound.server_driven":!0,"server-window-resize":!0,"screen-resize-bigger":!1,"metadata.supported":["fullscreen","maximized","iconic","above","below","title","size-hints","class-instance","transient-for","window-type","has-alpha","decorations","override-redirect","tray","modal","opacity"],encoding:"auto",encodings:d,"encoding.icons.max_size":[30,30],"encodings.core":d,"encodings.rgb_formats":xt,"encodings.window-icon":["png"],"encodings.cursor":["png"],"encoding.flush":!0,"encoding.transparency":!0,"encoding.scrolling":d.includes("scroll"),"encoding.decoder-speed":{video:0},"encodings.packet":!0,"encoding.color-gamut":Kt(),"encoding.video_scaling":!0,"encoding.video_max_size":[1024,768],"encoding.eos":!0,"encoding.full_csc_modes":{mpeg1:["YUV420P"],h264:["YUV420P"],"mpeg4+mp4":["YUV420P"],"h264+mp4":["YUV420P"],"vp8+webm":["YUV420P"],webp:["BGRX","BGRA"],jpeg:["BGRX","BGRA","BGR","RGBX","RGBA","RGB","YUV420P","YUV422P","YUV444P"]},"encoding.x264.YUV420P.profile":"baseline","encoding.h264.YUV420P.profile":"baseline","encoding.h264.YUV420P.level":"2.1","encoding.h264.cabac":!1,"encoding.h264.deblocking-filter":!1,"encoding.h264.fast-decode":!0,"encoding.h264+mp4.YUV420P.profile":"baseline","encoding.h264+mp4.YUV420P.level":"3.0","encoding.h264.score-delta":-20,"encoding.h264+mp4.score-delta":50,"encoding.h264+mp4.":50,"encoding.mpeg4+mp4.score-delta":40,"encoding.vp8+webm.score-delta":40,"sound.receive":!0,"sound.send":!1,"sound.decoders":[],"sound.bundle-metadata":!0,"encoding.rgb_zlib":!0,windows:!0,"window.pre-map":!0,keyboard:!0,xkbmap_layout:i.layout,xkbmap_keycodes:At(),xkbmap_print:"",xkbmap_query:"",desktop_size:t,desktop_mode_size:t,screen_sizes:Ve(t[0],t[1]),dpi:Ye(),clipboard:!0,"clipboard.want_targets":!0,"clipboard.greedy":!0,"clipboard.selections":r,notifications:!0,"notifications.close":!0,"notifications.actions":!0,cursors:!0,bell:!0,system_tray:!0,named_cursors:!1,"file-size-limit":10,flush:!0,cipher:void 0,"cipher.mode":void 0,"cipher.iv":void 0,"cipher.key_salt":void 0,"cipher.key_size":void 0,"cipher.key_hash":void 0,"cipher.key_stretch_iterations":void 0,"cipher.padding.options":void 0},o);return e&&Object.entries(l).forEach(([u,h])=>{if(h===null)throw new Te(`Invalid value ('${h}') for capability '${u}'`)}),Object.fromEntries(Object.entries(l).filter(([,u])=>u!==void 0))}function ln(o){const e=[window.innerWidth,window.innerHeight],t=dn(o),n={"clipboard.preferred-targets":cn(o.clipboardImages),"bandwidth-limit":o.bandWidthLimit,"xdg-menu-update":o.showStartMenu,"start-new-session":t,share:o.shareSession,steal:o.stealSession,username:o.username,display:o.display,"file-transfer":o.fileTransfer,"open-url":o.openUrl,printing:o.printing,clipboard:o.clipboard,desktop_size:e,desktop_mode_size:e,cursors:o.cursor,bell:o.bell,system_tray:o.tray,notifications:o.notifications,xkbmap_layout:o.keyboardLayout,encoding:o.encoder};if(o.encryption){const[s,i]=o.encryption.split("-");if(s!=="AES")throw new Te(`Invalid encryption: ${s} (${i})`);Object.assign(n,{cipher:s,"cipher.mode":i,"cipher.iv":ue(16),"cipher.key_salt":ue(32),"cipher.key_size":32,"cipher.key_hash":"SHA1","cipher.key_stretch_iterations":1e3,"cipher.padding.options":["PKCS#7"]})}if(o.video){const s=[...Ue,"h264"];ce&&ce.Renderer&&ce.Decoder&&s.push("mpeg1"),o.nativeVideo&&s.push("vp8+webm","h264+mp4","mpeg4+mp4"),Object.assign(n,{encodings:s,"encodings.core":s})}return n}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * @copyright Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * @license Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * @link https://github.com/Xpra-org/xpra-html5
 */const Ke={lastServerPing:0,lastClientEcho:0,clientPingLatency:0,serverPingLatency:0,serverLoad:[0,0,0]};class un extends ${constructor(e){super();f(this,"capabilities");f(this,"options",w({},se));f(this,"stats",w({},Ke));f(this,"serverCapabilities",null);f(this,"connectionCheckTimeout",0);f(this,"pingInterval",0);f(this,"inited",!1);f(this,"started",!1);f(this,"clipboardBuffer",{});f(this,"worker");f(this,"audio",new _t);f(this,"ws",new Dt);f(this,"keyboard",new jt);f(this,"mouse",new Zt);f(this,"logger",Jt((e,t)=>{this.sendLog(e,t)}));f(this,"processorBindings",{"new-window":this.processNewWindow,"window-icon":this.processWindowIcon,"startup-complete":this.processStartupComplete,"setting-change":this.processSettingChange,"window-move-resize":this.processWindowMoveResize,"window-resized":this.processWindowResized,"raise-window":this.processWindowRaise,"lost-window":this.processWindowLost,"window-metadata":this.processWindowMetadata,"new-override-redirect":this.processNewOverrideRedirect,"configure-override-redirect":this.processConfigureOverrideRedirect,"initiate-moveresize":this.processInitiateMoveResize,"send-file":this.processSendFile,"sound-data":this.processSoundData,"clipboard-token":this.processClipboardToken,"set-clipboard-enabled":this.processSetClipboardEnabled,"clipboard-request":this.processClipboardRequest,"info-response":this.processInfoResponse,"new-tray":this.processNewTray,"pointer-position":this.processPointerPosition,"open-url":this.processOpenUrl,notify_show:this.processShowNotification,notify_close:this.processCloseNotification,encodings:this.processEncodings,cursor:this.processCursor,hello:this.processHello,ping:this.processPing,ping_echo:this.processPingEcho,draw:this.processDraw,bell:this.processBell,challenge:this.processChallenge,eos:this.processEos,disconnect:this.processDisconnect});this.worker=new sn(e),this.capabilities=Re({"sound.decoders":this.audio.getDecoders()},!1)}async init(){this.inited||(await this.worker.init(),await this.audio.init(),this.ws.on("open",()=>this.handshake()),this.ws.on("error",e=>this.disconnect(e)),this.ws.on("close",e=>this.disconnect(e)),this.ws.on("connect",e=>this.emit("connect",e)),this.ws.on("disconnect",e=>this.emit("disconnect",e)),this.ws.on("message",e=>this.worker.pushRecieve(e)),this.worker.on("recieve",e=>this.recieve(e)),this.worker.on("send",e=>this.ws.send(e)),this.worker.on("failure",e=>this.disconnect(e)),this.audio.on("start",()=>this.sendSoundStart()),this.audio.on("stop",()=>this.sendSoundStop()),this.keyboard.on("layoutChanged",e=>this.sendLayoutChanged(e)),"connection"in navigator&&navigator.connection.addEventListener("change",()=>{this.ws.connected&&this.sendConnectionData()}),this.inited=!0)}connect(e,t={}){if(!this.inited)throw new oe("Xpra instance not initialized");this.options=w(w({},se),t);try{this.worker.configure(this.options),this.worker.setConnected(!0),this.ws.connect(e,this.options)}catch(n){this.emit("error",n.message)}}disconnect(e){e&&console.error("XpraConnection#disconnect",e);const t=e instanceof q||e instanceof be,n=this.options.reconnect&&!t&&!!e;t&&this.emit("error",e.message),this.clearTimers(),this.audio.stop(),this.worker.setConnected(!1),this.serverCapabilities=null,this.clipboardBuffer={},this.ws.disconnect(n)}handshake(){this.started=!0,this.connectionCheckTimeout=setTimeout(()=>{this.disconnect(new oe("Not a valid xpra server?"))},this.options.connectionTimeout),this.createCapabilities(),this.sendHello()}async pollClipboard(){if(this.options.clipboardDirection==="to-server")return;const[,e]=await Se("UTF8_STRING"),t=ke(e);this.sendClipboardToken(t)}recieve(e){const[t,...n]=e;this.ws.connected&&(this.processorBindings[t]?this.processorBindings[t].apply(this,n):console.debug("Unhandled message",t,n))}send(e){if(this.ws.connected){if(this.isReadOnly()&&kt.includes(e[0]))return;const t=["hello","ping","ping_echo","logging"];if(!this.started&&!t.includes(e[0]))return;this.worker.pushSend(e)}}clearTimers(){clearTimeout(this.connectionCheckTimeout),clearInterval(this.pingInterval)}createCapabilities(e={}){this.capabilities=Re(w(w({},ln(this.options)),e))}getOptions(){return w({},this.options)}getCapabilities(){return w({},this.capabilities)}getServerCapabilities(){return this.serverCapabilities?w({},this.serverCapabilities):null}isReady(){return this.started}isReadOnly(){var e;return!!((e=this.serverCapabilities)!=null&&e.readonly)}sendResize(e,t){const n=Math.round(e),s=Math.round(t);this.send(["desktop_size",n,s,Ve(n,s)])}sendCloseWindow(e){this.send(["close-window",e])}sendMapWindow(e){const[t,n]=e.position,[s,i]=e.dimension;this.send(["map-window",e.id,Math.round(t),Math.round(n),Math.round(s),Math.round(i),e.clientProperties])}sendUnmapWindow(e){this.send(["unmap-window",e.id,!0])}sendGeometryWindow(e,t,n){const[s,i]=t,[r,c]=n;this.send(["configure-window",e,Math.round(s),Math.round(i),Math.round(r),Math.round(c),{}])}sendConfigureWindow(e,t,n,s,i,r){const[c,d]=t,[l,u]=n;this.send(["configure-window",e,Math.round(c),Math.round(d),Math.round(l),Math.round(u),s,0,i,r])}sendDamageSequence(e,t,n,s,i=""){s<0&&console.warn("XpraConnection#sendDamageSequence",s),this.send(["damage-sequence",e,t,...n,s,i])}sendMouseMove(e,t,n){const[s,i]=t,r=[];this.options.mouse&&this.send(["pointer-position",e,[Math.round(s),Math.round(i)],n,r])}sendMouseWheel(e,t,n,s){if(!this.options.mouse||!this.serverCapabilities)return;const[i,r]=t,c=!!this.serverCapabilities["wheel.precise"],d=this.options.reverseScrollX?-i:i,l=this.options.reverseScrollY?-r:r,u=[],h=d>0?6:7,m=l>0?5:4,g=d>0?h:m,S=100;c?this.send(["wheel-motion",e,g,S,n,s,u]):(this.send(["button-action",e,g,!0,n,s,u]),this.send(["button-action",e,g,!1,n,s,u]))}sendMouseButton(e,t,n,s,i){const r=[];this.options.mouse&&this.send(["button-action",e,n,s,t,i,r])}sendKeyAction(e,t,n,s,i,r,c,d){this.options.keyboard&&(this.keyboard.onKeyPress(r,n),this.send(["key-action",e,t,n,s,i,r,c,d]))}sendLayoutChanged(e){this.send(["layout-changed",e,""])}sendWindowRaise(e,t){this.send(["focus",e,[]]),t.forEach(n=>{this.sendConfigureWindow(n.id,n.position,n.dimension,n.clientProperties,{focused:n.id===e},!0)})}sendWindowClose(e){this.send(["close-window",e])}sendNotificationClose(e){this.send(["notification-close",e,2,""])}sendSuspend(e){this.send(["suspend",!0,e])}sendResume(e){this.send(["resume",!0,e]),this.sendBufferRefresh(-1)}sendBufferRefresh(e){this.send(["buffer-refresh",e,0,100,{"refresh-now":!0,batch:{reset:!0}},{}])}sendConnectionData(){const e=Fe();this.send(["connection-data",e])}sendSoundStart(){this.send(["sound-control","start"])}sendSoundStop(){this.send(["sound-control","stop"])}sendStartCommand(e,t,n){this.send(["start-command",e,t,n?"True":"False"])}sendFile(e,t,n,s){if(this.serverCapabilities){const i=this.options.encoder==="rencodeplus",r=!!this.serverCapabilities["open-files"],c=s instanceof ArrayBuffer?new Uint8Array(s):s,d=i?Ee(c):c;this.send(["send-file",e,t,!1,r,n,d,{}])}}sendShutdown(){this.send(["shutdown-server"])}sendClipboardToken(e){if(this.options.clipboard){const i=e?"UTF8_STRING":"",r=e?["UTF8_STRING","text/plain"]:[];this.send(["clipboard-token","CLIPBOARD",r,i,i,8,"bytes",e,!0,!0,!0])}}sendLog(e,...t){if(this.serverCapabilities&&this.serverCapabilities["remote-logging.multi-line"]){const n=t.map(s=>ke(String(s)));this.send(["logging",e,n])}}sendHello(){this.send(["hello",this.capabilities])}sendPing(){const e=Math.ceil(performance.now());this.send(["ping",e])}sendClipboard(e,t,n,s="UTF8_STRING",i=8,r="bytes"){n===""?this.send(["clipboard-contents-none",e,t]):this.send(["clipboard-contents",e,t,s,i,r,n])}sendClipboardString(e,t,n,s="UTF8_STRING"){this.sendClipboard(e,t,n,s)}processHello(e){clearTimeout(this.connectionCheckTimeout),this.serverCapabilities=e,this.emit("hello",this.serverCapabilities),this.keyboard.configure(this.options,e),this.options.audio&&this.audio.setup(this.serverCapabilities)}processNewWindow(e,t,n,s,i,r,c={}){const d=parseInt(t),l=parseInt(n),u=parseInt(s),h=parseInt(i);this.emit("newWindow",{id:e,position:[d,l],dimension:[u,h],overrideRedirect:!1,metadata:r,clientProperties:c})}processWindowIcon(e,t,n,s,i){const r=Q(s,i);this.emit("windowIcon",{wid:e,dimension:[t,n],image:r})}processStartupComplete(){this.started=!0,this.emit("sessionStarted"),this.sendPing(),this.pingInterval=setInterval(()=>this.sendPing(),5e3),this.logger.info("Connection from Xpra HTML client")}processEncodings(e){console.debug("XpraConnection#processEncodings",e)}processCursor(e,t,n,s,i,r,c,d,l){if(!!this.options.cursor){if(arguments.length<8)this.emit("cursor",null);else if(e==="png"){const u=Q(e,l);this.emit("cursor",{dimension:[s,i],image:u,xhot:r,yhot:c})}}}processPing(...e){const t=e.length>1?e[1]:e[0],n=e.length>=3?e[2]:"";this.stats.lastServerPing=t,this.send(["ping_echo",t,0,0,0,0,n||""])}processPingEcho(e,t,n,s,i){this.stats.lastClientEcho=e,this.stats.clientPingLatency=i,this.stats.serverPingLatency=Math.ceil(performance.now())-this.stats.lastClientEcho,this.stats.serverLoad=[t/1e3,n/1e3,s/1e3],this.emit("pong",w({},this.stats))}processDraw(e,t,n,s,i,r,c,d,l,u){const h=performance.now(),m=(g,S="")=>this.sendDamageSequence(d,e,[s,i],g,S);this.emit("draw",{wid:e,image:c,encoding:r,packetSequence:d,rowStride:l,options:u||{},position:[t,n],dimension:[s,i],callback:g=>{const S=Math.round(1e3*performance.now()-1e3*h);g&&console.warn("XpraConnection#processDraw -> callback",g),m(S,g==null?void 0:g.message)}})}processSettingChange(e,t){switch(e){case"xdg-menu":const n=Object.values(t).map(s=>({name:s.Name,icon:s.IconData&&s.IconType?Q(s.IconType,s.IconData):void 0,entries:Object.entries(s.Entries).map(l=>{var[i,u]=l,h=u,{IconType:r,IconData:c}=h,d=ae(h,["IconType","IconData"]);return{name:i,exec:d.Exec.replace(/%[uUfF]/g,""),icon:c&&r?Q(r,c):void 0,attributes:d}})}));this.emit("updateXDGMenu",n);break;default:console.debug("XpraConnection#processSettingChange","uncaught",e,t);break}}processWindowMoveResize(e,t,n,s,i){this.emit("moveResizeWindow",{wid:e,position:[t,n],dimension:[s,i]})}processWindowResized(e,t,n){this.emit("moveResizeWindow",{wid:e,dimension:[t,n]})}processWindowRaise(e){this.emit("raiseWindow",e)}processWindowLost(e){this.emit("removeWindow",e)}processWindowMetadata(e,t){this.emit("updateWindowMetadata",{wid:e,metadata:t})}processNewOverrideRedirect(e,t,n,s,i,r,c={}){this.emit("newWindow",{id:e,position:[t,n],dimension:[s,i],overrideRedirect:!0,metadata:r,clientProperties:c})}processConfigureOverrideRedirect(e,t,n,s,i){this.emit("moveResizeWindow",{wid:e,dimension:[s,i],position:[t,n]})}processShowNotification(e,t,n,s,i,r,c,d,l,u,h){this.emit("showNotification",{id:t,replacesId:s,expires:d,actions:u,hints:h,icon:l?Q(l[0],l[3]):null,summary:r,body:c})}processCloseNotification(e){this.emit("hideNotification",e)}processBell(){this.options.bell&&new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()}processInitiateMoveResize(e,t,n,s,i,r){this.emit("initiateMoveResize",{wid:e,position:[t,n],direction:s,button:i,sourceIndication:r})}processSendFile(e,t,n,s,i){if(i.length!==s){console.warn("XpraConnection#processSendFile","Invalid length for",e);return}const r=new Blob([i],t);this.emit("sendFile",{filename:e,mime:t,size:s,blob:r,print:n})}processSoundData(e,t,n,s){try{if(!this.options.audio||!this.audio.validate(e))return;n["start-of-stream"]===1&&this.audio.start(),t&&t.length>0&&this.audio.addQueue(t,s),n["end-of-stream"]===1&&this.audio.stop()}catch(i){console.error("XpraConnection#processSoundData",i),this.audio.stop()}}async processClipboardToken(e,t,n,s,i,r,c){if(this.options.clipboard){arguments.length>=7&&(this.clipboardBuffer[e]=[c,s,i,r]);const d=this.capabilities["clipboard.preferred-targets"];if(n&&d.includes(n)){let u=c;s.match(/text|string/i)?(u instanceof Uint8Array&&(u=Ee(u)),await Ce(u)):s==="image/png"&&i==8&&r=="bytes"&&await Ce(c,s)}}}processSetClipboardEnabled(e){this.options.clipboard=!!e}async processClipboardRequest(e,t){const n=()=>{const s=this.clipboardBuffer.CLIPBOARD;if(s){const[i,r,c,d]=s;this.sendClipboard(e,t,i,r,c,d)}};if(this.options.clipboard){if(t!="CLIPBOARD"){this.sendClipboardString(e,t,"");return}try{const s=await Se("UTF8_STRING"),i=this.clipboardBuffer.PRIMARY;if(i&&i[1]==8&&i[2]=="bytes"&&s==i[3])n();else if(s){const[r,c]=s;this.sendClipboardString(e,t,c,r)}}catch(s){n(),console.error("XpraConnection#processClipboardRequest",s)}}}processChallenge(e,t,n,s,i){i=(i||"password").replace(/[^a-zA-Z0-9\.,:\+/]/gi,""),s=s||"xor";try{const r=on(e,n,s,this.options.password,this.options.ssl,this.options.encryption);if(r){const[c,d]=r;this.createCapabilities({challenge_response:c,challenge_client_salt:d}),this.sendHello()}}catch(r){this.disconnect(r)}}processInfoResponse(e){this.emit("infoResponse",e)}processNewTray(e,t,n,s){const i=parseInt(t),r=parseInt(n);this.emit("newTray",{id:e,metadata:s,position:[0,0],dimension:[i,r],overrideRedirect:!1,clientProperties:{}})}processPointerPosition(e,t,n){const s=parseInt(t),i=parseInt(n);this.emit("pointerPosition",{wid:e,position:[s,i]})}processEos(e){this.emit("eos",e)}processDisconnect(e){this.disconnect(new be(`Disconnected: ${e}`))}processOpenUrl(e){this.options.openUrl&&window.open(e,"_blank")}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * Original source: https://github.com/Xpra-org/xpra-html5
 */async function pn(o){switch(o.encoding){case"rgb32":case"rgb24":const[e,t]=o.dimension;return new ImageData(new Uint8ClampedArray(o.image.buffer),e,t);case"avif":case"jpeg":case"png/P":case"png/L":case"png":case"webp":const n=Q(o.encoding,o.image);return rn(n);default:console.warn("encodeXpraDrawData","Unhandled decode",o)}return null}async function hn(o,e){const t=o.getContext("2d"),[n,s]=e.position,[i,r]=e.dimension;if(t&&e.encoding!=="void")if(e.encoding==="scroll")e.image.forEach(([c,d,l,u,h,m])=>{t.drawImage(o,c,d,l,u,c+h,d+m,l,u)});else{const c=await pn(e);c&&(c instanceof ImageData?t.putImageData(c,n,s,0,0,i,r):(t.clearRect(n,s,i,r),t.drawImage(c,n,s)))}}/**
 * Xpra Typescript Client
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 *
 * ---
 *
 * Based on original Xpra source
 * Copyright (C) 2016-2022 Antoine Martin <antoine@devloop.org.uk>
 * Licensed under MPL 2.0, see: http://www.mozilla.org/MPL/2.0/
 * Original source: https://github.com/Xpra-org/xpra-html5
 */function Me(o,e){let t=5e3;if(o.overrideRedirect)t=3e4;else switch((o.metadata["window-type"]||[])[0]){case"DROPDOWN":case"TOOLTIP":case"POPUP_MENU":case"MENU":case"COMBO":t=2e4;break;case"UTILITY":case"DIALOG":t=15e3;break}return o.metadata.above?t+=5e3:o.metadata.below&&(t-=5e3),t+e}class mn{constructor(e){f(this,"windows",[]);f(this,"xpra");this.xpra=e,this.xpra.on("draw",t=>{const n=this.getWindow(t.wid);n&&(n.renderQueue.push(t),this.renderWindow(n))}),this.xpra.on("disconnect",()=>{this.clearWindows()})}onResize(e,t){const n=this.getWindow(e);if(n){const[s,i]=t;n.canvas.width!==s&&(n.canvas.width=s),n.canvas.height!==i&&(n.canvas.height=i)}}clearWindows(){this.windows=[]}createWindow(e){const[t,n]=e.dimension,s=document.createElement("canvas");s.width=t,s.height=n,this.windows.push({canvas:s,attributes:e,renderQueue:[],renderPending:0,inited:!1}),this.xpra.sendMapWindow(e)}async renderWindow(e){const t=e.renderQueue.shift();if(t&&e.canvas){try{await hn(e.canvas,t)}catch(n){t.callback(n),this.renderWindow(e);return}t.callback()}}removeWindow(e){const t=this.windows.findIndex(n=>n.attributes.id===e);t!==-1&&this.windows.splice(t,1)}updateWindow(e){const t=this.getWindow(e.id);t&&Object.assign(t.attributes,e)}moveResize(e,t,n){this.onResize(e.attributes.id,n),this.xpra.sendGeometryWindow(e.attributes.id,t,n)}mouseButton(e,t,n){const s=this.xpra.keyboard.getModifiers(t),i=this.xpra.mouse.getButton(t),r=this.xpra.mouse.getPosition(t);this.xpra.sendMouseButton(e.attributes.id,r,i,n,s)}mouseWheel(e,t){const n=this.xpra.keyboard.getModifiers(t),s=this.xpra.mouse.getPosition(t),i=this.xpra.mouse.getScroll(t);this.xpra.sendMouseWheel(e.attributes.id,i,s,n)}mouseMove(e,t){const n=e?e.attributes.id:0,s=this.xpra.keyboard.getModifiers(t),i=this.xpra.mouse.getPosition(t);this.xpra.sendMouseMove(n,i,s)}keyPress(e,t,n){const s=e?e.attributes.id:0,i=this.xpra.keyboard.getModifiers(t),{keyname:r,keycode:c,keyval:d,group:l,str:u}=this.xpra.keyboard.getKey(t);this.xpra.sendKeyAction(s,r,n,i,d,u,c,l)}raise(e){const t=this.windows.map(n=>n.attributes);this.xpra.sendWindowRaise(e.attributes.id,t)}minimize(e){this.xpra.sendUnmapWindow(e.attributes)}maximize(e,t,n){this.restore(e),this.moveResize(e,t,n)}restore(e){this.xpra.sendMapWindow(e.attributes)}close(e){this.xpra.sendCloseWindow(e.attributes.id)}getWindow(e){return this.windows.find(t=>t.attributes.id===e)||null}}/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */function fn(o){if(o){const{image:e,xhot:t,yhot:n}=o;return`transparent url('${e}') no-repeat ${t}px ${n}px`}return""}function wn(o,e=""){if(o){const{image:t,xhot:n,yhot:s}=o,i=e?`, ${e}`:"";return`url('${t}') ${n} ${s}${i}`}return e}function Ie(o,e,t){let n="";const{width:s,height:i,x:r,y:c}=o.getBoundingClientRect(),d=e[0]-r,l=e[1]-c;return l<=t?n+="n":l>=i-t&&(n+="s"),d<=t?n+="w":d>=s-t&&(n+="e"),n}function We(o){const{onDown:e,onMove:t,onRelease:n}=o();return s=>{s.preventDefault();const i=s.pageX,r=s.pageY;let c=!1;const d=u=>{const h=u.pageX-i,m=u.pageY-r;c=!0,t(u,h,m)},l=u=>{window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",l),n(u,c)};window.addEventListener("mousemove",d),window.addEventListener("mouseup",l),e&&e(s.nativeEvent,i,r)}}function Ne({opacity:o}){if(typeof o=="number")return o<0?1:o/4294967296}/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */var v=(o=>(o.SetHost="SET_HOST",o.SetShowOptions="SET_SHOW_OPTIONS",o.AddWindow="ADD_WINDOW",o.RemoveWindow="REMOVE_WINDOW",o.SetWindowIcon="SET_WINDOW_ICON",o.SetConnected="SET_CONNECTED",o.SetCursor="SET_CURSOR",o.UpdateStats="UPDATE_STATS",o.MoveResizeWindow="MOVE_RESIZE_WINDOW",o.MaximizeWindow="MAXIMIZE_WINDOW",o.UpdateMetadata="UPDATE_METADATA",o.RaiseWindow="RAISE_WINDOW",o.AddNotification="ADD_NOTIFICATION",o.RemoveNotification="REMOVE_NOTIFICATION,",o.SetDraggingWindow="SET_DRAGGING_WINDOW",o.ClearWindows="CLEAR_WINDOWS",o.SetOption="SET_OPTION",o.UpdateMenu="UPDATE_MENU",o.SetError="SET_ERROR",o.SetStarted="SET_STARTED",o))(v||{});let De=1;const pe={connect:!1,host:"ws://127.0.0.1:10000",showOptions:!1,connected:!1,cursor:null,windows:[],notifications:[],activeWindow:0,draggingWindow:-1,actualDesktopSize:[0,0],stats:w({},Ke),options:w({},se),menu:[],error:"",started:!1};function gn(o,e){var n,s;const t=(i,r)=>{const c=o.windows,d=c.find(l=>l.id===i);return d&&Object.assign(d,r(d)),M(w({},o),{windows:c})};switch(e.type){case"SET_HOST":return M(w({},o),{host:e.payload});case"SET_SHOW_OPTIONS":return M(w({},o),{showOptions:e.payload});case"ADD_WINDOW":const i=!!e.payload.metadata.tray;return M(w({},o),{activeWindow:e.payload.id,windows:[...o.windows,{id:e.payload.id,minimized:e.payload.metadata.iconic===!0,maximized:!1,title:e.payload.metadata.title||String(e.payload.id),position:e.payload.position,dimension:e.payload.dimension,minDimension:(n=e.payload.metadata["size-constraints"])==null?void 0:n["minimum-size"],maxDimension:(s=e.payload.metadata["size-constraints"])==null?void 0:s["maximum-size"],opacity:Ne(e.payload.metadata),tray:i,zIndex:i?0:Me(e.payload,++De)}]});case"REMOVE_WINDOW":const{windows:r}=o,c=r.findIndex(I=>I.id===e.payload);c!==-1&&r.splice(c,1);const d=r.length>0?r[r.length-1].id:0;return M(w({},o),{activeWindow:d,windows:r});case"SET_WINDOW_ICON":const l=e.payload;return t(l.wid,()=>({icon:l}));case"SET_CONNECTED":return M(w({},o),{started:!1,windows:e.payload?o.windows:[],connected:e.payload});case"SET_CURSOR":return M(w({},o),{cursor:e.payload});case"UPDATE_STATS":return M(w({},o),{stats:w(w({},o.stats),e.payload)});case"MOVE_RESIZE_WINDOW":const{wid:u,position:h,dimension:m}=e.payload;return t(u,I=>({position:h||I.position,dimension:m||I.dimension}));case"MAXIMIZE_WINDOW":const{maximize:g}=e.payload;return t(e.payload.wid,I=>({oldPosition:g?I.position:void 0,oldDimension:g?I.dimension:void 0,position:g?e.payload.position:I.oldPosition,dimension:g?e.payload.dimension:I.oldDimension,maximized:g}));case"UPDATE_METADATA":const{title:S,iconic:y}=e.payload.metadata;return t(e.payload.wid,I=>({opacity:Ne(e.payload.metadata),minimized:y===void 0?I.minimized:y===!0,title:S===void 0?I.title:S}));case"RAISE_WINDOW":return M(w({},t(e.payload.id,()=>({zIndex:Me(e.payload,++De)}))),{activeWindow:e.payload.id});case"ADD_NOTIFICATION":return M(w({},o),{notifications:[...o.notifications,e.payload]});case"REMOVE_NOTIFICATION,":const{notifications:C}=o,D=C.findIndex(([I])=>I.id===e.payload);return D!==-1&&C.splice(D,1),M(w({},o),{notifications:C});case"SET_DRAGGING_WINDOW":return M(w({},o),{draggingWindow:e.payload});case"CLEAR_WINDOWS":return M(w({},o),{cursor:null,windows:[],notifications:[],draggingWindow:-1});case"SET_OPTION":const[B,W]=e.payload;return M(w({},o),{options:M(w({},o.options),{[B]:W})});case"UPDATE_MENU":return M(w({},o),{menu:e.payload});case"SET_ERROR":return M(w({},o),{error:e.payload});case"SET_STARTED":return M(w({},o),{started:e.payload});default:return o}}/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const T=A.exports.createContext({wm:null,xpra:null,state:pe,root:null,setRoot:()=>{},setCursor:()=>{},dispatch:()=>{}}),An=Qe(["connect"],[],["connect","host"]),yn=nn(),bn=M(w(w({},pe),An),{options:w(w({},pe.options),yn)}),vn=({children:o,wm:e,xpra:t})=>{const[n,s]=A.exports.useReducer(gn,bn),[i,r]=A.exports.useState(null),[c,d]=A.exports.useState(null),l=()=>{s({type:v.SetConnected,payload:!0}),s({type:v.SetError,payload:""}),Notification.requestPermission()},u=p=>{s({type:v.SetConnected,payload:p!=="disconnected"}),s({type:v.ClearWindows})},h=p=>{e.createWindow(p),s({type:v.AddWindow,payload:p})},m=p=>{s({type:v.RemoveWindow,payload:p})},g=p=>s({type:v.SetWindowIcon,payload:p}),S=p=>s({type:v.UpdateStats,payload:p}),y=p=>s({type:v.SetCursor,payload:p}),C=p=>le(()=>{if(p){const{offsetWidth:k,offsetHeight:P}=p;t.sendResize(k,P)}},200),D=p=>{s({type:v.MoveResizeWindow,payload:p}),p.dimension&&e.onResize(p.wid,p.dimension)},B=p=>s({type:v.RaiseWindow,payload:e.getWindow(p).attributes}),W=p=>s({type:v.UpdateMetadata,payload:p}),I=p=>{},ie=p=>k=>{if(n.connected&&k.target===document.body)k.preventDefault(),k.stopPropagation();else return;const P=e.getWindow(p);e.keyPress(P,k,k.type==="keydown")},ee=p=>le(k=>{const P=e.getWindow(p);P&&e.mouseWheel(P,k)},100),z=async p=>{const k=await Vt(p.summary,{body:p.body,icon:p.icon||void 0});if(k){const P=()=>t.sendNotificationClose(p.id);k.addEventListener("close",P)}s({type:v.AddNotification,payload:[p,k]})},V=p=>s({type:v.RemoveNotification,payload:p}),K=p=>{p.print?Qt(p.filename,p.blob):Ge(p.filename,p.blob)},j=p=>{if(c){const[k,P]=p.position;Object.assign(c.style,{left:`${k}px`,top:`${P}px`})}},Z=()=>{},G=p=>s({type:v.SetError,payload:p}),H=p=>s({type:v.UpdateMenu,payload:p}),te=()=>s({type:v.SetStarted,payload:!0});return A.exports.useEffect(()=>(t.on("connect",l),t.on("disconnect",u),t.on("newWindow",h),t.on("removeWindow",m),t.on("windowIcon",g),t.on("pong",S),t.on("cursor",y),t.on("moveResizeWindow",D),t.on("updateWindowMetadata",W),t.on("raiseWindow",B),t.on("initiateMoveResize",I),t.on("showNotification",z),t.on("hideNotification",V),t.on("sendFile",K),t.on("pointerPosition",j),t.on("newTray",h),t.on("eos",Z),t.on("updateXDGMenu",H),t.on("error",G),t.on("sessionStarted",te),n.connect&&t.connect(n.host,n.options),()=>{t.off("connect",l),t.off("disconnect",u),t.off("newWindow",h),t.off("removeWindow",m),t.off("windowIcon",g),t.off("pong",S),t.off("cursor",y),t.off("moveResizeWindow",D),t.off("updateWindowMetadata",W),t.off("raiseWindow",B),t.off("initiateMoveResize",I),t.off("showNotification",z),t.off("hideNotification",V),t.off("sendFile",K),t.off("pointerPosition",j),t.off("newTray",h),t.off("eos",Z),t.off("updateXDGMenu",H),t.off("error",G),t.off("sessionStarted",te)}),[]),A.exports.useEffect(()=>{const p=C(i);return t.on("sessionStarted",p),window.addEventListener("resize",p),()=>{t.off("sessionStarted",p),window.removeEventListener("resize",p)}},[i]),A.exports.useEffect(()=>{const p=ie(n.activeWindow),k=ee(n.activeWindow);return window.addEventListener("keydown",p),window.addEventListener("keyup",p),window.addEventListener("wheel",k),window.addEventListener("mousewheel",k),window.addEventListener("DOMMouseScroll",k),()=>{window.removeEventListener("keydown",p),window.removeEventListener("keyup",p),window.removeEventListener("wheel",k),window.removeEventListener("mousewheel",k),window.removeEventListener("DOMMouseScroll",k)}},[n.activeWindow]),a.createElement(T.Provider,{value:{state:n,dispatch:s,root:i,wm:e,xpra:t,setRoot:r,setCursor:d}},o)};/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const En=300,F=({toggled:o,children:e,mountOnEnter:t=!0,unmountOnExit:n=!0})=>a.createElement(ot,{in:o,timeout:En,mountOnEnter:t,unmountOnExit:n,classNames:"fade-on-out"},e);var Sn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAUdEVYdEF1dGhvcgBKYWt1YiBTdGVpbmVy5vv3LwAAADV0RVh0RGVzY3JpcHRpb24ASW52ZXJ0ZWQgdmFyaWFudCBvZiB0aGUgRE1aIGN1cnNvciB0aGVtZS5odVs8AAAAM3RFWHRTb3VyY2UAaHR0cDovL2ppbW1hYy5tdXNpY2hhbGwuY3ovdGhlbWVzLnBocD9za2luPTdQM5WxAAADwUlEQVRYhe2WTUhsZRjHf+PVcdLU48d1GkMvdwI185ZIzEYpaKttWqhcKhlFF65USjcK6equNFJbCEokiISiochQgfmBaI6CKGmg5MeIwpBXZpIRPec8LWb0Wte6c1SsRX94eDcvvD+er/8L/+sFEpFX/833o3Vd9zc3N78FxAIRdw0QKyISCAT8xcXFDuDlu4aIl5D8fr+voKDgbe44E/EiIu3t7eL3+8Xn8x3l5ua+GYIw3RlAeXm5FBUVSSAQEJ/Pd2i32x8BMbcBEVYqdV1nfn4ep9OJxWJJXFpa+t5msz0AXropRFgAmqahqiqTk5NUVVURGxtrXV1ddQFpgOUmEIYAVFVlYmKCuro6FEXJ8Hq93wE2IPq6EGEBiMgFgKqquFwuGhoaSE5Ofri/v/8t8Mp1IcIep8sAqqoyPj5Oa2srVqs1d29vbwiwAmajENcGUFWV4eFh2traSEtLy9/Z2fkGSDUKYWihXAUxMDBAZ2cn6enpjo2Nja+A+0YgDANcbsjz6O/vp6+vD7vd/t7a2tqXQAoQFQ6EIYC/NuPl6OnpYXBwkKysrPdXVla+CBfC8E6/6vHzrHR3dzM8PExOTs4HCwsLT4BkIPKfICKNAlwuAYDD4cBisWA2m4mOjmZxcZG8vDzy8/M/mpmZ+b2wsPAz4ClwZvQtCHlBSUmJABcRGRkpcXFxYrVaxe12y99J13WZnp5+Aii3lgGAsrIyxsbGUFWVrq4uent76ejo+GFoaOgns9l8bDKZxGQy6WazOSAivxJcUtfScxmora0VXdelpqZGEhISxGazyebmpni93qdAEfA6YAceAg8ILqiYWwFoaGgQXdfl9PRU9Xg8oiiKpKSkSH19vWiaJk1NTY0EvcEM3AtFBDcwqwuAxsZGERFZXFxcdzqdn2uaJtXV1aIoimRkZMjBwYEcHBx4gDe4oUM+BzA3Nye6rsvs7OwK8DFQcHR05Nna2hJFUSQ1NVVaWlpEVVWprKysIDh+t/Jtiz/v5qmpqSXgQ+ARkDw6OvpY0zSpqKiQpKQkyczMlOPjY1leXp4DXiO4hG4HYH5+/kegDMgF4ghOj+L3+/c2NjYkMTFRsrOz5fDwUNbX138OQd5KGWJ3d3e/Bt4Bsnn2LTcBUS6X6/HZ2Zlsb29LIBCQk5MTvbS0tCV017A1X6UoIJGgw8Xw57qagPiRkZFPPB7PL2632+1wOD4F3iXoA2H1wIsITQRHSQA9dF7WPYIluU/wg3oC/Ab4APWK+4YBwlEEz2ZeC8X54vrv6w+aYEf+AZkZtAAAAABJRU5ErkJggg==";/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const Cn=10,Oe=16;let Be=!1;const kn=({win:o,bar:e,winstance:t})=>{const{oldPosition:n,oldDimension:s}=o,{wm:i,xpra:r,root:c,dispatch:d}=A.exports.useContext(T),l="w-4 h-4 rounded-full cursor-pointer bg-gradient-to-b shadow-inner hover:shadow",u=m=>{m.stopPropagation(),m.preventDefault()},h=()=>{if(e.current&&c)if(o.maximized)n&&s&&(i.maximize(t,n,s),d({type:v.MaximizeWindow,payload:{wid:o.id,maximize:!1}}));else{const g=e.current.offsetHeight,S=c.offsetWidth,y=c.offsetHeight-g;i.maximize(t,[0,g],[S,y]),d({type:v.MaximizeWindow,payload:{wid:o.id,position:[0,g],dimension:[S,y],maximize:!0}})}};return a.createElement("div",{className:"flex items-center space-x-2",onMouseDown:u},a.createElement("div",{title:"Minimize",className:`${l} from-green-300 to-green-500 hover:from-green-400`,onClick:()=>i.minimize(t)}),a.createElement("div",{title:"Maximize",className:`${l} from-blue-300 to-blue-500 hover:from-blue-400`,onClick:h}),!r.isReadOnly()&&a.createElement("div",{title:"Close",className:`${l} from-red-300 to-red-500 hover:from-red-400`,onClick:()=>i.close(t)}))},je=({win:{icon:o,title:e}})=>a.createElement(a.Fragment,null,o&&a.createElement("img",{alt:e,src:o.image,className:"max-h-full"}),!o&&a.createElement("div",{className:"w-full h-full bg-gray-500 rounded"})),he=({id:o})=>{const e=A.exports.useRef(null),{wm:t,state:n}=A.exports.useContext(T),s=t.getWindow(o),i=n.draggingWindow>=0?"pointer-events-none":"",r=A.exports.useCallback(l=>{t.mouseButton(s,l,!0)},[]),c=A.exports.useCallback(l=>{t.mouseButton(s,l,!1)},[]),d=A.exports.useCallback(l=>{l.preventDefault(),l.stopPropagation(),t.mouseMove(s,l.nativeEvent)},[]);return A.exports.useEffect(()=>{e.current&&e.current.appendChild(s.canvas)},[e.current]),a.createElement("div",{ref:e,className:i,onMouseDown:r,onMouseUp:c,onMouseMove:d})},xn=({win:o})=>{var P;const{id:e,position:t,dimension:n,title:s,minimized:i,maximized:r,opacity:c,zIndex:d,minDimension:l,maxDimension:u}=o,[h,m]=A.exports.useState("default"),{wm:g,dispatch:S,xpra:y}=A.exports.useContext(T),C=A.exports.useRef(null),D=A.exports.useRef(null),B=A.exports.useRef(null),W=g.getWindow(e),I={opacity:c,zIndex:d},ie={cursor:h},ee={toggled:!i,mountOnEnter:!1,unmountOnExit:!1},z=(b,R,x,E,N=!1)=>{C.current&&Object.assign(C.current.style,{left:`${b}px`,top:`${R}px`,width:`${x}px`,height:`${E}px`}),W!=null&&W.canvas&&Object.assign(W.canvas.style,{width:`${x}px`,height:`${E}px`}),N&&S({type:v.MoveResizeWindow,payload:{wid:e,position:[b,R],dimension:[x,E]}})},V=(b=!1)=>{const[R,x]=t,[E,N]=n;z(R,x,E,N,b)},K=b=>(R,x,E,N,L)=>{const[U,X]=l||[100,100],[Je,$e]=u||[Number.MAX_VALUE,Number.MAX_VALUE];E=Math.min(Je,Math.max(U,E)),N=Math.min($e,Math.max(X,N)),b(R,x,E,N,L)},j=K((b,R,x,E)=>{!y.isReadOnly()&&!r&&z(b,R,x,E),G(!0)}),Z=K((b,R,x,E,N)=>{G(!1),!y.isReadOnly()&&!r&&(z(b,R,x,E,!0),N&&g.moveResize(W,[b,R],[x,E]))}),G=b=>{Be||S({type:v.SetDraggingWindow,payload:b?e:-1}),Be=b},H=b=>{b.preventDefault(),b.stopPropagation(),g.raise(W),S({type:v.RaiseWindow,payload:W.attributes})},te=le(b=>{if(B.current){const R=Ie(B.current,[b.pageX,b.pageY],Oe);m(`${R}-resize`)}else m("default")},Cn),p=A.exports.useCallback(We(()=>{const[b,R]=n;let[x,E]=t;return{onMove(N,L,U){x=t[0]+L,E=t[1]+U,j(x,E,b,R),G(!0)},onRelease(N,L){Z(x,E,b,R,L)}}}),[t,n]),k=A.exports.useCallback(We(()=>{let b="",[R,x]=t,[E,N]=n;return{onDown(L,U,X){B.current&&(b=Ie(B.current,[U,X],Oe))},onMove(L,U,X){b.startsWith("n")?(N=n[1]-X,x=t[1]+X):b.startsWith("s")&&(N=n[1]+X),b.endsWith("w")?(E=n[0]-U,R=t[0]+U):b.endsWith("e")&&(E=n[0]+U),j(R,x,E,N)},onRelease(L,U){Z(R,x,E,N,U)}}}),[B,t,n]);return A.exports.useEffect(()=>{V()},[t,n]),A.exports.useEffect(()=>{V()},[C]),A.exports.useEffect(()=>{const[b,R]=t,[x,E]=n;y.isReadOnly()||(b<=0||R<=0)&&(g.moveResize(W,[100,100],[x,E]),z(100,100,x,E,!0))},[]),(P=W==null?void 0:W.attributes)!=null&&P.overrideRedirect?a.createElement(F,w({},ee),a.createElement("div",{className:"absolute bg-black cursor-default shadow",ref:C,style:I,onMouseDown:H},a.createElement(he,{id:e}))):a.createElement(F,w({},ee),a.createElement("div",{ref:C,style:I,className:"absolute",onMouseDown:H,onMouseMove:te},a.createElement("div",{ref:B,className:"absolute z-10 -left-2 -top-10 -bottom-2 -right-2",style:ie,onMouseDown:k}),a.createElement("div",{className:"relative w-full h-full z-20 outline outline-1 outline-gray-200 shadow-xl"},a.createElement("div",{className:"absolute -top-8 w-full flex items-center p-1 px-2 h-8 space-x-2 outline outline-1 outline-gray-200 bg-gray-100 cursor-default",ref:D,onMouseDown:p},a.createElement("div",{className:"flex items-center justify-center",style:{width:"16px",height:"16px"}},a.createElement(je,{win:o})),a.createElement("div",{className:"flex-grow truncate text-sm"},a.createElement("span",null,s||e)),a.createElement(kn,{winstance:W,win:o,bar:D,outer:C})),a.createElement("div",{className:"xpra-window-canvas w-full h-full bg-black"},a.createElement(he,{id:e})))))},Rn=({children:o})=>{const e=A.exports.createRef(),t=A.exports.createRef(),{wm:n,state:s,setRoot:i,setCursor:r}=A.exports.useContext(T),c=m=>{n.mouseMove(null,m.nativeEvent)},d=m=>{m.preventDefault()},l=w({dimension:[32,32],xhot:8,yhot:3,image:Sn},s.cursor||{}),u=`
.xpra-cursor {
  background: ${fn(l)};
}

.xpra-window-canvas {
  cursor: ${wn(s.cursor,"default")};
}
`,h=s.windows.filter(m=>!m.tray);return A.exports.useEffect(()=>{e.current&&i(e.current)},[e.current]),A.exports.useEffect(()=>{t.current&&r(t.current)},[t.current]),a.createElement(a.Fragment,null,a.createElement("div",{id:"xpra-desktop",className:"absolute inset-0 z-30 overflow-hidden bg-gradient-to-br from-emerald-500 via-emerald-300 to-emerald-500",ref:e,onMouseMove:c,onContextMenu:d},s.connected&&h.map(m=>a.createElement(xn,{key:m.id,win:m})),o),a.createElement("div",{ref:t,className:"xpra-cursor absolute z-50"}),a.createElement("style",null,u))};/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */let Ze=1;const Mn=({disabled:o,label:e,value:t,required:n,options:s,onChange:i})=>{const r=`xpra_${++Ze}`,c="rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed";return a.createElement("div",null,e&&a.createElement("label",{htmlFor:r},e),a.createElement("div",null,a.createElement("select",{className:c,id:r,required:n,disabled:o,defaultValue:t,onChange:i},Object.entries(s).map(([d,l])=>a.createElement("option",{key:d,value:d},l)))))},_=({children:o,disabled:e,label:t,type:n,transparent:s,onClick:i})=>{let r="flex items-center justify-center relative rounded w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed hover:outline hover:outline-1";return s?r+=" border border border-transparent":r+=" bg-white border border-black-100",a.createElement("button",{className:r,disabled:e,type:n||"button",onClick:i},t||o)},de=({disabled:o,label:e,value:t,type:n,placeholder:s,required:i,onChange:r})=>{const c=`xpra_${++Ze}`,d="rounded bg-white border border-black-100 w-full p-1 disabled:opacity-20 disabled:cursor-not-allowed";return a.createElement("div",null,e&&a.createElement("label",{htmlFor:c},e),a.createElement("div",null,a.createElement("input",{type:n||"text",className:d,id:c,placeholder:s,required:i,disabled:o,defaultValue:t,onInput:r})))},O=({label:o,value:e,onChange:t})=>a.createElement("div",{className:"select-none"},a.createElement("label",{className:"inline-flex items-center space-x-2 cursor-pointer"},a.createElement("input",{type:"checkbox",defaultChecked:e,onChange:t}),a.createElement("span",null,o)));/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */const In=["shadow-lg","bg-emerald-100/50","opacity-90","rounded"],He=(...o)=>o.join(" "),qe=({items:o,onCallback:e=()=>{},root:t=!0})=>{const n=A.exports.useRef(null),[s,i]=A.exports.useState(-1),r=["max-h-96","max-w-xs"];t?r.push("top-full","left-0"):r.push("top-0","left-full","overflow-auto");const c=u=>i(u),d=()=>i(-1),l=u=>{u&&u(),e()};if(t){const u=h=>{if(n.current){const m=h.target;m&&(n.current.contains(m)||m===n.current.parentNode)||l()}};A.exports.useEffect(()=>(document.addEventListener("click",u),()=>{document.removeEventListener("click",u)}),[n])}return a.createElement("div",{ref:n,className:He("absolute","shadow","bg-emerald-100/80",...r),onMouseLeave:d},o.map(({icon:u,title:h,items:m,callback:g},S)=>a.createElement("div",{key:S,className:"relative text-left"},a.createElement("div",{className:"p-2 hover:bg-white truncate flex space-x-2 items-center",onClick:()=>l(g),onMouseOver:()=>c(S)},u&&a.createElement("img",{src:u,className:"w-4 h-4"}),a.createElement("span",null,h)),s===S&&m&&m.length>0&&a.createElement(qe,{root:!1,items:m}))))},fe=({classNames:o,children:e})=>{const t=He("absolute","z-50",...In,...o);return a.createElement("div",{className:t},e)},Wn=()=>{const{xpra:o,state:e,dispatch:t}=A.exports.useContext(T),n=e.showOptions?"Hide options":"Show options",s=(h,m)=>t({type:v.SetOption,payload:[h,m]}),i=[{key:"reconnect",label:"Automatically reconnect",component:O},{key:"shareSession",label:"Share Session",component:O},{key:"stealSession",label:"Steal Session",component:O},{key:"clipboard",label:"Clipboard",component:O},{key:"clipboardImages",label:"Clipboard Images",component:O},{key:"fileTransfer",label:"File Transfer",component:O},{key:"printing",label:"Printing",component:O},{key:"bell",label:"Bell",component:O},{key:"notifications",label:"Notifications",component:O},{key:"openUrl",label:"Open URLs",component:O},{key:"audio",label:"Audio",component:O},{key:"showStartMenu",label:"XDG Menu",component:O},{key:"swapKeys",label:"Swap Ctrl and Cmd key",component:O},{key:"reverseScrollX",label:"Reverse X scroll",component:O},{key:"reverseScrollY",label:"Reverse Y scroll",component:O},{key:"keyboardLayout",label:"Keyboard Layout",component:Mn,options:It}].map(h=>M(w({},h),{value:e.options[h.key],onChange:m=>s(h.key,m.target.value)})),r=h=>t({type:v.SetHost,payload:h.target.value}),c=h=>s("username",h.target.value),d=h=>s("password",h.target.value),l=h=>{h.preventDefault(),t({type:v.SetError,payload:""}),o.connect(e.host,e.options)},u=()=>t({type:v.SetShowOptions,payload:!e.showOptions});return a.createElement(fe,{classNames:["p-8","top-1/2","left-1/2 transform","-translate-x-1/2","-translate-y-1/2","w-96","max-w-full","max-h-full","overflow-auto"]},a.createElement("form",{className:"space-y-4",onSubmit:l},a.createElement("div",{className:"space-y-2"},a.createElement(de,{required:!0,placeholder:"Host",value:e.host,onChange:r}),a.createElement("div",{className:"flex space-x-2"},a.createElement(de,{placeholder:"Username",value:e.options.username,onChange:c}),a.createElement(de,{type:"password",placeholder:"Password",value:e.options.password,onChange:d}))),e.error&&a.createElement("div",{className:"bg-red-300 border border-red-500 text-red-500 p-2 rounded"},e.error),a.createElement("div",{className:"flex space-x-2"},a.createElement(_,{label:"Connect",type:"submit"}),a.createElement(_,{label:n,onClick:u})),a.createElement(F,{toggled:e.showOptions},a.createElement("div",{className:"px-2 text-sm"},i.map(S=>{var y=S,{component:h,key:m}=y,g=ae(y,["component","key"]);const C=h;return a.createElement(C,w({key:m},g))})))))},Nn=()=>{const{state:o}=A.exports.useContext(T),e=[["Last server ping",o.stats.lastServerPing],["Last client echo",o.stats.lastClientEcho],["Client ping latency",o.stats.clientPingLatency],["Server ping latency",o.stats.serverPingLatency],["Server load",o.stats.serverLoad.join(" / ")],["Window count",o.windows.length]];return a.createElement("div",{className:"absolute bottom-1 left-1 p-1 z-0 opacity-50 bg-emerald-100 rounded"},a.createElement("table",{className:"text-xs"},a.createElement("tbody",null,e.map(([t,n])=>a.createElement("tr",{key:t},a.createElement("td",{className:"p-1"},t),a.createElement("td",{className:"p-1 text-right text-gray-500"},n))))))},Dn=()=>{const{wm:o,state:e,dispatch:t,xpra:n}=A.exports.useContext(T),[s,i]=A.exports.useState(!1),r=e.windows.filter(y=>y.minimized),c=e.windows.filter(y=>y.tray),d=[...e.menu.map(y=>({title:y.name,icon:y.icon,items:y.entries.map(C=>({title:C.name,icon:C.icon,callback:()=>{n.sendStartCommand(C.name,C.exec,!1)}}))})),{title:"Server",items:[{title:"Shutdown server",callback:()=>{confirm("Are you sure you want to shut down the server ?")&&n.sendShutdown()}}]}],l=()=>n.disconnect(),u=y=>C=>{C.stopPropagation(),C.preventDefault();const D=o.getWindow(y.id);D&&(o.restore(D),o.raise(D),t({type:v.RaiseWindow,payload:D.attributes}))},h=()=>i(!s),m=()=>{i(!1)},g=()=>n.pollClipboard(),S=async()=>{(await Yt()).forEach(({buffer:C,name:D,size:B,type:W})=>n.sendFile(D,W,B,C))};return a.createElement(fe,{classNames:["top-1","left-1/2","-translate-x-1/2","p-1","select-none"]},a.createElement("div",{className:"flex space-x-4 px-2"},a.createElement("div",{className:"flex space-x-1"},e.menu.length>0&&a.createElement(_,{transparent:!0,onClick:h},a.createElement("i",{className:"fa fa-bars pointer-events-none"}),a.createElement(F,{toggled:s},a.createElement(qe,{items:d,onCallback:m}))),a.createElement(_,{transparent:!0,onClick:l},a.createElement("i",{className:"fa fa-unlink"})),e.options.clipboard&&a.createElement(_,{transparent:!0,onClick:g},a.createElement("i",{className:"fa fa-clipboard"})),e.options.fileTransfer&&a.createElement(_,{transparent:!0,onClick:S},a.createElement("i",{className:"fa fa-upload"}))),r.length>0&&a.createElement("div",{className:"flex space-x-1"},r.map(y=>a.createElement(_,{key:y.id,transparent:!0,onClick:u(y)},a.createElement("div",{className:"flex space-x-1 items-center",style:{maxWidth:"128px"}},a.createElement("div",{className:"w-4 h-4"},a.createElement(je,{win:y})),a.createElement("div",{className:"truncate text-center text-sm"},y.title))))),c.length>0&&a.createElement("div",{className:"flex space-x-1"},c.map(y=>a.createElement("div",{key:y.id,className:"flex space-x-1 items-center"},a.createElement("div",{className:"flex items-center justify-center w-4 h-4 overflow-hidden",title:y.title},a.createElement(he,{id:y.id})))))))},On=()=>{const{state:o,xpra:e}=A.exports.useContext(T),t=()=>e.disconnect();return a.createElement(fe,{classNames:["p-8","top-1/2","left-1/2 transform","-translate-x-1/2","-translate-y-1/2","w-96"]},a.createElement("div",{className:"space-y-4"},a.createElement("div",{className:"text-center"},"Connecting to ",o.host),a.createElement("div",null,a.createElement(_,{onClick:t},"Cancel"))))};/**
 * Xpra Typescript Client React UI
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */function Bn(){const{state:o}=A.exports.useContext(T);return a.createElement(a.Fragment,null,a.createElement(F,{toggled:!o.connected},a.createElement(Wn,null)),a.createElement(F,{toggled:!o.started&&o.connected},a.createElement(On,null)),a.createElement(Rn,null,o.connected&&a.createElement(Nn,null)),a.createElement(F,{toggled:o.started},a.createElement(Dn,null)))}function Pn({xpra:o,wm:e}){return a.createElement(vn,{wm:e,xpra:o},a.createElement(Bn,null))}function Un(){return new Worker("assets/webworker.c83fb137.js",{type:"module"})}/**
 * Xpra Typescript Client Example
 * @link https://github.com/andersevenrud/xpra-html5-client
 * @author Anders Evenrud <andersevenrud@gmail.com>
 * @license Mozilla Public License Version 2.0
 */async function Tn(){const o=document.querySelector("#app"),e=new Un,t=new un(e),n=new mn(t);await t.init(),o&&st.render(A.exports.createElement(Pn,{xpra:t,wm:n}),o),window.xpra={xpra:t}}window.addEventListener("DOMContentLoaded",()=>{Tn()});
//# sourceMappingURL=index.c23b9350.js.map
